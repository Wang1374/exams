{"version":3,"sources":["webpack:///./node_modules/@textbus/core/bundles/lib/root-component.js","webpack:///./node_modules/rxjs/_esm5/internal/util/hostReportError.js","webpack:///./node_modules/rxjs/_esm5/internal/symbol/iterator.js","webpack:///./node_modules/rxjs/_esm5/internal/Subscriber.js","webpack:///./node_modules/rxjs/_esm5/internal/util/subscribeToPromise.js","webpack:///./node_modules/rxjs/_esm5/internal/util/subscribeToIterable.js","webpack:///./node_modules/rxjs/_esm5/internal/util/subscribeToObservable.js","webpack:///./node_modules/rxjs/_esm5/internal/util/subscribeTo.js","webpack:///./node_modules/rxjs/_esm5/internal/observable/of.js","webpack:///./node_modules/rxjs/_esm5/internal/operators/debounceTime.js","webpack:///./node_modules/rxjs/_esm5/internal/BehaviorSubject.js","webpack:///./node_modules/@textbus/core/bundles/lib/editor-controller.js","webpack:///./node_modules/rxjs/_esm5/internal/observable/fromArray.js","webpack:///./node_modules/@textbus/core/bundles/lib/_es-hack.js","webpack:///./node_modules/rxjs/_esm5/internal/scheduled/scheduleArray.js","webpack:///./node_modules/@tanbo/di/bundles/esm/core/utils/stringify.js","webpack:///./node_modules/@tanbo/di/bundles/esm/core/utils/inject-error.js","webpack:///./node_modules/@tanbo/di/bundles/esm/core/annotations.js","webpack:///./node_modules/@tanbo/di/bundles/esm/core/decorators.js","webpack:///./node_modules/@tanbo/di/bundles/esm/core/forward-ref.js","webpack:///./node_modules/@tanbo/di/bundles/esm/core/injectable.js","webpack:///./node_modules/@tanbo/di/bundles/esm/core/injection-token.js","webpack:///./node_modules/@tanbo/di/bundles/esm/core/injector.js","webpack:///./node_modules/@tanbo/di/bundles/esm/core/null-injector.js","webpack:///./node_modules/@tanbo/di/bundles/esm/core/metadata.js","webpack:///./node_modules/@tanbo/di/bundles/esm/core/reflective-provider.js","webpack:///./node_modules/@tanbo/di/bundles/esm/core/reflective-injector.js","webpack:///./node_modules/rxjs/_esm5/internal/SubjectSubscription.js","webpack:///./node_modules/rxjs/_esm5/internal/Subject.js","webpack:///./node_modules/rxjs/_esm5/internal/symbol/rxSubscriber.js","webpack:///./node_modules/rxjs/_esm5/internal/util/isObject.js","webpack:///./node_modules/@textbus/core/bundles/public-api.js","webpack:///./node_modules/@textbus/core/bundles/lib/output-translator.js","webpack:///./node_modules/rxjs/_esm5/internal/scheduler/Action.js","webpack:///./node_modules/rxjs/_esm5/internal/scheduler/AsyncAction.js","webpack:///./node_modules/rxjs/_esm5/internal/Scheduler.js","webpack:///./node_modules/rxjs/_esm5/internal/scheduler/AsyncScheduler.js","webpack:///./node_modules/rxjs/_esm5/internal/scheduler/async.js","webpack:///./node_modules/rxjs/_esm5/internal/observable/fromEvent.js","webpack:///./node_modules/@textbus/core/bundles/lib/inject-tokens.js","webpack:///./node_modules/rxjs/_esm5/internal/config.js","webpack:///./node_modules/rxjs/_esm5/internal/util/isArray.js","webpack:///./node_modules/@textbus/core/bundles/lib/editor.js","webpack:///./node_modules/@textbus/core/bundles/lib/i18n/i18n.js","webpack:///./node_modules/@textbus/core/bundles/lib/history.js","webpack:///./node_modules/rxjs/_esm5/internal/util/identity.js","webpack:///./node_modules/reflect-metadata/Reflect.js","webpack:///./node_modules/tslib/tslib.es6.js","webpack:///./node_modules/rxjs/_esm5/internal/util/isScheduler.js","webpack:///./node_modules/@textbus/core/bundles/lib/component-injectors.js","webpack:///./node_modules/rxjs/_esm5/internal/util/UnsubscriptionError.js","webpack:///./node_modules/rxjs/_esm5/internal/Subscription.js","webpack:///./node_modules/rxjs/_esm5/internal/operators/mergeMap.js","webpack:///./node_modules/rxjs/_esm5/internal/operators/mergeAll.js","webpack:///./node_modules/rxjs/_esm5/internal/observable/merge.js","webpack:///./node_modules/rxjs/_esm5/internal/util/noop.js","webpack:///./node_modules/rxjs/_esm5/internal/operators/tap.js","webpack:///./node_modules/rxjs/_esm5/internal/symbol/observable.js","webpack:///./node_modules/@textbus/core/bundles/lib/_utils/make-error.js","webpack:///./node_modules/rxjs/_esm5/internal/innerSubscribe.js","webpack:///./node_modules/rxjs/_esm5/internal/scheduled/scheduleObservable.js","webpack:///./node_modules/rxjs/_esm5/internal/scheduled/schedulePromise.js","webpack:///./node_modules/rxjs/_esm5/internal/scheduled/scheduleIterable.js","webpack:///./node_modules/rxjs/_esm5/internal/util/isInteropObservable.js","webpack:///./node_modules/rxjs/_esm5/internal/util/isIterable.js","webpack:///./node_modules/rxjs/_esm5/internal/scheduled/scheduled.js","webpack:///./node_modules/rxjs/_esm5/internal/observable/from.js","webpack:///./node_modules/rxjs/_esm5/internal/util/isFunction.js","webpack:///./node_modules/rxjs/_esm5/internal/util/isArrayLike.js","webpack:///./node_modules/rxjs/_esm5/internal/Observer.js","webpack:///./node_modules/rxjs/_esm5/internal/util/canReportError.js","webpack:///./node_modules/rxjs/_esm5/internal/util/toSubscriber.js","webpack:///./node_modules/rxjs/_esm5/internal/util/pipe.js","webpack:///./node_modules/rxjs/_esm5/internal/Observable.js","webpack:///./node_modules/rxjs/_esm5/internal/operators/map.js","webpack:///./node_modules/rxjs/_esm5/internal/util/ObjectUnsubscribedError.js","webpack:///./node_modules/@textbus/core/bundles/lib/i18n/en_US.js","webpack:///./node_modules/@textbus/core/bundles/lib/i18n/zh_CN.js","webpack:///./node_modules/@textbus/core/bundles/lib/ui/_utils/tab.js","webpack:///./node_modules/@textbus/core/bundles/lib/ui/_utils/uikit.js","webpack:///./node_modules/@textbus/core/bundles/lib/ui/iframe-html.js","webpack:///./node_modules/@textbus/core/bundles/lib/ui/layout.js","webpack:///./node_modules/@textbus/core/bundles/lib/ui/plugins/control-panel.plugin.js","webpack:///./node_modules/@textbus/core/bundles/lib/ui/plugins/dialog.plugin.js","webpack:///./node_modules/@textbus/core/bundles/lib/ui/plugins/message.plugin.js","webpack:///./node_modules/@textbus/core/bundles/lib/ui/file-uploader.js","webpack:///./node_modules/rxjs/_esm5/internal/operators/filter.js","webpack:///./node_modules/@textbus/core/bundles/lib/ui/input.js","webpack:///./node_modules/rxjs/_esm5/internal/util/subscribeToArray.js","webpack:///./node_modules/rxjs/_esm5/internal/util/isPromise.js","webpack:///./node_modules/@textbus/core/bundles/lib/core/di/component.js","webpack:///./node_modules/@textbus/core/bundles/lib/core/di/component-setter.js","webpack:///./node_modules/@textbus/core/bundles/lib/core/di/dynamic-keymap.js","webpack:///./node_modules/@textbus/core/bundles/lib/core/di/interceptor.js","webpack:///./node_modules/@textbus/core/bundles/lib/core/di/markdown-support.js","webpack:///./node_modules/@textbus/core/bundles/lib/core/contents.js","webpack:///./node_modules/@textbus/core/bundles/lib/core/format-data.js","webpack:///./node_modules/@textbus/core/bundles/lib/core/formatter.js","webpack:///./node_modules/@textbus/core/bundles/lib/core/format-map.js","webpack:///./node_modules/@textbus/core/bundles/lib/core/marker.js","webpack:///./node_modules/@textbus/core/bundles/lib/core/fragment.js","webpack:///./node_modules/@textbus/core/bundles/lib/core/element.js","webpack:///./node_modules/@textbus/core/bundles/lib/core/component.js","webpack:///./node_modules/@textbus/core/bundles/lib/core/renderer.js","webpack:///./node_modules/@textbus/core/bundles/lib/core/output-renderer.js","webpack:///./node_modules/@textbus/core/bundles/lib/core/parser.js","webpack:///./node_modules/@textbus/core/bundles/lib/core/range.js","webpack:///./node_modules/@textbus/core/bundles/lib/core/selection.js","webpack:///./node_modules/rxjs/_esm5/internal/operators/sampleTime.js"],"names":["RootComponent_1","__decorate","decorators","target","key","desc","d","c","arguments","length","r","Object","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","__metadata","k","v","metadata","__param","paramIndex","decorator","RootComponentInterceptor","selection","input","rootComponent","editorController","this","contentSnapshot","formatterSnapshot","Map","recordSnapshotFromEditingBefore","startIndex","selectionSnapshot","firstRange","latestFragment","forEach","append","mergeFormats","index","value","replace","str","test","s","insert","isEmptyFragment","remove","endIndex","selectionStart","last","getContentAtIndex","commonAncestorFragment","from","rootFragment","startFragment","afterContent","block","event","clipboardFragment","data","fragment","contents","sliceContents","isEmpty","hasBlockComponent","map","includes","len","formats","getFormatKeys","push","getFormatRanges","f","firstContent","isSingleComponent","parentComponent","parentFragment","indexOf","contentLength","insertAfter","isAllBlock","reverse","ranges","range","deleteRange","delete","formatRanges","formatRange","_a","apply","assign","formatData","clone","effect","clear","token","set","_b","RootComponent","RootComponentLoader","node","component","slotsMap","toSlot","slot","super","isOutputMode","slotRenderFn","tagName","renderFn","loader","providers","provide","useClass","styles","hostReportError","err","setTimeout","getSymbolIterator","Symbol","iterator","Subscriber","_super","destinationOrNext","error","complete","_this","call","syncErrorValue","syncErrorThrown","syncErrorThrowable","isStopped","destination","add","SafeSubscriber","prototype","create","next","subscriber","_next","_error","_complete","unsubscribe","closed","_unsubscribeAndRecycle","_parentOrParents","_parentSubscriber","observerOrNext","context","bind","_context","useDeprecatedSynchronousErrorHandling","__tryOrSetError","__tryOrUnsub","wrappedComplete","fn","parent","Error","_unsubscribe","subscribeToPromise","promise","then","subscribeToIterable","iterable","item","done","return","subscribeToObservable","obj","obs","subscribe","TypeError","subscribeTo","result","isArrayLike","subscribeToArray","isPromise","isObject","msg","of","args","_i","scheduler","pop","debounceTime","dueTime","source","lift","DebounceTimeOperator","DebounceTimeSubscriber","debouncedSubscription","lastValue","hasValue","clearDebounce","schedule","dispatchNext","debouncedNext","BehaviorSubject","_value","get","getValue","enumerable","configurable","_subscribe","subscription","hasError","thrownError","ObjectUnsubscribedError","Subject","status","stateChangeEvent","onStateChange","asObservable","b","supportMarkdown","dispatch","readonly","sourcecodeMode","fromArray","HackInput","scheduleArray","sub","stringify","Array","isArray","join","name","res","toString","newLineIndex","substring","makeInjectError","madeProvideScopeError","Annotations","classes","props","methods","params","keys","has","makeParamDecorator","propertyKey","parameterIndex","annotations","getAnnotations","pushParamMetadata","makeClassDecorator","setClassMetadata","paramTypes","getMetadata","hasOwnProperty","__annotations__","ForwardRef","forwardRefFn","forwardRef","Injectable","InjectableDecorator","options","provideIn","InjectionToken","description","InjectFlags","Injector","THROW_IF_NOT_FOUND","__debug_value__","nullInjectorErrorFn","parentInjector","notFoundValue","Inject","Self","SkipSelf","Optional","normalizeProvider","provider","useValue","normalizeValueProviderFactory","normalizeClassProviderFactory","useExisting","normalizeExistingProviderFactory","useFactory","normalizeFactoryProviderFactory","normalizeConstructorProviderFactory","normalizeTypeProviderFactory","scope","deps","normalizeDeps","resolvedClass","resolveClassParams","injector","cacheFn","cachedInstance","instance","propMetadataKeys","getPropMetadataKeys","propsMetadata","getPropMetadata","contextCallback","construct","getClassMetadata","metadataKeys","getParamMetadata","dep","injectKey","optional","visibility","reflectiveInjectorErrorFn","provideScopeError","staticProviders","recordValues","normalizedProviders","flags","Default","normalizedProvider","generateFactory","factory","resolveDeps","reflectiveValue","tryValue","injectToken","getRef","SubjectSubscription","subject","observers","subscriberIndex","splice","Subscription","SubjectSubscriber","rxSubscriber","operator","copy","slice","_trySubscribe","EMPTY","observable","Observable","AnonymousSubject","Math","random","x","OutputTranslator","HTMLOutputTranslator","singleTagTest","RegExp","singleTags","vDom","childNodes","child","vDomToHTMLString","xssFilter","simpleXSSFilter","replaceEmpty","text","textContent","filter","undefined","toLowerCase","attrValue","attrs","attrName","attrStr","childHTML","split","symbolTransfer","Action","work","state","delay","AsyncAction","pending","id","recycleAsyncId","requestAsyncId","setInterval","flush","clearInterval","execute","_execute","errored","errorValue","e","actions","Scheduler","SchedulerAction","now","Date","AsyncScheduler","delegate","active","scheduled","action","shift","asyncScheduler","fromEvent","eventName","resultSelector","pipe","handler","setupSubscription","sourceObj","isEventTarget","source_1","addEventListener","removeEventListener","isJQueryStyleEventEmitter","source_2","on","off","isNodeStyleEventEmitter","source_3","addListener","removeListener","EDITOR_OPTIONS","EDITABLE_DOCUMENT","_enable_super_gross_mode_that_will_cause_bad_things","config","Promise","stack","editorErrorFn","Editor","selector","stateController","defaultPlugins","readyState","tasks","readyEvent","subs","changeEvent","container","document","querySelector","HTMLElement","onReady","onChange","i18n","rootInjector","layout","setTheme","theme","contentDocument","bootstrap","init","appendChild","html","resolve","run","parser","parse","parserHTML","scroller","scrollTop","updateDocHeight","iframe","workbench","getOutputComponentMetadata","outputTranslator","outputRenderer","content","transform","render","links","styleSheets","scripts","json","toJSON","destroy","plugins","p","onDestroy","removeChild","getReferencedComponents","annotation","Set","cssMin","getComponentCollection","collection","fragments","slots","instances","constructor","renderer","restore","ev","sourceElement","focusNode","findFocusNode","position","getPositionByNode","createRange","addRange","setStart","collapse","onViewUpdated","dom","listen","setup","onSave","addKeymap","keymap","ctrlKey","record","customPlugins","body","componentAnnotations","components","setDocStyle","formatters","componentInjectors","editorInjector","message","upload","type","currentValue","rangeCount","findLastPosition","setPosition","uploader","customInjector","componentInjector","markdownSupport","markdownGrammarInterceptor","addMarkdownSupport","componentStyles","editModeStyles","link","linkEle","createElement","head","docStyles","styleEl","innerHTML","editingStyleSheets","resizeObserver","ResizeObserver","observe","childBody","lastChild","height","nodeType","Node","ELEMENT_NODE","getBoundingClientRect","bottom","div","style","max","offsetHeight","parentNode","trim","I18n_1","I18n","defaultConfig","customConfig","path","tokens","customValue","getLabelByTokens","template","values","TBHistory_1","historyErrorFn","TBHistory","historySequence","historyIndex","historyChangeEvent","historyUsedEvent","historyStackSize","onUsed","canBack","snapshot","cloneHistoryData","usePaths","paths","canForward","stateChangeSubscription","stopListen","recordSnapshot","snapshotSubscription","getRangePaths","getPaths","collapsed","startPaths","endPaths","endFragment","findPosition","getSlotAtIndex","nativeRange","nativeSelection","getRangeAt","start","setEnd","end","removeAllRanges","Document","identity","root","global","self","Function","exporter","makeExporter","previous","writable","hasOwn","supportsSymbol","toPrimitiveSymbol","toPrimitive","iteratorSymbol","supportsCreate","supportsProto","__proto__","downLevel","HashMap","MakeDictionary","functionPrototype","getPrototypeOf","usePolyfill","process","_Map","entries","CreateMapPolyfill","_Set","CreateSetPolyfill","_WeakMap","WeakMap","CreateWeakMapPolyfill","Metadata","attributes","IsUndefined","IsArray","IsConstructor","DecorateConstructor","IsObject","IsNull","ToPropertyKey","DecorateProperty","metadataKey","metadataValue","IsPropertyKey","OrdinaryDefineOwnMetadata","defineMetadata","hasMetadata","OrdinaryHasMetadata","hasOwnMetadata","OrdinaryHasOwnMetadata","OrdinaryGetMetadata","getOwnMetadata","OrdinaryGetOwnMetadata","getMetadataKeys","OrdinaryMetadataKeys","getOwnMetadataKeys","OrdinaryOwnMetadataKeys","deleteMetadata","metadataMap","GetOrCreateMetadataMap","size","targetMetadata","decorated","descriptor","O","P","Create","MetadataKey","OrdinaryGetPrototypeOf","ToBoolean","MetadataValue","ownKeys","parentKeys","ownKeys_1","hasKey","parentKeys_1","keysObj","GetIterator","IteratorStep","nextValue","IteratorValue","IteratorClose","Type","IsSymbol","ToPrimitive","PreferredType","hint","exoticToPrim","GetMethod","OrdinaryToPrimitive","toString_1","IsCallable","valueOf","toString_2","argument","ToString","V","func","method","iterResult","proto","prototypeProto","cacheSentinel","arraySentinel","MapIterator","_index","_keys","_values","_selector","throw","_cacheKey","_cacheIndex","_find","getKey","getEntry","_","_map","UUID_SIZE","rootKey","CreateUniqueKey","_key","table","GetOrCreateWeakMapTable","CreateUUID","FillRandomBytes","buffer","GenRandomBytes","Uint8Array","crypto","getRandomValues","msCrypto","offset","byte","__","extendStatics","setPrototypeOf","__extends","isScheduler","ComponentInjectors","injectors","componentConstruct","_c","_d","UnsubscriptionErrorImpl","errors","UnsubscriptionError","_subscriptions","_ctorUnsubscribe","parent_1","isFunction","flattenUnsubscriptionErrors","concat","teardown","tmp","subscriptions","subscriptionIndex","empty","reduce","errs","mergeMap","project","concurrent","Number","POSITIVE_INFINITY","a","ii","MergeMapOperator","observer","MergeMapSubscriber","hasCompleted","_tryNext","_innerSub","ish","innerSubscriber","innerSubscription","innerSubscribe","notifyNext","innerValue","notifyComplete","mergeAll","merge","observables","noop","tap","nextOrObserver","DoOperator","TapSubscriber","_tapNext","_tapError","_tapComplete","makeError","SimpleInnerSubscriber","notifyError","SimpleOuterSubscriber","scheduleObservable","schedulePromise","scheduleIterable","isInteropObservable","isIterable","canReportError","closed_1","toSubscriber","pipeFromArray","fns","prev","_isScalar","sink","console","warn","promiseCtor","getPromiseCtor","reject","operations","toPromise","thisArg","MapOperator","MapSubscriber","count","ObjectUnsubscribedErrorImpl","i18n_zh_CN","editor","noUploader","paste","cut","selectAll","noAccessClipboard","controlPanel","cancelFixed","fixed","elementRef","children","btnWrapper","viewContainer","btns","btn","createTextNode","label","classList","view","el","setAttribute","onCreated","iframeHTML","_topBar","_bottomBar","isAppendTop","isAppendBottom","onReadyEvent","createEditableFrame","onMessage","window","ready","dashboard","leftContainer","viewer","pageContainer","docContainer","loading","t","rightContainer","prepend","src","domain","location","origin","scrolling","_fixed","oldViews","tab","insertBefore","fixedBtn","title","views","show","tabs","timer","dialogWrapper","close","element","clearTimeout","messageBox","time","createMessage","tip","FileUploader","predicate","FilterOperator","FilterSubscriber","isWindows","navigator","userAgent","isMac","history","_readonly","pasteMiddlewares","markdownMatchers","keymaps","cursor","inputWrap","_display","flashing","customContextmenuActions","prevComponent","contextmenu","initEvent","bindDefaultKeymap","dispatchInputReadyEvent","hide","disabled","middleware","unshift","startContainer","updateCursorPosition","focus","rect","getRangePosition","fontSize","lineHeight","color","getComputedStyle","top","isNaN","parseFloat","boxHeight","left","backgroundColor","limit","paddingTop","parseInt","cursorTop","viewTop","isWriting","button","getSelection","focusOffset","isCollapsed","iconClasses","makeContextmenu","pageX","pageY","y","preventDefault","reg","metaKey","shiftKey","altKey","markdownConfig","matchKey","some","activeFragmentContents","matchContent","match","componentFactory","clean","hasMatched","invokeKeymaps","dispatchEvent","dynamicKeymap","keymapActions","updateStateBySelection","dispatchComponentPresetEvent","commonAncestorComponent","actionGroups","interceptor","onContextmenu","dispatchInputEvent","clipboardData","getData","cssText","files","all","reader","FileReader","onload","readAsDataURL","urls","handlePaste","contentEditable","hasEmpty","onDelete","stopped","onDeleteRange","onEnter","toPrevious","toNext","toPreviousLine","toNextLine","back","forward","currentRangePosition","previousRangePosition","abs","nextRangePosition","onInput","showPanels","createView","setter","prevContent","keepInputContent","onInputReady","onPaste","prevPromise","nextMiddleware","newDOM","invokeFn","permissions","query","clipboard","read","items","types","getType","blob","innerText","danger","execCommand","display","toggleShowHide","eventFromSelf","groups","menus","clientWidth","documentElement","clientHeight","menuWidth","menuHeight","maxHeight","itemCount","autoRecordingHistory","array","Component","ComponentDecorator","define","ComponentSetter","DynamicKeymap","TBEvent","_stopped","Interceptor","MarkdownSupport","elements","n","lastChildIndex","fragmentStartIndex","fragmentEndIndex","min","cc","discardedContents","parentFragmentAccessToken","newContents","FormatData","tag","equalMap","equalStringList","right","FormatEffect","FormatterPriority","rule","priority","inheritValidators","validators","excludeValidators","extendTags","makeTagsMatcher","tags","makeStyleMatcher","makeAttrsMatcher","excludeStyles","excludeAttrs","Invalid","exclude","Exclude","inherit","Inherit","Valid","getAttribute","styleName","nodeName","attr","hasAttribute","optionValue","styleValue","InlineFormatter","BlockFormatter","formatter","important","oldFormats","newFormatMarks","first","fill","newFormatRange","mark","equal","ff","_dirty","_changed","_outputDirty","_outputChanged","markAsChanged","parentComponentAccessToken","fragmentErrorFn","formatMap","eventMap","_clean","markAsDirtied","_apply","insertAdjacentInlineFormat","_append","ref","insertFragment","_insert","selfFormatMap","discardedFormatMap","format","_e","newFormatMap","coverChild","componentInstance","getContext","splitFormatMap","format2","gourdComponentInSelf","lineFormatRange","cacheFormats","newFormat","VTextNode","vElementErrorFn","_childNodes","unbindFns","destroyEvent","listeners","className","class","deleteProperty","attrs2","addChild","newNodes","newNode","oldNode","mapToJSON","nativeNode","listenKey","callback","BrComponent_1","canDispatchDataChange","canDispatchContentChange","componentDataChange","componentContentChange","Proxy","receiver","dirty","deletedValue","iteratorIndex","slotCount","callbackFn","deleteCount","deletedSlots","LeafAbstractComponent","BrComponentLoader","nativeVDomMapping","vDomNativeMapping","rendererErrorFn","host","rendingEvent","viewUpdateEvent","vDomPositionMapping","fragmentVDomMapping","fragmentContentContainerMapping","rendererVNodeMap","NVMappingTable","componentVDomCacheMap","onRendingBefore","changed","rendingComponent","oldVDom","diffAndUpdate","patch","getNativeNodeByVDom","getComponentRootVNode","oldNativeNode","abandonedNativeNode","nativeChildNodes","oldChild","forceUpdate","childFormats","containerFormats","formatSeparate","rendingSlotFormats","rendingContents","rendered","isDirty","newVDom","isEqual","newNativeNode","replaceChild","destroyVDom","onRendered","vElement","slotRender","contentContainer","rendingFragment","slotView","replaceSlotView","oldView","newView","componentRootView","vEle","newVElement","textNode","createVDOMByExtractContent","progenyFormats","cloneRange","calculatePriority","sort","formatRangeConfigList","equalClasses","outputRendererErrorFn","outputDirty","outputRendered","outputChanged","componentLoaders","DOMParser","parseFromString","parseHTML","rootSlot","readComponent","viewData","readFormats","TEXT_NODE","maps","startPosition","endPosition","endContainer","commonAncestorContainer","startOffset","endOffset","getCommonAncestorFragment","getCommonAncestorComponent","info","findFocusNodeAndOffset","startChildFragment","endChildFragment","startChildComponent","endChildComponent","getSelectedScope","rangeMark","getScopes","findExpandedStartIndex","findExpandedEndIndex","scopes","newScope","childFragment","getExpandedScope","currentContent","getPreviousPosition","getNextPosition","deleteEmptyTree","prevPosition","startContent","afterContents","recordPath","endFragmentIsCommon","selectedScopes","firstScope","deleteSelectedScope","findPath","parentData","endFragmentInDoc","findFirstPosition","getCommonAncestorFragmentScope","canDelete","toEnd","findLastChild","cacheFragment","fragmentIndex","componentIndex","current","nextContent","startLeft","range2","oldPosition","isToPrevLine","loopCount","minLeft","minTop","oldLeft","rect2","isToNextLine","maxRight","firstFragment","lastFragment","offsetNode","isInsertBefore","span","ownerDocument","startParentComponent","endParentComponent","startFragmentPosition","endFragmentPosition","childSlots","startComponent","endComponent","findFocusNativeTextNode","toLeft","getPositionByVDom","findComponentNativeNode","getVElementByFragment","getComponentRootNativeNode","childPosition","CursorMoveDirection","selectionChange","_ranges","selectionChangeEvent","isChanged","oldCursorPosition","startFocusNode","endFocusNode","startNextSibling","nextSibling","endNextSibling","getCommonFragment","getCommonComponent","startNativeRange","endNativeRange","lastRange","moveCursor","Left","Right","Up","Down","syncNative","selectAllChildren","depth","tree","firstComponents","arr","firstFragments","direction","cleanOldCursorTimer","getPreviousLinePosition","getNextLinePosition","sampleTime","period","SampleTimeOperator","SampleTimeSubscriber","dispatchNotification"],"mappings":"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","file":"js/chunk-21e49f0c.cbffcf9a.js","sourcesContent":["var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nvar RootComponent_1;\r\nimport { forwardRef, Inject, Injectable } from '@tanbo/di';\r\nimport { AbstractComponent, Component, DivisionAbstractComponent, Fragment, InlineFormatter, LeafAbstractComponent, Interceptor, TBSelection, VElement, BrComponent, } from './core/_api';\r\nimport { HackInput } from './_es-hack';\r\nimport { EditorController } from './editor-controller';\r\nlet RootComponentInterceptor = class RootComponentInterceptor {\r\n    constructor(selection, input, rootComponent, editorController) {\r\n        this.selection = selection;\r\n        this.input = input;\r\n        this.editorController = editorController;\r\n        this.contentSnapshot = [];\r\n        this.formatterSnapshot = new Map();\r\n        this.rootComponent = rootComponent; // \r\n    }\r\n    onInputReady() {\r\n        this.recordSnapshotFromEditingBefore();\r\n    }\r\n    onInput() {\r\n        const selection = this.selection;\r\n        const startIndex = this.selectionSnapshot.firstRange.startIndex;\r\n        const latestFragment = new Fragment();\r\n        const contentSnapshot = this.contentSnapshot;\r\n        contentSnapshot.forEach(i => latestFragment.append(i));\r\n        this.mergeFormats(latestFragment);\r\n        const input = this.input;\r\n        let index = 0;\r\n        input.value.replace(/\\n+|[^\\n]+/g, (str) => {\r\n            if (/\\n+/.test(str)) {\r\n                for (let i = 0; i < str.length; i++) {\r\n                    const s = new BrComponent();\r\n                    latestFragment.insert(s, index + startIndex);\r\n                    index++;\r\n                }\r\n            }\r\n            else {\r\n                latestFragment.insert(str, startIndex + index);\r\n                index += str.length;\r\n            }\r\n            return str;\r\n        });\r\n        const isEmptyFragment = contentSnapshot.length === 1 && contentSnapshot[0] instanceof BrComponent;\r\n        if (isEmptyFragment && latestFragment.length > 1) {\r\n            latestFragment.remove(latestFragment.length - 1);\r\n        }\r\n        selection.firstRange.startIndex = selection.firstRange.endIndex = startIndex + input.selectionStart;\r\n        const last = latestFragment.getContentAtIndex(latestFragment.length - 1);\r\n        if (startIndex + input.selectionStart === latestFragment.length &&\r\n            last instanceof BrComponent) {\r\n            latestFragment.append(new BrComponent(), true);\r\n        }\r\n        selection.commonAncestorFragment.from(latestFragment);\r\n    }\r\n    onEnter() {\r\n        const firstRange = this.selection.firstRange;\r\n        const rootFragment = firstRange.startFragment;\r\n        rootFragment.insert(new BrComponent(), firstRange.startIndex);\r\n        firstRange.startIndex = firstRange.endIndex = firstRange.startIndex + 1;\r\n        const afterContent = rootFragment.getContentAtIndex(firstRange.startIndex);\r\n        if (typeof afterContent === 'string') {\r\n            return;\r\n        }\r\n        if (firstRange.startIndex === rootFragment.length ||\r\n            afterContent instanceof LeafAbstractComponent && afterContent.block ||\r\n            afterContent instanceof AbstractComponent && !(afterContent instanceof LeafAbstractComponent)) {\r\n            rootFragment.insert(new BrComponent(), firstRange.startIndex);\r\n        }\r\n    }\r\n    onPaste(event) {\r\n        const firstRange = this.selection.firstRange;\r\n        const clipboardFragment = event.data.fragment;\r\n        const fragment = firstRange.startFragment;\r\n        const contents = clipboardFragment.sliceContents();\r\n        const isEmpty = fragment.length === 0 || fragment.length === 1 && fragment.getContentAtIndex(0) instanceof BrComponent;\r\n        const hasBlockComponent = contents.map(i => {\r\n            return i instanceof AbstractComponent && !(i instanceof LeafAbstractComponent);\r\n        }).includes(true);\r\n        if (!hasBlockComponent) {\r\n            const len = clipboardFragment.length;\r\n            const formats = [];\r\n            if (isEmpty && firstRange.startIndex === 0) {\r\n                fragment.getFormatKeys().forEach(key => {\r\n                    formats.push(...fragment.getFormatRanges(key));\r\n                });\r\n            }\r\n            fragment.insert(clipboardFragment, firstRange.startIndex);\r\n            formats.forEach(f => f.startIndex = 0);\r\n            firstRange.startIndex = firstRange.endIndex = firstRange.startIndex + len;\r\n            return;\r\n        }\r\n        const firstContent = clipboardFragment.getContentAtIndex(0);\r\n        const isSingleComponent = clipboardFragment.length === 1 &&\r\n            firstContent instanceof AbstractComponent &&\r\n            !(firstContent instanceof LeafAbstractComponent);\r\n        const parentComponent = fragment.parentComponent;\r\n        const parentFragment = parentComponent.parentFragment;\r\n        if (!parentFragment) {\r\n            fragment.insert(clipboardFragment, firstRange.startIndex);\r\n            return;\r\n        }\r\n        const index = parentFragment.indexOf(parentComponent);\r\n        if (isEmpty && isSingleComponent) {\r\n            parentFragment.insert(firstContent, index);\r\n            return;\r\n        }\r\n        const contentLength = fragment.length;\r\n        if (isSingleComponent &&\r\n            (firstRange.endIndex === contentLength || firstRange.endIndex === contentLength - 1 && fragment.getContentAtIndex(contentLength - 1) instanceof BrComponent)) {\r\n            parentFragment.insertAfter(firstContent, parentComponent);\r\n            return;\r\n        }\r\n        const isAllBlock = !contents.map(i => {\r\n            return i instanceof AbstractComponent && !(i instanceof LeafAbstractComponent);\r\n        }).includes(false);\r\n        if (isAllBlock && isEmpty) {\r\n            contents.reverse().forEach(c => {\r\n                parentFragment.insert(c, index);\r\n            });\r\n            return;\r\n        }\r\n        const len = clipboardFragment.length;\r\n        fragment.insert(clipboardFragment, firstRange.startIndex);\r\n        firstRange.startIndex = firstRange.endIndex = firstRange.startIndex + len;\r\n    }\r\n    onDeleteRange() {\r\n        this.selection.ranges.forEach(range => {\r\n            range.deleteRange();\r\n        });\r\n    }\r\n    onDelete() {\r\n        this.selection.ranges.forEach(range => {\r\n            range.delete();\r\n        });\r\n    }\r\n    mergeFormats(latestFragment) {\r\n        this.formatterSnapshot.forEach((formatRanges, key) => {\r\n            if (key instanceof InlineFormatter) {\r\n                formatRanges.forEach(formatRange => {\r\n                    var _a;\r\n                    latestFragment.apply(key, Object.assign(Object.assign({}, formatRange), { formatData: (_a = formatRange.formatData) === null || _a === void 0 ? void 0 : _a.clone() }));\r\n                });\r\n            }\r\n            else {\r\n                formatRanges.forEach(formatRange => {\r\n                    var _a;\r\n                    latestFragment.apply(key, {\r\n                        get startIndex() {\r\n                            return 0;\r\n                        },\r\n                        get endIndex() {\r\n                            return latestFragment.length;\r\n                        },\r\n                        effect: formatRange.effect,\r\n                        formatData: (_a = formatRange.formatData) === null || _a === void 0 ? void 0 : _a.clone()\r\n                    });\r\n                });\r\n            }\r\n        });\r\n    }\r\n    recordSnapshotFromEditingBefore() {\r\n        this.selectionSnapshot = this.selection.clone();\r\n        const commonAncestorFragment = this.selectionSnapshot.commonAncestorFragment;\r\n        this.contentSnapshot = commonAncestorFragment.sliceContents();\r\n        this.formatterSnapshot.clear();\r\n        commonAncestorFragment.getFormatKeys().forEach(token => {\r\n            this.formatterSnapshot.set(token, commonAncestorFragment.getFormatRanges(token).map(formatRange => {\r\n                var _a, _b;\r\n                if (token instanceof InlineFormatter) {\r\n                    return Object.assign(Object.assign({}, formatRange), { formatData: (_a = formatRange.formatData) === null || _a === void 0 ? void 0 : _a.clone() });\r\n                }\r\n                return {\r\n                    startIndex: 0,\r\n                    endIndex: formatRange.endIndex,\r\n                    effect: formatRange.effect,\r\n                    formatData: (_b = formatRange.formatData) === null || _b === void 0 ? void 0 : _b.clone()\r\n                };\r\n            }));\r\n        });\r\n    }\r\n};\r\nRootComponentInterceptor = __decorate([\r\n    Injectable(),\r\n    __param(0, Inject(forwardRef(() => TBSelection))),\r\n    __param(1, Inject(forwardRef(() => HackInput))),\r\n    __param(2, Inject(forwardRef(() => RootComponent))),\r\n    __param(3, Inject(forwardRef(() => EditorController))),\r\n    __metadata(\"design:paramtypes\", [TBSelection,\r\n        HackInput, Object, EditorController])\r\n], RootComponentInterceptor);\r\nclass RootComponentLoader {\r\n    match() {\r\n        return false;\r\n    }\r\n    read(node) {\r\n        const component = new RootComponent();\r\n        return {\r\n            component,\r\n            slotsMap: [{\r\n                    toSlot: component.slot,\r\n                    from: node\r\n                }]\r\n        };\r\n    }\r\n}\r\nlet RootComponent = RootComponent_1 = class RootComponent extends DivisionAbstractComponent {\r\n    constructor() {\r\n        super('body');\r\n    }\r\n    clone() {\r\n        const component = new RootComponent_1();\r\n        component.slot.from(this.slot.clone());\r\n        return component;\r\n    }\r\n    slotRender(isOutputMode, slotRenderFn) {\r\n        return slotRenderFn(this.slot, new VElement(this.tagName));\r\n    }\r\n    render(isOutputMode, renderFn) {\r\n        return renderFn(this.slot);\r\n    }\r\n};\r\nRootComponent = RootComponent_1 = __decorate([\r\n    Component({\r\n        loader: new RootComponentLoader(),\r\n        providers: [{\r\n                provide: Interceptor,\r\n                useClass: RootComponentInterceptor\r\n            }],\r\n        styles: [\r\n            `body{word-break: break-word;}`\r\n        ]\r\n    }),\r\n    Injectable(),\r\n    __metadata(\"design:paramtypes\", [])\r\n], RootComponent);\r\nexport { RootComponent };\r\n//# sourceMappingURL=root-component.js.map","/** PURE_IMPORTS_START  PURE_IMPORTS_END */\nexport function hostReportError(err) {\n    setTimeout(function () { throw err; }, 0);\n}\n//# sourceMappingURL=hostReportError.js.map\n","/** PURE_IMPORTS_START  PURE_IMPORTS_END */\nexport function getSymbolIterator() {\n    if (typeof Symbol !== 'function' || !Symbol.iterator) {\n        return '@@iterator';\n    }\n    return Symbol.iterator;\n}\nexport var iterator = /*@__PURE__*/ getSymbolIterator();\nexport var $$iterator = iterator;\n//# sourceMappingURL=iterator.js.map\n","/** PURE_IMPORTS_START tslib,_util_isFunction,_Observer,_Subscription,_internal_symbol_rxSubscriber,_config,_util_hostReportError PURE_IMPORTS_END */\nimport * as tslib_1 from \"tslib\";\nimport { isFunction } from './util/isFunction';\nimport { empty as emptyObserver } from './Observer';\nimport { Subscription } from './Subscription';\nimport { rxSubscriber as rxSubscriberSymbol } from '../internal/symbol/rxSubscriber';\nimport { config } from './config';\nimport { hostReportError } from './util/hostReportError';\nvar Subscriber = /*@__PURE__*/ (function (_super) {\n    tslib_1.__extends(Subscriber, _super);\n    function Subscriber(destinationOrNext, error, complete) {\n        var _this = _super.call(this) || this;\n        _this.syncErrorValue = null;\n        _this.syncErrorThrown = false;\n        _this.syncErrorThrowable = false;\n        _this.isStopped = false;\n        switch (arguments.length) {\n            case 0:\n                _this.destination = emptyObserver;\n                break;\n            case 1:\n                if (!destinationOrNext) {\n                    _this.destination = emptyObserver;\n                    break;\n                }\n                if (typeof destinationOrNext === 'object') {\n                    if (destinationOrNext instanceof Subscriber) {\n                        _this.syncErrorThrowable = destinationOrNext.syncErrorThrowable;\n                        _this.destination = destinationOrNext;\n                        destinationOrNext.add(_this);\n                    }\n                    else {\n                        _this.syncErrorThrowable = true;\n                        _this.destination = new SafeSubscriber(_this, destinationOrNext);\n                    }\n                    break;\n                }\n            default:\n                _this.syncErrorThrowable = true;\n                _this.destination = new SafeSubscriber(_this, destinationOrNext, error, complete);\n                break;\n        }\n        return _this;\n    }\n    Subscriber.prototype[rxSubscriberSymbol] = function () { return this; };\n    Subscriber.create = function (next, error, complete) {\n        var subscriber = new Subscriber(next, error, complete);\n        subscriber.syncErrorThrowable = false;\n        return subscriber;\n    };\n    Subscriber.prototype.next = function (value) {\n        if (!this.isStopped) {\n            this._next(value);\n        }\n    };\n    Subscriber.prototype.error = function (err) {\n        if (!this.isStopped) {\n            this.isStopped = true;\n            this._error(err);\n        }\n    };\n    Subscriber.prototype.complete = function () {\n        if (!this.isStopped) {\n            this.isStopped = true;\n            this._complete();\n        }\n    };\n    Subscriber.prototype.unsubscribe = function () {\n        if (this.closed) {\n            return;\n        }\n        this.isStopped = true;\n        _super.prototype.unsubscribe.call(this);\n    };\n    Subscriber.prototype._next = function (value) {\n        this.destination.next(value);\n    };\n    Subscriber.prototype._error = function (err) {\n        this.destination.error(err);\n        this.unsubscribe();\n    };\n    Subscriber.prototype._complete = function () {\n        this.destination.complete();\n        this.unsubscribe();\n    };\n    Subscriber.prototype._unsubscribeAndRecycle = function () {\n        var _parentOrParents = this._parentOrParents;\n        this._parentOrParents = null;\n        this.unsubscribe();\n        this.closed = false;\n        this.isStopped = false;\n        this._parentOrParents = _parentOrParents;\n        return this;\n    };\n    return Subscriber;\n}(Subscription));\nexport { Subscriber };\nvar SafeSubscriber = /*@__PURE__*/ (function (_super) {\n    tslib_1.__extends(SafeSubscriber, _super);\n    function SafeSubscriber(_parentSubscriber, observerOrNext, error, complete) {\n        var _this = _super.call(this) || this;\n        _this._parentSubscriber = _parentSubscriber;\n        var next;\n        var context = _this;\n        if (isFunction(observerOrNext)) {\n            next = observerOrNext;\n        }\n        else if (observerOrNext) {\n            next = observerOrNext.next;\n            error = observerOrNext.error;\n            complete = observerOrNext.complete;\n            if (observerOrNext !== emptyObserver) {\n                context = Object.create(observerOrNext);\n                if (isFunction(context.unsubscribe)) {\n                    _this.add(context.unsubscribe.bind(context));\n                }\n                context.unsubscribe = _this.unsubscribe.bind(_this);\n            }\n        }\n        _this._context = context;\n        _this._next = next;\n        _this._error = error;\n        _this._complete = complete;\n        return _this;\n    }\n    SafeSubscriber.prototype.next = function (value) {\n        if (!this.isStopped && this._next) {\n            var _parentSubscriber = this._parentSubscriber;\n            if (!config.useDeprecatedSynchronousErrorHandling || !_parentSubscriber.syncErrorThrowable) {\n                this.__tryOrUnsub(this._next, value);\n            }\n            else if (this.__tryOrSetError(_parentSubscriber, this._next, value)) {\n                this.unsubscribe();\n            }\n        }\n    };\n    SafeSubscriber.prototype.error = function (err) {\n        if (!this.isStopped) {\n            var _parentSubscriber = this._parentSubscriber;\n            var useDeprecatedSynchronousErrorHandling = config.useDeprecatedSynchronousErrorHandling;\n            if (this._error) {\n                if (!useDeprecatedSynchronousErrorHandling || !_parentSubscriber.syncErrorThrowable) {\n                    this.__tryOrUnsub(this._error, err);\n                    this.unsubscribe();\n                }\n                else {\n                    this.__tryOrSetError(_parentSubscriber, this._error, err);\n                    this.unsubscribe();\n                }\n            }\n            else if (!_parentSubscriber.syncErrorThrowable) {\n                this.unsubscribe();\n                if (useDeprecatedSynchronousErrorHandling) {\n                    throw err;\n                }\n                hostReportError(err);\n            }\n            else {\n                if (useDeprecatedSynchronousErrorHandling) {\n                    _parentSubscriber.syncErrorValue = err;\n                    _parentSubscriber.syncErrorThrown = true;\n                }\n                else {\n                    hostReportError(err);\n                }\n                this.unsubscribe();\n            }\n        }\n    };\n    SafeSubscriber.prototype.complete = function () {\n        var _this = this;\n        if (!this.isStopped) {\n            var _parentSubscriber = this._parentSubscriber;\n            if (this._complete) {\n                var wrappedComplete = function () { return _this._complete.call(_this._context); };\n                if (!config.useDeprecatedSynchronousErrorHandling || !_parentSubscriber.syncErrorThrowable) {\n                    this.__tryOrUnsub(wrappedComplete);\n                    this.unsubscribe();\n                }\n                else {\n                    this.__tryOrSetError(_parentSubscriber, wrappedComplete);\n                    this.unsubscribe();\n                }\n            }\n            else {\n                this.unsubscribe();\n            }\n        }\n    };\n    SafeSubscriber.prototype.__tryOrUnsub = function (fn, value) {\n        try {\n            fn.call(this._context, value);\n        }\n        catch (err) {\n            this.unsubscribe();\n            if (config.useDeprecatedSynchronousErrorHandling) {\n                throw err;\n            }\n            else {\n                hostReportError(err);\n            }\n        }\n    };\n    SafeSubscriber.prototype.__tryOrSetError = function (parent, fn, value) {\n        if (!config.useDeprecatedSynchronousErrorHandling) {\n            throw new Error('bad call');\n        }\n        try {\n            fn.call(this._context, value);\n        }\n        catch (err) {\n            if (config.useDeprecatedSynchronousErrorHandling) {\n                parent.syncErrorValue = err;\n                parent.syncErrorThrown = true;\n                return true;\n            }\n            else {\n                hostReportError(err);\n                return true;\n            }\n        }\n        return false;\n    };\n    SafeSubscriber.prototype._unsubscribe = function () {\n        var _parentSubscriber = this._parentSubscriber;\n        this._context = null;\n        this._parentSubscriber = null;\n        _parentSubscriber.unsubscribe();\n    };\n    return SafeSubscriber;\n}(Subscriber));\nexport { SafeSubscriber };\n//# sourceMappingURL=Subscriber.js.map\n","/** PURE_IMPORTS_START _hostReportError PURE_IMPORTS_END */\nimport { hostReportError } from './hostReportError';\nexport var subscribeToPromise = function (promise) {\n    return function (subscriber) {\n        promise.then(function (value) {\n            if (!subscriber.closed) {\n                subscriber.next(value);\n                subscriber.complete();\n            }\n        }, function (err) { return subscriber.error(err); })\n            .then(null, hostReportError);\n        return subscriber;\n    };\n};\n//# sourceMappingURL=subscribeToPromise.js.map\n","/** PURE_IMPORTS_START _symbol_iterator PURE_IMPORTS_END */\nimport { iterator as Symbol_iterator } from '../symbol/iterator';\nexport var subscribeToIterable = function (iterable) {\n    return function (subscriber) {\n        var iterator = iterable[Symbol_iterator]();\n        do {\n            var item = void 0;\n            try {\n                item = iterator.next();\n            }\n            catch (err) {\n                subscriber.error(err);\n                return subscriber;\n            }\n            if (item.done) {\n                subscriber.complete();\n                break;\n            }\n            subscriber.next(item.value);\n            if (subscriber.closed) {\n                break;\n            }\n        } while (true);\n        if (typeof iterator.return === 'function') {\n            subscriber.add(function () {\n                if (iterator.return) {\n                    iterator.return();\n                }\n            });\n        }\n        return subscriber;\n    };\n};\n//# sourceMappingURL=subscribeToIterable.js.map\n","/** PURE_IMPORTS_START _symbol_observable PURE_IMPORTS_END */\nimport { observable as Symbol_observable } from '../symbol/observable';\nexport var subscribeToObservable = function (obj) {\n    return function (subscriber) {\n        var obs = obj[Symbol_observable]();\n        if (typeof obs.subscribe !== 'function') {\n            throw new TypeError('Provided object does not correctly implement Symbol.observable');\n        }\n        else {\n            return obs.subscribe(subscriber);\n        }\n    };\n};\n//# sourceMappingURL=subscribeToObservable.js.map\n","/** PURE_IMPORTS_START _subscribeToArray,_subscribeToPromise,_subscribeToIterable,_subscribeToObservable,_isArrayLike,_isPromise,_isObject,_symbol_iterator,_symbol_observable PURE_IMPORTS_END */\nimport { subscribeToArray } from './subscribeToArray';\nimport { subscribeToPromise } from './subscribeToPromise';\nimport { subscribeToIterable } from './subscribeToIterable';\nimport { subscribeToObservable } from './subscribeToObservable';\nimport { isArrayLike } from './isArrayLike';\nimport { isPromise } from './isPromise';\nimport { isObject } from './isObject';\nimport { iterator as Symbol_iterator } from '../symbol/iterator';\nimport { observable as Symbol_observable } from '../symbol/observable';\nexport var subscribeTo = function (result) {\n    if (!!result && typeof result[Symbol_observable] === 'function') {\n        return subscribeToObservable(result);\n    }\n    else if (isArrayLike(result)) {\n        return subscribeToArray(result);\n    }\n    else if (isPromise(result)) {\n        return subscribeToPromise(result);\n    }\n    else if (!!result && typeof result[Symbol_iterator] === 'function') {\n        return subscribeToIterable(result);\n    }\n    else {\n        var value = isObject(result) ? 'an invalid object' : \"'\" + result + \"'\";\n        var msg = \"You provided \" + value + \" where a stream was expected.\"\n            + ' You can provide an Observable, Promise, Array, or Iterable.';\n        throw new TypeError(msg);\n    }\n};\n//# sourceMappingURL=subscribeTo.js.map\n","/** PURE_IMPORTS_START _util_isScheduler,_fromArray,_scheduled_scheduleArray PURE_IMPORTS_END */\nimport { isScheduler } from '../util/isScheduler';\nimport { fromArray } from './fromArray';\nimport { scheduleArray } from '../scheduled/scheduleArray';\nexport function of() {\n    var args = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n    }\n    var scheduler = args[args.length - 1];\n    if (isScheduler(scheduler)) {\n        args.pop();\n        return scheduleArray(args, scheduler);\n    }\n    else {\n        return fromArray(args);\n    }\n}\n//# sourceMappingURL=of.js.map\n","/** PURE_IMPORTS_START tslib,_Subscriber,_scheduler_async PURE_IMPORTS_END */\nimport * as tslib_1 from \"tslib\";\nimport { Subscriber } from '../Subscriber';\nimport { async } from '../scheduler/async';\nexport function debounceTime(dueTime, scheduler) {\n    if (scheduler === void 0) {\n        scheduler = async;\n    }\n    return function (source) { return source.lift(new DebounceTimeOperator(dueTime, scheduler)); };\n}\nvar DebounceTimeOperator = /*@__PURE__*/ (function () {\n    function DebounceTimeOperator(dueTime, scheduler) {\n        this.dueTime = dueTime;\n        this.scheduler = scheduler;\n    }\n    DebounceTimeOperator.prototype.call = function (subscriber, source) {\n        return source.subscribe(new DebounceTimeSubscriber(subscriber, this.dueTime, this.scheduler));\n    };\n    return DebounceTimeOperator;\n}());\nvar DebounceTimeSubscriber = /*@__PURE__*/ (function (_super) {\n    tslib_1.__extends(DebounceTimeSubscriber, _super);\n    function DebounceTimeSubscriber(destination, dueTime, scheduler) {\n        var _this = _super.call(this, destination) || this;\n        _this.dueTime = dueTime;\n        _this.scheduler = scheduler;\n        _this.debouncedSubscription = null;\n        _this.lastValue = null;\n        _this.hasValue = false;\n        return _this;\n    }\n    DebounceTimeSubscriber.prototype._next = function (value) {\n        this.clearDebounce();\n        this.lastValue = value;\n        this.hasValue = true;\n        this.add(this.debouncedSubscription = this.scheduler.schedule(dispatchNext, this.dueTime, this));\n    };\n    DebounceTimeSubscriber.prototype._complete = function () {\n        this.debouncedNext();\n        this.destination.complete();\n    };\n    DebounceTimeSubscriber.prototype.debouncedNext = function () {\n        this.clearDebounce();\n        if (this.hasValue) {\n            var lastValue = this.lastValue;\n            this.lastValue = null;\n            this.hasValue = false;\n            this.destination.next(lastValue);\n        }\n    };\n    DebounceTimeSubscriber.prototype.clearDebounce = function () {\n        var debouncedSubscription = this.debouncedSubscription;\n        if (debouncedSubscription !== null) {\n            this.remove(debouncedSubscription);\n            debouncedSubscription.unsubscribe();\n            this.debouncedSubscription = null;\n        }\n    };\n    return DebounceTimeSubscriber;\n}(Subscriber));\nfunction dispatchNext(subscriber) {\n    subscriber.debouncedNext();\n}\n//# sourceMappingURL=debounceTime.js.map\n","/** PURE_IMPORTS_START tslib,_Subject,_util_ObjectUnsubscribedError PURE_IMPORTS_END */\nimport * as tslib_1 from \"tslib\";\nimport { Subject } from './Subject';\nimport { ObjectUnsubscribedError } from './util/ObjectUnsubscribedError';\nvar BehaviorSubject = /*@__PURE__*/ (function (_super) {\n    tslib_1.__extends(BehaviorSubject, _super);\n    function BehaviorSubject(_value) {\n        var _this = _super.call(this) || this;\n        _this._value = _value;\n        return _this;\n    }\n    Object.defineProperty(BehaviorSubject.prototype, \"value\", {\n        get: function () {\n            return this.getValue();\n        },\n        enumerable: true,\n        configurable: true\n    });\n    BehaviorSubject.prototype._subscribe = function (subscriber) {\n        var subscription = _super.prototype._subscribe.call(this, subscriber);\n        if (subscription && !subscription.closed) {\n            subscriber.next(this._value);\n        }\n        return subscription;\n    };\n    BehaviorSubject.prototype.getValue = function () {\n        if (this.hasError) {\n            throw this.thrownError;\n        }\n        else if (this.closed) {\n            throw new ObjectUnsubscribedError();\n        }\n        else {\n            return this._value;\n        }\n    };\n    BehaviorSubject.prototype.next = function (value) {\n        _super.prototype.next.call(this, this._value = value);\n    };\n    return BehaviorSubject;\n}(Subject));\nexport { BehaviorSubject };\n//# sourceMappingURL=BehaviorSubject.js.map\n","import { BehaviorSubject } from 'rxjs';\r\nexport class EditorController {\r\n    constructor(status) {\r\n        this.status = status;\r\n        this.stateChangeEvent = new BehaviorSubject(this.status);\r\n        this.onStateChange = this.stateChangeEvent.asObservable();\r\n    }\r\n    set supportMarkdown(b) {\r\n        this.status.supportMarkdown = b;\r\n        this.dispatch();\r\n    }\r\n    get supportMarkdown() {\r\n        return this.status.supportMarkdown;\r\n    }\r\n    set readonly(b) {\r\n        this.status.readonly = b;\r\n        this.dispatch();\r\n    }\r\n    get readonly() {\r\n        return this.status.readonly;\r\n    }\r\n    set sourceCodeMode(b) {\r\n        this.status.sourcecodeMode = b;\r\n        this.dispatch();\r\n    }\r\n    get sourceCodeMode() {\r\n        return this.status.sourcecodeMode;\r\n    }\r\n    dispatch() {\r\n        this.stateChangeEvent.next(Object.assign({}, this.status));\r\n    }\r\n}\r\n//# sourceMappingURL=editor-controller.js.map","/** PURE_IMPORTS_START _Observable,_util_subscribeToArray,_scheduled_scheduleArray PURE_IMPORTS_END */\nimport { Observable } from '../Observable';\nimport { subscribeToArray } from '../util/subscribeToArray';\nimport { scheduleArray } from '../scheduled/scheduleArray';\nexport function fromArray(input, scheduler) {\n    if (!scheduler) {\n        return new Observable(subscribeToArray(input));\n    }\n    else {\n        return scheduleArray(input, scheduler);\n    }\n}\n//# sourceMappingURL=fromArray.js.map\n","/**\r\n *  Input \r\n */\r\nexport class HackInput {\r\n}\r\n//# sourceMappingURL=_es-hack.js.map","/** PURE_IMPORTS_START _Observable,_Subscription PURE_IMPORTS_END */\nimport { Observable } from '../Observable';\nimport { Subscription } from '../Subscription';\nexport function scheduleArray(input, scheduler) {\n    return new Observable(function (subscriber) {\n        var sub = new Subscription();\n        var i = 0;\n        sub.add(scheduler.schedule(function () {\n            if (i === input.length) {\n                subscriber.complete();\n                return;\n            }\n            subscriber.next(input[i++]);\n            if (!subscriber.closed) {\n                sub.add(this.schedule());\n            }\n        }));\n        return sub;\n    });\n}\n//# sourceMappingURL=scheduleArray.js.map\n","export function stringify(token) {\r\n    if (typeof token === 'string') {\r\n        return token;\r\n    }\r\n    if (Array.isArray(token)) {\r\n        return '[' + token.map(stringify).join(', ') + ']';\r\n    }\r\n    if (token == null) {\r\n        return '' + token;\r\n    }\r\n    if (token.name) {\r\n        return `${token.name}`;\r\n    }\r\n    if (token.token) {\r\n        return `${token.token}`;\r\n    }\r\n    const res = token.toString();\r\n    if (res == null) {\r\n        return '' + res;\r\n    }\r\n    const newLineIndex = res.indexOf('\\n');\r\n    return newLineIndex === -1 ? res : res.substring(0, newLineIndex);\r\n}\r\n","import { stringify } from './stringify';\r\nexport function makeInjectError(name) {\r\n    return function injectError(token) {\r\n        const error = new Error(`No provide for \\`${stringify(token)}\\`!`);\r\n        error.name = name;\r\n        return error;\r\n    };\r\n}\r\nexport function madeProvideScopeError(name) {\r\n    return function provideError(token) {\r\n        const error = new Error(`Can not found provide scope \\`${stringify(token)}\\`!`);\r\n        error.name = name;\r\n        return error;\r\n    };\r\n}\r\n","/**\r\n *  class \r\n */\r\nexport class Annotations {\r\n    constructor() {\r\n        this.classes = new Map();\r\n        this.props = new Map();\r\n        this.methods = new Map();\r\n        this.params = new Map();\r\n    }\r\n    setClassMetadata(token, params) {\r\n        this.classes.set(token, params);\r\n    }\r\n    getClassMetadata(token) {\r\n        return this.classes.get(token);\r\n    }\r\n    getClassMetadataKeys() {\r\n        return Array.from(this.classes.keys());\r\n    }\r\n    pushParamMetadata(token, params) {\r\n        if (!this.params.has(token)) {\r\n            this.params.set(token, [params]);\r\n        }\r\n        else {\r\n            this.params.get(token).push(params);\r\n        }\r\n    }\r\n    getParamMetadata(token) {\r\n        return this.params.get(token);\r\n    }\r\n    getParamMetadataKeys() {\r\n        return Array.from(this.params.keys());\r\n    }\r\n    getPropMetadataKeys() {\r\n        return Array.from(this.props.keys());\r\n    }\r\n    pushPropMetadata(token, params) {\r\n        if (!this.props.has(token)) {\r\n            this.props.set(token, [params]);\r\n        }\r\n        else {\r\n            this.props.get(token).push(params);\r\n        }\r\n    }\r\n    getPropMetadata(token) {\r\n        return this.props.get(token);\r\n    }\r\n    pushMethodMetadata(token, params) {\r\n        if (!this.methods.has(token)) {\r\n            this.methods.set(token, [params]);\r\n        }\r\n        else {\r\n            this.methods.get(token).push(params);\r\n        }\r\n    }\r\n    getMethodMetadata(token) {\r\n        return this.methods.get(token);\r\n    }\r\n}\r\n","import { Annotations } from './annotations';\r\n/**\r\n * \r\n */\r\nexport function makeParamDecorator(token, metadata) {\r\n    return function (target, propertyKey, parameterIndex) {\r\n        const annotations = getAnnotations(target);\r\n        annotations.pushParamMetadata(token, {\r\n            propertyKey,\r\n            parameterIndex,\r\n            metadata\r\n        });\r\n    };\r\n}\r\n/**\r\n * \r\n */\r\nexport function makePropertyDecorator(token, contextCallback) {\r\n    return function (target, propertyKey) {\r\n        const annotations = getAnnotations(target.constructor);\r\n        annotations.pushPropMetadata(token, {\r\n            propertyKey,\r\n            contextCallback\r\n        });\r\n    };\r\n}\r\n/**\r\n * \r\n */\r\nexport function makeMethodDecorator(token, ...params) {\r\n    return function (target, methodName) {\r\n        const annotations = getAnnotations(target.constructor);\r\n        annotations.pushMethodMetadata(token, {\r\n            methodName,\r\n            params\r\n        });\r\n    };\r\n}\r\n/**\r\n * \r\n */\r\nexport function makeClassDecorator(token, metadata) {\r\n    return function (target) {\r\n        const annotations = getAnnotations(target);\r\n        annotations.setClassMetadata(token, {\r\n            paramTypes: Reflect.getMetadata('design:paramtypes', target),\r\n            metadata\r\n        });\r\n    };\r\n}\r\n/**\r\n * \r\n */\r\nexport function getAnnotations(target) {\r\n    if (!target.hasOwnProperty('__annotaions__')) {\r\n        const annotations = new Annotations();\r\n        Reflect.defineProperty(target, '__annotations__', {\r\n            get() {\r\n                return annotations;\r\n            }\r\n        });\r\n    }\r\n    return target.__annotations__;\r\n}\r\n","export class ForwardRef {\r\n    constructor(forwardRefFn) {\r\n        this.forwardRefFn = forwardRefFn;\r\n    }\r\n    getRef() {\r\n        return this.forwardRefFn();\r\n    }\r\n}\r\n/**\r\n * \r\n * @param fn\r\n */\r\nexport function forwardRef(fn) {\r\n    return new ForwardRef(fn);\r\n}\r\n","import { makeClassDecorator } from './decorators';\r\nexport class Scope {\r\n    constructor(name) {\r\n        this.name = name;\r\n    }\r\n    toString() {\r\n        return this.name || '[anonymous provide scope]';\r\n    }\r\n}\r\n/**\r\n * \r\n */\r\nexport const Injectable = function InjectableDecorator(options) {\r\n    if (this instanceof InjectableDecorator) {\r\n        this.provideIn = (options === null || options === void 0 ? void 0 : options.provideIn) || null;\r\n    }\r\n    else {\r\n        return makeClassDecorator(Injectable, new Injectable(options));\r\n    }\r\n};\r\n","/**\r\n *  token \r\n */\r\nexport class InjectionToken {\r\n    constructor(description) {\r\n        this.description = description;\r\n    }\r\n    toString() {\r\n        return this.description || '[anonymous injection token]';\r\n    }\r\n}\r\n","export var InjectFlags;\r\n(function (InjectFlags) {\r\n    InjectFlags[\"Default\"] = \"Default\";\r\n    InjectFlags[\"Self\"] = \"Self\";\r\n    InjectFlags[\"SkipSelf\"] = \"SkipSelf\";\r\n    InjectFlags[\"Optional\"] = \"Optional\";\r\n})(InjectFlags || (InjectFlags = {}));\r\n/**\r\n * DI \r\n */\r\nexport class Injector {\r\n}\r\n","import { Injector } from './injector';\r\nimport { makeInjectError } from './utils/_api';\r\nexport const THROW_IF_NOT_FOUND = {\r\n    __debug_value__: 'THROW_IF_NOT_FOUND'\r\n};\r\nconst nullInjectorErrorFn = makeInjectError('NullInjectorError');\r\nexport class NullInjector extends Injector {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.parentInjector = null;\r\n    }\r\n    get(token, notFoundValue = THROW_IF_NOT_FOUND) {\r\n        if (notFoundValue === THROW_IF_NOT_FOUND) {\r\n            throw nullInjectorErrorFn(token);\r\n        }\r\n        return notFoundValue;\r\n    }\r\n}\r\n","import { makeParamDecorator, makePropertyDecorator } from './decorators';\r\nimport { ForwardRef } from './forward-ref';\r\nimport { THROW_IF_NOT_FOUND } from './null-injector';\r\n/**\r\n *  token\r\n */\r\nexport const Inject = function InjectDecorator(token) {\r\n    if (this instanceof Inject) {\r\n        this.token = token;\r\n    }\r\n    else {\r\n        return makeParamDecorator(Inject, new Inject(token));\r\n    }\r\n};\r\nexport const Self = function SelfDecorator() {\r\n    if (!(this instanceof Self)) {\r\n        return makeParamDecorator(Self, new Self());\r\n    }\r\n};\r\nexport const SkipSelf = function SkipSelfDecorator() {\r\n    if (!(this instanceof SkipSelf)) {\r\n        return makeParamDecorator(SkipSelf, new SkipSelf());\r\n    }\r\n};\r\nexport const Optional = function OptionalDecorator() {\r\n    if (!(this instanceof Optional)) {\r\n        return makeParamDecorator(Optional, new Optional());\r\n    }\r\n};\r\nexport const Prop = function PropDecorator(token, notFoundValue = THROW_IF_NOT_FOUND, flags) {\r\n    if (!(this instanceof Prop)) {\r\n        return makePropertyDecorator(Prop, function (instance, propertyName, injector) {\r\n            instance[propertyName] = injector.get(token instanceof ForwardRef ? token.getRef() : token, notFoundValue, flags);\r\n        });\r\n    }\r\n};\r\n","import { InjectFlags } from './injector';\r\nimport { Inject, Optional, Self, SkipSelf } from './metadata';\r\nimport { getAnnotations } from './decorators';\r\nimport { stringify } from './utils/stringify';\r\nimport { Injectable } from './injectable';\r\nimport { InjectionToken } from './injection-token';\r\n/**\r\n *  provide\r\n * @param provider\r\n */\r\nexport function normalizeProvider(provider) {\r\n    if (provider.useValue) {\r\n        return normalizeValueProviderFactory(provider);\r\n    }\r\n    if (provider.useClass) {\r\n        return normalizeClassProviderFactory(provider);\r\n    }\r\n    if (provider.useExisting) {\r\n        return normalizeExistingProviderFactory(provider);\r\n    }\r\n    if (provider.useFactory) {\r\n        return normalizeFactoryProviderFactory(provider);\r\n    }\r\n    if (provider.provide) {\r\n        if (provider.provide instanceof InjectionToken) {\r\n            return normalizeValueProviderFactory(provider);\r\n        }\r\n        return normalizeConstructorProviderFactory(provider);\r\n    }\r\n    return normalizeTypeProviderFactory(provider);\r\n}\r\nfunction normalizeValueProviderFactory(provider) {\r\n    return {\r\n        provide: provider.provide,\r\n        scope: null,\r\n        generateFactory() {\r\n            return function () {\r\n                return provider.useValue;\r\n            };\r\n        },\r\n        deps: []\r\n    };\r\n}\r\nfunction normalizeClassProviderFactory(provider) {\r\n    let deps;\r\n    let provideIn;\r\n    if (provider.deps) {\r\n        deps = normalizeDeps(provider.provide, provider.deps);\r\n    }\r\n    else {\r\n        const resolvedClass = resolveClassParams(provider.useClass);\r\n        provideIn = resolvedClass.scope;\r\n        deps = normalizeDeps(provider.provide, resolvedClass.deps);\r\n    }\r\n    return {\r\n        provide: provider.provide,\r\n        scope: provideIn,\r\n        deps,\r\n        generateFactory(injector, cacheFn) {\r\n            return function (...args) {\r\n                if (provider.provide !== provider.useClass) {\r\n                    const cachedInstance = injector.get(provider.useClass, null, InjectFlags.Optional);\r\n                    if (cachedInstance) {\r\n                        return cachedInstance;\r\n                    }\r\n                }\r\n                const instance = new provider.useClass(...args);\r\n                const propMetadataKeys = getAnnotations(provider.useClass).getPropMetadataKeys();\r\n                propMetadataKeys.forEach(key => {\r\n                    const propsMetadata = getAnnotations(provider.useClass).getPropMetadata(key) || [];\r\n                    propsMetadata.forEach(item => {\r\n                        item.contextCallback(instance, item.propertyKey, injector);\r\n                    });\r\n                });\r\n                cacheFn(provider.provide, instance);\r\n                if (provider.provide !== provider.useClass) {\r\n                    cacheFn(provider.useClass, instance);\r\n                }\r\n                return instance;\r\n            };\r\n        }\r\n    };\r\n}\r\nfunction normalizeExistingProviderFactory(provider) {\r\n    return {\r\n        provide: provider.provide,\r\n        scope: null,\r\n        generateFactory(injector) {\r\n            return function () {\r\n                return injector.get(provider.useExisting);\r\n            };\r\n        },\r\n        deps: []\r\n    };\r\n}\r\nfunction normalizeFactoryProviderFactory(provider) {\r\n    return {\r\n        provide: provider.provide,\r\n        scope: null,\r\n        generateFactory() {\r\n            return function (...args) {\r\n                return provider.useFactory(...args);\r\n            };\r\n        },\r\n        deps: normalizeDeps(provider.provide, provider.deps || [])\r\n    };\r\n}\r\nfunction normalizeConstructorProviderFactory(provider) {\r\n    return normalizeClassProviderFactory(Object.assign(Object.assign({}, provider), { useClass: provider.provide }));\r\n}\r\nfunction normalizeTypeProviderFactory(provider) {\r\n    return normalizeClassProviderFactory({\r\n        provide: provider,\r\n        useClass: provider\r\n    });\r\n}\r\nfunction resolveClassParams(construct) {\r\n    const annotations = getAnnotations(construct);\r\n    const metadata = annotations.getClassMetadata(Injectable);\r\n    if (typeof metadata === 'undefined') {\r\n        throw new Error(`Class \\`${stringify(construct)}\\` is not injectable!`);\r\n    }\r\n    const deps = (metadata.paramTypes || []).map(i => [i]);\r\n    const metadataKeys = [Inject, Self, SkipSelf, Optional];\r\n    metadataKeys.forEach(key => {\r\n        (annotations.getParamMetadata(key) || []).forEach(item => {\r\n            deps[item.parameterIndex].push(item.metadata);\r\n        });\r\n    });\r\n    return {\r\n        scope: metadata.metadata.provideIn,\r\n        deps\r\n    };\r\n}\r\nfunction normalizeDeps(provide, deps) {\r\n    return deps.map((dep, index) => {\r\n        const r = {\r\n            injectKey: null,\r\n            optional: false,\r\n            visibility: null\r\n        };\r\n        if (!Array.isArray(dep)) {\r\n            r.injectKey = dep;\r\n        }\r\n        else {\r\n            for (let i = 0; i < dep.length; i++) {\r\n                const item = dep[i];\r\n                if (item instanceof Inject) {\r\n                    r.injectKey = item.token;\r\n                }\r\n                else if (item instanceof Self || item instanceof SkipSelf) {\r\n                    r.visibility = item;\r\n                }\r\n                else if (item instanceof Optional) {\r\n                    r.optional = true;\r\n                }\r\n                else {\r\n                    r.injectKey = item;\r\n                }\r\n            }\r\n        }\r\n        if (typeof r.injectKey === 'undefined') {\r\n            throw new Error(`The ${index} th dependent parameter type of \\`${stringify(provide)}\\` was not obtained,\r\nif the dependency is declared later, you can refer to it using \\`constructor(@Inject(forwardRef(() => [Type|InjectionToken])) paramName: [Type]) {}\\``);\r\n        }\r\n        return r;\r\n    });\r\n}\r\n","import { InjectFlags, Injector } from './injector';\r\nimport { normalizeProvider } from './reflective-provider';\r\nimport { Self, SkipSelf } from './metadata';\r\nimport { madeProvideScopeError, makeInjectError } from './utils/inject-error';\r\nimport { ForwardRef } from './forward-ref';\r\nimport { InjectionToken } from './injection-token';\r\nimport { NullInjector, THROW_IF_NOT_FOUND } from './null-injector';\r\nimport { Injectable } from './injectable';\r\nimport { getAnnotations } from './decorators';\r\nconst reflectiveInjectorErrorFn = makeInjectError('ReflectiveInjectorError');\r\nconst provideScopeError = madeProvideScopeError('ReflectiveInjectorError');\r\n/**\r\n * \r\n */\r\nexport class ReflectiveInjector extends Injector {\r\n    constructor(parentInjector, staticProviders, scope) {\r\n        super();\r\n        this.parentInjector = parentInjector;\r\n        this.staticProviders = staticProviders;\r\n        this.scope = scope;\r\n        this.recordValues = new Map();\r\n        this.normalizedProviders = staticProviders.map(provide => {\r\n            return normalizeProvider(provide);\r\n        });\r\n    }\r\n    /**\r\n     * \r\n     * @param token  token\r\n     * @param notFoundValue \r\n     * @param flags \r\n     */\r\n    get(token, notFoundValue = THROW_IF_NOT_FOUND, flags) {\r\n        var _a;\r\n        flags = flags || InjectFlags.Default;\r\n        if (flags === InjectFlags.SkipSelf) {\r\n            if (this.parentInjector) {\r\n                return this.parentInjector.get(token, notFoundValue);\r\n            }\r\n            if (notFoundValue !== THROW_IF_NOT_FOUND) {\r\n                return notFoundValue;\r\n            }\r\n            throw reflectiveInjectorErrorFn(token);\r\n        }\r\n        if (this.recordValues.has(token)) {\r\n            return this.recordValues.get(token);\r\n        }\r\n        for (let i = 0; i < this.normalizedProviders.length; i++) {\r\n            const normalizedProvider = this.normalizedProviders[i];\r\n            if (normalizedProvider.provide === token) {\r\n                return this.getValue(token, notFoundValue, normalizedProvider);\r\n            }\r\n        }\r\n        if (!(token instanceof InjectionToken)) {\r\n            const scope = (_a = getAnnotations(token).getClassMetadata(Injectable)) === null || _a === void 0 ? void 0 : _a.metadata.provideIn;\r\n            if (scope) {\r\n                const normalizedProvider = normalizeProvider(token);\r\n                if (this.scope === scope) {\r\n                    this.normalizedProviders.push(normalizedProvider);\r\n                    return this.getValue(token, notFoundValue, normalizedProvider);\r\n                }\r\n                const parentInjector = this.parentInjector;\r\n                if (!parentInjector || parentInjector instanceof NullInjector) {\r\n                    if (normalizedProvider.scope === 'root') {\r\n                        this.normalizedProviders.push(normalizedProvider);\r\n                        return this.getValue(token, notFoundValue, normalizedProvider);\r\n                    }\r\n                    if (notFoundValue !== THROW_IF_NOT_FOUND) {\r\n                        return notFoundValue;\r\n                    }\r\n                    throw provideScopeError(normalizedProvider.scope);\r\n                }\r\n            }\r\n        }\r\n        if (flags === InjectFlags.Self) {\r\n            if (notFoundValue === THROW_IF_NOT_FOUND) {\r\n                throw reflectiveInjectorErrorFn(token);\r\n            }\r\n            return notFoundValue;\r\n        }\r\n        if (this.parentInjector) {\r\n            return this.parentInjector.get(token, notFoundValue, flags === InjectFlags.Optional ? InjectFlags.Optional : InjectFlags.Default);\r\n        }\r\n        if (notFoundValue === THROW_IF_NOT_FOUND) {\r\n            throw reflectiveInjectorErrorFn(token);\r\n        }\r\n        return notFoundValue;\r\n    }\r\n    getValue(token, notFoundValue = THROW_IF_NOT_FOUND, normalizedProvider) {\r\n        const { generateFactory, deps } = normalizedProvider;\r\n        const factory = generateFactory(this, (token, value) => {\r\n            this.recordValues.set(token, value);\r\n        });\r\n        const params = this.resolveDeps(deps || [], notFoundValue);\r\n        const value = factory(...params);\r\n        this.recordValues.set(token, value);\r\n        return value;\r\n    }\r\n    /**\r\n     * \r\n     * @param deps \r\n     * @param notFoundValue \r\n     * @private\r\n     */\r\n    resolveDeps(deps, notFoundValue) {\r\n        return deps.map(dep => {\r\n            let reflectiveValue;\r\n            const tryValue = {};\r\n            const injectToken = dep.injectKey instanceof ForwardRef ? dep.injectKey.getRef() : dep.injectKey;\r\n            if (dep.visibility instanceof Self) {\r\n                reflectiveValue = this.get(injectToken, tryValue, InjectFlags.Self);\r\n            }\r\n            else if (dep.visibility instanceof SkipSelf) {\r\n                if (this.parentInjector) {\r\n                    reflectiveValue = this.parentInjector.get(injectToken, tryValue);\r\n                }\r\n                else {\r\n                    if (dep.optional) {\r\n                        if (notFoundValue === THROW_IF_NOT_FOUND) {\r\n                            return null;\r\n                        }\r\n                    }\r\n                    throw reflectiveInjectorErrorFn(injectToken);\r\n                }\r\n            }\r\n            else {\r\n                reflectiveValue = this.get(injectToken, tryValue);\r\n            }\r\n            if (reflectiveValue === tryValue) {\r\n                if (dep.optional) {\r\n                    if (notFoundValue === THROW_IF_NOT_FOUND) {\r\n                        return null;\r\n                    }\r\n                    return notFoundValue;\r\n                }\r\n                throw reflectiveInjectorErrorFn(injectToken);\r\n            }\r\n            return reflectiveValue;\r\n        });\r\n    }\r\n}\r\n","/** PURE_IMPORTS_START tslib,_Subscription PURE_IMPORTS_END */\nimport * as tslib_1 from \"tslib\";\nimport { Subscription } from './Subscription';\nvar SubjectSubscription = /*@__PURE__*/ (function (_super) {\n    tslib_1.__extends(SubjectSubscription, _super);\n    function SubjectSubscription(subject, subscriber) {\n        var _this = _super.call(this) || this;\n        _this.subject = subject;\n        _this.subscriber = subscriber;\n        _this.closed = false;\n        return _this;\n    }\n    SubjectSubscription.prototype.unsubscribe = function () {\n        if (this.closed) {\n            return;\n        }\n        this.closed = true;\n        var subject = this.subject;\n        var observers = subject.observers;\n        this.subject = null;\n        if (!observers || observers.length === 0 || subject.isStopped || subject.closed) {\n            return;\n        }\n        var subscriberIndex = observers.indexOf(this.subscriber);\n        if (subscriberIndex !== -1) {\n            observers.splice(subscriberIndex, 1);\n        }\n    };\n    return SubjectSubscription;\n}(Subscription));\nexport { SubjectSubscription };\n//# sourceMappingURL=SubjectSubscription.js.map\n","/** PURE_IMPORTS_START tslib,_Observable,_Subscriber,_Subscription,_util_ObjectUnsubscribedError,_SubjectSubscription,_internal_symbol_rxSubscriber PURE_IMPORTS_END */\nimport * as tslib_1 from \"tslib\";\nimport { Observable } from './Observable';\nimport { Subscriber } from './Subscriber';\nimport { Subscription } from './Subscription';\nimport { ObjectUnsubscribedError } from './util/ObjectUnsubscribedError';\nimport { SubjectSubscription } from './SubjectSubscription';\nimport { rxSubscriber as rxSubscriberSymbol } from '../internal/symbol/rxSubscriber';\nvar SubjectSubscriber = /*@__PURE__*/ (function (_super) {\n    tslib_1.__extends(SubjectSubscriber, _super);\n    function SubjectSubscriber(destination) {\n        var _this = _super.call(this, destination) || this;\n        _this.destination = destination;\n        return _this;\n    }\n    return SubjectSubscriber;\n}(Subscriber));\nexport { SubjectSubscriber };\nvar Subject = /*@__PURE__*/ (function (_super) {\n    tslib_1.__extends(Subject, _super);\n    function Subject() {\n        var _this = _super.call(this) || this;\n        _this.observers = [];\n        _this.closed = false;\n        _this.isStopped = false;\n        _this.hasError = false;\n        _this.thrownError = null;\n        return _this;\n    }\n    Subject.prototype[rxSubscriberSymbol] = function () {\n        return new SubjectSubscriber(this);\n    };\n    Subject.prototype.lift = function (operator) {\n        var subject = new AnonymousSubject(this, this);\n        subject.operator = operator;\n        return subject;\n    };\n    Subject.prototype.next = function (value) {\n        if (this.closed) {\n            throw new ObjectUnsubscribedError();\n        }\n        if (!this.isStopped) {\n            var observers = this.observers;\n            var len = observers.length;\n            var copy = observers.slice();\n            for (var i = 0; i < len; i++) {\n                copy[i].next(value);\n            }\n        }\n    };\n    Subject.prototype.error = function (err) {\n        if (this.closed) {\n            throw new ObjectUnsubscribedError();\n        }\n        this.hasError = true;\n        this.thrownError = err;\n        this.isStopped = true;\n        var observers = this.observers;\n        var len = observers.length;\n        var copy = observers.slice();\n        for (var i = 0; i < len; i++) {\n            copy[i].error(err);\n        }\n        this.observers.length = 0;\n    };\n    Subject.prototype.complete = function () {\n        if (this.closed) {\n            throw new ObjectUnsubscribedError();\n        }\n        this.isStopped = true;\n        var observers = this.observers;\n        var len = observers.length;\n        var copy = observers.slice();\n        for (var i = 0; i < len; i++) {\n            copy[i].complete();\n        }\n        this.observers.length = 0;\n    };\n    Subject.prototype.unsubscribe = function () {\n        this.isStopped = true;\n        this.closed = true;\n        this.observers = null;\n    };\n    Subject.prototype._trySubscribe = function (subscriber) {\n        if (this.closed) {\n            throw new ObjectUnsubscribedError();\n        }\n        else {\n            return _super.prototype._trySubscribe.call(this, subscriber);\n        }\n    };\n    Subject.prototype._subscribe = function (subscriber) {\n        if (this.closed) {\n            throw new ObjectUnsubscribedError();\n        }\n        else if (this.hasError) {\n            subscriber.error(this.thrownError);\n            return Subscription.EMPTY;\n        }\n        else if (this.isStopped) {\n            subscriber.complete();\n            return Subscription.EMPTY;\n        }\n        else {\n            this.observers.push(subscriber);\n            return new SubjectSubscription(this, subscriber);\n        }\n    };\n    Subject.prototype.asObservable = function () {\n        var observable = new Observable();\n        observable.source = this;\n        return observable;\n    };\n    Subject.create = function (destination, source) {\n        return new AnonymousSubject(destination, source);\n    };\n    return Subject;\n}(Observable));\nexport { Subject };\nvar AnonymousSubject = /*@__PURE__*/ (function (_super) {\n    tslib_1.__extends(AnonymousSubject, _super);\n    function AnonymousSubject(destination, source) {\n        var _this = _super.call(this) || this;\n        _this.destination = destination;\n        _this.source = source;\n        return _this;\n    }\n    AnonymousSubject.prototype.next = function (value) {\n        var destination = this.destination;\n        if (destination && destination.next) {\n            destination.next(value);\n        }\n    };\n    AnonymousSubject.prototype.error = function (err) {\n        var destination = this.destination;\n        if (destination && destination.error) {\n            this.destination.error(err);\n        }\n    };\n    AnonymousSubject.prototype.complete = function () {\n        var destination = this.destination;\n        if (destination && destination.complete) {\n            this.destination.complete();\n        }\n    };\n    AnonymousSubject.prototype._subscribe = function (subscriber) {\n        var source = this.source;\n        if (source) {\n            return this.source.subscribe(subscriber);\n        }\n        else {\n            return Subscription.EMPTY;\n        }\n    };\n    return AnonymousSubject;\n}(Subject));\nexport { AnonymousSubject };\n//# sourceMappingURL=Subject.js.map\n","/** PURE_IMPORTS_START  PURE_IMPORTS_END */\nexport var rxSubscriber = /*@__PURE__*/ (function () {\n    return typeof Symbol === 'function'\n        ? /*@__PURE__*/ Symbol('rxSubscriber')\n        : '@@rxSubscriber_' + /*@__PURE__*/ Math.random();\n})();\nexport var $$rxSubscriber = rxSubscriber;\n//# sourceMappingURL=rxSubscriber.js.map\n","/** PURE_IMPORTS_START  PURE_IMPORTS_END */\nexport function isObject(x) {\n    return x !== null && typeof x === 'object';\n}\n//# sourceMappingURL=isObject.js.map\n","import 'reflect-metadata';\r\nexport * from 'reflect-metadata';\r\nexport * from '@tanbo/di';\r\nexport * from './lib/_utils/make-error';\r\nexport * from './lib/i18n/_api';\r\nexport * from './lib/core/_api';\r\nexport * from './lib/ui/_api';\r\nexport * from './lib/component-injectors';\r\nexport * from './lib/editor';\r\nexport * from './lib/editor-controller';\r\nexport * from './lib/editor-options';\r\nexport * from './lib/history';\r\nexport * from './lib/inject-tokens';\r\nexport * from './lib/output-translator';\r\nexport * from './lib/plugin';\r\nexport * from './lib/root-component';\r\n//# sourceMappingURL=public-api.js.map","import { Renderer, VTextNode } from './core/_api';\r\nexport class OutputTranslator {\r\n}\r\n/**\r\n * HTML \r\n */\r\nexport class HTMLOutputTranslator {\r\n    constructor() {\r\n        this.singleTagTest = new RegExp(`^(${HTMLOutputTranslator.singleTags.join('|')})$`, 'i');\r\n    }\r\n    transform(vDom) {\r\n        return vDom.childNodes.map(child => {\r\n            return this.vDomToHTMLString(child);\r\n        }).join('');\r\n    }\r\n    vDomToHTMLString(vDom) {\r\n        const xssFilter = HTMLOutputTranslator.simpleXSSFilter;\r\n        if (vDom instanceof VTextNode) {\r\n            return Renderer.replaceEmpty(xssFilter.text(vDom.textContent), '&nbsp;');\r\n        }\r\n        const styles = Array.from(vDom.styles.keys()).filter(key => {\r\n            const v = vDom.styles.get(key);\r\n            return !(v === undefined || v === null || v === '');\r\n        }).map(key => {\r\n            const k = key.replace(/(?=[A-Z])/g, '-').toLowerCase();\r\n            return xssFilter.attrValue(`${k}:${vDom.styles.get(key)}`);\r\n        }).join(';');\r\n        const attrs = Array.from(vDom.attrs.keys()).filter(key => vDom.attrs.get(key) !== false).map(k => {\r\n            const key = xssFilter.attrName(k);\r\n            const value = vDom.attrs.get(k);\r\n            return (value === true ? `${key}` : `${key}=\"${xssFilter.attrValue(`${value}`)}\"`);\r\n        });\r\n        if (styles) {\r\n            attrs.push(`style=\"${styles}\"`);\r\n        }\r\n        if (vDom.classes && vDom.classes.length) {\r\n            attrs.push(`class=\"${xssFilter.attrValue(vDom.classes.join(' '))}\"`);\r\n        }\r\n        let attrStr = attrs.join(' ');\r\n        attrStr = attrStr ? ' ' + attrStr : '';\r\n        if (this.singleTagTest.test(vDom.tagName)) {\r\n            return `<${vDom.tagName}${attrStr}>`;\r\n        }\r\n        const childHTML = vDom.childNodes.map(child => {\r\n            return this.vDomToHTMLString(child);\r\n        }).join('');\r\n        return [\r\n            `<${vDom.tagName}${attrStr}>`,\r\n            childHTML,\r\n            `</${vDom.tagName}>`\r\n        ].join('');\r\n    }\r\n}\r\nHTMLOutputTranslator.singleTags = 'br,img,hr'.split(',');\r\nHTMLOutputTranslator.simpleXSSFilter = {\r\n    text(text) {\r\n        return text.replace(/[><&]/g, str => {\r\n            return {\r\n                '<': '&lt;',\r\n                '>': '&gt;',\r\n                '&': '&amp;'\r\n            }[str];\r\n        });\r\n    },\r\n    attrName(text) {\r\n        return this.symbolTransfer(text.replace(/=/g, ''));\r\n    },\r\n    attrValue(text) {\r\n        return this.symbolTransfer(text);\r\n    },\r\n    symbolTransfer(text) {\r\n        return text.replace(/[><\"'&/]/g, str => {\r\n            return {\r\n                '<': '&lt;',\r\n                '>': '&gt;',\r\n                '\"': '&quot;',\r\n                \"'\": '&#x27;',\r\n                '&': '&amp;',\r\n                '/': '&#x2F;'\r\n            }[str];\r\n        });\r\n    }\r\n};\r\n//# sourceMappingURL=output-translator.js.map","/** PURE_IMPORTS_START tslib,_Subscription PURE_IMPORTS_END */\nimport * as tslib_1 from \"tslib\";\nimport { Subscription } from '../Subscription';\nvar Action = /*@__PURE__*/ (function (_super) {\n    tslib_1.__extends(Action, _super);\n    function Action(scheduler, work) {\n        return _super.call(this) || this;\n    }\n    Action.prototype.schedule = function (state, delay) {\n        if (delay === void 0) {\n            delay = 0;\n        }\n        return this;\n    };\n    return Action;\n}(Subscription));\nexport { Action };\n//# sourceMappingURL=Action.js.map\n","/** PURE_IMPORTS_START tslib,_Action PURE_IMPORTS_END */\nimport * as tslib_1 from \"tslib\";\nimport { Action } from './Action';\nvar AsyncAction = /*@__PURE__*/ (function (_super) {\n    tslib_1.__extends(AsyncAction, _super);\n    function AsyncAction(scheduler, work) {\n        var _this = _super.call(this, scheduler, work) || this;\n        _this.scheduler = scheduler;\n        _this.work = work;\n        _this.pending = false;\n        return _this;\n    }\n    AsyncAction.prototype.schedule = function (state, delay) {\n        if (delay === void 0) {\n            delay = 0;\n        }\n        if (this.closed) {\n            return this;\n        }\n        this.state = state;\n        var id = this.id;\n        var scheduler = this.scheduler;\n        if (id != null) {\n            this.id = this.recycleAsyncId(scheduler, id, delay);\n        }\n        this.pending = true;\n        this.delay = delay;\n        this.id = this.id || this.requestAsyncId(scheduler, this.id, delay);\n        return this;\n    };\n    AsyncAction.prototype.requestAsyncId = function (scheduler, id, delay) {\n        if (delay === void 0) {\n            delay = 0;\n        }\n        return setInterval(scheduler.flush.bind(scheduler, this), delay);\n    };\n    AsyncAction.prototype.recycleAsyncId = function (scheduler, id, delay) {\n        if (delay === void 0) {\n            delay = 0;\n        }\n        if (delay !== null && this.delay === delay && this.pending === false) {\n            return id;\n        }\n        clearInterval(id);\n        return undefined;\n    };\n    AsyncAction.prototype.execute = function (state, delay) {\n        if (this.closed) {\n            return new Error('executing a cancelled action');\n        }\n        this.pending = false;\n        var error = this._execute(state, delay);\n        if (error) {\n            return error;\n        }\n        else if (this.pending === false && this.id != null) {\n            this.id = this.recycleAsyncId(this.scheduler, this.id, null);\n        }\n    };\n    AsyncAction.prototype._execute = function (state, delay) {\n        var errored = false;\n        var errorValue = undefined;\n        try {\n            this.work(state);\n        }\n        catch (e) {\n            errored = true;\n            errorValue = !!e && e || new Error(e);\n        }\n        if (errored) {\n            this.unsubscribe();\n            return errorValue;\n        }\n    };\n    AsyncAction.prototype._unsubscribe = function () {\n        var id = this.id;\n        var scheduler = this.scheduler;\n        var actions = scheduler.actions;\n        var index = actions.indexOf(this);\n        this.work = null;\n        this.state = null;\n        this.pending = false;\n        this.scheduler = null;\n        if (index !== -1) {\n            actions.splice(index, 1);\n        }\n        if (id != null) {\n            this.id = this.recycleAsyncId(scheduler, id, null);\n        }\n        this.delay = null;\n    };\n    return AsyncAction;\n}(Action));\nexport { AsyncAction };\n//# sourceMappingURL=AsyncAction.js.map\n","var Scheduler = /*@__PURE__*/ (function () {\n    function Scheduler(SchedulerAction, now) {\n        if (now === void 0) {\n            now = Scheduler.now;\n        }\n        this.SchedulerAction = SchedulerAction;\n        this.now = now;\n    }\n    Scheduler.prototype.schedule = function (work, delay, state) {\n        if (delay === void 0) {\n            delay = 0;\n        }\n        return new this.SchedulerAction(this, work).schedule(state, delay);\n    };\n    Scheduler.now = function () { return Date.now(); };\n    return Scheduler;\n}());\nexport { Scheduler };\n//# sourceMappingURL=Scheduler.js.map\n","/** PURE_IMPORTS_START tslib,_Scheduler PURE_IMPORTS_END */\nimport * as tslib_1 from \"tslib\";\nimport { Scheduler } from '../Scheduler';\nvar AsyncScheduler = /*@__PURE__*/ (function (_super) {\n    tslib_1.__extends(AsyncScheduler, _super);\n    function AsyncScheduler(SchedulerAction, now) {\n        if (now === void 0) {\n            now = Scheduler.now;\n        }\n        var _this = _super.call(this, SchedulerAction, function () {\n            if (AsyncScheduler.delegate && AsyncScheduler.delegate !== _this) {\n                return AsyncScheduler.delegate.now();\n            }\n            else {\n                return now();\n            }\n        }) || this;\n        _this.actions = [];\n        _this.active = false;\n        _this.scheduled = undefined;\n        return _this;\n    }\n    AsyncScheduler.prototype.schedule = function (work, delay, state) {\n        if (delay === void 0) {\n            delay = 0;\n        }\n        if (AsyncScheduler.delegate && AsyncScheduler.delegate !== this) {\n            return AsyncScheduler.delegate.schedule(work, delay, state);\n        }\n        else {\n            return _super.prototype.schedule.call(this, work, delay, state);\n        }\n    };\n    AsyncScheduler.prototype.flush = function (action) {\n        var actions = this.actions;\n        if (this.active) {\n            actions.push(action);\n            return;\n        }\n        var error;\n        this.active = true;\n        do {\n            if (error = action.execute(action.state, action.delay)) {\n                break;\n            }\n        } while (action = actions.shift());\n        this.active = false;\n        if (error) {\n            while (action = actions.shift()) {\n                action.unsubscribe();\n            }\n            throw error;\n        }\n    };\n    return AsyncScheduler;\n}(Scheduler));\nexport { AsyncScheduler };\n//# sourceMappingURL=AsyncScheduler.js.map\n","/** PURE_IMPORTS_START _AsyncAction,_AsyncScheduler PURE_IMPORTS_END */\nimport { AsyncAction } from './AsyncAction';\nimport { AsyncScheduler } from './AsyncScheduler';\nexport var asyncScheduler = /*@__PURE__*/ new AsyncScheduler(AsyncAction);\nexport var async = asyncScheduler;\n//# sourceMappingURL=async.js.map\n","/** PURE_IMPORTS_START _Observable,_util_isArray,_util_isFunction,_operators_map PURE_IMPORTS_END */\nimport { Observable } from '../Observable';\nimport { isArray } from '../util/isArray';\nimport { isFunction } from '../util/isFunction';\nimport { map } from '../operators/map';\nvar toString = /*@__PURE__*/ (function () { return Object.prototype.toString; })();\nexport function fromEvent(target, eventName, options, resultSelector) {\n    if (isFunction(options)) {\n        resultSelector = options;\n        options = undefined;\n    }\n    if (resultSelector) {\n        return fromEvent(target, eventName, options).pipe(map(function (args) { return isArray(args) ? resultSelector.apply(void 0, args) : resultSelector(args); }));\n    }\n    return new Observable(function (subscriber) {\n        function handler(e) {\n            if (arguments.length > 1) {\n                subscriber.next(Array.prototype.slice.call(arguments));\n            }\n            else {\n                subscriber.next(e);\n            }\n        }\n        setupSubscription(target, eventName, handler, subscriber, options);\n    });\n}\nfunction setupSubscription(sourceObj, eventName, handler, subscriber, options) {\n    var unsubscribe;\n    if (isEventTarget(sourceObj)) {\n        var source_1 = sourceObj;\n        sourceObj.addEventListener(eventName, handler, options);\n        unsubscribe = function () { return source_1.removeEventListener(eventName, handler, options); };\n    }\n    else if (isJQueryStyleEventEmitter(sourceObj)) {\n        var source_2 = sourceObj;\n        sourceObj.on(eventName, handler);\n        unsubscribe = function () { return source_2.off(eventName, handler); };\n    }\n    else if (isNodeStyleEventEmitter(sourceObj)) {\n        var source_3 = sourceObj;\n        sourceObj.addListener(eventName, handler);\n        unsubscribe = function () { return source_3.removeListener(eventName, handler); };\n    }\n    else if (sourceObj && sourceObj.length) {\n        for (var i = 0, len = sourceObj.length; i < len; i++) {\n            setupSubscription(sourceObj[i], eventName, handler, subscriber, options);\n        }\n    }\n    else {\n        throw new TypeError('Invalid event target');\n    }\n    subscriber.add(unsubscribe);\n}\nfunction isNodeStyleEventEmitter(sourceObj) {\n    return sourceObj && typeof sourceObj.addListener === 'function' && typeof sourceObj.removeListener === 'function';\n}\nfunction isJQueryStyleEventEmitter(sourceObj) {\n    return sourceObj && typeof sourceObj.on === 'function' && typeof sourceObj.off === 'function';\n}\nfunction isEventTarget(sourceObj) {\n    return sourceObj && typeof sourceObj.addEventListener === 'function' && typeof sourceObj.removeEventListener === 'function';\n}\n//# sourceMappingURL=fromEvent.js.map\n","import { InjectionToken } from '@tanbo/di';\r\n/**\r\n *  key\r\n */\r\nexport const EDITOR_OPTIONS = new InjectionToken('EDITOR_OPTIONS');\r\n/**\r\n *  Document  key\r\n */\r\nexport const EDITABLE_DOCUMENT = new InjectionToken('EDITABLE_DOCUMENT');\r\n//# sourceMappingURL=inject-tokens.js.map","/** PURE_IMPORTS_START  PURE_IMPORTS_END */\nvar _enable_super_gross_mode_that_will_cause_bad_things = false;\nexport var config = {\n    Promise: undefined,\n    set useDeprecatedSynchronousErrorHandling(value) {\n        if (value) {\n            var error = /*@__PURE__*/ new Error();\n            /*@__PURE__*/ console.warn('DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \\n' + error.stack);\n        }\n        else if (_enable_super_gross_mode_that_will_cause_bad_things) {\n            /*@__PURE__*/ console.log('RxJS: Back to a better error behavior. Thank you. <3');\n        }\n        _enable_super_gross_mode_that_will_cause_bad_things = value;\n    },\n    get useDeprecatedSynchronousErrorHandling() {\n        return _enable_super_gross_mode_that_will_cause_bad_things;\n    },\n};\n//# sourceMappingURL=config.js.map\n","/** PURE_IMPORTS_START  PURE_IMPORTS_END */\nexport var isArray = /*@__PURE__*/ (function () { return Array.isArray || (function (x) { return x && typeof x.length === 'number'; }); })();\n//# sourceMappingURL=isArray.js.map\n","import { from, fromEvent, Observable, of, Subject } from 'rxjs';\r\nimport { debounceTime } from 'rxjs/operators';\r\nimport { getAnnotations, InjectFlags, Injector, NullInjector, ReflectiveInjector, } from '@tanbo/di';\r\nimport { AbstractComponent, BackboneAbstractComponent, BranchAbstractComponent, BrComponent, Component, DivisionAbstractComponent, LeafAbstractComponent, MarkdownSupport, OutputRenderer, Parser, Renderer, TBRange, TBSelection } from './core/_api';\r\nimport { FileUploader, Input, Layout, UIControlPanel, UIDialog, UIMessage } from './ui/_api';\r\nimport { HTMLOutputTranslator, OutputTranslator } from './output-translator';\r\nimport { EditorController } from './editor-controller';\r\nimport { makeError } from './_utils/make-error';\r\nimport { ComponentInjectors } from './component-injectors';\r\nimport { EDITABLE_DOCUMENT, EDITOR_OPTIONS } from './inject-tokens';\r\nimport { RootComponent } from './root-component';\r\nimport { TBHistory } from './history';\r\nimport { I18n, i18n_zh_CN } from './i18n/_api';\r\nimport { HackInput } from './_es-hack';\r\nconst editorErrorFn = makeError('Editor');\r\n/**\r\n * TextBus \r\n */\r\nexport class Editor {\r\n    constructor(selector, options = {}) {\r\n        this.selector = selector;\r\n        this.options = options;\r\n        /**  */\r\n        this.stateController = null;\r\n        /**  */\r\n        this.injector = null;\r\n        this.defaultPlugins = [\r\n            UIDialog,\r\n            UIControlPanel,\r\n            UIMessage,\r\n        ];\r\n        this.readyState = false;\r\n        this.tasks = [];\r\n        this.readyEvent = new Subject();\r\n        this.subs = [];\r\n        this.changeEvent = new Subject();\r\n        if (typeof selector === 'string') {\r\n            this.container = document.querySelector(selector);\r\n        }\r\n        else {\r\n            this.container = selector;\r\n        }\r\n        if (!this.container || !(this.container instanceof HTMLElement)) {\r\n            throw editorErrorFn('selector is not an HTMLElement, or the CSS selector cannot find a DOM element in the document.');\r\n        }\r\n        this.onReady = this.readyEvent.asObservable();\r\n        this.onChange = this.changeEvent.asObservable();\r\n        this.stateController = new EditorController({\r\n            readonly: false,\r\n            sourcecodeMode: false,\r\n            supportMarkdown: true\r\n        });\r\n        const i18n = new I18n(i18n_zh_CN, options.i18n);\r\n        const rootInjector = new ReflectiveInjector(new NullInjector(), [Layout, {\r\n                provide: EditorController,\r\n                useValue: this.stateController\r\n            }, {\r\n                provide: I18n,\r\n                useValue: i18n\r\n            }]);\r\n        const layout = rootInjector.get(Layout);\r\n        layout.setTheme(options.theme);\r\n        this.layout = layout;\r\n        this.subs.push(layout.onReady.subscribe(contentDocument => {\r\n            const injector = this.bootstrap(rootInjector, contentDocument);\r\n            this.init(injector);\r\n        }));\r\n        this.container.appendChild(layout.container);\r\n    }\r\n    set readonly(b) {\r\n        this.stateController.readonly = b;\r\n    }\r\n    get readonly() {\r\n        return this.stateController.readonly;\r\n    }\r\n    set supportMarkdown(b) {\r\n        this.stateController.supportMarkdown = b;\r\n    }\r\n    get supportMarkdown() {\r\n        return this.stateController.supportMarkdown;\r\n    }\r\n    /**\r\n     *  TextBus \r\n     * @param html\r\n     */\r\n    setContents(html) {\r\n        return new Promise((resolve) => {\r\n            this.run(() => {\r\n                const parser = this.injector.get(Parser);\r\n                const fragment = parser.parse(Parser.parserHTML(html));\r\n                this.injector.get(RootComponent).slot.from(fragment);\r\n                setTimeout(() => {\r\n                    const layout = this.injector.get(Layout);\r\n                    layout.scroller.scrollTop = 0;\r\n                    this.updateDocHeight(layout.iframe, layout.workbench, this.injector.get(EDITABLE_DOCUMENT));\r\n                    resolve();\r\n                }, 30);\r\n            });\r\n        });\r\n    }\r\n    /**\r\n     *  TextBus \r\n     */\r\n    getContents() {\r\n        const metadata = this.getOutputComponentMetadata();\r\n        const outputTranslator = this.injector.get(OutputTranslator);\r\n        const outputRenderer = this.injector.get(OutputRenderer);\r\n        const rootComponent = this.injector.get(RootComponent);\r\n        const content = outputTranslator.transform(outputRenderer.render(rootComponent));\r\n        return {\r\n            content,\r\n            links: metadata.links,\r\n            styleSheets: metadata.styles,\r\n            scripts: metadata.scripts\r\n        };\r\n    }\r\n    /**\r\n     *  TextBus  JSON \r\n     */\r\n    getJSONLiteral() {\r\n        const outputRenderer = this.injector.get(OutputRenderer);\r\n        const rootComponent = this.injector.get(RootComponent);\r\n        const json = outputRenderer.render(rootComponent).toJSON();\r\n        const metadata = this.getOutputComponentMetadata();\r\n        return {\r\n            content: json,\r\n            links: metadata.links,\r\n            styleSheets: metadata.styles,\r\n            scripts: metadata.scripts\r\n        };\r\n    }\r\n    /**\r\n     *  TextBus \r\n     */\r\n    destroy() {\r\n        this.subs.forEach(s => s.unsubscribe());\r\n        [Input, Layout, ComponentInjectors].forEach(i => {\r\n            this.injector.get(i).destroy();\r\n        });\r\n        [...(this.defaultPlugins), ...(this.options.plugins || [])].forEach(p => {\r\n            var _a, _b;\r\n            (_b = (_a = this.injector.get(p)).onDestroy) === null || _b === void 0 ? void 0 : _b.call(_a);\r\n        });\r\n        this.container.removeChild(this.layout.container);\r\n    }\r\n    getOutputComponentMetadata() {\r\n        const classes = this.getReferencedComponents();\r\n        const styles = [...(this.options.styleSheets || '')];\r\n        const scripts = [];\r\n        const links = [];\r\n        classes.forEach(c => {\r\n            const annotation = getAnnotations(c).getClassMetadata(Component).metadata;\r\n            if (annotation.styles) {\r\n                styles.push(...annotation.styles.filter(i => i));\r\n            }\r\n            if (annotation.scripts) {\r\n                scripts.push(...annotation.scripts.filter(i => i));\r\n            }\r\n            if (annotation.links) {\r\n                links.push(...annotation.links);\r\n            }\r\n        });\r\n        return {\r\n            links,\r\n            styles: Array.from(new Set(styles)).map(i => Editor.cssMin(i)),\r\n            scripts: Array.from(new Set(scripts))\r\n        };\r\n    }\r\n    getReferencedComponents() {\r\n        function getComponentCollection(component) {\r\n            const collection = [component];\r\n            const fragments = [];\r\n            if (component instanceof DivisionAbstractComponent) {\r\n                fragments.push(component.slot);\r\n            }\r\n            else if (component instanceof BranchAbstractComponent) {\r\n                fragments.push(...component.slots);\r\n            }\r\n            else if (component instanceof BackboneAbstractComponent) {\r\n                fragments.push(...Array.from(component));\r\n            }\r\n            fragments.forEach(fragment => {\r\n                fragment.sliceContents().forEach(i => {\r\n                    if (i instanceof AbstractComponent) {\r\n                        collection.push(...getComponentCollection(i));\r\n                    }\r\n                });\r\n            });\r\n            return collection;\r\n        }\r\n        const instances = getComponentCollection(this.injector.get(RootComponent));\r\n        return Array.from(new Set(instances.map(i => i.constructor)));\r\n    }\r\n    init(injector) {\r\n        this.injector = injector;\r\n        const contentDocument = injector.get(EDITABLE_DOCUMENT);\r\n        const layout = injector.get(Layout);\r\n        const rootComponent = injector.get(RootComponent);\r\n        const selection = injector.get(TBSelection);\r\n        const renderer = injector.get(Renderer);\r\n        const parser = injector.get(Parser);\r\n        this.subs.push(rootComponent.onChange.pipe(debounceTime(1)).subscribe(() => {\r\n            renderer.render(rootComponent);\r\n            Promise.resolve().then(() => selection.restore());\r\n        }), fromEvent(contentDocument, 'click').subscribe((ev) => {\r\n            const sourceElement = ev.target;\r\n            const focusNode = this.findFocusNode(sourceElement, renderer);\r\n            if (!focusNode || focusNode === sourceElement) {\r\n                return;\r\n            }\r\n            const position = renderer.getPositionByNode(focusNode);\r\n            if (position.endIndex - position.startIndex === 1) {\r\n                const content = position.fragment.getContentAtIndex(position.startIndex);\r\n                if (content instanceof LeafAbstractComponent) {\r\n                    if (!selection.firstRange) {\r\n                        const range = new TBRange(contentDocument.createRange(), renderer);\r\n                        selection.addRange(range);\r\n                    }\r\n                    selection.firstRange.setStart(position.fragment, position.endIndex);\r\n                    selection.firstRange.collapse();\r\n                    selection.restore();\r\n                }\r\n            }\r\n        }), renderer.onViewUpdated.subscribe(() => {\r\n            this.changeEvent.next();\r\n        }));\r\n        const dom = Parser.parserHTML(this.options.contents || '<p><br></p>');\r\n        rootComponent.slot.from(parser.parse(dom));\r\n        this.listen(layout.iframe, layout.workbench, contentDocument);\r\n        this.defaultPlugins.forEach(f => {\r\n            injector.get(f).setup();\r\n        });\r\n        const input = injector.get(Input);\r\n        if (typeof this.options.onSave === 'function') {\r\n            input.addKeymap({\r\n                keymap: {\r\n                    ctrlKey: true,\r\n                    key: 's'\r\n                },\r\n                action: () => {\r\n                    this.options.onSave();\r\n                }\r\n            });\r\n        }\r\n        injector.get(TBHistory).record();\r\n        const customPlugins = this.options.plugins || [];\r\n        let i = 0;\r\n        if (!customPlugins.length) {\r\n            this.readyState = true;\r\n            this.readyEvent.next();\r\n            this.tasks.forEach(fn => fn());\r\n        }\r\n        else {\r\n            customPlugins.forEach(f => {\r\n                setTimeout(() => {\r\n                    i++;\r\n                    injector.get(f).setup();\r\n                    if (i === customPlugins.length) {\r\n                        this.readyState = true;\r\n                        this.readyEvent.next();\r\n                        this.tasks.forEach(fn => fn());\r\n                    }\r\n                });\r\n            });\r\n        }\r\n    }\r\n    bootstrap(rootInjector, contentDocument) {\r\n        const renderer = new Renderer(contentDocument.body);\r\n        const selection = new TBSelection(contentDocument, fromEvent(contentDocument, 'selectionchange'), renderer);\r\n        this.componentAnnotations = [RootComponent, ...(this.options.components || []), BrComponent].map(c => {\r\n            return getAnnotations(c).getClassMetadata(Component).metadata;\r\n        });\r\n        this.setDocStyle(this.componentAnnotations, contentDocument);\r\n        const parser = new Parser(this.componentAnnotations.map(c => c.loader), this.options.formatters);\r\n        const componentInjectors = new ComponentInjectors();\r\n        const editorInjector = new ReflectiveInjector(rootInjector, [\r\n            ...this.defaultPlugins,\r\n            Input,\r\n            TBHistory,\r\n            RootComponent, {\r\n                provide: HackInput,\r\n                useClass: Input\r\n            }, {\r\n                provide: EDITABLE_DOCUMENT,\r\n                useValue: contentDocument\r\n            }, {\r\n                provide: EDITOR_OPTIONS,\r\n                useValue: this.options\r\n            }, {\r\n                provide: Editor,\r\n                useValue: this\r\n            }, {\r\n                provide: OutputRenderer,\r\n                useValue: new OutputRenderer()\r\n            }, {\r\n                provide: OutputTranslator,\r\n                useValue: new HTMLOutputTranslator()\r\n            }, {\r\n                provide: Parser,\r\n                useValue: parser\r\n            }, {\r\n                provide: TBSelection,\r\n                useValue: selection\r\n            }, {\r\n                provide: Renderer,\r\n                useValue: renderer\r\n            }, {\r\n                provide: ComponentInjectors,\r\n                useValue: componentInjectors\r\n            }, {\r\n                provide: FileUploader,\r\n                useFactory: (message, i18n, selection, rootComponent) => {\r\n                    return {\r\n                        upload: (type, currentValue) => {\r\n                            if (selection.rangeCount === 0) {\r\n                                const range = selection.createRange();\r\n                                const position = range.findLastPosition(rootComponent.slot);\r\n                                range.setPosition(position.fragment, position.index);\r\n                                selection.addRange(range);\r\n                            }\r\n                            if (typeof this.options.uploader === 'function') {\r\n                                const result = this.options.uploader(type, currentValue);\r\n                                if (result instanceof Observable) {\r\n                                    return result;\r\n                                }\r\n                                else if (result instanceof Promise) {\r\n                                    return from(result);\r\n                                }\r\n                                else if (typeof result === 'string') {\r\n                                    return of(result);\r\n                                }\r\n                            }\r\n                            message.message(i18n.get('editor.noUploader'));\r\n                            return of('');\r\n                        }\r\n                    };\r\n                },\r\n                deps: [UIMessage, I18n, TBSelection, RootComponent]\r\n            }\r\n        ]);\r\n        const customInjector = new ReflectiveInjector(editorInjector, [\r\n            ...(this.options.providers || []),\r\n            ...(this.options.plugins || []), {\r\n                provide: Injector,\r\n                useFactory() {\r\n                    return customInjector;\r\n                }\r\n            }\r\n        ]);\r\n        const input = customInjector.get(Input);\r\n        [RootComponent, ...(this.options.components || [])].forEach(c => {\r\n            const metadata = getAnnotations(c).getClassMetadata(Component);\r\n            const annotation = metadata.metadata;\r\n            const componentInjector = new ReflectiveInjector(customInjector, annotation.providers || []);\r\n            componentInjectors.set(c, componentInjector);\r\n            const markdownSupport = componentInjector.get(MarkdownSupport, null, InjectFlags.Optional);\r\n            if (markdownSupport) {\r\n                const markdownGrammarInterceptor = markdownSupport.provide();\r\n                input.addMarkdownSupport(markdownGrammarInterceptor);\r\n            }\r\n        });\r\n        return customInjector;\r\n    }\r\n    setDocStyle(componentAnnotations, contentDocument) {\r\n        const links = [];\r\n        const componentStyles = componentAnnotations.map(c => {\r\n            var _a, _b;\r\n            if (Array.isArray(c.links)) {\r\n                links.push(...c.links);\r\n            }\r\n            return [((_a = c.styles) === null || _a === void 0 ? void 0 : _a.join('')) || '', ((_b = c.editModeStyles) === null || _b === void 0 ? void 0 : _b.join('')) || ''].join('');\r\n        }).join('');\r\n        links.forEach(link => {\r\n            const linkEle = contentDocument.createElement('link');\r\n            Object.assign(linkEle, link);\r\n            contentDocument.head.appendChild(linkEle);\r\n        });\r\n        const docStyles = Editor.cssMin([componentStyles, ...(this.options.styleSheets || [])].join(''));\r\n        const styleEl = contentDocument.createElement('style');\r\n        styleEl.innerHTML = Editor.cssMin([...docStyles, ...(this.options.editingStyleSheets || [])].join(''));\r\n        contentDocument.head.append(styleEl);\r\n    }\r\n    run(fn) {\r\n        if (!this.readyState) {\r\n            this.tasks.push(fn);\r\n            return;\r\n        }\r\n        fn();\r\n    }\r\n    listen(iframe, container, contentDocument) {\r\n        if (!(contentDocument === null || contentDocument === void 0 ? void 0 : contentDocument.body)) {\r\n            return;\r\n        }\r\n        this.resizeObserver = new ResizeObserver(() => {\r\n            this.updateDocHeight(iframe, container, contentDocument);\r\n        });\r\n        this.resizeObserver.observe(contentDocument.body);\r\n    }\r\n    updateDocHeight(iframe, container, contentDocument) {\r\n        const childBody = contentDocument.body;\r\n        const lastChild = childBody.lastChild;\r\n        let height = 0;\r\n        if (lastChild) {\r\n            if (lastChild.nodeType === Node.ELEMENT_NODE) {\r\n                height = lastChild.getBoundingClientRect().bottom;\r\n            }\r\n            else {\r\n                const div = contentDocument.createElement('div');\r\n                childBody.appendChild(div);\r\n                height = div.getBoundingClientRect().bottom;\r\n                childBody.removeChild(div);\r\n            }\r\n        }\r\n        iframe.style.height = Math.max(height, container.offsetHeight) + 'px';\r\n    }\r\n    findFocusNode(node, renderer) {\r\n        const position = renderer.getPositionByNode(node);\r\n        if (!position) {\r\n            const parentNode = node.parentNode;\r\n            if (parentNode) {\r\n                return this.findFocusNode(parentNode, renderer);\r\n            }\r\n            return null;\r\n        }\r\n        return node;\r\n    }\r\n    static cssMin(str) {\r\n        return str\r\n            .replace(/\\s*(?=[>{}:;,[])/g, '')\r\n            .replace(/([>{}:;,])\\s*/g, '$1')\r\n            .replace(/;}/g, '}').replace(/\\s+/, ' ').trim();\r\n    }\r\n}\r\n//# sourceMappingURL=editor.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nvar I18n_1;\r\nimport { Injectable } from '@tanbo/di';\r\n/**\r\n * TextBus \r\n */\r\nlet I18n = I18n_1 = class I18n {\r\n    constructor(defaultConfig, customConfig) {\r\n        this.defaultConfig = defaultConfig;\r\n        this.customConfig = customConfig;\r\n    }\r\n    /**\r\n     *  path  i18n \r\n     * \r\n     * @param path  a.ba['b'].ca[0] \r\n     */\r\n    get(path) {\r\n        const tokens = this.parse(path);\r\n        const customValue = this.getLabelByTokens(this.customConfig, tokens);\r\n        if (typeof customValue === 'string') {\r\n            return customValue;\r\n        }\r\n        const value = this.getLabelByTokens(this.defaultConfig, tokens);\r\n        return typeof value === 'string' ? value : '';\r\n    }\r\n    /**\r\n     *  path  i18n  i18n \r\n     * @param path  a.ba['b'].ca[0] \r\n     */\r\n    getContext(path) {\r\n        const tokens = this.parse(path);\r\n        const customConfig = this.getLabelByTokens(this.customConfig, tokens) || {};\r\n        const defaultConfig = this.getLabelByTokens(this.defaultConfig, tokens) || {};\r\n        return new I18n_1(defaultConfig, customConfig);\r\n    }\r\n    /**\r\n     * : {number} number \r\n     *  template string {0} is {1}.\r\n     * @param template \r\n     * @param values \r\n     */\r\n    joinTemplate(template, ...values) {\r\n        return template.replace(/{\\d+}/g, str => {\r\n            return values[str.replace(/{\\s*|\\s*}/g, '')] || str;\r\n        });\r\n    }\r\n    parse(path) {\r\n        return path.split(/[.\\[\\]'\"]+/g).map(i => i.trim()).filter(i => i);\r\n    }\r\n    getLabelByTokens(config, tokens) {\r\n        if (!config || tokens.length === 0) {\r\n            return null;\r\n        }\r\n        let value = config;\r\n        for (let i = 0; i < tokens.length; i++) {\r\n            value = value[tokens[i]];\r\n            if (typeof value === 'undefined') {\r\n                return null;\r\n            }\r\n        }\r\n        return value;\r\n    }\r\n};\r\nI18n = I18n_1 = __decorate([\r\n    Injectable(),\r\n    __metadata(\"design:paramtypes\", [Object, Object])\r\n], I18n);\r\nexport { I18n };\r\n//# sourceMappingURL=i18n.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nvar TBHistory_1;\r\nimport { Subject } from 'rxjs';\r\nimport { sampleTime } from 'rxjs/operators';\r\nimport { forwardRef, Inject, Injectable } from '@tanbo/di';\r\nimport { BackboneAbstractComponent, BranchAbstractComponent, DivisionAbstractComponent, Renderer, TBRange, TBSelection } from './core/_api';\r\nimport { EDITABLE_DOCUMENT, EDITOR_OPTIONS } from './inject-tokens';\r\nimport { RootComponent } from './root-component';\r\nimport { EditorController } from './editor-controller';\r\nimport { makeError } from './_utils/make-error';\r\nconst historyErrorFn = makeError('History');\r\n/**\r\n * TextBus \r\n */\r\nlet TBHistory = TBHistory_1 = class TBHistory {\r\n    constructor(options, selection, context, renderer, editorController, rootComponent) {\r\n        this.options = options;\r\n        this.selection = selection;\r\n        this.context = context;\r\n        this.renderer = renderer;\r\n        this.editorController = editorController;\r\n        this.rootComponent = rootComponent;\r\n        this.historySequence = [];\r\n        this.historyIndex = 0;\r\n        this.historyChangeEvent = new Subject();\r\n        this.historyUsedEvent = new Subject();\r\n        this.historyStackSize = options.historyStackSize || 50;\r\n        this.onChange = this.historyChangeEvent.asObservable();\r\n        this.onUsed = this.historyUsedEvent.asObservable();\r\n    }\r\n    /**  */\r\n    get canBack() {\r\n        return this.historySequence.length > 0 && this.historyIndex > 0;\r\n    }\r\n    /**  */\r\n    get canForward() {\r\n        return this.historySequence.length > 0 && this.historyIndex < this.historySequence.length - 1;\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    back() {\r\n        if (this.canBack) {\r\n            this.historyIndex--;\r\n            this.historyIndex = Math.max(0, this.historyIndex);\r\n            const snapshot = TBHistory_1.cloneHistoryData(this.historySequence[this.historyIndex]);\r\n            this.rootComponent.slot.from(snapshot.component.slot);\r\n            this.usePaths(snapshot.paths, this.rootComponent.slot);\r\n            this.listen();\r\n            this.historyUsedEvent.next();\r\n        }\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    forward() {\r\n        if (this.canForward) {\r\n            this.historyIndex++;\r\n            const snapshot = TBHistory_1.cloneHistoryData(this.historySequence[this.historyIndex]);\r\n            this.rootComponent.slot.from(snapshot.component.slot);\r\n            this.usePaths(snapshot.paths, this.rootComponent.slot);\r\n            this.listen();\r\n            this.historyUsedEvent.next();\r\n        }\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    destroy() {\r\n        var _a;\r\n        this.historySequence = null;\r\n        (_a = this.stateChangeSubscription) === null || _a === void 0 ? void 0 : _a.unsubscribe();\r\n        this.stopListen();\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    clean() {\r\n        this.historyIndex = 0;\r\n        this.historySequence = [];\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    record() {\r\n        this.recordSnapshot();\r\n        this.listen();\r\n    }\r\n    stopListen() {\r\n        if (this.snapshotSubscription) {\r\n            this.snapshotSubscription.unsubscribe();\r\n        }\r\n    }\r\n    listen() {\r\n        this.stopListen();\r\n        this.snapshotSubscription = this.rootComponent.onChange.pipe(sampleTime(5000)).subscribe(() => {\r\n            this.recordSnapshot();\r\n        });\r\n    }\r\n    recordSnapshot() {\r\n        if (this.historySequence.length !== this.historyIndex) {\r\n            this.historySequence.length = this.historyIndex + 1;\r\n        }\r\n        this.historySequence.push({\r\n            component: this.rootComponent.clone(),\r\n            paths: this.getRangePaths()\r\n        });\r\n        if (this.historySequence.length > this.historyStackSize) {\r\n            this.historySequence.shift();\r\n        }\r\n        this.historyIndex = this.historySequence.length - 1;\r\n        this.historyChangeEvent.next();\r\n    }\r\n    static cloneHistoryData(snapshot) {\r\n        return {\r\n            component: snapshot.component.clone(),\r\n            paths: snapshot.paths.map(i => i)\r\n        };\r\n    }\r\n    /**\r\n     *  Selection  Range  path\r\n     */\r\n    getRangePaths() {\r\n        const getPaths = (fragment) => {\r\n            const paths = [];\r\n            while (fragment) {\r\n                const parentComponent = fragment.parentComponent;\r\n                if (!parentComponent.parentFragment) {\r\n                    break;\r\n                }\r\n                if (parentComponent instanceof BranchAbstractComponent) {\r\n                    paths.push(parentComponent.slots.indexOf(fragment));\r\n                }\r\n                else if (parentComponent instanceof BackboneAbstractComponent) {\r\n                    paths.push(parentComponent.indexOf(fragment));\r\n                }\r\n                else {\r\n                    paths.push(0);\r\n                }\r\n                fragment = parentComponent.parentFragment;\r\n                if (fragment) {\r\n                    paths.push(fragment.indexOf(parentComponent));\r\n                }\r\n            }\r\n            return paths.reverse();\r\n        };\r\n        return this.selection.ranges.map(range => {\r\n            const paths = getPaths(range.startFragment);\r\n            paths.push(range.startIndex);\r\n            if (range.collapsed) {\r\n                return {\r\n                    startPaths: paths,\r\n                    endPaths: paths\r\n                };\r\n            }\r\n            else {\r\n                const endPaths = getPaths(range.endFragment);\r\n                endPaths.push(range.endIndex);\r\n                return {\r\n                    startPaths: paths,\r\n                    endPaths\r\n                };\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     *  Selection\r\n     * @param paths\r\n     * @param fragment\r\n     */\r\n    usePaths(paths, fragment) {\r\n        const findPosition = (position, fragment) => {\r\n            const paths = position.map(i => i).reverse();\r\n            while (true) {\r\n                const index = paths.pop();\r\n                if (paths.length === 0) {\r\n                    return {\r\n                        fragment,\r\n                        index\r\n                    };\r\n                }\r\n                const c = fragment.getContentAtIndex(index);\r\n                const last = paths.pop();\r\n                if (c instanceof DivisionAbstractComponent && last === 0) {\r\n                    fragment = c.slot;\r\n                }\r\n                else if (c instanceof BranchAbstractComponent) {\r\n                    fragment = c.slots[last];\r\n                }\r\n                else if (c instanceof BackboneAbstractComponent) {\r\n                    fragment = c.getSlotAtIndex(last);\r\n                }\r\n                else {\r\n                    throw historyErrorFn('location of the history range could not be found.');\r\n                }\r\n                if (paths.length === 1) {\r\n                    return {\r\n                        fragment,\r\n                        index: paths.pop()\r\n                    };\r\n                }\r\n            }\r\n        };\r\n        let nativeRange;\r\n        if (this.selection.nativeSelection.rangeCount) {\r\n            nativeRange = this.selection.nativeSelection.getRangeAt(0);\r\n        }\r\n        else {\r\n            nativeRange = this.context.createRange();\r\n        }\r\n        const len = paths.length;\r\n        if (len === 0) {\r\n            return;\r\n        }\r\n        const startPaths = paths[0].startPaths;\r\n        const endPaths = paths[len - 1].endPaths;\r\n        const start = findPosition(startPaths, fragment);\r\n        const range = new TBRange(nativeRange, this.renderer);\r\n        range.setStart(start.fragment, start.index);\r\n        if (endPaths === startPaths) {\r\n            range.setEnd(start.fragment, start.index);\r\n        }\r\n        else {\r\n            const end = findPosition(endPaths, fragment);\r\n            range.setEnd(end.fragment, end.index);\r\n        }\r\n        this.selection.removeAllRanges();\r\n        this.selection.addRange(range);\r\n    }\r\n};\r\nTBHistory = TBHistory_1 = __decorate([\r\n    Injectable(),\r\n    __param(0, Inject(forwardRef(() => EDITOR_OPTIONS))),\r\n    __param(1, Inject(forwardRef(() => TBSelection))),\r\n    __param(2, Inject(forwardRef(() => EDITABLE_DOCUMENT))),\r\n    __param(3, Inject(forwardRef(() => Renderer))),\r\n    __param(4, Inject(forwardRef(() => EditorController))),\r\n    __param(5, Inject(forwardRef(() => RootComponent))),\r\n    __metadata(\"design:paramtypes\", [Object, TBSelection,\r\n        Document,\r\n        Renderer,\r\n        EditorController,\r\n        RootComponent])\r\n], TBHistory);\r\nexport { TBHistory };\r\n//# sourceMappingURL=history.js.map","/** PURE_IMPORTS_START  PURE_IMPORTS_END */\nexport function identity(x) {\n    return x;\n}\n//# sourceMappingURL=identity.js.map\n","/*! *****************************************************************************\nCopyright (C) Microsoft. All rights reserved.\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\nthis file except in compliance with the License. You may obtain a copy of the\nLicense at http://www.apache.org/licenses/LICENSE-2.0\n\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\nMERCHANTABLITY OR NON-INFRINGEMENT.\n\nSee the Apache Version 2.0 License for specific language governing permissions\nand limitations under the License.\n***************************************************************************** */\nvar Reflect;\n(function (Reflect) {\n    // Metadata Proposal\n    // https://rbuckton.github.io/reflect-metadata/\n    (function (factory) {\n        var root = typeof global === \"object\" ? global :\n            typeof self === \"object\" ? self :\n                typeof this === \"object\" ? this :\n                    Function(\"return this;\")();\n        var exporter = makeExporter(Reflect);\n        if (typeof root.Reflect === \"undefined\") {\n            root.Reflect = Reflect;\n        }\n        else {\n            exporter = makeExporter(root.Reflect, exporter);\n        }\n        factory(exporter);\n        function makeExporter(target, previous) {\n            return function (key, value) {\n                if (typeof target[key] !== \"function\") {\n                    Object.defineProperty(target, key, { configurable: true, writable: true, value: value });\n                }\n                if (previous)\n                    previous(key, value);\n            };\n        }\n    })(function (exporter) {\n        var hasOwn = Object.prototype.hasOwnProperty;\n        // feature test for Symbol support\n        var supportsSymbol = typeof Symbol === \"function\";\n        var toPrimitiveSymbol = supportsSymbol && typeof Symbol.toPrimitive !== \"undefined\" ? Symbol.toPrimitive : \"@@toPrimitive\";\n        var iteratorSymbol = supportsSymbol && typeof Symbol.iterator !== \"undefined\" ? Symbol.iterator : \"@@iterator\";\n        var supportsCreate = typeof Object.create === \"function\"; // feature test for Object.create support\n        var supportsProto = { __proto__: [] } instanceof Array; // feature test for __proto__ support\n        var downLevel = !supportsCreate && !supportsProto;\n        var HashMap = {\n            // create an object in dictionary mode (a.k.a. \"slow\" mode in v8)\n            create: supportsCreate\n                ? function () { return MakeDictionary(Object.create(null)); }\n                : supportsProto\n                    ? function () { return MakeDictionary({ __proto__: null }); }\n                    : function () { return MakeDictionary({}); },\n            has: downLevel\n                ? function (map, key) { return hasOwn.call(map, key); }\n                : function (map, key) { return key in map; },\n            get: downLevel\n                ? function (map, key) { return hasOwn.call(map, key) ? map[key] : undefined; }\n                : function (map, key) { return map[key]; },\n        };\n        // Load global or shim versions of Map, Set, and WeakMap\n        var functionPrototype = Object.getPrototypeOf(Function);\n        var usePolyfill = typeof process === \"object\" && process.env && process.env[\"REFLECT_METADATA_USE_MAP_POLYFILL\"] === \"true\";\n        var _Map = !usePolyfill && typeof Map === \"function\" && typeof Map.prototype.entries === \"function\" ? Map : CreateMapPolyfill();\n        var _Set = !usePolyfill && typeof Set === \"function\" && typeof Set.prototype.entries === \"function\" ? Set : CreateSetPolyfill();\n        var _WeakMap = !usePolyfill && typeof WeakMap === \"function\" ? WeakMap : CreateWeakMapPolyfill();\n        // [[Metadata]] internal slot\n        // https://rbuckton.github.io/reflect-metadata/#ordinary-object-internal-methods-and-internal-slots\n        var Metadata = new _WeakMap();\n        /**\n         * Applies a set of decorators to a property of a target object.\n         * @param decorators An array of decorators.\n         * @param target The target object.\n         * @param propertyKey (Optional) The property key to decorate.\n         * @param attributes (Optional) The property descriptor for the target key.\n         * @remarks Decorators are applied in reverse order.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     Example = Reflect.decorate(decoratorsArray, Example);\n         *\n         *     // property (on constructor)\n         *     Reflect.decorate(decoratorsArray, Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     Reflect.decorate(decoratorsArray, Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     Object.defineProperty(Example, \"staticMethod\",\n         *         Reflect.decorate(decoratorsArray, Example, \"staticMethod\",\n         *             Object.getOwnPropertyDescriptor(Example, \"staticMethod\")));\n         *\n         *     // method (on prototype)\n         *     Object.defineProperty(Example.prototype, \"method\",\n         *         Reflect.decorate(decoratorsArray, Example.prototype, \"method\",\n         *             Object.getOwnPropertyDescriptor(Example.prototype, \"method\")));\n         *\n         */\n        function decorate(decorators, target, propertyKey, attributes) {\n            if (!IsUndefined(propertyKey)) {\n                if (!IsArray(decorators))\n                    throw new TypeError();\n                if (!IsObject(target))\n                    throw new TypeError();\n                if (!IsObject(attributes) && !IsUndefined(attributes) && !IsNull(attributes))\n                    throw new TypeError();\n                if (IsNull(attributes))\n                    attributes = undefined;\n                propertyKey = ToPropertyKey(propertyKey);\n                return DecorateProperty(decorators, target, propertyKey, attributes);\n            }\n            else {\n                if (!IsArray(decorators))\n                    throw new TypeError();\n                if (!IsConstructor(target))\n                    throw new TypeError();\n                return DecorateConstructor(decorators, target);\n            }\n        }\n        exporter(\"decorate\", decorate);\n        // 4.1.2 Reflect.metadata(metadataKey, metadataValue)\n        // https://rbuckton.github.io/reflect-metadata/#reflect.metadata\n        /**\n         * A default metadata decorator factory that can be used on a class, class member, or parameter.\n         * @param metadataKey The key for the metadata entry.\n         * @param metadataValue The value for the metadata entry.\n         * @returns A decorator function.\n         * @remarks\n         * If `metadataKey` is already defined for the target and target key, the\n         * metadataValue for that key will be overwritten.\n         * @example\n         *\n         *     // constructor\n         *     @Reflect.metadata(key, value)\n         *     class Example {\n         *     }\n         *\n         *     // property (on constructor, TypeScript only)\n         *     class Example {\n         *         @Reflect.metadata(key, value)\n         *         static staticProperty;\n         *     }\n         *\n         *     // property (on prototype, TypeScript only)\n         *     class Example {\n         *         @Reflect.metadata(key, value)\n         *         property;\n         *     }\n         *\n         *     // method (on constructor)\n         *     class Example {\n         *         @Reflect.metadata(key, value)\n         *         static staticMethod() { }\n         *     }\n         *\n         *     // method (on prototype)\n         *     class Example {\n         *         @Reflect.metadata(key, value)\n         *         method() { }\n         *     }\n         *\n         */\n        function metadata(metadataKey, metadataValue) {\n            function decorator(target, propertyKey) {\n                if (!IsObject(target))\n                    throw new TypeError();\n                if (!IsUndefined(propertyKey) && !IsPropertyKey(propertyKey))\n                    throw new TypeError();\n                OrdinaryDefineOwnMetadata(metadataKey, metadataValue, target, propertyKey);\n            }\n            return decorator;\n        }\n        exporter(\"metadata\", metadata);\n        /**\n         * Define a unique metadata entry on the target.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param metadataValue A value that contains attached metadata.\n         * @param target The target object on which to define metadata.\n         * @param propertyKey (Optional) The property key for the target.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example);\n         *\n         *     // property (on constructor)\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example.prototype, \"method\");\n         *\n         *     // decorator factory as metadata-producing annotation.\n         *     function MyAnnotation(options): Decorator {\n         *         return (target, key?) => Reflect.defineMetadata(\"custom:annotation\", options, target, key);\n         *     }\n         *\n         */\n        function defineMetadata(metadataKey, metadataValue, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryDefineOwnMetadata(metadataKey, metadataValue, target, propertyKey);\n        }\n        exporter(\"defineMetadata\", defineMetadata);\n        /**\n         * Gets a value indicating whether the target object or its prototype chain has the provided metadata key defined.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns `true` if the metadata key was defined on the target object or its prototype chain; otherwise, `false`.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function hasMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryHasMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"hasMetadata\", hasMetadata);\n        /**\n         * Gets a value indicating whether the target object has the provided metadata key defined.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns `true` if the metadata key was defined on the target object; otherwise, `false`.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function hasOwnMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryHasOwnMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"hasOwnMetadata\", hasOwnMetadata);\n        /**\n         * Gets the metadata value for the provided metadata key on the target object or its prototype chain.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns The metadata value for the metadata key if found; otherwise, `undefined`.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function getMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryGetMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"getMetadata\", getMetadata);\n        /**\n         * Gets the metadata value for the provided metadata key on the target object.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns The metadata value for the metadata key if found; otherwise, `undefined`.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function getOwnMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryGetOwnMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"getOwnMetadata\", getOwnMetadata);\n        /**\n         * Gets the metadata keys defined on the target object or its prototype chain.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns An array of unique metadata keys.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.getMetadataKeys(Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.getMetadataKeys(Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.getMetadataKeys(Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.getMetadataKeys(Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.getMetadataKeys(Example.prototype, \"method\");\n         *\n         */\n        function getMetadataKeys(target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryMetadataKeys(target, propertyKey);\n        }\n        exporter(\"getMetadataKeys\", getMetadataKeys);\n        /**\n         * Gets the unique metadata keys defined on the target object.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns An array of unique metadata keys.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.getOwnMetadataKeys(Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.getOwnMetadataKeys(Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.getOwnMetadataKeys(Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.getOwnMetadataKeys(Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.getOwnMetadataKeys(Example.prototype, \"method\");\n         *\n         */\n        function getOwnMetadataKeys(target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryOwnMetadataKeys(target, propertyKey);\n        }\n        exporter(\"getOwnMetadataKeys\", getOwnMetadataKeys);\n        /**\n         * Deletes the metadata entry from the target object with the provided key.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns `true` if the metadata entry was found and deleted; otherwise, false.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function deleteMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            var metadataMap = GetOrCreateMetadataMap(target, propertyKey, /*Create*/ false);\n            if (IsUndefined(metadataMap))\n                return false;\n            if (!metadataMap.delete(metadataKey))\n                return false;\n            if (metadataMap.size > 0)\n                return true;\n            var targetMetadata = Metadata.get(target);\n            targetMetadata.delete(propertyKey);\n            if (targetMetadata.size > 0)\n                return true;\n            Metadata.delete(target);\n            return true;\n        }\n        exporter(\"deleteMetadata\", deleteMetadata);\n        function DecorateConstructor(decorators, target) {\n            for (var i = decorators.length - 1; i >= 0; --i) {\n                var decorator = decorators[i];\n                var decorated = decorator(target);\n                if (!IsUndefined(decorated) && !IsNull(decorated)) {\n                    if (!IsConstructor(decorated))\n                        throw new TypeError();\n                    target = decorated;\n                }\n            }\n            return target;\n        }\n        function DecorateProperty(decorators, target, propertyKey, descriptor) {\n            for (var i = decorators.length - 1; i >= 0; --i) {\n                var decorator = decorators[i];\n                var decorated = decorator(target, propertyKey, descriptor);\n                if (!IsUndefined(decorated) && !IsNull(decorated)) {\n                    if (!IsObject(decorated))\n                        throw new TypeError();\n                    descriptor = decorated;\n                }\n            }\n            return descriptor;\n        }\n        function GetOrCreateMetadataMap(O, P, Create) {\n            var targetMetadata = Metadata.get(O);\n            if (IsUndefined(targetMetadata)) {\n                if (!Create)\n                    return undefined;\n                targetMetadata = new _Map();\n                Metadata.set(O, targetMetadata);\n            }\n            var metadataMap = targetMetadata.get(P);\n            if (IsUndefined(metadataMap)) {\n                if (!Create)\n                    return undefined;\n                metadataMap = new _Map();\n                targetMetadata.set(P, metadataMap);\n            }\n            return metadataMap;\n        }\n        // 3.1.1.1 OrdinaryHasMetadata(MetadataKey, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinaryhasmetadata\n        function OrdinaryHasMetadata(MetadataKey, O, P) {\n            var hasOwn = OrdinaryHasOwnMetadata(MetadataKey, O, P);\n            if (hasOwn)\n                return true;\n            var parent = OrdinaryGetPrototypeOf(O);\n            if (!IsNull(parent))\n                return OrdinaryHasMetadata(MetadataKey, parent, P);\n            return false;\n        }\n        // 3.1.2.1 OrdinaryHasOwnMetadata(MetadataKey, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinaryhasownmetadata\n        function OrdinaryHasOwnMetadata(MetadataKey, O, P) {\n            var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ false);\n            if (IsUndefined(metadataMap))\n                return false;\n            return ToBoolean(metadataMap.has(MetadataKey));\n        }\n        // 3.1.3.1 OrdinaryGetMetadata(MetadataKey, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinarygetmetadata\n        function OrdinaryGetMetadata(MetadataKey, O, P) {\n            var hasOwn = OrdinaryHasOwnMetadata(MetadataKey, O, P);\n            if (hasOwn)\n                return OrdinaryGetOwnMetadata(MetadataKey, O, P);\n            var parent = OrdinaryGetPrototypeOf(O);\n            if (!IsNull(parent))\n                return OrdinaryGetMetadata(MetadataKey, parent, P);\n            return undefined;\n        }\n        // 3.1.4.1 OrdinaryGetOwnMetadata(MetadataKey, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinarygetownmetadata\n        function OrdinaryGetOwnMetadata(MetadataKey, O, P) {\n            var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ false);\n            if (IsUndefined(metadataMap))\n                return undefined;\n            return metadataMap.get(MetadataKey);\n        }\n        // 3.1.5.1 OrdinaryDefineOwnMetadata(MetadataKey, MetadataValue, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinarydefineownmetadata\n        function OrdinaryDefineOwnMetadata(MetadataKey, MetadataValue, O, P) {\n            var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ true);\n            metadataMap.set(MetadataKey, MetadataValue);\n        }\n        // 3.1.6.1 OrdinaryMetadataKeys(O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinarymetadatakeys\n        function OrdinaryMetadataKeys(O, P) {\n            var ownKeys = OrdinaryOwnMetadataKeys(O, P);\n            var parent = OrdinaryGetPrototypeOf(O);\n            if (parent === null)\n                return ownKeys;\n            var parentKeys = OrdinaryMetadataKeys(parent, P);\n            if (parentKeys.length <= 0)\n                return ownKeys;\n            if (ownKeys.length <= 0)\n                return parentKeys;\n            var set = new _Set();\n            var keys = [];\n            for (var _i = 0, ownKeys_1 = ownKeys; _i < ownKeys_1.length; _i++) {\n                var key = ownKeys_1[_i];\n                var hasKey = set.has(key);\n                if (!hasKey) {\n                    set.add(key);\n                    keys.push(key);\n                }\n            }\n            for (var _a = 0, parentKeys_1 = parentKeys; _a < parentKeys_1.length; _a++) {\n                var key = parentKeys_1[_a];\n                var hasKey = set.has(key);\n                if (!hasKey) {\n                    set.add(key);\n                    keys.push(key);\n                }\n            }\n            return keys;\n        }\n        // 3.1.7.1 OrdinaryOwnMetadataKeys(O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinaryownmetadatakeys\n        function OrdinaryOwnMetadataKeys(O, P) {\n            var keys = [];\n            var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ false);\n            if (IsUndefined(metadataMap))\n                return keys;\n            var keysObj = metadataMap.keys();\n            var iterator = GetIterator(keysObj);\n            var k = 0;\n            while (true) {\n                var next = IteratorStep(iterator);\n                if (!next) {\n                    keys.length = k;\n                    return keys;\n                }\n                var nextValue = IteratorValue(next);\n                try {\n                    keys[k] = nextValue;\n                }\n                catch (e) {\n                    try {\n                        IteratorClose(iterator);\n                    }\n                    finally {\n                        throw e;\n                    }\n                }\n                k++;\n            }\n        }\n        // 6 ECMAScript Data Typ0es and Values\n        // https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values\n        function Type(x) {\n            if (x === null)\n                return 1 /* Null */;\n            switch (typeof x) {\n                case \"undefined\": return 0 /* Undefined */;\n                case \"boolean\": return 2 /* Boolean */;\n                case \"string\": return 3 /* String */;\n                case \"symbol\": return 4 /* Symbol */;\n                case \"number\": return 5 /* Number */;\n                case \"object\": return x === null ? 1 /* Null */ : 6 /* Object */;\n                default: return 6 /* Object */;\n            }\n        }\n        // 6.1.1 The Undefined Type\n        // https://tc39.github.io/ecma262/#sec-ecmascript-language-types-undefined-type\n        function IsUndefined(x) {\n            return x === undefined;\n        }\n        // 6.1.2 The Null Type\n        // https://tc39.github.io/ecma262/#sec-ecmascript-language-types-null-type\n        function IsNull(x) {\n            return x === null;\n        }\n        // 6.1.5 The Symbol Type\n        // https://tc39.github.io/ecma262/#sec-ecmascript-language-types-symbol-type\n        function IsSymbol(x) {\n            return typeof x === \"symbol\";\n        }\n        // 6.1.7 The Object Type\n        // https://tc39.github.io/ecma262/#sec-object-type\n        function IsObject(x) {\n            return typeof x === \"object\" ? x !== null : typeof x === \"function\";\n        }\n        // 7.1 Type Conversion\n        // https://tc39.github.io/ecma262/#sec-type-conversion\n        // 7.1.1 ToPrimitive(input [, PreferredType])\n        // https://tc39.github.io/ecma262/#sec-toprimitive\n        function ToPrimitive(input, PreferredType) {\n            switch (Type(input)) {\n                case 0 /* Undefined */: return input;\n                case 1 /* Null */: return input;\n                case 2 /* Boolean */: return input;\n                case 3 /* String */: return input;\n                case 4 /* Symbol */: return input;\n                case 5 /* Number */: return input;\n            }\n            var hint = PreferredType === 3 /* String */ ? \"string\" : PreferredType === 5 /* Number */ ? \"number\" : \"default\";\n            var exoticToPrim = GetMethod(input, toPrimitiveSymbol);\n            if (exoticToPrim !== undefined) {\n                var result = exoticToPrim.call(input, hint);\n                if (IsObject(result))\n                    throw new TypeError();\n                return result;\n            }\n            return OrdinaryToPrimitive(input, hint === \"default\" ? \"number\" : hint);\n        }\n        // 7.1.1.1 OrdinaryToPrimitive(O, hint)\n        // https://tc39.github.io/ecma262/#sec-ordinarytoprimitive\n        function OrdinaryToPrimitive(O, hint) {\n            if (hint === \"string\") {\n                var toString_1 = O.toString;\n                if (IsCallable(toString_1)) {\n                    var result = toString_1.call(O);\n                    if (!IsObject(result))\n                        return result;\n                }\n                var valueOf = O.valueOf;\n                if (IsCallable(valueOf)) {\n                    var result = valueOf.call(O);\n                    if (!IsObject(result))\n                        return result;\n                }\n            }\n            else {\n                var valueOf = O.valueOf;\n                if (IsCallable(valueOf)) {\n                    var result = valueOf.call(O);\n                    if (!IsObject(result))\n                        return result;\n                }\n                var toString_2 = O.toString;\n                if (IsCallable(toString_2)) {\n                    var result = toString_2.call(O);\n                    if (!IsObject(result))\n                        return result;\n                }\n            }\n            throw new TypeError();\n        }\n        // 7.1.2 ToBoolean(argument)\n        // https://tc39.github.io/ecma262/2016/#sec-toboolean\n        function ToBoolean(argument) {\n            return !!argument;\n        }\n        // 7.1.12 ToString(argument)\n        // https://tc39.github.io/ecma262/#sec-tostring\n        function ToString(argument) {\n            return \"\" + argument;\n        }\n        // 7.1.14 ToPropertyKey(argument)\n        // https://tc39.github.io/ecma262/#sec-topropertykey\n        function ToPropertyKey(argument) {\n            var key = ToPrimitive(argument, 3 /* String */);\n            if (IsSymbol(key))\n                return key;\n            return ToString(key);\n        }\n        // 7.2 Testing and Comparison Operations\n        // https://tc39.github.io/ecma262/#sec-testing-and-comparison-operations\n        // 7.2.2 IsArray(argument)\n        // https://tc39.github.io/ecma262/#sec-isarray\n        function IsArray(argument) {\n            return Array.isArray\n                ? Array.isArray(argument)\n                : argument instanceof Object\n                    ? argument instanceof Array\n                    : Object.prototype.toString.call(argument) === \"[object Array]\";\n        }\n        // 7.2.3 IsCallable(argument)\n        // https://tc39.github.io/ecma262/#sec-iscallable\n        function IsCallable(argument) {\n            // NOTE: This is an approximation as we cannot check for [[Call]] internal method.\n            return typeof argument === \"function\";\n        }\n        // 7.2.4 IsConstructor(argument)\n        // https://tc39.github.io/ecma262/#sec-isconstructor\n        function IsConstructor(argument) {\n            // NOTE: This is an approximation as we cannot check for [[Construct]] internal method.\n            return typeof argument === \"function\";\n        }\n        // 7.2.7 IsPropertyKey(argument)\n        // https://tc39.github.io/ecma262/#sec-ispropertykey\n        function IsPropertyKey(argument) {\n            switch (Type(argument)) {\n                case 3 /* String */: return true;\n                case 4 /* Symbol */: return true;\n                default: return false;\n            }\n        }\n        // 7.3 Operations on Objects\n        // https://tc39.github.io/ecma262/#sec-operations-on-objects\n        // 7.3.9 GetMethod(V, P)\n        // https://tc39.github.io/ecma262/#sec-getmethod\n        function GetMethod(V, P) {\n            var func = V[P];\n            if (func === undefined || func === null)\n                return undefined;\n            if (!IsCallable(func))\n                throw new TypeError();\n            return func;\n        }\n        // 7.4 Operations on Iterator Objects\n        // https://tc39.github.io/ecma262/#sec-operations-on-iterator-objects\n        function GetIterator(obj) {\n            var method = GetMethod(obj, iteratorSymbol);\n            if (!IsCallable(method))\n                throw new TypeError(); // from Call\n            var iterator = method.call(obj);\n            if (!IsObject(iterator))\n                throw new TypeError();\n            return iterator;\n        }\n        // 7.4.4 IteratorValue(iterResult)\n        // https://tc39.github.io/ecma262/2016/#sec-iteratorvalue\n        function IteratorValue(iterResult) {\n            return iterResult.value;\n        }\n        // 7.4.5 IteratorStep(iterator)\n        // https://tc39.github.io/ecma262/#sec-iteratorstep\n        function IteratorStep(iterator) {\n            var result = iterator.next();\n            return result.done ? false : result;\n        }\n        // 7.4.6 IteratorClose(iterator, completion)\n        // https://tc39.github.io/ecma262/#sec-iteratorclose\n        function IteratorClose(iterator) {\n            var f = iterator[\"return\"];\n            if (f)\n                f.call(iterator);\n        }\n        // 9.1 Ordinary Object Internal Methods and Internal Slots\n        // https://tc39.github.io/ecma262/#sec-ordinary-object-internal-methods-and-internal-slots\n        // 9.1.1.1 OrdinaryGetPrototypeOf(O)\n        // https://tc39.github.io/ecma262/#sec-ordinarygetprototypeof\n        function OrdinaryGetPrototypeOf(O) {\n            var proto = Object.getPrototypeOf(O);\n            if (typeof O !== \"function\" || O === functionPrototype)\n                return proto;\n            // TypeScript doesn't set __proto__ in ES5, as it's non-standard.\n            // Try to determine the superclass constructor. Compatible implementations\n            // must either set __proto__ on a subclass constructor to the superclass constructor,\n            // or ensure each class has a valid `constructor` property on its prototype that\n            // points back to the constructor.\n            // If this is not the same as Function.[[Prototype]], then this is definately inherited.\n            // This is the case when in ES6 or when using __proto__ in a compatible browser.\n            if (proto !== functionPrototype)\n                return proto;\n            // If the super prototype is Object.prototype, null, or undefined, then we cannot determine the heritage.\n            var prototype = O.prototype;\n            var prototypeProto = prototype && Object.getPrototypeOf(prototype);\n            if (prototypeProto == null || prototypeProto === Object.prototype)\n                return proto;\n            // If the constructor was not a function, then we cannot determine the heritage.\n            var constructor = prototypeProto.constructor;\n            if (typeof constructor !== \"function\")\n                return proto;\n            // If we have some kind of self-reference, then we cannot determine the heritage.\n            if (constructor === O)\n                return proto;\n            // we have a pretty good guess at the heritage.\n            return constructor;\n        }\n        // naive Map shim\n        function CreateMapPolyfill() {\n            var cacheSentinel = {};\n            var arraySentinel = [];\n            var MapIterator = /** @class */ (function () {\n                function MapIterator(keys, values, selector) {\n                    this._index = 0;\n                    this._keys = keys;\n                    this._values = values;\n                    this._selector = selector;\n                }\n                MapIterator.prototype[\"@@iterator\"] = function () { return this; };\n                MapIterator.prototype[iteratorSymbol] = function () { return this; };\n                MapIterator.prototype.next = function () {\n                    var index = this._index;\n                    if (index >= 0 && index < this._keys.length) {\n                        var result = this._selector(this._keys[index], this._values[index]);\n                        if (index + 1 >= this._keys.length) {\n                            this._index = -1;\n                            this._keys = arraySentinel;\n                            this._values = arraySentinel;\n                        }\n                        else {\n                            this._index++;\n                        }\n                        return { value: result, done: false };\n                    }\n                    return { value: undefined, done: true };\n                };\n                MapIterator.prototype.throw = function (error) {\n                    if (this._index >= 0) {\n                        this._index = -1;\n                        this._keys = arraySentinel;\n                        this._values = arraySentinel;\n                    }\n                    throw error;\n                };\n                MapIterator.prototype.return = function (value) {\n                    if (this._index >= 0) {\n                        this._index = -1;\n                        this._keys = arraySentinel;\n                        this._values = arraySentinel;\n                    }\n                    return { value: value, done: true };\n                };\n                return MapIterator;\n            }());\n            return /** @class */ (function () {\n                function Map() {\n                    this._keys = [];\n                    this._values = [];\n                    this._cacheKey = cacheSentinel;\n                    this._cacheIndex = -2;\n                }\n                Object.defineProperty(Map.prototype, \"size\", {\n                    get: function () { return this._keys.length; },\n                    enumerable: true,\n                    configurable: true\n                });\n                Map.prototype.has = function (key) { return this._find(key, /*insert*/ false) >= 0; };\n                Map.prototype.get = function (key) {\n                    var index = this._find(key, /*insert*/ false);\n                    return index >= 0 ? this._values[index] : undefined;\n                };\n                Map.prototype.set = function (key, value) {\n                    var index = this._find(key, /*insert*/ true);\n                    this._values[index] = value;\n                    return this;\n                };\n                Map.prototype.delete = function (key) {\n                    var index = this._find(key, /*insert*/ false);\n                    if (index >= 0) {\n                        var size = this._keys.length;\n                        for (var i = index + 1; i < size; i++) {\n                            this._keys[i - 1] = this._keys[i];\n                            this._values[i - 1] = this._values[i];\n                        }\n                        this._keys.length--;\n                        this._values.length--;\n                        if (key === this._cacheKey) {\n                            this._cacheKey = cacheSentinel;\n                            this._cacheIndex = -2;\n                        }\n                        return true;\n                    }\n                    return false;\n                };\n                Map.prototype.clear = function () {\n                    this._keys.length = 0;\n                    this._values.length = 0;\n                    this._cacheKey = cacheSentinel;\n                    this._cacheIndex = -2;\n                };\n                Map.prototype.keys = function () { return new MapIterator(this._keys, this._values, getKey); };\n                Map.prototype.values = function () { return new MapIterator(this._keys, this._values, getValue); };\n                Map.prototype.entries = function () { return new MapIterator(this._keys, this._values, getEntry); };\n                Map.prototype[\"@@iterator\"] = function () { return this.entries(); };\n                Map.prototype[iteratorSymbol] = function () { return this.entries(); };\n                Map.prototype._find = function (key, insert) {\n                    if (this._cacheKey !== key) {\n                        this._cacheIndex = this._keys.indexOf(this._cacheKey = key);\n                    }\n                    if (this._cacheIndex < 0 && insert) {\n                        this._cacheIndex = this._keys.length;\n                        this._keys.push(key);\n                        this._values.push(undefined);\n                    }\n                    return this._cacheIndex;\n                };\n                return Map;\n            }());\n            function getKey(key, _) {\n                return key;\n            }\n            function getValue(_, value) {\n                return value;\n            }\n            function getEntry(key, value) {\n                return [key, value];\n            }\n        }\n        // naive Set shim\n        function CreateSetPolyfill() {\n            return /** @class */ (function () {\n                function Set() {\n                    this._map = new _Map();\n                }\n                Object.defineProperty(Set.prototype, \"size\", {\n                    get: function () { return this._map.size; },\n                    enumerable: true,\n                    configurable: true\n                });\n                Set.prototype.has = function (value) { return this._map.has(value); };\n                Set.prototype.add = function (value) { return this._map.set(value, value), this; };\n                Set.prototype.delete = function (value) { return this._map.delete(value); };\n                Set.prototype.clear = function () { this._map.clear(); };\n                Set.prototype.keys = function () { return this._map.keys(); };\n                Set.prototype.values = function () { return this._map.values(); };\n                Set.prototype.entries = function () { return this._map.entries(); };\n                Set.prototype[\"@@iterator\"] = function () { return this.keys(); };\n                Set.prototype[iteratorSymbol] = function () { return this.keys(); };\n                return Set;\n            }());\n        }\n        // naive WeakMap shim\n        function CreateWeakMapPolyfill() {\n            var UUID_SIZE = 16;\n            var keys = HashMap.create();\n            var rootKey = CreateUniqueKey();\n            return /** @class */ (function () {\n                function WeakMap() {\n                    this._key = CreateUniqueKey();\n                }\n                WeakMap.prototype.has = function (target) {\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ false);\n                    return table !== undefined ? HashMap.has(table, this._key) : false;\n                };\n                WeakMap.prototype.get = function (target) {\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ false);\n                    return table !== undefined ? HashMap.get(table, this._key) : undefined;\n                };\n                WeakMap.prototype.set = function (target, value) {\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ true);\n                    table[this._key] = value;\n                    return this;\n                };\n                WeakMap.prototype.delete = function (target) {\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ false);\n                    return table !== undefined ? delete table[this._key] : false;\n                };\n                WeakMap.prototype.clear = function () {\n                    // NOTE: not a real clear, just makes the previous data unreachable\n                    this._key = CreateUniqueKey();\n                };\n                return WeakMap;\n            }());\n            function CreateUniqueKey() {\n                var key;\n                do\n                    key = \"@@WeakMap@@\" + CreateUUID();\n                while (HashMap.has(keys, key));\n                keys[key] = true;\n                return key;\n            }\n            function GetOrCreateWeakMapTable(target, create) {\n                if (!hasOwn.call(target, rootKey)) {\n                    if (!create)\n                        return undefined;\n                    Object.defineProperty(target, rootKey, { value: HashMap.create() });\n                }\n                return target[rootKey];\n            }\n            function FillRandomBytes(buffer, size) {\n                for (var i = 0; i < size; ++i)\n                    buffer[i] = Math.random() * 0xff | 0;\n                return buffer;\n            }\n            function GenRandomBytes(size) {\n                if (typeof Uint8Array === \"function\") {\n                    if (typeof crypto !== \"undefined\")\n                        return crypto.getRandomValues(new Uint8Array(size));\n                    if (typeof msCrypto !== \"undefined\")\n                        return msCrypto.getRandomValues(new Uint8Array(size));\n                    return FillRandomBytes(new Uint8Array(size), size);\n                }\n                return FillRandomBytes(new Array(size), size);\n            }\n            function CreateUUID() {\n                var data = GenRandomBytes(UUID_SIZE);\n                // mark as random - RFC 4122  4.4\n                data[6] = data[6] & 0x4f | 0x40;\n                data[8] = data[8] & 0xbf | 0x80;\n                var result = \"\";\n                for (var offset = 0; offset < UUID_SIZE; ++offset) {\n                    var byte = data[offset];\n                    if (offset === 4 || offset === 6 || offset === 8)\n                        result += \"-\";\n                    if (byte < 16)\n                        result += \"0\";\n                    result += byte.toString(16).toLowerCase();\n                }\n                return result;\n            }\n        }\n        // uses a heuristic used by v8 and chakra to force an object into dictionary mode.\n        function MakeDictionary(obj) {\n            obj.__ = undefined;\n            delete obj.__;\n            return obj;\n        }\n    });\n})(Reflect || (Reflect = {}));\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __createBinding(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","/** PURE_IMPORTS_START  PURE_IMPORTS_END */\nexport function isScheduler(value) {\n    return value && typeof value.schedule === 'function';\n}\n//# sourceMappingURL=isScheduler.js.map\n","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nimport { Injectable, InjectFlags, ReflectiveInjector } from '@tanbo/di';\r\nimport { ComponentSetter, Interceptor } from './core/_api';\r\n/**\r\n *  Injector \r\n */\r\nlet ComponentInjectors = class ComponentInjectors {\r\n    constructor() {\r\n        this.injectors = new Map();\r\n    }\r\n    set(componentConstruct, injector) {\r\n        this.injectors.set(componentConstruct, injector);\r\n    }\r\n    get(componentConstruct) {\r\n        return this.injectors.get(componentConstruct) || new ReflectiveInjector(null, []);\r\n    }\r\n    destroy() {\r\n        this.injectors.forEach(injector => {\r\n            var _a, _b, _c, _d;\r\n            (_b = (_a = injector.get(Interceptor, null, InjectFlags.Self)) === null || _a === void 0 ? void 0 : _a.onDestroy) === null || _b === void 0 ? void 0 : _b.call(_a);\r\n            (_d = (_c = injector.get(ComponentSetter, null, InjectFlags.Self)) === null || _c === void 0 ? void 0 : _c.onDestroy) === null || _d === void 0 ? void 0 : _d.call(_c);\r\n        });\r\n    }\r\n};\r\nComponentInjectors = __decorate([\r\n    Injectable()\r\n], ComponentInjectors);\r\nexport { ComponentInjectors };\r\n//# sourceMappingURL=component-injectors.js.map","/** PURE_IMPORTS_START  PURE_IMPORTS_END */\nvar UnsubscriptionErrorImpl = /*@__PURE__*/ (function () {\n    function UnsubscriptionErrorImpl(errors) {\n        Error.call(this);\n        this.message = errors ?\n            errors.length + \" errors occurred during unsubscription:\\n\" + errors.map(function (err, i) { return i + 1 + \") \" + err.toString(); }).join('\\n  ') : '';\n        this.name = 'UnsubscriptionError';\n        this.errors = errors;\n        return this;\n    }\n    UnsubscriptionErrorImpl.prototype = /*@__PURE__*/ Object.create(Error.prototype);\n    return UnsubscriptionErrorImpl;\n})();\nexport var UnsubscriptionError = UnsubscriptionErrorImpl;\n//# sourceMappingURL=UnsubscriptionError.js.map\n","/** PURE_IMPORTS_START _util_isArray,_util_isObject,_util_isFunction,_util_UnsubscriptionError PURE_IMPORTS_END */\nimport { isArray } from './util/isArray';\nimport { isObject } from './util/isObject';\nimport { isFunction } from './util/isFunction';\nimport { UnsubscriptionError } from './util/UnsubscriptionError';\nvar Subscription = /*@__PURE__*/ (function () {\n    function Subscription(unsubscribe) {\n        this.closed = false;\n        this._parentOrParents = null;\n        this._subscriptions = null;\n        if (unsubscribe) {\n            this._ctorUnsubscribe = true;\n            this._unsubscribe = unsubscribe;\n        }\n    }\n    Subscription.prototype.unsubscribe = function () {\n        var errors;\n        if (this.closed) {\n            return;\n        }\n        var _a = this, _parentOrParents = _a._parentOrParents, _ctorUnsubscribe = _a._ctorUnsubscribe, _unsubscribe = _a._unsubscribe, _subscriptions = _a._subscriptions;\n        this.closed = true;\n        this._parentOrParents = null;\n        this._subscriptions = null;\n        if (_parentOrParents instanceof Subscription) {\n            _parentOrParents.remove(this);\n        }\n        else if (_parentOrParents !== null) {\n            for (var index = 0; index < _parentOrParents.length; ++index) {\n                var parent_1 = _parentOrParents[index];\n                parent_1.remove(this);\n            }\n        }\n        if (isFunction(_unsubscribe)) {\n            if (_ctorUnsubscribe) {\n                this._unsubscribe = undefined;\n            }\n            try {\n                _unsubscribe.call(this);\n            }\n            catch (e) {\n                errors = e instanceof UnsubscriptionError ? flattenUnsubscriptionErrors(e.errors) : [e];\n            }\n        }\n        if (isArray(_subscriptions)) {\n            var index = -1;\n            var len = _subscriptions.length;\n            while (++index < len) {\n                var sub = _subscriptions[index];\n                if (isObject(sub)) {\n                    try {\n                        sub.unsubscribe();\n                    }\n                    catch (e) {\n                        errors = errors || [];\n                        if (e instanceof UnsubscriptionError) {\n                            errors = errors.concat(flattenUnsubscriptionErrors(e.errors));\n                        }\n                        else {\n                            errors.push(e);\n                        }\n                    }\n                }\n            }\n        }\n        if (errors) {\n            throw new UnsubscriptionError(errors);\n        }\n    };\n    Subscription.prototype.add = function (teardown) {\n        var subscription = teardown;\n        if (!teardown) {\n            return Subscription.EMPTY;\n        }\n        switch (typeof teardown) {\n            case 'function':\n                subscription = new Subscription(teardown);\n            case 'object':\n                if (subscription === this || subscription.closed || typeof subscription.unsubscribe !== 'function') {\n                    return subscription;\n                }\n                else if (this.closed) {\n                    subscription.unsubscribe();\n                    return subscription;\n                }\n                else if (!(subscription instanceof Subscription)) {\n                    var tmp = subscription;\n                    subscription = new Subscription();\n                    subscription._subscriptions = [tmp];\n                }\n                break;\n            default: {\n                throw new Error('unrecognized teardown ' + teardown + ' added to Subscription.');\n            }\n        }\n        var _parentOrParents = subscription._parentOrParents;\n        if (_parentOrParents === null) {\n            subscription._parentOrParents = this;\n        }\n        else if (_parentOrParents instanceof Subscription) {\n            if (_parentOrParents === this) {\n                return subscription;\n            }\n            subscription._parentOrParents = [_parentOrParents, this];\n        }\n        else if (_parentOrParents.indexOf(this) === -1) {\n            _parentOrParents.push(this);\n        }\n        else {\n            return subscription;\n        }\n        var subscriptions = this._subscriptions;\n        if (subscriptions === null) {\n            this._subscriptions = [subscription];\n        }\n        else {\n            subscriptions.push(subscription);\n        }\n        return subscription;\n    };\n    Subscription.prototype.remove = function (subscription) {\n        var subscriptions = this._subscriptions;\n        if (subscriptions) {\n            var subscriptionIndex = subscriptions.indexOf(subscription);\n            if (subscriptionIndex !== -1) {\n                subscriptions.splice(subscriptionIndex, 1);\n            }\n        }\n    };\n    Subscription.EMPTY = (function (empty) {\n        empty.closed = true;\n        return empty;\n    }(new Subscription()));\n    return Subscription;\n}());\nexport { Subscription };\nfunction flattenUnsubscriptionErrors(errors) {\n    return errors.reduce(function (errs, err) { return errs.concat((err instanceof UnsubscriptionError) ? err.errors : err); }, []);\n}\n//# sourceMappingURL=Subscription.js.map\n","/** PURE_IMPORTS_START tslib,_map,_observable_from,_innerSubscribe PURE_IMPORTS_END */\nimport * as tslib_1 from \"tslib\";\nimport { map } from './map';\nimport { from } from '../observable/from';\nimport { SimpleOuterSubscriber, SimpleInnerSubscriber, innerSubscribe } from '../innerSubscribe';\nexport function mergeMap(project, resultSelector, concurrent) {\n    if (concurrent === void 0) {\n        concurrent = Number.POSITIVE_INFINITY;\n    }\n    if (typeof resultSelector === 'function') {\n        return function (source) { return source.pipe(mergeMap(function (a, i) { return from(project(a, i)).pipe(map(function (b, ii) { return resultSelector(a, b, i, ii); })); }, concurrent)); };\n    }\n    else if (typeof resultSelector === 'number') {\n        concurrent = resultSelector;\n    }\n    return function (source) { return source.lift(new MergeMapOperator(project, concurrent)); };\n}\nvar MergeMapOperator = /*@__PURE__*/ (function () {\n    function MergeMapOperator(project, concurrent) {\n        if (concurrent === void 0) {\n            concurrent = Number.POSITIVE_INFINITY;\n        }\n        this.project = project;\n        this.concurrent = concurrent;\n    }\n    MergeMapOperator.prototype.call = function (observer, source) {\n        return source.subscribe(new MergeMapSubscriber(observer, this.project, this.concurrent));\n    };\n    return MergeMapOperator;\n}());\nexport { MergeMapOperator };\nvar MergeMapSubscriber = /*@__PURE__*/ (function (_super) {\n    tslib_1.__extends(MergeMapSubscriber, _super);\n    function MergeMapSubscriber(destination, project, concurrent) {\n        if (concurrent === void 0) {\n            concurrent = Number.POSITIVE_INFINITY;\n        }\n        var _this = _super.call(this, destination) || this;\n        _this.project = project;\n        _this.concurrent = concurrent;\n        _this.hasCompleted = false;\n        _this.buffer = [];\n        _this.active = 0;\n        _this.index = 0;\n        return _this;\n    }\n    MergeMapSubscriber.prototype._next = function (value) {\n        if (this.active < this.concurrent) {\n            this._tryNext(value);\n        }\n        else {\n            this.buffer.push(value);\n        }\n    };\n    MergeMapSubscriber.prototype._tryNext = function (value) {\n        var result;\n        var index = this.index++;\n        try {\n            result = this.project(value, index);\n        }\n        catch (err) {\n            this.destination.error(err);\n            return;\n        }\n        this.active++;\n        this._innerSub(result);\n    };\n    MergeMapSubscriber.prototype._innerSub = function (ish) {\n        var innerSubscriber = new SimpleInnerSubscriber(this);\n        var destination = this.destination;\n        destination.add(innerSubscriber);\n        var innerSubscription = innerSubscribe(ish, innerSubscriber);\n        if (innerSubscription !== innerSubscriber) {\n            destination.add(innerSubscription);\n        }\n    };\n    MergeMapSubscriber.prototype._complete = function () {\n        this.hasCompleted = true;\n        if (this.active === 0 && this.buffer.length === 0) {\n            this.destination.complete();\n        }\n        this.unsubscribe();\n    };\n    MergeMapSubscriber.prototype.notifyNext = function (innerValue) {\n        this.destination.next(innerValue);\n    };\n    MergeMapSubscriber.prototype.notifyComplete = function () {\n        var buffer = this.buffer;\n        this.active--;\n        if (buffer.length > 0) {\n            this._next(buffer.shift());\n        }\n        else if (this.active === 0 && this.hasCompleted) {\n            this.destination.complete();\n        }\n    };\n    return MergeMapSubscriber;\n}(SimpleOuterSubscriber));\nexport { MergeMapSubscriber };\nexport var flatMap = mergeMap;\n//# sourceMappingURL=mergeMap.js.map\n","/** PURE_IMPORTS_START _mergeMap,_util_identity PURE_IMPORTS_END */\nimport { mergeMap } from './mergeMap';\nimport { identity } from '../util/identity';\nexport function mergeAll(concurrent) {\n    if (concurrent === void 0) {\n        concurrent = Number.POSITIVE_INFINITY;\n    }\n    return mergeMap(identity, concurrent);\n}\n//# sourceMappingURL=mergeAll.js.map\n","/** PURE_IMPORTS_START _Observable,_util_isScheduler,_operators_mergeAll,_fromArray PURE_IMPORTS_END */\nimport { Observable } from '../Observable';\nimport { isScheduler } from '../util/isScheduler';\nimport { mergeAll } from '../operators/mergeAll';\nimport { fromArray } from './fromArray';\nexport function merge() {\n    var observables = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        observables[_i] = arguments[_i];\n    }\n    var concurrent = Number.POSITIVE_INFINITY;\n    var scheduler = null;\n    var last = observables[observables.length - 1];\n    if (isScheduler(last)) {\n        scheduler = observables.pop();\n        if (observables.length > 1 && typeof observables[observables.length - 1] === 'number') {\n            concurrent = observables.pop();\n        }\n    }\n    else if (typeof last === 'number') {\n        concurrent = observables.pop();\n    }\n    if (scheduler === null && observables.length === 1 && observables[0] instanceof Observable) {\n        return observables[0];\n    }\n    return mergeAll(concurrent)(fromArray(observables, scheduler));\n}\n//# sourceMappingURL=merge.js.map\n","/** PURE_IMPORTS_START  PURE_IMPORTS_END */\nexport function noop() { }\n//# sourceMappingURL=noop.js.map\n","/** PURE_IMPORTS_START tslib,_Subscriber,_util_noop,_util_isFunction PURE_IMPORTS_END */\nimport * as tslib_1 from \"tslib\";\nimport { Subscriber } from '../Subscriber';\nimport { noop } from '../util/noop';\nimport { isFunction } from '../util/isFunction';\nexport function tap(nextOrObserver, error, complete) {\n    return function tapOperatorFunction(source) {\n        return source.lift(new DoOperator(nextOrObserver, error, complete));\n    };\n}\nvar DoOperator = /*@__PURE__*/ (function () {\n    function DoOperator(nextOrObserver, error, complete) {\n        this.nextOrObserver = nextOrObserver;\n        this.error = error;\n        this.complete = complete;\n    }\n    DoOperator.prototype.call = function (subscriber, source) {\n        return source.subscribe(new TapSubscriber(subscriber, this.nextOrObserver, this.error, this.complete));\n    };\n    return DoOperator;\n}());\nvar TapSubscriber = /*@__PURE__*/ (function (_super) {\n    tslib_1.__extends(TapSubscriber, _super);\n    function TapSubscriber(destination, observerOrNext, error, complete) {\n        var _this = _super.call(this, destination) || this;\n        _this._tapNext = noop;\n        _this._tapError = noop;\n        _this._tapComplete = noop;\n        _this._tapError = error || noop;\n        _this._tapComplete = complete || noop;\n        if (isFunction(observerOrNext)) {\n            _this._context = _this;\n            _this._tapNext = observerOrNext;\n        }\n        else if (observerOrNext) {\n            _this._context = observerOrNext;\n            _this._tapNext = observerOrNext.next || noop;\n            _this._tapError = observerOrNext.error || noop;\n            _this._tapComplete = observerOrNext.complete || noop;\n        }\n        return _this;\n    }\n    TapSubscriber.prototype._next = function (value) {\n        try {\n            this._tapNext.call(this._context, value);\n        }\n        catch (err) {\n            this.destination.error(err);\n            return;\n        }\n        this.destination.next(value);\n    };\n    TapSubscriber.prototype._error = function (err) {\n        try {\n            this._tapError.call(this._context, err);\n        }\n        catch (err) {\n            this.destination.error(err);\n            return;\n        }\n        this.destination.error(err);\n    };\n    TapSubscriber.prototype._complete = function () {\n        try {\n            this._tapComplete.call(this._context);\n        }\n        catch (err) {\n            this.destination.error(err);\n            return;\n        }\n        return this.destination.complete();\n    };\n    return TapSubscriber;\n}(Subscriber));\n//# sourceMappingURL=tap.js.map\n","/** PURE_IMPORTS_START  PURE_IMPORTS_END */\nexport var observable = /*@__PURE__*/ (function () { return typeof Symbol === 'function' && Symbol.observable || '@@observable'; })();\n//# sourceMappingURL=observable.js.map\n","export function makeError(name) {\r\n    return function textbusError(message) {\r\n        const error = new Error(message);\r\n        error.name = `[TextBusError: ${name}]`;\r\n        error.stack = error.stack.replace(/\\n.*?(?=\\n)/, '');\r\n        return error;\r\n    };\r\n}\r\n//# sourceMappingURL=make-error.js.map","/** PURE_IMPORTS_START tslib,_Subscriber,_Observable,_util_subscribeTo PURE_IMPORTS_END */\nimport * as tslib_1 from \"tslib\";\nimport { Subscriber } from './Subscriber';\nimport { Observable } from './Observable';\nimport { subscribeTo } from './util/subscribeTo';\nvar SimpleInnerSubscriber = /*@__PURE__*/ (function (_super) {\n    tslib_1.__extends(SimpleInnerSubscriber, _super);\n    function SimpleInnerSubscriber(parent) {\n        var _this = _super.call(this) || this;\n        _this.parent = parent;\n        return _this;\n    }\n    SimpleInnerSubscriber.prototype._next = function (value) {\n        this.parent.notifyNext(value);\n    };\n    SimpleInnerSubscriber.prototype._error = function (error) {\n        this.parent.notifyError(error);\n        this.unsubscribe();\n    };\n    SimpleInnerSubscriber.prototype._complete = function () {\n        this.parent.notifyComplete();\n        this.unsubscribe();\n    };\n    return SimpleInnerSubscriber;\n}(Subscriber));\nexport { SimpleInnerSubscriber };\nvar ComplexInnerSubscriber = /*@__PURE__*/ (function (_super) {\n    tslib_1.__extends(ComplexInnerSubscriber, _super);\n    function ComplexInnerSubscriber(parent, outerValue, outerIndex) {\n        var _this = _super.call(this) || this;\n        _this.parent = parent;\n        _this.outerValue = outerValue;\n        _this.outerIndex = outerIndex;\n        return _this;\n    }\n    ComplexInnerSubscriber.prototype._next = function (value) {\n        this.parent.notifyNext(this.outerValue, value, this.outerIndex, this);\n    };\n    ComplexInnerSubscriber.prototype._error = function (error) {\n        this.parent.notifyError(error);\n        this.unsubscribe();\n    };\n    ComplexInnerSubscriber.prototype._complete = function () {\n        this.parent.notifyComplete(this);\n        this.unsubscribe();\n    };\n    return ComplexInnerSubscriber;\n}(Subscriber));\nexport { ComplexInnerSubscriber };\nvar SimpleOuterSubscriber = /*@__PURE__*/ (function (_super) {\n    tslib_1.__extends(SimpleOuterSubscriber, _super);\n    function SimpleOuterSubscriber() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    SimpleOuterSubscriber.prototype.notifyNext = function (innerValue) {\n        this.destination.next(innerValue);\n    };\n    SimpleOuterSubscriber.prototype.notifyError = function (err) {\n        this.destination.error(err);\n    };\n    SimpleOuterSubscriber.prototype.notifyComplete = function () {\n        this.destination.complete();\n    };\n    return SimpleOuterSubscriber;\n}(Subscriber));\nexport { SimpleOuterSubscriber };\nvar ComplexOuterSubscriber = /*@__PURE__*/ (function (_super) {\n    tslib_1.__extends(ComplexOuterSubscriber, _super);\n    function ComplexOuterSubscriber() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    ComplexOuterSubscriber.prototype.notifyNext = function (_outerValue, innerValue, _outerIndex, _innerSub) {\n        this.destination.next(innerValue);\n    };\n    ComplexOuterSubscriber.prototype.notifyError = function (error) {\n        this.destination.error(error);\n    };\n    ComplexOuterSubscriber.prototype.notifyComplete = function (_innerSub) {\n        this.destination.complete();\n    };\n    return ComplexOuterSubscriber;\n}(Subscriber));\nexport { ComplexOuterSubscriber };\nexport function innerSubscribe(result, innerSubscriber) {\n    if (innerSubscriber.closed) {\n        return undefined;\n    }\n    if (result instanceof Observable) {\n        return result.subscribe(innerSubscriber);\n    }\n    var subscription;\n    try {\n        subscription = subscribeTo(result)(innerSubscriber);\n    }\n    catch (error) {\n        innerSubscriber.error(error);\n    }\n    return subscription;\n}\n//# sourceMappingURL=innerSubscribe.js.map\n","/** PURE_IMPORTS_START _Observable,_Subscription,_symbol_observable PURE_IMPORTS_END */\nimport { Observable } from '../Observable';\nimport { Subscription } from '../Subscription';\nimport { observable as Symbol_observable } from '../symbol/observable';\nexport function scheduleObservable(input, scheduler) {\n    return new Observable(function (subscriber) {\n        var sub = new Subscription();\n        sub.add(scheduler.schedule(function () {\n            var observable = input[Symbol_observable]();\n            sub.add(observable.subscribe({\n                next: function (value) { sub.add(scheduler.schedule(function () { return subscriber.next(value); })); },\n                error: function (err) { sub.add(scheduler.schedule(function () { return subscriber.error(err); })); },\n                complete: function () { sub.add(scheduler.schedule(function () { return subscriber.complete(); })); },\n            }));\n        }));\n        return sub;\n    });\n}\n//# sourceMappingURL=scheduleObservable.js.map\n","/** PURE_IMPORTS_START _Observable,_Subscription PURE_IMPORTS_END */\nimport { Observable } from '../Observable';\nimport { Subscription } from '../Subscription';\nexport function schedulePromise(input, scheduler) {\n    return new Observable(function (subscriber) {\n        var sub = new Subscription();\n        sub.add(scheduler.schedule(function () {\n            return input.then(function (value) {\n                sub.add(scheduler.schedule(function () {\n                    subscriber.next(value);\n                    sub.add(scheduler.schedule(function () { return subscriber.complete(); }));\n                }));\n            }, function (err) {\n                sub.add(scheduler.schedule(function () { return subscriber.error(err); }));\n            });\n        }));\n        return sub;\n    });\n}\n//# sourceMappingURL=schedulePromise.js.map\n","/** PURE_IMPORTS_START _Observable,_Subscription,_symbol_iterator PURE_IMPORTS_END */\nimport { Observable } from '../Observable';\nimport { Subscription } from '../Subscription';\nimport { iterator as Symbol_iterator } from '../symbol/iterator';\nexport function scheduleIterable(input, scheduler) {\n    if (!input) {\n        throw new Error('Iterable cannot be null');\n    }\n    return new Observable(function (subscriber) {\n        var sub = new Subscription();\n        var iterator;\n        sub.add(function () {\n            if (iterator && typeof iterator.return === 'function') {\n                iterator.return();\n            }\n        });\n        sub.add(scheduler.schedule(function () {\n            iterator = input[Symbol_iterator]();\n            sub.add(scheduler.schedule(function () {\n                if (subscriber.closed) {\n                    return;\n                }\n                var value;\n                var done;\n                try {\n                    var result = iterator.next();\n                    value = result.value;\n                    done = result.done;\n                }\n                catch (err) {\n                    subscriber.error(err);\n                    return;\n                }\n                if (done) {\n                    subscriber.complete();\n                }\n                else {\n                    subscriber.next(value);\n                    this.schedule();\n                }\n            }));\n        }));\n        return sub;\n    });\n}\n//# sourceMappingURL=scheduleIterable.js.map\n","/** PURE_IMPORTS_START _symbol_observable PURE_IMPORTS_END */\nimport { observable as Symbol_observable } from '../symbol/observable';\nexport function isInteropObservable(input) {\n    return input && typeof input[Symbol_observable] === 'function';\n}\n//# sourceMappingURL=isInteropObservable.js.map\n","/** PURE_IMPORTS_START _symbol_iterator PURE_IMPORTS_END */\nimport { iterator as Symbol_iterator } from '../symbol/iterator';\nexport function isIterable(input) {\n    return input && typeof input[Symbol_iterator] === 'function';\n}\n//# sourceMappingURL=isIterable.js.map\n","/** PURE_IMPORTS_START _scheduleObservable,_schedulePromise,_scheduleArray,_scheduleIterable,_util_isInteropObservable,_util_isPromise,_util_isArrayLike,_util_isIterable PURE_IMPORTS_END */\nimport { scheduleObservable } from './scheduleObservable';\nimport { schedulePromise } from './schedulePromise';\nimport { scheduleArray } from './scheduleArray';\nimport { scheduleIterable } from './scheduleIterable';\nimport { isInteropObservable } from '../util/isInteropObservable';\nimport { isPromise } from '../util/isPromise';\nimport { isArrayLike } from '../util/isArrayLike';\nimport { isIterable } from '../util/isIterable';\nexport function scheduled(input, scheduler) {\n    if (input != null) {\n        if (isInteropObservable(input)) {\n            return scheduleObservable(input, scheduler);\n        }\n        else if (isPromise(input)) {\n            return schedulePromise(input, scheduler);\n        }\n        else if (isArrayLike(input)) {\n            return scheduleArray(input, scheduler);\n        }\n        else if (isIterable(input) || typeof input === 'string') {\n            return scheduleIterable(input, scheduler);\n        }\n    }\n    throw new TypeError((input !== null && typeof input || input) + ' is not observable');\n}\n//# sourceMappingURL=scheduled.js.map\n","/** PURE_IMPORTS_START _Observable,_util_subscribeTo,_scheduled_scheduled PURE_IMPORTS_END */\nimport { Observable } from '../Observable';\nimport { subscribeTo } from '../util/subscribeTo';\nimport { scheduled } from '../scheduled/scheduled';\nexport function from(input, scheduler) {\n    if (!scheduler) {\n        if (input instanceof Observable) {\n            return input;\n        }\n        return new Observable(subscribeTo(input));\n    }\n    else {\n        return scheduled(input, scheduler);\n    }\n}\n//# sourceMappingURL=from.js.map\n","/** PURE_IMPORTS_START  PURE_IMPORTS_END */\nexport function isFunction(x) {\n    return typeof x === 'function';\n}\n//# sourceMappingURL=isFunction.js.map\n","/** PURE_IMPORTS_START  PURE_IMPORTS_END */\nexport var isArrayLike = (function (x) { return x && typeof x.length === 'number' && typeof x !== 'function'; });\n//# sourceMappingURL=isArrayLike.js.map\n","/** PURE_IMPORTS_START _config,_util_hostReportError PURE_IMPORTS_END */\nimport { config } from './config';\nimport { hostReportError } from './util/hostReportError';\nexport var empty = {\n    closed: true,\n    next: function (value) { },\n    error: function (err) {\n        if (config.useDeprecatedSynchronousErrorHandling) {\n            throw err;\n        }\n        else {\n            hostReportError(err);\n        }\n    },\n    complete: function () { }\n};\n//# sourceMappingURL=Observer.js.map\n","/** PURE_IMPORTS_START _Subscriber PURE_IMPORTS_END */\nimport { Subscriber } from '../Subscriber';\nexport function canReportError(observer) {\n    while (observer) {\n        var _a = observer, closed_1 = _a.closed, destination = _a.destination, isStopped = _a.isStopped;\n        if (closed_1 || isStopped) {\n            return false;\n        }\n        else if (destination && destination instanceof Subscriber) {\n            observer = destination;\n        }\n        else {\n            observer = null;\n        }\n    }\n    return true;\n}\n//# sourceMappingURL=canReportError.js.map\n","/** PURE_IMPORTS_START _Subscriber,_symbol_rxSubscriber,_Observer PURE_IMPORTS_END */\nimport { Subscriber } from '../Subscriber';\nimport { rxSubscriber as rxSubscriberSymbol } from '../symbol/rxSubscriber';\nimport { empty as emptyObserver } from '../Observer';\nexport function toSubscriber(nextOrObserver, error, complete) {\n    if (nextOrObserver) {\n        if (nextOrObserver instanceof Subscriber) {\n            return nextOrObserver;\n        }\n        if (nextOrObserver[rxSubscriberSymbol]) {\n            return nextOrObserver[rxSubscriberSymbol]();\n        }\n    }\n    if (!nextOrObserver && !error && !complete) {\n        return new Subscriber(emptyObserver);\n    }\n    return new Subscriber(nextOrObserver, error, complete);\n}\n//# sourceMappingURL=toSubscriber.js.map\n","/** PURE_IMPORTS_START _identity PURE_IMPORTS_END */\nimport { identity } from './identity';\nexport function pipe() {\n    var fns = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        fns[_i] = arguments[_i];\n    }\n    return pipeFromArray(fns);\n}\nexport function pipeFromArray(fns) {\n    if (fns.length === 0) {\n        return identity;\n    }\n    if (fns.length === 1) {\n        return fns[0];\n    }\n    return function piped(input) {\n        return fns.reduce(function (prev, fn) { return fn(prev); }, input);\n    };\n}\n//# sourceMappingURL=pipe.js.map\n","/** PURE_IMPORTS_START _util_canReportError,_util_toSubscriber,_symbol_observable,_util_pipe,_config PURE_IMPORTS_END */\nimport { canReportError } from './util/canReportError';\nimport { toSubscriber } from './util/toSubscriber';\nimport { observable as Symbol_observable } from './symbol/observable';\nimport { pipeFromArray } from './util/pipe';\nimport { config } from './config';\nvar Observable = /*@__PURE__*/ (function () {\n    function Observable(subscribe) {\n        this._isScalar = false;\n        if (subscribe) {\n            this._subscribe = subscribe;\n        }\n    }\n    Observable.prototype.lift = function (operator) {\n        var observable = new Observable();\n        observable.source = this;\n        observable.operator = operator;\n        return observable;\n    };\n    Observable.prototype.subscribe = function (observerOrNext, error, complete) {\n        var operator = this.operator;\n        var sink = toSubscriber(observerOrNext, error, complete);\n        if (operator) {\n            sink.add(operator.call(sink, this.source));\n        }\n        else {\n            sink.add(this.source || (config.useDeprecatedSynchronousErrorHandling && !sink.syncErrorThrowable) ?\n                this._subscribe(sink) :\n                this._trySubscribe(sink));\n        }\n        if (config.useDeprecatedSynchronousErrorHandling) {\n            if (sink.syncErrorThrowable) {\n                sink.syncErrorThrowable = false;\n                if (sink.syncErrorThrown) {\n                    throw sink.syncErrorValue;\n                }\n            }\n        }\n        return sink;\n    };\n    Observable.prototype._trySubscribe = function (sink) {\n        try {\n            return this._subscribe(sink);\n        }\n        catch (err) {\n            if (config.useDeprecatedSynchronousErrorHandling) {\n                sink.syncErrorThrown = true;\n                sink.syncErrorValue = err;\n            }\n            if (canReportError(sink)) {\n                sink.error(err);\n            }\n            else {\n                console.warn(err);\n            }\n        }\n    };\n    Observable.prototype.forEach = function (next, promiseCtor) {\n        var _this = this;\n        promiseCtor = getPromiseCtor(promiseCtor);\n        return new promiseCtor(function (resolve, reject) {\n            var subscription;\n            subscription = _this.subscribe(function (value) {\n                try {\n                    next(value);\n                }\n                catch (err) {\n                    reject(err);\n                    if (subscription) {\n                        subscription.unsubscribe();\n                    }\n                }\n            }, reject, resolve);\n        });\n    };\n    Observable.prototype._subscribe = function (subscriber) {\n        var source = this.source;\n        return source && source.subscribe(subscriber);\n    };\n    Observable.prototype[Symbol_observable] = function () {\n        return this;\n    };\n    Observable.prototype.pipe = function () {\n        var operations = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            operations[_i] = arguments[_i];\n        }\n        if (operations.length === 0) {\n            return this;\n        }\n        return pipeFromArray(operations)(this);\n    };\n    Observable.prototype.toPromise = function (promiseCtor) {\n        var _this = this;\n        promiseCtor = getPromiseCtor(promiseCtor);\n        return new promiseCtor(function (resolve, reject) {\n            var value;\n            _this.subscribe(function (x) { return value = x; }, function (err) { return reject(err); }, function () { return resolve(value); });\n        });\n    };\n    Observable.create = function (subscribe) {\n        return new Observable(subscribe);\n    };\n    return Observable;\n}());\nexport { Observable };\nfunction getPromiseCtor(promiseCtor) {\n    if (!promiseCtor) {\n        promiseCtor = config.Promise || Promise;\n    }\n    if (!promiseCtor) {\n        throw new Error('no Promise impl found');\n    }\n    return promiseCtor;\n}\n//# sourceMappingURL=Observable.js.map\n","/** PURE_IMPORTS_START tslib,_Subscriber PURE_IMPORTS_END */\nimport * as tslib_1 from \"tslib\";\nimport { Subscriber } from '../Subscriber';\nexport function map(project, thisArg) {\n    return function mapOperation(source) {\n        if (typeof project !== 'function') {\n            throw new TypeError('argument is not a function. Are you looking for `mapTo()`?');\n        }\n        return source.lift(new MapOperator(project, thisArg));\n    };\n}\nvar MapOperator = /*@__PURE__*/ (function () {\n    function MapOperator(project, thisArg) {\n        this.project = project;\n        this.thisArg = thisArg;\n    }\n    MapOperator.prototype.call = function (subscriber, source) {\n        return source.subscribe(new MapSubscriber(subscriber, this.project, this.thisArg));\n    };\n    return MapOperator;\n}());\nexport { MapOperator };\nvar MapSubscriber = /*@__PURE__*/ (function (_super) {\n    tslib_1.__extends(MapSubscriber, _super);\n    function MapSubscriber(destination, project, thisArg) {\n        var _this = _super.call(this, destination) || this;\n        _this.project = project;\n        _this.count = 0;\n        _this.thisArg = thisArg || _this;\n        return _this;\n    }\n    MapSubscriber.prototype._next = function (value) {\n        var result;\n        try {\n            result = this.project.call(this.thisArg, value, this.count++);\n        }\n        catch (err) {\n            this.destination.error(err);\n            return;\n        }\n        this.destination.next(result);\n    };\n    return MapSubscriber;\n}(Subscriber));\n//# sourceMappingURL=map.js.map\n","/** PURE_IMPORTS_START  PURE_IMPORTS_END */\nvar ObjectUnsubscribedErrorImpl = /*@__PURE__*/ (function () {\n    function ObjectUnsubscribedErrorImpl() {\n        Error.call(this);\n        this.message = 'object unsubscribed';\n        this.name = 'ObjectUnsubscribedError';\n        return this;\n    }\n    ObjectUnsubscribedErrorImpl.prototype = /*@__PURE__*/ Object.create(Error.prototype);\n    return ObjectUnsubscribedErrorImpl;\n})();\nexport var ObjectUnsubscribedError = ObjectUnsubscribedErrorImpl;\n//# sourceMappingURL=ObjectUnsubscribedError.js.map\n","export const i18n_en_US = {\r\n    /** core library dependency start, no optional */\r\n    editor: {\r\n        noUploader: 'please configure the upload method during initialization!',\r\n        copy: 'copy',\r\n        paste: 'paste',\r\n        cut: 'cut',\r\n        selectAll: 'select all',\r\n        input: {\r\n            noAccessClipboard: 'no access to the clipboard!'\r\n        },\r\n        controlPanel: {\r\n            cancelFixed: 'cancel fixed',\r\n            fixed: 'fixed'\r\n        }\r\n    },\r\n    /** core library dependency end */\r\n    /** optional config */\r\n    plugins: {},\r\n    components: {}\r\n};\r\n//# sourceMappingURL=en_US.js.map","export const i18n_zh_CN = {\r\n    /**  */\r\n    editor: {\r\n        noUploader: ' uploader ',\r\n        copy: '',\r\n        paste: '',\r\n        cut: '',\r\n        selectAll: '',\r\n        input: {\r\n            noAccessClipboard: ''\r\n        },\r\n        controlPanel: {\r\n            cancelFixed: '',\r\n            fixed: ''\r\n        }\r\n    },\r\n    /**  */\r\n    /**  */\r\n    plugins: {},\r\n    components: {}\r\n};\r\n//# sourceMappingURL=zh_CN.js.map","import { createElement, createTextNode } from './_api';\r\nexport class Tab {\r\n    constructor() {\r\n        this.elementRef = createElement('div', {\r\n            classes: ['textbus-tab'],\r\n            children: [\r\n                this.head = createElement('div', {\r\n                    classes: ['textbus-tab-head'],\r\n                    children: [\r\n                        this.btnWrapper = createElement('div', {\r\n                            classes: ['textbus-tab-btn-wrapper']\r\n                        })\r\n                    ]\r\n                }),\r\n                this.viewContainer = createElement('div', {\r\n                    classes: ['textbus-tab-view']\r\n                })\r\n            ]\r\n        });\r\n    }\r\n    show(config) {\r\n        this.btnWrapper.innerHTML = '';\r\n        this.viewContainer.innerHTML = '';\r\n        const btns = config.map((item, index) => {\r\n            const btn = createElement('button', {\r\n                classes: ['textbus-tab-btn'],\r\n                children: [\r\n                    createTextNode(item.label)\r\n                ]\r\n            });\r\n            btn.addEventListener('click', () => {\r\n                btns.forEach(b => b.classList.remove('textbus-tab-btn-active'));\r\n                btn.classList.add('textbus-tab-btn-active');\r\n                this.viewContainer.innerHTML = '';\r\n                this.viewContainer.appendChild(item.view);\r\n            });\r\n            this.btnWrapper.appendChild(btn);\r\n            if (index === 0) {\r\n                btn.classList.add('textbus-tab-btn-active');\r\n                this.viewContainer.appendChild(item.view);\r\n            }\r\n            return btn;\r\n        });\r\n    }\r\n}\r\n//# sourceMappingURL=tab.js.map","export function createElement(tagName, options = {}) {\r\n    const el = document.createElement(tagName);\r\n    if (options.classes) {\r\n        el.classList.add(...options.classes);\r\n    }\r\n    if (options.attrs) {\r\n        Object.keys(options.attrs).forEach(key => {\r\n            el.setAttribute(key, options.attrs[key]);\r\n        });\r\n    }\r\n    if (options.props) {\r\n        Object.keys(options.props).forEach(key => {\r\n            el[key] = options.props[key];\r\n        });\r\n    }\r\n    if (options.children) {\r\n        options.children.filter(i => i).forEach(item => {\r\n            el.appendChild(item);\r\n        });\r\n    }\r\n    if (options.onCreated) {\r\n        options.onCreated(el);\r\n    }\r\n    return el;\r\n}\r\nexport function createTextNode(content) {\r\n    return document.createTextNode(content);\r\n}\r\n//# sourceMappingURL=uikit.js.map","export const iframeHTML = `\r\n<!DOCTYPE html>\r\n<html lang=\"zh\">\r\n<head>\r\n  <meta charset=\"UTF-8\">\r\n  <meta name=\"viewport\"\r\n        content=\"width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0\">\r\n  <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\r\n  <title>@tanbo/textbus</title>\r\n  <style>\r\n    html {\r\n      height: 100%\r\n    }\r\n    body {\r\n      padding: 0 8px;\r\n      margin: 0;\r\n      min-height: 100%;\r\n      box-sizing: border-box;\r\n      text-size-adjust: none;\r\n      cursor: text;\r\n      text-rendering: optimizeLegibility;\r\n      -webkit-font-smoothing: antialiased;\r\n    }\r\n    ::selection {\r\n      background-color: rgba(18, 150, 219, .2);\r\n    }\r\n    [textbus-editable=off] > * {\r\n      user-select: none;\r\n      cursor: default;\r\n    }\r\n    [textbus-editable=on] {\r\n      user-select: text;\r\n      cursor: text;\r\n    }\r\n  </style>\r\n</head>\r\n<body></body>\r\n</html>\r\n`.replace(/\\n/g, '').replace(/\\s+/g, ' ').replace(/'/g, '\\\\\\'');\r\n//# sourceMappingURL=iframe-html.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nimport { Injectable } from '@tanbo/di';\r\nimport { Subject } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\nimport { createElement } from './_utils/_api';\r\nimport { iframeHTML } from './iframe-html';\r\nimport { EditorController } from '../editor-controller';\r\nlet Layout = class Layout {\r\n    constructor(editorController) {\r\n        this.editorController = editorController;\r\n        this._topBar = createElement('div', {\r\n            classes: ['textbus-ui-top']\r\n        });\r\n        this._bottomBar = createElement('div', {\r\n            classes: ['textbus-ui-bottom', 'textbus-status-bar']\r\n        });\r\n        this.isAppendTop = false;\r\n        this.isAppendBottom = false;\r\n        this.onReadyEvent = new Subject();\r\n        this.subs = [];\r\n        this.onReady = this.onReadyEvent.asObservable();\r\n        this.iframe = this.createEditableFrame();\r\n        const onMessage = (ev) => {\r\n            if (ev.data === 'complete') {\r\n                if (this.iframe.contentDocument) {\r\n                    window.removeEventListener('message', onMessage);\r\n                    this.onReadyEvent.next(this.iframe.contentDocument);\r\n                    this.ready();\r\n                }\r\n            }\r\n        };\r\n        window.addEventListener('message', onMessage);\r\n        this.container = createElement('div', {\r\n            classes: ['textbus-container'],\r\n            children: [\r\n                this.workbench = createElement('div', {\r\n                    classes: ['textbus-ui-workbench'],\r\n                    children: [\r\n                        this.dashboard = createElement('div', {\r\n                            classes: ['textbus-ui-dashboard'],\r\n                            children: [\r\n                                this.leftContainer = createElement('div', {\r\n                                    classes: ['textbus-ui-left']\r\n                                }),\r\n                                this.viewer = createElement('div', {\r\n                                    classes: ['textbus-ui-viewer'],\r\n                                    children: [\r\n                                        this.scroller = createElement('div', {\r\n                                            classes: ['textbus-ui-scroll'],\r\n                                            children: [\r\n                                                this.pageContainer = createElement('div', {\r\n                                                    classes: ['textbus-ui-page'],\r\n                                                    children: [\r\n                                                        this.docContainer = createElement('div', {\r\n                                                            classes: ['textbus-ui-doc'],\r\n                                                            children: [\r\n                                                                this.iframe\r\n                                                            ]\r\n                                                        })\r\n                                                    ]\r\n                                                }),\r\n                                                this.loading = createElement('div', {\r\n                                                    classes: ['textbus-loading'],\r\n                                                    props: {\r\n                                                        innerHTML: 'TextBus'.split('').map(t => `<div>${t}</div>`).join('')\r\n                                                    }\r\n                                                })\r\n                                            ]\r\n                                        })\r\n                                    ]\r\n                                }),\r\n                                this.rightContainer = createElement('div', {\r\n                                    classes: ['textbus-ui-right']\r\n                                })\r\n                            ]\r\n                        })\r\n                    ]\r\n                })\r\n            ]\r\n        });\r\n        this.subs.push(this.editorController.onStateChange.pipe(map(s => s.readonly)).subscribe(b => {\r\n            if (b) {\r\n                this.container.classList.add('textbus-readonly');\r\n            }\r\n            else {\r\n                this.container.classList.remove('textbus-readonly');\r\n            }\r\n        }));\r\n    }\r\n    get topBar() {\r\n        if (!this.isAppendTop) {\r\n            this.container.prepend(this._topBar);\r\n            this.isAppendTop = true;\r\n        }\r\n        return this._topBar;\r\n    }\r\n    get bottomBar() {\r\n        if (!this.isAppendBottom) {\r\n            this.container.append(this._bottomBar);\r\n            this.isAppendBottom = true;\r\n        }\r\n        return this._bottomBar;\r\n    }\r\n    setTheme(theme) {\r\n        this.container.classList.add('textbus-theme-' + theme);\r\n    }\r\n    destroy() {\r\n        this.subs.forEach(i => i.unsubscribe());\r\n    }\r\n    ready() {\r\n        this.loading.classList.add('textbus-loading-done');\r\n        this.pageContainer.classList.add('textbus-ui-page-ready');\r\n        setTimeout(() => {\r\n            this.scroller.removeChild(this.loading);\r\n        }, 300);\r\n    }\r\n    createEditableFrame() {\r\n        return createElement('iframe', {\r\n            attrs: {\r\n                src: `javascript:void(\r\n      (function () {\r\n        document.open();\r\n        if('${document.domain}') {\r\n          document.domain='${document.domain}';\r\n        }\r\n        document.write('${iframeHTML}');\r\n        document.close();\r\n        window.parent.postMessage('complete','${document.domain ? location.origin : '*'}');\r\n      })()\r\n      )`,\r\n                scrolling: 'no'\r\n            },\r\n            classes: ['textbus-frame']\r\n        });\r\n    }\r\n};\r\nLayout = __decorate([\r\n    Injectable(),\r\n    __metadata(\"design:paramtypes\", [EditorController])\r\n], Layout);\r\nexport { Layout };\r\n//# sourceMappingURL=layout.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nimport { Injectable } from '@tanbo/di';\r\nimport { createElement } from '../_utils/_api';\r\nimport { EditorController } from '../../editor-controller';\r\nimport { Tab } from '../_utils/tab';\r\nimport { Layout } from '../layout';\r\nimport { I18n } from '../../i18n/i18n';\r\nlet UIControlPanel = class UIControlPanel {\r\n    constructor(editorController, i18n, layout) {\r\n        this.editorController = editorController;\r\n        this.i18n = i18n;\r\n        this.layout = layout;\r\n        this._fixed = false;\r\n        this.subs = [];\r\n        this.oldViews = [];\r\n        this.tab = new Tab();\r\n    }\r\n    set fixed(b) {\r\n        this._fixed = b;\r\n        if (b) {\r\n            this.layout.dashboard.insertBefore(this.elementRef, this.layout.rightContainer);\r\n            this.elementRef.classList.add('textbus-control-panel-fixed');\r\n            this.fixedBtn.classList.add('textbus-control-panel-fixed-btn-active');\r\n            this.fixedBtn.title = this.i18n.get('editor.controlPanel.cancelFixed');\r\n        }\r\n        else {\r\n            this.layout.viewer.append(this.elementRef);\r\n            this.elementRef.classList.remove('textbus-control-panel-fixed');\r\n            this.fixedBtn.classList.remove('textbus-control-panel-fixed-btn-active');\r\n            this.fixedBtn.title = this.i18n.get('editor.controlPanel.fixed');\r\n        }\r\n    }\r\n    get fixed() {\r\n        return this._fixed;\r\n    }\r\n    setup() {\r\n        this.elementRef = createElement('div', {\r\n            classes: ['textbus-control-panel'],\r\n            children: [\r\n                this.container = createElement('div', {\r\n                    classes: ['textbus-control-panel-container'],\r\n                    children: [\r\n                        this.tab.elementRef\r\n                    ]\r\n                })\r\n            ]\r\n        });\r\n        this.fixedBtn = createElement('button', {\r\n            attrs: {\r\n                type: 'button',\r\n                title: this.i18n.get('editor.controlPanel.fixed')\r\n            },\r\n            classes: ['textbus-control-panel-fixed-btn'],\r\n            children: [createElement('span', {\r\n                    classes: ['textbus-icon-pushpin']\r\n                })]\r\n        });\r\n        this.fixedBtn.addEventListener('click', () => {\r\n            this.fixed = !this.fixed;\r\n        });\r\n        this.tab.head.insertBefore(this.fixedBtn, this.tab.head.children[0]);\r\n        this.subs.push(this.editorController.onStateChange.subscribe(status => {\r\n            if (status.readonly) {\r\n                this.fixed = false;\r\n            }\r\n        }));\r\n        this.fixed = false;\r\n    }\r\n    showPanels(views) {\r\n        this.oldViews.forEach(view => {\r\n            var _a;\r\n            (_a = view.onDestroy) === null || _a === void 0 ? void 0 : _a.call(view);\r\n        });\r\n        this.oldViews = views;\r\n        if (views.length === 0) {\r\n            this.tab.show([]);\r\n            this.elementRef.classList.remove('textbus-control-panel-show');\r\n            return;\r\n        }\r\n        this.elementRef.classList.add('textbus-control-panel-show');\r\n        const tabs = views.map(view => {\r\n            return {\r\n                label: view.title,\r\n                view: view.view\r\n            };\r\n        });\r\n        this.tab.show(tabs);\r\n    }\r\n    onDestroy() {\r\n        this.subs.forEach(s => s.unsubscribe());\r\n    }\r\n};\r\nUIControlPanel = __decorate([\r\n    Injectable(),\r\n    __metadata(\"design:paramtypes\", [EditorController,\r\n        I18n,\r\n        Layout])\r\n], UIControlPanel);\r\nexport { UIControlPanel };\r\n//# sourceMappingURL=control-panel.plugin.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nimport { Injectable } from '@tanbo/di';\r\nimport { createElement } from '../_utils/uikit';\r\nimport { Layout } from '../layout';\r\nimport { EditorController } from '../../editor-controller';\r\nlet UIDialog = class UIDialog {\r\n    constructor(layout, editorController) {\r\n        this.layout = layout;\r\n        this.editorController = editorController;\r\n        this.timer = null;\r\n        this.subs = [];\r\n    }\r\n    setup() {\r\n        this.elementRef = createElement('div', {\r\n            classes: ['textbus-dialog'],\r\n            children: [\r\n                this.dialogWrapper = createElement('div', {\r\n                    classes: ['textbus-dialog-wrapper']\r\n                })\r\n            ]\r\n        });\r\n        this.layout.workbench.appendChild(this.elementRef);\r\n        this.subs.push(this.editorController.onStateChange.subscribe(status => {\r\n            if (status.readonly || status.sourcecodeMode) {\r\n                this.close();\r\n            }\r\n        }));\r\n    }\r\n    dialog(element) {\r\n        this.dialogWrapper.innerHTML = '';\r\n        this.dialogWrapper.appendChild(element);\r\n        this.elementRef.classList.add('textbus-dialog-active');\r\n        this.timer = setTimeout(() => {\r\n            this.dialogWrapper.classList.add('textbus-dialog-wrapper-active');\r\n        }, 200);\r\n    }\r\n    close() {\r\n        this.dialogWrapper.classList.remove('textbus-dialog-wrapper-active');\r\n        this.timer = setTimeout(() => {\r\n            this.elementRef.classList.remove('textbus-dialog-active');\r\n            this.dialogWrapper.innerHTML = '';\r\n        }, 200);\r\n    }\r\n    onDestroy() {\r\n        clearTimeout(this.timer);\r\n        this.subs.forEach(i => i.unsubscribe());\r\n    }\r\n};\r\nUIDialog = __decorate([\r\n    Injectable(),\r\n    __metadata(\"design:paramtypes\", [Layout,\r\n        EditorController])\r\n], UIDialog);\r\nexport { UIDialog };\r\n//# sourceMappingURL=dialog.plugin.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nimport { Injectable } from '@tanbo/di';\r\nimport { createElement, createTextNode } from '../_utils/_api';\r\nimport { Layout } from '../layout';\r\nlet UIMessage = class UIMessage {\r\n    constructor(layout) {\r\n        this.layout = layout;\r\n    }\r\n    setup() {\r\n        this.messageBox = createElement('div', {\r\n            classes: ['textbus-message']\r\n        });\r\n        this.layout.workbench.append(this.messageBox);\r\n    }\r\n    message(message, time) {\r\n        this.createMessage('message', message, time);\r\n    }\r\n    info(message, time) {\r\n        this.createMessage('info', message, time);\r\n    }\r\n    success(message, time) {\r\n        this.createMessage('success', message, time);\r\n    }\r\n    warning(message, time) {\r\n        this.createMessage('warning', message, time);\r\n    }\r\n    danger(message, time) {\r\n        this.createMessage('danger', message, time);\r\n    }\r\n    createMessage(type, message, time = 3000) {\r\n        const tip = createElement('div', {\r\n            classes: ['textbus-message-item', 'textbus-message-item-' + type],\r\n            children: [createTextNode(message)]\r\n        });\r\n        this.messageBox.append(tip);\r\n        setTimeout(() => {\r\n            tip.remove();\r\n        }, time);\r\n    }\r\n};\r\nUIMessage = __decorate([\r\n    Injectable(),\r\n    __metadata(\"design:paramtypes\", [Layout])\r\n], UIMessage);\r\nexport { UIMessage };\r\n//# sourceMappingURL=message.plugin.js.map","export class FileUploader {\r\n}\r\n//# sourceMappingURL=file-uploader.js.map","/** PURE_IMPORTS_START tslib,_Subscriber PURE_IMPORTS_END */\nimport * as tslib_1 from \"tslib\";\nimport { Subscriber } from '../Subscriber';\nexport function filter(predicate, thisArg) {\n    return function filterOperatorFunction(source) {\n        return source.lift(new FilterOperator(predicate, thisArg));\n    };\n}\nvar FilterOperator = /*@__PURE__*/ (function () {\n    function FilterOperator(predicate, thisArg) {\n        this.predicate = predicate;\n        this.thisArg = thisArg;\n    }\n    FilterOperator.prototype.call = function (subscriber, source) {\n        return source.subscribe(new FilterSubscriber(subscriber, this.predicate, this.thisArg));\n    };\n    return FilterOperator;\n}());\nvar FilterSubscriber = /*@__PURE__*/ (function (_super) {\n    tslib_1.__extends(FilterSubscriber, _super);\n    function FilterSubscriber(destination, predicate, thisArg) {\n        var _this = _super.call(this, destination) || this;\n        _this.predicate = predicate;\n        _this.thisArg = thisArg;\n        _this.count = 0;\n        return _this;\n    }\n    FilterSubscriber.prototype._next = function (value) {\n        var result;\n        try {\n            result = this.predicate.call(this.thisArg, value, this.count++);\n        }\n        catch (err) {\n            this.destination.error(err);\n            return;\n        }\n        if (result) {\n            this.destination.next(value);\n        }\n    };\n    return FilterSubscriber;\n}(Subscriber));\n//# sourceMappingURL=filter.js.map\n","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nimport { fromEvent } from 'rxjs';\r\nimport { filter, map } from 'rxjs/operators';\r\nimport { Inject, Injectable, InjectFlags } from '@tanbo/di';\r\nimport { AbstractComponent, ComponentSetter, DivisionAbstractComponent, Interceptor, LeafAbstractComponent, Parser, Renderer, TBEvent, TBSelection, DynamicKeymap, BrComponent, BranchAbstractComponent, BackboneAbstractComponent } from '../core/_api';\r\nimport { EDITABLE_DOCUMENT } from '../inject-tokens';\r\nimport { TBHistory } from '../history';\r\nimport { EditorController } from '../editor-controller';\r\nimport { UIControlPanel } from './plugins/control-panel.plugin';\r\nimport { createElement, createTextNode } from './_utils/uikit';\r\nimport { ComponentInjectors } from '../component-injectors';\r\nimport { Layout } from './layout';\r\nimport { I18n } from '../i18n/i18n';\r\nimport { UIMessage } from './plugins/message.plugin';\r\nexport const isWindows = /win(dows|32|64)/i.test(navigator.userAgent);\r\nexport const isMac = /mac os/i.test(navigator.userAgent);\r\n/**\r\n * \r\n */\r\nlet Input = class Input {\r\n    constructor(context, layout, controlPanel, i18n, editorController, componentInjectors, renderer, message, parser, selection, history) {\r\n        this.context = context;\r\n        this.layout = layout;\r\n        this.controlPanel = controlPanel;\r\n        this.i18n = i18n;\r\n        this.editorController = editorController;\r\n        this.componentInjectors = componentInjectors;\r\n        this.renderer = renderer;\r\n        this.message = message;\r\n        this.parser = parser;\r\n        this.selection = selection;\r\n        this.history = history;\r\n        this._readonly = false;\r\n        this.pasteMiddlewares = [];\r\n        this.markdownMatchers = [];\r\n        this.input = document.createElement('textarea');\r\n        this.keymaps = [];\r\n        this.elementRef = document.createElement('div');\r\n        this.cursor = document.createElement('span');\r\n        this.inputWrap = document.createElement('span');\r\n        this.timer = null;\r\n        this._display = true;\r\n        this.flashing = true;\r\n        this.subs = [];\r\n        this.customContextmenuActions = [];\r\n        this.prevComponent = null;\r\n        this.contextmenu = new ContextMenu(this.history);\r\n        this.layout.docContainer.append(this.elementRef);\r\n        this.elementRef.classList.add('textbus-selection');\r\n        this.cursor.classList.add('textbus-cursor');\r\n        this.inputWrap.classList.add('textbus-input-wrap');\r\n        this.input.classList.add('textbus-input');\r\n        this.inputWrap.appendChild(this.input);\r\n        this.elementRef.appendChild(this.inputWrap);\r\n        this.elementRef.appendChild(this.cursor);\r\n        this.init();\r\n        this.initEvent();\r\n        this.bindDefaultKeymap();\r\n        this.subs.push(history.onUsed.subscribe(() => {\r\n            this.dispatchInputReadyEvent();\r\n        }));\r\n        this.subs.push(editorController.onStateChange.pipe(map(i => i.readonly)).subscribe(b => {\r\n            this.readonly = b;\r\n        }));\r\n    }\r\n    get value() {\r\n        return this.input.value;\r\n    }\r\n    get selectionStart() {\r\n        return this.input.selectionStart;\r\n    }\r\n    set readonly(b) {\r\n        this._readonly = b;\r\n        this.hide();\r\n        this.input.disabled = b;\r\n    }\r\n    get readonly() {\r\n        return this._readonly;\r\n    }\r\n    set display(v) {\r\n        this._display = v;\r\n        this.cursor.style.visibility = v ? 'visible' : 'hidden';\r\n    }\r\n    get display() {\r\n        return this._display;\r\n    }\r\n    /**\r\n     * \r\n     * @param middleware\r\n     */\r\n    addPasteMiddleware(middleware) {\r\n        this.pasteMiddlewares.push(middleware);\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    addContextMenus(actions) {\r\n        this.customContextmenuActions.push(actions);\r\n    }\r\n    /**\r\n     *  Markdown \r\n     */\r\n    addMarkdownSupport(config) {\r\n        this.markdownMatchers.unshift(config);\r\n    }\r\n    /**\r\n     * \r\n     * @param keymap\r\n     */\r\n    addKeymap(keymap) {\r\n        this.keymaps.unshift(keymap);\r\n    }\r\n    destroy() {\r\n        this.contextmenu.destroy();\r\n        this.subs.forEach(s => s.unsubscribe());\r\n    }\r\n    updateStateBySelection() {\r\n        if (this.readonly || !this.selection.rangeCount) {\r\n            this.hide();\r\n            return;\r\n        }\r\n        if (this.selection.collapsed) {\r\n            const startContainer = this.selection.firstRange.nativeRange.startContainer;\r\n            const position = this.renderer.getPositionByNode(startContainer);\r\n            if (!position || position && startContainer.nodeType === Node.ELEMENT_NODE && startContainer.childNodes.length === 0) {\r\n                this.hide();\r\n                return;\r\n            }\r\n        }\r\n        this.updateCursorPosition();\r\n        if (this.selection.collapsed) {\r\n            this.show();\r\n        }\r\n        else {\r\n            this.hide();\r\n        }\r\n        this.input.focus();\r\n    }\r\n    updateCursorPosition() {\r\n        const startContainer = this.selection.firstRange.nativeRange.startContainer;\r\n        const node = (startContainer.nodeType === Node.ELEMENT_NODE ? startContainer : startContainer.parentNode);\r\n        if ((node === null || node === void 0 ? void 0 : node.nodeType) !== Node.ELEMENT_NODE) {\r\n            return;\r\n        }\r\n        const rect = this.selection.firstRange.getRangePosition();\r\n        const { fontSize, lineHeight, color } = getComputedStyle(node);\r\n        if (isWindows) {\r\n            this.inputWrap.style.top = fontSize;\r\n        }\r\n        let height;\r\n        if (isNaN(+lineHeight)) {\r\n            const f = parseFloat(lineHeight);\r\n            if (isNaN(f)) {\r\n                height = parseFloat(fontSize);\r\n            }\r\n            else {\r\n                height = f;\r\n            }\r\n        }\r\n        else {\r\n            height = parseFloat(fontSize) * parseFloat(lineHeight);\r\n        }\r\n        const boxHeight = Math.max(height, rect.height);\r\n        let top = rect.top;\r\n        if (rect.height < height) {\r\n            top -= (height - rect.height) / 2;\r\n        }\r\n        this.elementRef.style.left = rect.left + 'px';\r\n        this.elementRef.style.top = top + 'px';\r\n        this.elementRef.style.height = boxHeight + 'px';\r\n        this.cursor.style.backgroundColor = color;\r\n        this.input.style.lineHeight = boxHeight + 'px';\r\n        this.input.style.fontSize = fontSize;\r\n        if (this.selection.collapsed && this.selection.rangeCount === 1) {\r\n            const limit = this.layout.scroller;\r\n            const scrollTop = limit.scrollTop;\r\n            const offsetHeight = limit.offsetHeight;\r\n            const paddingTop = parseInt(getComputedStyle(limit).paddingTop) || 0;\r\n            const cursorTop = top + boxHeight + paddingTop + 5;\r\n            const viewTop = scrollTop + offsetHeight;\r\n            if (cursorTop > viewTop) {\r\n                limit.scrollTop = cursorTop - offsetHeight;\r\n            }\r\n            else if (top < scrollTop) {\r\n                limit.scrollTop = top;\r\n            }\r\n        }\r\n    }\r\n    init() {\r\n        let isWriting = false;\r\n        this.subs.push(fromEvent(this.context, 'mousedown').subscribe((ev) => {\r\n            if (ev.button === 2) {\r\n                return;\r\n            }\r\n            this.contextmenu.hide();\r\n            this.selection.removeAllRanges(true);\r\n        }), fromEvent(this.context, 'contextmenu').pipe(filter(() => !this.readonly)).subscribe((ev) => {\r\n            const selection = this.context.getSelection();\r\n            const focusNode = selection.focusNode;\r\n            const offset = selection.focusOffset;\r\n            const isCollapsed = selection.isCollapsed;\r\n            setTimeout(() => {\r\n                if (isCollapsed) {\r\n                    if (!selection.isCollapsed) {\r\n                        selection.collapse(focusNode, offset);\r\n                    }\r\n                }\r\n            });\r\n            const rect = this.layout.docContainer.getBoundingClientRect();\r\n            this.contextmenu.show([\r\n                [{\r\n                        iconClasses: ['textbus-icon-copy'],\r\n                        label: this.i18n.get('editor.copy'),\r\n                        disabled: this.selection.collapsed,\r\n                        action: () => {\r\n                            this.copy();\r\n                        }\r\n                    }, {\r\n                        iconClasses: ['textbus-icon-paste'],\r\n                        label: this.i18n.get('editor.paste'),\r\n                        // disabled: true,\r\n                        action: () => {\r\n                            this.paste();\r\n                        }\r\n                    }, {\r\n                        iconClasses: ['textbus-icon-cut'],\r\n                        label: this.i18n.get('editor.cut'),\r\n                        disabled: this.selection.collapsed,\r\n                        action: () => {\r\n                            this.cut();\r\n                            this.history.record();\r\n                        }\r\n                    }, {\r\n                        iconClasses: ['textbus-icon-select'],\r\n                        label: this.i18n.get('editor.selectAll'),\r\n                        action: () => {\r\n                            this.selection.selectAll();\r\n                        }\r\n                    }],\r\n                ...this.makeContextmenu(),\r\n                ...this.customContextmenuActions\r\n            ], ev.pageX + rect.x, ev.pageY + rect.y);\r\n            ev.preventDefault();\r\n        }), fromEvent(this.input, 'compositionstart').pipe(filter(() => !this.readonly)).subscribe(() => {\r\n            isWriting = true;\r\n        }), fromEvent(this.input, 'compositionend').pipe(filter(() => !this.readonly)).subscribe(() => {\r\n            isWriting = false;\r\n        }), fromEvent(this.input, 'keydown').pipe(filter(() => !this.readonly)).pipe(filter(() => {\r\n            // \r\n            return !isWriting || !this.input.value;\r\n        })).subscribe((ev) => {\r\n            const reg = /\\w+/.test(ev.key) ? new RegExp(`^${ev.key}$`, 'i') : new RegExp(`^[${ev.key.replace(/([-\\\\])/g, '\\\\$1')}]$`, 'i');\r\n            if (this.editorController.supportMarkdown &&\r\n                !(isMac ? ev.metaKey : ev.ctrlKey) && !ev.shiftKey && !ev.altKey) {\r\n                for (const markdownConfig of this.markdownMatchers) {\r\n                    const matchKey = Array.isArray(markdownConfig.key) ?\r\n                        markdownConfig.key.some(k => reg.test(k)) :\r\n                        reg.test(markdownConfig.key);\r\n                    if (matchKey) {\r\n                        const commonAncestorFragment = this.selection.commonAncestorFragment;\r\n                        const activeFragmentContents = commonAncestorFragment.sliceContents();\r\n                        const content = activeFragmentContents[0];\r\n                        if (activeFragmentContents.length > 2 || typeof content !== 'string') {\r\n                            continue;\r\n                        }\r\n                        if (activeFragmentContents[1] && !(activeFragmentContents[1] instanceof BrComponent)) {\r\n                            continue;\r\n                        }\r\n                        let matchContent = false;\r\n                        if (markdownConfig.match instanceof RegExp) {\r\n                            matchContent = markdownConfig.match.test(content);\r\n                        }\r\n                        else if (typeof markdownConfig.match === 'function') {\r\n                            matchContent = markdownConfig.match(content);\r\n                        }\r\n                        if (matchContent) {\r\n                            const component = markdownConfig.componentFactory(content);\r\n                            if (!(component instanceof AbstractComponent)) {\r\n                                continue;\r\n                            }\r\n                            const parentComponent = commonAncestorFragment.parentComponent;\r\n                            const firstRange = this.selection.firstRange;\r\n                            if (component instanceof DivisionAbstractComponent) {\r\n                                firstRange.setPosition(component.slot, 0);\r\n                            }\r\n                            else if (component instanceof BranchAbstractComponent) {\r\n                                firstRange.setPosition(component.slots[0], 0);\r\n                            }\r\n                            else if (component instanceof BackboneAbstractComponent) {\r\n                                firstRange.setPosition(component.getSlotAtIndex(0), 0);\r\n                            }\r\n                            else {\r\n                                commonAncestorFragment.clean();\r\n                                commonAncestorFragment.append(component);\r\n                                firstRange.setPosition(commonAncestorFragment, 1);\r\n                                this.dispatchInputReadyEvent();\r\n                                ev.preventDefault();\r\n                                return;\r\n                            }\r\n                            if (parentComponent) {\r\n                                const parentFragment = parentComponent.parentFragment;\r\n                                if (parentComponent instanceof DivisionAbstractComponent) {\r\n                                    const index = parentFragment.indexOf(parentComponent);\r\n                                    parentFragment.remove(index, index + 1);\r\n                                    parentFragment.insert(component, index);\r\n                                    this.dispatchInputReadyEvent();\r\n                                }\r\n                                else {\r\n                                    commonAncestorFragment.clean();\r\n                                    commonAncestorFragment.append(component);\r\n                                    this.dispatchInputReadyEvent();\r\n                                }\r\n                            }\r\n                            else {\r\n                                // root\r\n                                commonAncestorFragment.clean();\r\n                                commonAncestorFragment.append(component);\r\n                                this.dispatchInputReadyEvent();\r\n                            }\r\n                            ev.preventDefault();\r\n                            return;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            let hasMatched = false;\r\n            const invokeKeymaps = (keymaps) => {\r\n                for (const config of keymaps) {\r\n                    const test = Array.isArray(config.keymap.key) ?\r\n                        config.keymap.key.map(k => reg.test(k)).includes(true) :\r\n                        reg.test(config.keymap.key);\r\n                    if (test &&\r\n                        !!config.keymap.altKey === ev.altKey &&\r\n                        !!config.keymap.shiftKey === ev.shiftKey &&\r\n                        !!config.keymap.ctrlKey === (isMac ? ev.metaKey : ev.ctrlKey)) {\r\n                        hasMatched = true;\r\n                        this.dispatchInputReadyEvent();\r\n                        config.action(ev);\r\n                        this.dispatchInputReadyEvent();\r\n                        break;\r\n                    }\r\n                }\r\n            };\r\n            this.dispatchEvent((injector, instance) => {\r\n                const dynamicKeymap = injector.get(DynamicKeymap, null, InjectFlags.Self);\r\n                if (dynamicKeymap) {\r\n                    const keymapActions = dynamicKeymap.provide(instance);\r\n                    invokeKeymaps(keymapActions);\r\n                    if (hasMatched) {\r\n                        return false;\r\n                    }\r\n                }\r\n                return true;\r\n            });\r\n            if (!hasMatched) {\r\n                invokeKeymaps(this.keymaps);\r\n            }\r\n            if (hasMatched) {\r\n                ev.preventDefault();\r\n                return false;\r\n            }\r\n        }), fromEvent(this.context, 'mousedown').subscribe(() => {\r\n            this.flashing = false;\r\n        }), fromEvent(this.context, 'mouseup').subscribe(() => {\r\n            this.flashing = true;\r\n        }), this.selection.onChange.pipe(filter(() => !this.readonly)).subscribe(() => {\r\n            this.updateStateBySelection();\r\n            this.dispatchComponentPresetEvent();\r\n        }));\r\n    }\r\n    makeContextmenu() {\r\n        var _a, _b;\r\n        let component = this.selection.commonAncestorComponent;\r\n        if (!component) {\r\n            return [];\r\n        }\r\n        const actionGroups = [];\r\n        while (component) {\r\n            const injector = this.componentInjectors.get(component.constructor);\r\n            const interceptor = injector.get(Interceptor, null, InjectFlags.Self);\r\n            const v = (_a = interceptor === null || interceptor === void 0 ? void 0 : interceptor.onContextmenu) === null || _a === void 0 ? void 0 : _a.call(interceptor, component);\r\n            if (v) {\r\n                actionGroups.push(v);\r\n            }\r\n            component = (_b = component.parentFragment) === null || _b === void 0 ? void 0 : _b.parentComponent;\r\n        }\r\n        return actionGroups;\r\n    }\r\n    initEvent() {\r\n        this.subs.push(fromEvent(this.input, 'blur').subscribe(() => {\r\n            this.hide();\r\n        }), fromEvent(this.input, 'focus').pipe(filter(() => !this.readonly)).subscribe(() => {\r\n            this.dispatchInputReadyEvent();\r\n        }), fromEvent(this.input, 'input').pipe(filter(() => !this.readonly)).subscribe(() => {\r\n            this.dispatchInputEvent();\r\n        }), fromEvent(this.input, 'paste').pipe(filter(() => !this.readonly)).subscribe((ev) => {\r\n            const text = ev.clipboardData.getData('Text');\r\n            const div = document.createElement('div');\r\n            div.style.cssText = 'width:10px; height:10px; overflow: hidden; position: fixed; left: -9999px';\r\n            const files = Array.from(ev.clipboardData.files);\r\n            if (files.length) {\r\n                Promise.all(files.filter(i => {\r\n                    return /image/i.test(i.type);\r\n                }).map(item => {\r\n                    const reader = new FileReader();\r\n                    return new Promise(resolve => {\r\n                        reader.onload = (event) => {\r\n                            resolve(event.target.result);\r\n                        };\r\n                        reader.readAsDataURL(item);\r\n                    });\r\n                })).then(urls => {\r\n                    div.innerHTML = urls.map(i => {\r\n                        return `<img src=${i}>`;\r\n                    }).join('');\r\n                    this.handlePaste(div, text);\r\n                });\r\n                return;\r\n            }\r\n            div.contentEditable = 'true';\r\n            document.body.appendChild(div);\r\n            div.focus();\r\n            setTimeout(() => {\r\n                let html = div.innerHTML;\r\n                let hasEmpty = true;\r\n                const reg = /<(?!(?:td|th))(\\w+)[^>]*?>\\s*?<\\/\\1>/g;\r\n                while (hasEmpty) {\r\n                    hasEmpty = false;\r\n                    html = html.replace(reg, function () {\r\n                        hasEmpty = true;\r\n                        return '';\r\n                    });\r\n                }\r\n                div.innerHTML = html;\r\n                this.handlePaste(div, text);\r\n                document.body.removeChild(div);\r\n            });\r\n        }), fromEvent(this.input, 'copy').pipe(filter(() => !this.readonly)).subscribe(() => {\r\n            this.copy();\r\n        }), fromEvent(this.input, 'cut').pipe(filter(() => !this.readonly)).subscribe(() => {\r\n            this.cut();\r\n            this.history.record();\r\n        }));\r\n    }\r\n    bindDefaultKeymap() {\r\n        this.addKeymap({\r\n            keymap: {\r\n                key: 'Tab'\r\n            },\r\n            action: () => {\r\n                this.input.value = '    ';\r\n                this.dispatchInputEvent();\r\n            }\r\n        });\r\n        this.addKeymap({\r\n            keymap: {\r\n                key: ['Backspace', 'Delete']\r\n            },\r\n            action: () => {\r\n                if (this.selection.collapsed) {\r\n                    this.dispatchEvent((injector, instance) => {\r\n                        var _a;\r\n                        const event = new TBEvent(instance);\r\n                        const interceptor = injector.get(Interceptor, null, InjectFlags.Self);\r\n                        if (interceptor) {\r\n                            (_a = interceptor.onDelete) === null || _a === void 0 ? void 0 : _a.call(interceptor, event);\r\n                        }\r\n                        return !event.stopped;\r\n                    });\r\n                }\r\n                else {\r\n                    this.dispatchEvent((injector, instance) => {\r\n                        var _a;\r\n                        const event = new TBEvent(instance);\r\n                        const interceptor = injector.get(Interceptor, null, InjectFlags.Self);\r\n                        if (interceptor) {\r\n                            (_a = interceptor.onDeleteRange) === null || _a === void 0 ? void 0 : _a.call(interceptor, event);\r\n                        }\r\n                        return !event.stopped;\r\n                    });\r\n                }\r\n                this.dispatchInputReadyEvent();\r\n            }\r\n        });\r\n        this.addKeymap({\r\n            keymap: {\r\n                key: 'Enter'\r\n            },\r\n            action: () => {\r\n                if (!this.selection.collapsed) {\r\n                    this.dispatchEvent((injector, instance) => {\r\n                        var _a;\r\n                        const event = new TBEvent(instance);\r\n                        const interceptor = injector.get(Interceptor, null, InjectFlags.Self);\r\n                        if (interceptor) {\r\n                            (_a = interceptor.onDeleteRange) === null || _a === void 0 ? void 0 : _a.call(interceptor, event);\r\n                        }\r\n                        return !event.stopped;\r\n                    });\r\n                }\r\n                if (this.selection.collapsed) {\r\n                    this.dispatchEvent((injector, instance) => {\r\n                        var _a;\r\n                        const event = new TBEvent(instance);\r\n                        const interceptor = injector.get(Interceptor, null, InjectFlags.Self);\r\n                        if (interceptor) {\r\n                            (_a = interceptor.onEnter) === null || _a === void 0 ? void 0 : _a.call(interceptor, event);\r\n                        }\r\n                        return !event.stopped;\r\n                    });\r\n                }\r\n                this.dispatchInputReadyEvent();\r\n            }\r\n        });\r\n        this.addKeymap({\r\n            keymap: {\r\n                key: 'a',\r\n                ctrlKey: true\r\n            },\r\n            action: () => {\r\n                this.selection.selectAll();\r\n            }\r\n        });\r\n        this.addKeymap({\r\n            keymap: {\r\n                key: ['ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown']\r\n            },\r\n            action: (ev) => {\r\n                switch (ev.key) {\r\n                    case 'ArrowLeft':\r\n                        this.selection.toPrevious();\r\n                        break;\r\n                    case 'ArrowRight':\r\n                        this.selection.toNext();\r\n                        break;\r\n                    case 'ArrowUp':\r\n                        this.selection.toPreviousLine();\r\n                        break;\r\n                    case 'ArrowDown':\r\n                        this.selection.toNextLine();\r\n                        break;\r\n                }\r\n                this.dispatchInputReadyEvent();\r\n            }\r\n        });\r\n        this.addKeymap({\r\n            keymap: {\r\n                key: 'z',\r\n                ctrlKey: true\r\n            },\r\n            action: () => {\r\n                this.history.back();\r\n            }\r\n        });\r\n        this.addKeymap({\r\n            keymap: {\r\n                key: 'y',\r\n                ctrlKey: true,\r\n            },\r\n            action: () => {\r\n                this.history.forward();\r\n            }\r\n        });\r\n        this.addKeymap({\r\n            keymap: {\r\n                key: 'Home'\r\n            },\r\n            action: () => {\r\n                // \r\n                let currentRangePosition = this.selection.firstRange.getRangePosition();\r\n                while (true) {\r\n                    this.selection.toPrevious();\r\n                    const previousRangePosition = this.selection.firstRange.getRangePosition();\r\n                    if (Math.abs(currentRangePosition.bottom - previousRangePosition.bottom) > 5) {\r\n                        this.selection.toNext();\r\n                        break;\r\n                    }\r\n                    // \r\n                    else if (previousRangePosition.left === currentRangePosition.left && previousRangePosition.top === currentRangePosition.top) {\r\n                        break;\r\n                    }\r\n                    currentRangePosition = previousRangePosition;\r\n                }\r\n            }\r\n        });\r\n        this.addKeymap({\r\n            keymap: {\r\n                key: 'End'\r\n            },\r\n            action: () => {\r\n                // \r\n                let currentRangePosition = this.selection.firstRange.getRangePosition();\r\n                while (true) {\r\n                    this.selection.toNext();\r\n                    const nextRangePosition = this.selection.firstRange.getRangePosition();\r\n                    if (Math.abs(currentRangePosition.bottom - nextRangePosition.bottom) > 5) {\r\n                        this.selection.toPrevious();\r\n                        break;\r\n                    }\r\n                    // \r\n                    else if (currentRangePosition.left === nextRangePosition.left && currentRangePosition.top === nextRangePosition.top) {\r\n                        break;\r\n                    }\r\n                    currentRangePosition = nextRangePosition;\r\n                }\r\n            }\r\n        });\r\n    }\r\n    dispatchInputEvent() {\r\n        if (!this.selection.collapsed) {\r\n            this.dispatchEvent((injector, instance) => {\r\n                var _a;\r\n                const event = new TBEvent(instance);\r\n                const interceptor = injector.get(Interceptor, null, InjectFlags.Self);\r\n                if (interceptor) {\r\n                    (_a = interceptor.onDeleteRange) === null || _a === void 0 ? void 0 : _a.call(interceptor, event);\r\n                }\r\n                return !event.stopped;\r\n            });\r\n            this.dispatchInputReadyEvent(true);\r\n        }\r\n        if (this.selection.collapsed) {\r\n            this.dispatchEvent((injector, instance) => {\r\n                var _a;\r\n                const event = new TBEvent(instance);\r\n                const interceptor = injector.get(Interceptor, null, InjectFlags.Self);\r\n                if (interceptor) {\r\n                    (_a = interceptor.onInput) === null || _a === void 0 ? void 0 : _a.call(interceptor, event);\r\n                }\r\n                return !event.stopped;\r\n            });\r\n        }\r\n    }\r\n    dispatchComponentPresetEvent() {\r\n        var _a;\r\n        let component = this.selection.commonAncestorComponent;\r\n        if (!component) {\r\n            this.controlPanel.showPanels([]);\r\n            return;\r\n        }\r\n        const views = [];\r\n        const createView = (component) => {\r\n            const injector = this.componentInjectors.get(component.constructor);\r\n            const setter = injector.get(ComponentSetter, null, InjectFlags.Self);\r\n            if (setter) {\r\n                return setter.create(component);\r\n            }\r\n            return null;\r\n        };\r\n        if (this.selection.collapsed) {\r\n            const firstRange = this.selection.firstRange;\r\n            const prevContent = firstRange.startFragment.getContentAtIndex(firstRange.startIndex - 1);\r\n            if (prevContent instanceof LeafAbstractComponent) {\r\n                component = prevContent;\r\n            }\r\n        }\r\n        if (component === this.prevComponent) {\r\n            return;\r\n        }\r\n        this.prevComponent = component;\r\n        while (component) {\r\n            const v = createView(component);\r\n            if (v) {\r\n                views.push(v);\r\n            }\r\n            component = (_a = component.parentFragment) === null || _a === void 0 ? void 0 : _a.parentComponent;\r\n        }\r\n        this.controlPanel.showPanels(views);\r\n    }\r\n    dispatchInputReadyEvent(keepInputContent = false) {\r\n        if (!keepInputContent) {\r\n            this.input.value = '';\r\n        }\r\n        if (this.selection.collapsed && this.selection.rangeCount === 1) {\r\n            this.dispatchEvent((injector, instance) => {\r\n                var _a;\r\n                const event = new TBEvent(instance);\r\n                const interceptor = injector.get(Interceptor, null, InjectFlags.Self);\r\n                if (interceptor) {\r\n                    (_a = interceptor.onInputReady) === null || _a === void 0 ? void 0 : _a.call(interceptor, event);\r\n                }\r\n                return !event.stopped;\r\n            });\r\n        }\r\n    }\r\n    handlePaste(dom, text) {\r\n        const paste = (element) => {\r\n            let fragment = this.parser.parse(element);\r\n            const firstContent = fragment.getContentAtIndex(0);\r\n            if (fragment.length === 1 && firstContent instanceof DivisionAbstractComponent) {\r\n                fragment = firstContent.slot;\r\n            }\r\n            if (!this.selection.collapsed) {\r\n                this.dispatchEvent((injector, instance) => {\r\n                    var _a;\r\n                    const event = new TBEvent(instance);\r\n                    const interceptor = injector.get(Interceptor, null, InjectFlags.Self);\r\n                    if (interceptor) {\r\n                        (_a = interceptor.onDeleteRange) === null || _a === void 0 ? void 0 : _a.call(interceptor, event);\r\n                    }\r\n                    return !event.stopped;\r\n                });\r\n            }\r\n            if (this.selection.collapsed) {\r\n                this.dispatchEvent((injector, instance) => {\r\n                    var _a;\r\n                    const event = new TBEvent(instance, { fragment, text });\r\n                    const interceptor = injector.get(Interceptor, null, InjectFlags.Self);\r\n                    if (interceptor) {\r\n                        (_a = interceptor.onPaste) === null || _a === void 0 ? void 0 : _a.call(interceptor, event);\r\n                    }\r\n                    return !event.stopped;\r\n                });\r\n            }\r\n            this.dispatchInputReadyEvent();\r\n        };\r\n        if (!this.pasteMiddlewares.length) {\r\n            paste(dom);\r\n            this.history.record();\r\n            return;\r\n        }\r\n        this.pasteMiddlewares.reduce((prevPromise, nextMiddleware) => {\r\n            return prevPromise.then(newDOM => {\r\n                return nextMiddleware(newDOM);\r\n            });\r\n        }, Promise.resolve(dom)).then(result => {\r\n            paste(result);\r\n            this.history.record();\r\n        });\r\n    }\r\n    dispatchEvent(invokeFn) {\r\n        var _a;\r\n        let component = this.selection.commonAncestorComponent;\r\n        while (component) {\r\n            const injector = this.componentInjectors.get(component.constructor);\r\n            if (!invokeFn(injector, component)) {\r\n                break;\r\n            }\r\n            component = (_a = component.parentFragment) === null || _a === void 0 ? void 0 : _a.parentComponent;\r\n        }\r\n    }\r\n    paste() {\r\n        navigator.permissions.query({ name: 'clipboard-write' }).then((result) => {\r\n            if (result.state === 'granted') {\r\n                navigator.clipboard.read().then((items) => {\r\n                    const item = items[0];\r\n                    item.types.filter((i) => i === 'text/html').forEach((type) => {\r\n                        item.getType(type).then(blob => {\r\n                            return blob.text();\r\n                        }).then(text => {\r\n                            const div = document.createElement('div');\r\n                            div.innerHTML = text;\r\n                            this.handlePaste(div, div.innerText);\r\n                            this.history.record();\r\n                        });\r\n                    });\r\n                });\r\n            }\r\n            else {\r\n                this.message.danger(this.i18n.get('editor.input.noAccessClipboard'));\r\n            }\r\n        });\r\n    }\r\n    cut() {\r\n        this.context.execCommand('copy');\r\n        this.selection.ranges.forEach(range => {\r\n            range.deleteRange();\r\n        });\r\n        this.dispatchInputReadyEvent();\r\n    }\r\n    copy() {\r\n        this.context.execCommand('copy');\r\n    }\r\n    show() {\r\n        this.display = true;\r\n        clearTimeout(this.timer);\r\n        const toggleShowHide = () => {\r\n            this.display = !this.display || !this.flashing;\r\n            this.timer = setTimeout(toggleShowHide, 400);\r\n        };\r\n        this.timer = setTimeout(toggleShowHide, 400);\r\n    }\r\n    hide() {\r\n        this.display = false;\r\n        clearTimeout(this.timer);\r\n    }\r\n};\r\nInput = __decorate([\r\n    Injectable(),\r\n    __param(0, Inject(EDITABLE_DOCUMENT)),\r\n    __metadata(\"design:paramtypes\", [Document,\r\n        Layout,\r\n        UIControlPanel,\r\n        I18n,\r\n        EditorController,\r\n        ComponentInjectors,\r\n        Renderer,\r\n        UIMessage,\r\n        Parser,\r\n        TBSelection,\r\n        TBHistory])\r\n], Input);\r\nexport { Input };\r\nclass ContextMenu {\r\n    constructor(history) {\r\n        this.history = history;\r\n        this.eventFromSelf = false;\r\n        this.subs = [];\r\n        this.elementRef = createElement('div', {\r\n            classes: ['textbus-contextmenu'],\r\n            children: [\r\n                createElement('div', {\r\n                    classes: ['textbus-contextmenu-container'],\r\n                    children: [\r\n                        this.groups = createElement('div', {\r\n                            classes: ['textbus-contextmenu-groups']\r\n                        })\r\n                    ]\r\n                })\r\n            ]\r\n        });\r\n        this.elementRef.addEventListener('click', () => {\r\n            this.hide();\r\n        });\r\n        this.elementRef.addEventListener('contextmenu', ev => ev.preventDefault());\r\n    }\r\n    hide() {\r\n        var _a;\r\n        this.subs.forEach(i => i.unsubscribe());\r\n        this.subs = [];\r\n        (_a = this.elementRef.parentNode) === null || _a === void 0 ? void 0 : _a.removeChild(this.elementRef);\r\n    }\r\n    show(menus, x, y) {\r\n        this.subs.push(fromEvent(document, 'mousedown').subscribe(() => {\r\n            if (!this.eventFromSelf) {\r\n                this.hide();\r\n            }\r\n        }), fromEvent(window, 'resize').subscribe(() => {\r\n            setPosition();\r\n        }));\r\n        this.groups.innerHTML = '';\r\n        const setPosition = () => {\r\n            const clientWidth = document.documentElement.clientWidth;\r\n            const clientHeight = document.documentElement.clientHeight;\r\n            if (x + menuWidth >= clientWidth) {\r\n                x -= menuWidth;\r\n            }\r\n            if (y + menuHeight >= clientHeight - 20) {\r\n                y = clientHeight - menuHeight - 20;\r\n            }\r\n            if (y < 20) {\r\n                y = 20;\r\n            }\r\n            Object.assign(this.elementRef.style, {\r\n                left: x + 'px',\r\n                top: y + 'px'\r\n            });\r\n            this.elementRef.style.maxHeight = clientHeight - y - 20 + 'px';\r\n        };\r\n        let itemCount = 0;\r\n        menus.forEach(actions => {\r\n            itemCount += actions.length;\r\n            if (actions.length === 0) {\r\n                return;\r\n            }\r\n            this.groups.appendChild(createElement('div', {\r\n                classes: ['textbus-contextmenu-group'],\r\n                children: actions.map(item => {\r\n                    const btn = createElement('button', {\r\n                        attrs: {\r\n                            type: 'button'\r\n                        },\r\n                        props: {\r\n                            disabled: item.disabled\r\n                        },\r\n                        classes: ['textbus-contextmenu-item'],\r\n                        children: [\r\n                            createElement('span', {\r\n                                classes: ['textbus-contextmenu-item-icon'],\r\n                                children: [\r\n                                    createElement('span', {\r\n                                        classes: item.iconClasses ? item.iconClasses : []\r\n                                    })\r\n                                ]\r\n                            }),\r\n                            createElement('span', {\r\n                                classes: ['textbus-contextmenu-item-label'],\r\n                                children: [createTextNode(item.label)]\r\n                            })\r\n                        ]\r\n                    });\r\n                    if (!item.disabled) {\r\n                        btn.addEventListener('mousedown', () => {\r\n                            this.eventFromSelf = true;\r\n                        });\r\n                        btn.addEventListener('click', () => {\r\n                            item.action();\r\n                            if (item.autoRecordingHistory !== false) {\r\n                                this.history.record();\r\n                            }\r\n                            this.eventFromSelf = false;\r\n                        });\r\n                    }\r\n                    return btn;\r\n                })\r\n            }));\r\n        });\r\n        const menuWidth = 180 + 10;\r\n        const menuHeight = itemCount * 26 + menus.length * 10 + menus.length + 10;\r\n        setPosition();\r\n        document.body.appendChild(this.elementRef);\r\n    }\r\n    destroy() {\r\n        this.hide();\r\n    }\r\n}\r\n//# sourceMappingURL=input.js.map","/** PURE_IMPORTS_START  PURE_IMPORTS_END */\nexport var subscribeToArray = function (array) {\n    return function (subscriber) {\n        for (var i = 0, len = array.length; i < len && !subscriber.closed; i++) {\n            subscriber.next(array[i]);\n        }\n        subscriber.complete();\n    };\n};\n//# sourceMappingURL=subscribeToArray.js.map\n","/** PURE_IMPORTS_START  PURE_IMPORTS_END */\nexport function isPromise(value) {\n    return !!value && typeof value.subscribe !== 'function' && typeof value.then === 'function';\n}\n//# sourceMappingURL=isPromise.js.map\n","import { makeClassDecorator } from '@tanbo/di';\r\nexport const Component = function ComponentDecorator(define) {\r\n    if (!(this instanceof ComponentDecorator)) {\r\n        return makeClassDecorator(ComponentDecorator, define);\r\n    }\r\n};\r\n//# sourceMappingURL=component.js.map","/**\r\n * TextBus \r\n */\r\nexport class ComponentSetter {\r\n}\r\n//# sourceMappingURL=component-setter.js.map","export class DynamicKeymap {\r\n}\r\n//# sourceMappingURL=dynamic-keymap.js.map","/**\r\n * TextBus \r\n */\r\nexport class TBEvent {\r\n    constructor(instance, data = null) {\r\n        this.instance = instance;\r\n        this.data = data;\r\n        this._stopped = false;\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    get stopped() {\r\n        return this._stopped;\r\n    }\r\n    /**\r\n     *  DOM \r\n     */\r\n    stopPropagation() {\r\n        this._stopped = true;\r\n    }\r\n}\r\n/**\r\n * TextBus \r\n */\r\nexport class Interceptor {\r\n}\r\n//# sourceMappingURL=interceptor.js.map","export class MarkdownSupport {\r\n}\r\n//# sourceMappingURL=markdown-support.js.map","import { AbstractComponent, parentFragmentAccessToken } from './component';\r\n/**\r\n *  Fragment  AbstractComponent  string\r\n * \r\n */\r\nexport class Contents {\r\n    constructor() {\r\n        /**\r\n         * \r\n         */\r\n        this.elements = [];\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    get length() {\r\n        return this.elements.reduce((p, n) => p + n.length, 0);\r\n    }\r\n    /**\r\n     *  elements \r\n     * @param content \r\n     */\r\n    append(content) {\r\n        if (content === '') {\r\n            return;\r\n        }\r\n        const lastChildIndex = this.elements.length - 1;\r\n        const lastChild = this.elements[lastChildIndex];\r\n        if (typeof lastChild === 'string' && typeof content === 'string') {\r\n            this.elements[lastChildIndex] = lastChild + content;\r\n        }\r\n        else {\r\n            this.elements.push(content);\r\n        }\r\n    }\r\n    /**\r\n     * \r\n     * \r\n     * @param startIndex\r\n     * @param endIndex\r\n     */\r\n    slice(startIndex, endIndex = this.length) {\r\n        if (startIndex >= endIndex) {\r\n            return [];\r\n        }\r\n        let index = 0;\r\n        const result = [];\r\n        for (const el of this.elements) {\r\n            const fragmentStartIndex = index;\r\n            const fragmentEndIndex = index + el.length;\r\n            index += el.length;\r\n            if (startIndex < fragmentEndIndex && endIndex > fragmentStartIndex) {\r\n                if (typeof el === 'string') {\r\n                    const min = Math.max(0, startIndex - fragmentStartIndex);\r\n                    const max = Math.min(fragmentEndIndex, endIndex) - fragmentStartIndex;\r\n                    result.push(el.slice(min, max));\r\n                }\r\n                else {\r\n                    result.push(el);\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n    /**\r\n     *  -1\r\n     * @param element\r\n     */\r\n    indexOf(element) {\r\n        let index = 0;\r\n        for (const item of this.elements) {\r\n            if (item === element) {\r\n                return index;\r\n            }\r\n            index += item.length;\r\n        }\r\n        return -1;\r\n    }\r\n    /**\r\n     * \r\n     * @param content\r\n     * @param index \r\n     */\r\n    insert(content, index) {\r\n        if (content === '') {\r\n            return;\r\n        }\r\n        if (index >= this.length) {\r\n            this.append(content);\r\n            return;\r\n        }\r\n        let i = 0; // \r\n        let ii = 0; // \r\n        for (const el of this.elements) {\r\n            if (index >= i) {\r\n                if ((el instanceof AbstractComponent) && index === i) {\r\n                    const prev = this.elements[ii - 1];\r\n                    if (typeof prev === 'string' && typeof content === 'string') {\r\n                        this.elements[ii - 1] = prev + content;\r\n                    }\r\n                    else {\r\n                        if (i === 0) {\r\n                            this.elements.unshift(content);\r\n                        }\r\n                        else {\r\n                            this.elements.splice(ii, 0, content);\r\n                        }\r\n                    }\r\n                    break;\r\n                }\r\n                else if (typeof el === 'string') {\r\n                    if (index >= i && index < i + el.length) {\r\n                        const cc = [el.slice(0, index - i), content, el.slice(index - i)].filter(i => i);\r\n                        if (content instanceof AbstractComponent) {\r\n                            this.elements.splice(ii, 1, ...cc);\r\n                        }\r\n                        else {\r\n                            this.elements.splice(ii, 1, cc.join(''));\r\n                        }\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            ii++;\r\n            i += el.length;\r\n        }\r\n    }\r\n    /**\r\n     * \r\n     * @param startIndex\r\n     * @param endIndex\r\n     */\r\n    cut(startIndex, endIndex) {\r\n        if (endIndex <= startIndex) {\r\n            return [];\r\n        }\r\n        const discardedContents = this.slice(startIndex, endIndex);\r\n        const elements = this.slice(0, startIndex).concat(this.slice(endIndex, this.length));\r\n        this.elements = [];\r\n        elements.forEach(item => this.append(item));\r\n        return discardedContents.map(i => {\r\n            if (i instanceof AbstractComponent) {\r\n                i[parentFragmentAccessToken] = null;\r\n            }\r\n            return i;\r\n        });\r\n    }\r\n    /**\r\n     * \r\n     * @param index\r\n     */\r\n    getContentAtIndex(index) {\r\n        return this.slice(index, index + 1)[0];\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    clone() {\r\n        const newContents = new Contents();\r\n        this.elements.forEach(item => {\r\n            if (typeof item === 'string') {\r\n                newContents.append(item);\r\n            }\r\n            else {\r\n                const c = item.clone();\r\n                c[parentFragmentAccessToken] = null;\r\n                newContents.append(c);\r\n            }\r\n        });\r\n        return newContents;\r\n    }\r\n}\r\n//# sourceMappingURL=contents.js.map","/**\r\n * \r\n */\r\nexport class FormatData {\r\n    constructor(params = {}) {\r\n        this.attrs = new Map();\r\n        this.styles = new Map();\r\n        this.classes = [];\r\n        this.tag = params.tag;\r\n        if (params.attrs) {\r\n            if (params.attrs instanceof Map) {\r\n                this.attrs = params.attrs;\r\n            }\r\n            else {\r\n                this.attrs = new Map();\r\n                Object.keys(params.attrs).forEach(key => {\r\n                    this.attrs.set(key, params.attrs[key]);\r\n                });\r\n            }\r\n        }\r\n        if (params.styles) {\r\n            if (params.styles instanceof Map) {\r\n                this.styles = params.styles;\r\n            }\r\n            else {\r\n                this.styles = new Map();\r\n                Object.keys(params.styles).forEach(key => {\r\n                    this.styles.set(key, params.styles[key]);\r\n                });\r\n            }\r\n        }\r\n        if (params.classes) {\r\n            this.classes = [...params.classes];\r\n        }\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    clone() {\r\n        return new FormatData({\r\n            tag: this.tag,\r\n            attrs: this.attrs.size ? (() => {\r\n                const obj = {};\r\n                this.attrs.forEach((value, key) => {\r\n                    obj[key] = value;\r\n                });\r\n                return obj;\r\n            })() : null,\r\n            styles: this.styles.size ? (() => {\r\n                const obj = {};\r\n                this.styles.forEach((value, key) => {\r\n                    obj[key] = value;\r\n                });\r\n                return obj;\r\n            })() : null,\r\n            classes: this.classes\r\n        });\r\n    }\r\n    /**\r\n     *  data \r\n     * @param data\r\n     */\r\n    equal(data) {\r\n        if (data === this) {\r\n            return true;\r\n        }\r\n        if (!data) {\r\n            return false;\r\n        }\r\n        const left = data;\r\n        return left.tag == this.tag &&\r\n            FormatData.equalMap(left.attrs, this.attrs) &&\r\n            FormatData.equalMap(left.styles, this.styles) &&\r\n            FormatData.equalStringList(left.classes, this.classes);\r\n    }\r\n    static equalStringList(left, right) {\r\n        if (left.length !== right.length) {\r\n            return false;\r\n        }\r\n        for (const item of left) {\r\n            if (!right.includes(item)) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n    static equalMap(left, right) {\r\n        if (left === right || !left === true && !right === true) {\r\n            return true;\r\n        }\r\n        if (!left !== !right || left.size !== right.size) {\r\n            return false;\r\n        }\r\n        return Array.from(left.keys()).reduce((v, key) => {\r\n            return v && left.get(key) === right.get(key);\r\n        }, true);\r\n    }\r\n}\r\n//# sourceMappingURL=format-data.js.map","import { FormatData } from './format-data';\r\n/**\r\n *  DOM \r\n */\r\nexport var FormatEffect;\r\n(function (FormatEffect) {\r\n    /**  */\r\n    FormatEffect[\"Valid\"] = \"Valid\";\r\n    /**  */\r\n    FormatEffect[\"Invalid\"] = \"Invalid\";\r\n    /**  */\r\n    FormatEffect[\"Exclude\"] = \"Exclude\";\r\n    /**  */\r\n    FormatEffect[\"Inherit\"] = \"Inherit\";\r\n})(FormatEffect || (FormatEffect = {}));\r\n/**\r\n * \r\n */\r\nexport var FormatterPriority;\r\n(function (FormatterPriority) {\r\n    FormatterPriority[FormatterPriority[\"BlockStyle\"] = 0] = \"BlockStyle\";\r\n    FormatterPriority[FormatterPriority[\"InlineTag\"] = 100] = \"InlineTag\";\r\n    FormatterPriority[FormatterPriority[\"InlineStyle\"] = 200] = \"InlineStyle\";\r\n    FormatterPriority[FormatterPriority[\"Attribute\"] = 300] = \"Attribute\";\r\n})(FormatterPriority || (FormatterPriority = {}));\r\n/**\r\n * TextBus  Formatter InlineFormatterBlockFormatter \r\n */\r\nexport class Formatter {\r\n    constructor(rule, priority) {\r\n        this.rule = rule;\r\n        this.priority = priority;\r\n        this.inheritValidators = [];\r\n        this.validators = [];\r\n        this.excludeValidators = [];\r\n        if (rule.extendTags) {\r\n            this.inheritValidators.push(this.makeTagsMatcher(rule.extendTags));\r\n        }\r\n        if (rule.tags) {\r\n            this.validators.push(this.makeTagsMatcher(rule.tags));\r\n        }\r\n        // if (rule.classes) {\r\n        //   this.validators.push(this.makeClassNameMatcher(rule.classes));\r\n        // }\r\n        if (rule.styles) {\r\n            this.validators.push(this.makeStyleMatcher(rule.styles));\r\n        }\r\n        if (rule.attrs) {\r\n            this.validators.push(this.makeAttrsMatcher(rule.attrs));\r\n        }\r\n        // if (rule.excludeClasses) {\r\n        //   this.excludeValidators.push(this.makeClassNameMatcher(rule.excludeClasses));\r\n        // }\r\n        if (rule.excludeStyles) {\r\n            this.excludeValidators.push(this.makeStyleMatcher(rule.excludeStyles));\r\n        }\r\n        if (rule.excludeAttrs) {\r\n            this.excludeValidators.push(this.makeAttrsMatcher(rule.excludeAttrs));\r\n        }\r\n    }\r\n    /**\r\n     *  DOM \r\n     * @param element\r\n     */\r\n    match(element) {\r\n        if (this.rule.filter) {\r\n            const b = this.rule.filter(element);\r\n            if (!b) {\r\n                return FormatEffect.Invalid;\r\n            }\r\n        }\r\n        const exclude = this.excludeValidators.map(fn => fn(element)).includes(true);\r\n        if (exclude) {\r\n            return FormatEffect.Exclude;\r\n        }\r\n        const inherit = this.inheritValidators.map(fn => fn(element)).includes(true);\r\n        if (inherit) {\r\n            return FormatEffect.Inherit;\r\n        }\r\n        return this.validators.map(fn => fn(element)).includes(true) ? FormatEffect.Valid : FormatEffect.Invalid;\r\n    }\r\n    extractData(node, config) {\r\n        if (!config) {\r\n            return new FormatData();\r\n        }\r\n        const attrs = new Map();\r\n        if (config.attrs) {\r\n            config.attrs.forEach(key => {\r\n                attrs.set(key, node.getAttribute(key));\r\n            });\r\n        }\r\n        const style = {};\r\n        if (config.styleName) {\r\n            (Array.isArray(config.styleName) ? config.styleName : [config.styleName]).forEach(name => {\r\n                const v = node.style[name];\r\n                if (v) {\r\n                    style[name] = v;\r\n                }\r\n            });\r\n        }\r\n        return new FormatData({\r\n            tag: config.tag ? node.nodeName.toLowerCase() : null,\r\n            attrs: attrs.size ? attrs : null,\r\n            styles: style\r\n        });\r\n    }\r\n    makeTagsMatcher(tags) {\r\n        return (node) => {\r\n            const tagName = node.nodeName.toLowerCase();\r\n            return Array.isArray(tags) ? tags.includes(tagName) : tags.test(tagName);\r\n        };\r\n    }\r\n    makeAttrsMatcher(attrs) {\r\n        return (node) => {\r\n            return attrs.map(attr => {\r\n                if (attr.value) {\r\n                    return node.getAttribute(attr.key) === attr.value;\r\n                }\r\n                return node.hasAttribute(attr.key);\r\n            }).includes(true);\r\n        };\r\n    }\r\n    makeStyleMatcher(styles) {\r\n        return (node) => {\r\n            return !Object.keys(styles).map(key => {\r\n                const optionValue = (Array.isArray(styles[key]) ?\r\n                    styles[key] :\r\n                    [styles[key]]);\r\n                let styleValue = node.style[key];\r\n                if (key === 'fontFamily' && typeof styleValue === 'string') {\r\n                    styleValue = styleValue.replace(/['\"]/g, '');\r\n                }\r\n                if (styleValue) {\r\n                    return optionValue.map(v => {\r\n                        if (v instanceof RegExp) {\r\n                            return v.test(styleValue);\r\n                        }\r\n                        return v === styleValue;\r\n                    }).includes(true);\r\n                }\r\n                return false;\r\n            }).includes(false);\r\n        };\r\n    }\r\n}\r\n/**\r\n * \r\n */\r\nexport class InlineFormatter extends Formatter {\r\n}\r\nexport class BlockFormatter extends Formatter {\r\n}\r\n//# sourceMappingURL=formatter.js.map","import { BlockFormatter, FormatEffect } from './formatter';\r\n/**\r\n *  Map<InlineFormatter | BlockFormatter, FormatRange[]> \r\n * \r\n */\r\nexport class FormatMap {\r\n    constructor() {\r\n        this.map = new Map();\r\n    }\r\n    keys() {\r\n        return this.map.keys();\r\n    }\r\n    get(formatter) {\r\n        return this.map.get(formatter);\r\n    }\r\n    set(formatter, formatRanges) {\r\n        this.map.set(formatter, formatRanges);\r\n    }\r\n    /**\r\n     * \r\n     * @param token \r\n     * @param formatter \r\n     * @param important \r\n     */\r\n    merge(token, formatter, important) {\r\n        if (token instanceof BlockFormatter) {\r\n            if (formatter.effect === FormatEffect.Invalid) {\r\n                this.map.delete(token);\r\n            }\r\n            else {\r\n                this.map.set(token, [formatter]);\r\n            }\r\n            return;\r\n        }\r\n        const oldFormats = this.map.get(token);\r\n        if (!Array.isArray(oldFormats)) {\r\n            if (formatter.effect !== FormatEffect.Invalid) {\r\n                this.map.set(token, [formatter]);\r\n            }\r\n            return;\r\n        }\r\n        const newFormatMarks = [];\r\n        const formatRanges = [];\r\n        important ? oldFormats.push(formatter) : oldFormats.unshift(formatter);\r\n        while (oldFormats.length) {\r\n            const first = oldFormats.shift();\r\n            if (newFormatMarks.length < first.endIndex) {\r\n                newFormatMarks.length = first.endIndex;\r\n            }\r\n            newFormatMarks.fill(first, first.startIndex, first.endIndex);\r\n        }\r\n        let newFormatRange = null;\r\n        for (let i = 0; i < newFormatMarks.length; i++) {\r\n            const mark = newFormatMarks[i];\r\n            if (!mark) {\r\n                newFormatRange = null;\r\n                continue;\r\n            }\r\n            if (!newFormatRange) {\r\n                newFormatRange = {\r\n                    startIndex: i,\r\n                    endIndex: i + 1,\r\n                    formatData: mark.formatData,\r\n                    effect: mark.effect\r\n                };\r\n                formatRanges.push(newFormatRange);\r\n                continue;\r\n            }\r\n            if (mark.effect === newFormatRange.effect && (mark.formatData &&\r\n                newFormatRange.formatData &&\r\n                mark.formatData.equal(newFormatRange.formatData) || !mark.formatData === true && !newFormatRange.formatData === true)) {\r\n                newFormatRange.endIndex = i + 1;\r\n            }\r\n            else {\r\n                newFormatRange = {\r\n                    startIndex: i,\r\n                    endIndex: i + 1,\r\n                    formatData: mark.formatData,\r\n                    effect: mark.effect\r\n                };\r\n                formatRanges.push(newFormatRange);\r\n            }\r\n        }\r\n        const ff = formatRanges.filter(f => f.effect !== FormatEffect.Invalid);\r\n        if (ff.length) {\r\n            this.map.set(token, ff);\r\n        }\r\n        else {\r\n            this.map.delete(token);\r\n        }\r\n    }\r\n}\r\n//# sourceMappingURL=format-map.js.map","import { Subject } from 'rxjs';\r\n/**\r\n * textbus  (Fragment)  (Componet) Fragment \r\n *   UI \r\n * ( Fragment , )\r\n *\r\n * Fragment  Component  Marker Marker \r\n * \r\n *\r\n *  Fragment/Component , Fragment  Component \r\n *  Fragment/Component  dirty  true.\r\n *\r\n *  Fragment/Component  Fragment \r\n *  Component  Fragment/Component  changed \r\n *  true.\r\n */\r\nexport class Marker {\r\n    constructor() {\r\n        this._dirty = true;\r\n        this._changed = true;\r\n        this._outputDirty = true;\r\n        this._outputChanged = true;\r\n        this.changeEvent = new Subject();\r\n        this.onChange = this.changeEvent.asObservable();\r\n    }\r\n    get dirty() {\r\n        return this._dirty;\r\n    }\r\n    get changed() {\r\n        return this._changed;\r\n    }\r\n    get outputDirty() {\r\n        return this._outputDirty;\r\n    }\r\n    get outputChanged() {\r\n        return this._outputChanged;\r\n    }\r\n    markAsDirtied() {\r\n        this._dirty = true;\r\n        this._outputDirty = true;\r\n        this.markAsChanged();\r\n    }\r\n    markAsChanged() {\r\n        this._changed = true;\r\n        this._outputChanged = true;\r\n        this.changeEvent.next();\r\n    }\r\n    rendered() {\r\n        this._dirty = this._changed = false;\r\n    }\r\n    outputRendered() {\r\n        this._outputDirty = this._outputChanged = false;\r\n    }\r\n}\r\n//# sourceMappingURL=marker.js.map","var _a;\r\nimport { Contents } from './contents';\r\nimport { BranchAbstractComponent, DivisionAbstractComponent, AbstractComponent, BackboneAbstractComponent, parentFragmentAccessToken, BrComponent } from './component';\r\nimport { BlockFormatter, FormatEffect, InlineFormatter } from './formatter';\r\nimport { FormatMap } from './format-map';\r\nimport { Marker } from './marker';\r\nimport { makeError } from '../_utils/make-error';\r\nexport const parentComponentAccessToken = Symbol('ParentComponentAccessToken');\r\nconst fragmentErrorFn = makeError('Fragment');\r\n/**\r\n * TextBus \r\n */\r\nexport class Fragment extends Marker {\r\n    constructor() {\r\n        super();\r\n        this[_a] = null;\r\n        this.contents = new Contents();\r\n        this.formatMap = new FormatMap();\r\n        this.eventMap = new Map();\r\n    }\r\n    get parentComponent() {\r\n        return this[parentComponentAccessToken];\r\n    }\r\n    /**\r\n     * fragment \r\n     */\r\n    get length() {\r\n        return this.contents.length;\r\n    }\r\n    /**\r\n     *  fragment  fragment\r\n     * @param source\r\n     */\r\n    from(source) {\r\n        this._clean();\r\n        const self = this;\r\n        Array.from(source.formatMap.keys()).forEach(token => {\r\n            this.formatMap.set(token, [...source.formatMap.get(token).map(f => {\r\n                    var _b;\r\n                    return token instanceof InlineFormatter ? Object.assign(Object.assign({}, f), { formatData: (_b = f.formatData) === null || _b === void 0 ? void 0 : _b.clone() }) : {\r\n                        get startIndex() {\r\n                            return 0;\r\n                        },\r\n                        get endIndex() {\r\n                            return self.length;\r\n                        },\r\n                        effect: f.effect,\r\n                        formatData: f.formatData\r\n                    };\r\n                })]);\r\n        });\r\n        source.contents.slice(0).forEach(c => {\r\n            this.contents.append(c);\r\n            if (c instanceof AbstractComponent) {\r\n                c[parentFragmentAccessToken] = this;\r\n                this.eventMap.set(c, c.onChange.subscribe(() => {\r\n                    this.markAsChanged();\r\n                }));\r\n            }\r\n        });\r\n        source.clean();\r\n        this.markAsDirtied();\r\n    }\r\n    /**\r\n     * \r\n     * @param fragment\r\n     */\r\n    concat(fragment) {\r\n        const index = this.length;\r\n        fragment.sliceContents(0).forEach(c => {\r\n            this.contents.append(c);\r\n            if (c instanceof AbstractComponent) {\r\n                c[parentFragmentAccessToken] = this;\r\n                this.eventMap.set(c, c.onChange.subscribe(() => {\r\n                    this.markAsChanged();\r\n                }));\r\n            }\r\n        });\r\n        fragment.getFormatKeys().filter(token => !(token instanceof BlockFormatter)).forEach(token => {\r\n            const formats = fragment.getFormatRanges(token) || [];\r\n            formats.forEach(f => {\r\n                f.startIndex += index;\r\n                f.endIndex += index;\r\n                this._apply(token, f);\r\n            });\r\n        });\r\n        fragment.clean();\r\n        this.markAsDirtied();\r\n    }\r\n    /**\r\n     *  fragment \r\n     * @param content\r\n     * @param insertAdjacentInlineFormat\r\n     */\r\n    append(content, insertAdjacentInlineFormat = false) {\r\n        this._append(content, insertAdjacentInlineFormat);\r\n        this.markAsDirtied();\r\n    }\r\n    /**\r\n     * \r\n     * @param startIndex\r\n     * @param endIndex\r\n     */\r\n    sliceContents(startIndex = 0, endIndex) {\r\n        return this.contents.slice(startIndex, endIndex);\r\n    }\r\n    /**\r\n     * \r\n     * @param contents\r\n     * @param ref\r\n     */\r\n    insertBefore(contents, ref) {\r\n        const index = this.indexOf(ref);\r\n        if (index === -1) {\r\n            throw fragmentErrorFn('component referenced is not a member of the current editable fragment');\r\n        }\r\n        this.insert(contents, index);\r\n    }\r\n    /**\r\n     * \r\n     * @param contents\r\n     * @param ref\r\n     */\r\n    insertAfter(contents, ref) {\r\n        const index = this.indexOf(ref);\r\n        if (index === -1) {\r\n            throw fragmentErrorFn('component referenced is not a member of the current editable fragment');\r\n        }\r\n        this.insert(contents, index + 1);\r\n    }\r\n    /**\r\n     * \r\n     * @param contents\r\n     * @param index\r\n     */\r\n    insert(contents, index) {\r\n        if (contents.length === 0) {\r\n            return;\r\n        }\r\n        if (contents instanceof Fragment) {\r\n            this.insertFragment(contents, index);\r\n        }\r\n        else {\r\n            this._insert(contents, index);\r\n        }\r\n        this.markAsDirtied();\r\n    }\r\n    /**\r\n     *  fragment \r\n     */\r\n    clone() {\r\n        const ff = new Fragment();\r\n        Array.from(this.formatMap.keys()).forEach(token => {\r\n            ff.formatMap.set(token, [...this.formatMap.get(token).map(f => {\r\n                    var _b;\r\n                    return token instanceof InlineFormatter ? Object.assign(Object.assign({}, f), { formatData: (_b = f.formatData) === null || _b === void 0 ? void 0 : _b.clone() }) : {\r\n                        get startIndex() {\r\n                            return 0;\r\n                        },\r\n                        get endIndex() {\r\n                            return ff.length;\r\n                        },\r\n                        effect: f.effect,\r\n                        formatData: f.formatData\r\n                    };\r\n                })]);\r\n        });\r\n        this.contents.clone().slice(0).forEach(i => ff._append(i));\r\n        return ff;\r\n    }\r\n    /**\r\n     *  fragment \r\n     */\r\n    clean() {\r\n        this._clean();\r\n        this.markAsDirtied();\r\n    }\r\n    /**\r\n     * \r\n     * @param index\r\n     */\r\n    getContentAtIndex(index) {\r\n        return this.contents.getContentAtIndex(index);\r\n    }\r\n    /**\r\n     * \r\n     * @param startIndex\r\n     * @param endIndex\r\n     */\r\n    remove(startIndex, endIndex = this.contents.length) {\r\n        this.cut(startIndex, endIndex).sliceContents().forEach(i => {\r\n            if (i instanceof AbstractComponent) {\r\n                i[parentFragmentAccessToken] = null;\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     *  fragment\r\n     * @param startIndex\r\n     * @param endIndex\r\n     */\r\n    cut(startIndex, endIndex = this.length) {\r\n        const fragment = new Fragment();\r\n        if (endIndex <= startIndex) {\r\n            return fragment;\r\n        }\r\n        const count = endIndex - startIndex;\r\n        const selfFormatMap = new FormatMap();\r\n        const discardedFormatMap = new FormatMap();\r\n        Array.from(this.formatMap.keys()).forEach(token => {\r\n            const formats = this.formatMap.get(token);\r\n            if (token instanceof BlockFormatter) {\r\n                selfFormatMap.set(token, [...formats]);\r\n                discardedFormatMap.set(token, formats.map(f => {\r\n                    var _b;\r\n                    return {\r\n                        effect: f.effect,\r\n                        formatData: (_b = f.formatData) === null || _b === void 0 ? void 0 : _b.clone(),\r\n                        get startIndex() {\r\n                            return 0;\r\n                        },\r\n                        get endIndex() {\r\n                            return fragment.length;\r\n                        }\r\n                    };\r\n                }));\r\n                return;\r\n            }\r\n            formats.forEach(format => {\r\n                var _b, _c, _d, _e;\r\n                // \r\n                // formatRange  ________-------________\r\n                // deleteRange     [  ]\r\n                if (format.startIndex >= endIndex) {\r\n                    selfFormatMap.merge(token, Object.assign(Object.assign({}, format), { startIndex: format.startIndex - count, endIndex: format.endIndex - count }), true);\r\n                    return;\r\n                }\r\n                // \r\n                // formatRange  ________-------________\r\n                // deleteRange                  [  ]\r\n                if (format.endIndex <= startIndex) {\r\n                    selfFormatMap.merge(token, Object.assign({}, format), true);\r\n                    return;\r\n                }\r\n                // \r\n                // formatRange  ________-------________\r\n                // deleteRange        [   ]\r\n                if (format.startIndex > startIndex &&\r\n                    format.startIndex < endIndex &&\r\n                    format.endIndex >= endIndex) {\r\n                    selfFormatMap.merge(token, Object.assign(Object.assign({}, format), { startIndex, endIndex: format.endIndex - count }), true);\r\n                    discardedFormatMap.merge(token, {\r\n                        effect: format.effect,\r\n                        formatData: (_b = format.formatData) === null || _b === void 0 ? void 0 : _b.clone(),\r\n                        startIndex: format.startIndex - startIndex,\r\n                        endIndex: count\r\n                    }, true);\r\n                    return;\r\n                }\r\n                // \r\n                // formatRange  ________-------________\r\n                // deleteRange           [   ]\r\n                if (format.startIndex <= startIndex && format.endIndex >= endIndex) {\r\n                    if (format.endIndex - count > format.startIndex) {\r\n                        selfFormatMap.merge(token, Object.assign(Object.assign({}, format), { endIndex: format.endIndex - count }), true);\r\n                    }\r\n                    discardedFormatMap.merge(token, {\r\n                        effect: format.effect,\r\n                        formatData: (_c = format.formatData) === null || _c === void 0 ? void 0 : _c.clone(),\r\n                        startIndex: 0,\r\n                        endIndex: count\r\n                    }, true);\r\n                    return;\r\n                }\r\n                // \r\n                // formatRange  ________-------________\r\n                // deleteRange               [   ]\r\n                if (format.startIndex <= startIndex && format.endIndex > startIndex && format.endIndex < endIndex) {\r\n                    selfFormatMap.merge(token, Object.assign(Object.assign({}, format), { endIndex: startIndex }), true);\r\n                    discardedFormatMap.merge(token, {\r\n                        effect: format.effect,\r\n                        formatData: (_d = format.formatData) === null || _d === void 0 ? void 0 : _d.clone(),\r\n                        startIndex: 0,\r\n                        endIndex: format.endIndex - startIndex\r\n                    }, true);\r\n                    return;\r\n                }\r\n                // \r\n                // formatRange  ________-------________\r\n                // deleteRange        [         ]\r\n                if (format.startIndex > startIndex && format.endIndex < endIndex) {\r\n                    discardedFormatMap.merge(token, {\r\n                        effect: format.effect,\r\n                        formatData: (_e = format.formatData) === null || _e === void 0 ? void 0 : _e.clone(),\r\n                        startIndex: format.startIndex - startIndex,\r\n                        endIndex: format.endIndex - startIndex\r\n                    }, true);\r\n                }\r\n            });\r\n        });\r\n        this.formatMap = selfFormatMap;\r\n        this.contents.cut(startIndex, endIndex).forEach(i => {\r\n            fragment._append(i);\r\n            if (i instanceof AbstractComponent) {\r\n                this.eventMap.get(i).unsubscribe();\r\n                this.eventMap.delete(i);\r\n            }\r\n        });\r\n        let newFormatMap = new FormatMap();\r\n        if (fragment.length === 1 && fragment.getContentAtIndex(0) instanceof BrComponent) {\r\n            const contentLength = this.length;\r\n            this.getFormatKeys().forEach(key => {\r\n                if (key instanceof InlineFormatter) {\r\n                    this.getFormatRanges(key).forEach(f => {\r\n                        var _b;\r\n                        if (f.endIndex === contentLength) {\r\n                            newFormatMap.set(key, [{\r\n                                    effect: f.effect,\r\n                                    formatData: (_b = f.formatData) === null || _b === void 0 ? void 0 : _b.clone(),\r\n                                    startIndex: 0,\r\n                                    endIndex: 1\r\n                                }]);\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n            Array.from(discardedFormatMap.keys()).filter(i => i instanceof BlockFormatter).forEach(key => {\r\n                newFormatMap.set(key, discardedFormatMap.get(key));\r\n            });\r\n        }\r\n        else {\r\n            newFormatMap = discardedFormatMap;\r\n        }\r\n        fragment.formatMap = newFormatMap;\r\n        this.markAsDirtied();\r\n        return fragment;\r\n    }\r\n    /**\r\n     *  Formatter\r\n     */\r\n    getFormatKeys() {\r\n        return Array.from(this.formatMap.keys());\r\n    }\r\n    /**\r\n     *  Formatter  FormatRange\r\n     * @param token\r\n     */\r\n    getFormatRanges(token) {\r\n        return this.formatMap.get(token) || [];\r\n    }\r\n    /**\r\n     *  fragment \r\n     * @param component\r\n     */\r\n    indexOf(component) {\r\n        return this.contents.indexOf(component);\r\n    }\r\n    apply(token, params, options = {\r\n        important: true,\r\n        coverChild: true\r\n    }) {\r\n        this._apply(token, params, options);\r\n        this.markAsDirtied();\r\n    }\r\n    /**\r\n     *  fragment\r\n     * @param context \r\n     * @param filter   filter  false\r\n     */\r\n    getContext(context, filter) {\r\n        const componentInstance = this.parentComponent;\r\n        if (!componentInstance) {\r\n            return null;\r\n        }\r\n        if (componentInstance instanceof context) {\r\n            if (typeof filter === 'function') {\r\n                if (filter(componentInstance)) {\r\n                    return componentInstance;\r\n                }\r\n            }\r\n            else {\r\n                return componentInstance;\r\n            }\r\n        }\r\n        const parentFragment = componentInstance.parentFragment;\r\n        if (!parentFragment) {\r\n            return null;\r\n        }\r\n        return parentFragment.getContext(context, filter);\r\n    }\r\n    insertFragment(fragment, index) {\r\n        const contents = fragment.sliceContents(0).reverse();\r\n        const isEmpty = this.length === 0 || this.length === 1 && this.getContentAtIndex(0) instanceof BrComponent;\r\n        contents.forEach(c => {\r\n            this.contents.insert(c, index);\r\n            if (c instanceof AbstractComponent) {\r\n                c[parentFragmentAccessToken] = this;\r\n                this.eventMap.set(c, c.onChange.subscribe(() => {\r\n                    this.markAsChanged();\r\n                }));\r\n            }\r\n        });\r\n        const len = fragment.length;\r\n        const splitFormatMap = new FormatMap();\r\n        this.getFormatKeys().filter(key => {\r\n            return key instanceof InlineFormatter;\r\n        }).forEach(key => {\r\n            const formats = this.getFormatRanges(key);\r\n            formats.forEach(format => {\r\n                var _b;\r\n                if (format.endIndex <= index) {\r\n                    return;\r\n                }\r\n                if (format.startIndex >= index) {\r\n                    format.startIndex += len;\r\n                    format.endIndex += len;\r\n                }\r\n                else {\r\n                    const format2 = {\r\n                        startIndex: index + len,\r\n                        endIndex: format.endIndex + len,\r\n                        effect: format.effect,\r\n                        formatData: (_b = format.formatData) === null || _b === void 0 ? void 0 : _b.clone()\r\n                    };\r\n                    format.endIndex = index;\r\n                    splitFormatMap.set(key, [format2]);\r\n                }\r\n            });\r\n        });\r\n        Array.from(splitFormatMap.keys()).forEach(key => {\r\n            splitFormatMap.get(key).forEach(f => {\r\n                this.formatMap.merge(key, f, true);\r\n            });\r\n        });\r\n        fragment.getFormatKeys().forEach(key => {\r\n            fragment.getFormatRanges(key).forEach(f => {\r\n                var _b;\r\n                this.formatMap.merge(key, {\r\n                    startIndex: f.startIndex + index,\r\n                    endIndex: f.endIndex + index,\r\n                    effect: f.effect,\r\n                    formatData: (_b = f.formatData) === null || _b === void 0 ? void 0 : _b.clone()\r\n                }, key instanceof InlineFormatter || !isEmpty);\r\n            });\r\n        });\r\n        fragment.clean();\r\n        this.markAsDirtied();\r\n    }\r\n    _insert(contents, index) {\r\n        if (contents instanceof AbstractComponent) {\r\n            this.gourdComponentInSelf(contents);\r\n            this.eventMap.set(contents, contents.onChange.subscribe(() => {\r\n                this.markAsChanged();\r\n            }));\r\n        }\r\n        this.contents.insert(contents, index);\r\n        const formatMap = new FormatMap();\r\n        Array.from(this.formatMap.keys()).forEach(token => {\r\n            const formats = this.formatMap.get(token) || [];\r\n            formats.forEach(format => {\r\n                if (token instanceof BlockFormatter) {\r\n                    formatMap.merge(token, format, true);\r\n                    return;\r\n                }\r\n                if (format.startIndex < index && format.endIndex >= index) {\r\n                    if (contents instanceof DivisionAbstractComponent ||\r\n                        contents instanceof BranchAbstractComponent ||\r\n                        contents instanceof BackboneAbstractComponent) {\r\n                        formatMap.merge(token, Object.assign(Object.assign({}, format), { endIndex: index }), true);\r\n                        formatMap.merge(token, {\r\n                            startIndex: index,\r\n                            endIndex: index + 1,\r\n                            effect: FormatEffect.Invalid,\r\n                            formatData: format.formatData.clone(),\r\n                        }, true);\r\n                        if (format.endIndex > index) {\r\n                            formatMap.merge(token, Object.assign(Object.assign({}, format), { startIndex: index + 1, endIndex: format.endIndex + 1 }), true);\r\n                        }\r\n                    }\r\n                    else {\r\n                        formatMap.merge(token, Object.assign(Object.assign({}, format), { endIndex: format.endIndex + contents.length }), true);\r\n                    }\r\n                }\r\n                else {\r\n                    if (format.startIndex >= index && format.startIndex > 0 && format.startIndex < format.endIndex) {\r\n                        format.startIndex += contents.length;\r\n                    }\r\n                    if (format.endIndex >= index) {\r\n                        format.endIndex += contents.length;\r\n                    }\r\n                    formatMap.merge(token, format, true);\r\n                }\r\n            });\r\n        });\r\n        this.formatMap = formatMap;\r\n        this.markAsDirtied();\r\n    }\r\n    _apply(token, formatRange, options = {\r\n        important: true,\r\n        coverChild: true\r\n    }) {\r\n        const { coverChild, important } = options;\r\n        if (token instanceof BlockFormatter) {\r\n            const self = this;\r\n            this.formatMap.merge(token, Object.assign(Object.assign({}, formatRange), { get startIndex() {\r\n                    return 0;\r\n                },\r\n                get endIndex() {\r\n                    return self.length;\r\n                } }), important);\r\n            return;\r\n        }\r\n        if (formatRange.startIndex < 0) {\r\n            formatRange.startIndex = 0;\r\n        }\r\n        if (formatRange.endIndex > this.length) {\r\n            formatRange.endIndex = this.length;\r\n        }\r\n        if (this.getContentAtIndex(formatRange.endIndex) instanceof BrComponent) {\r\n            formatRange.endIndex++;\r\n        }\r\n        const lineFormatRange = formatRange;\r\n        const contents = this.sliceContents(lineFormatRange.startIndex, lineFormatRange.endIndex);\r\n        let index = 0;\r\n        const cacheFormats = [];\r\n        let newFormat;\r\n        contents.forEach(item => {\r\n            if (item instanceof DivisionAbstractComponent) {\r\n                newFormat = null;\r\n                if (coverChild) {\r\n                    const newFormatRange = Object.assign({}, lineFormatRange);\r\n                    newFormatRange.startIndex = 0;\r\n                    newFormatRange.endIndex = item.slot.length;\r\n                    item.slot.apply(token, newFormatRange, options);\r\n                }\r\n            }\r\n            else if (item instanceof BranchAbstractComponent) {\r\n                newFormat = null;\r\n                if (coverChild) {\r\n                    item.slots.forEach(fragment => {\r\n                        const newFormatRange = Object.assign({}, lineFormatRange);\r\n                        newFormatRange.startIndex = 0;\r\n                        newFormatRange.endIndex = fragment.length;\r\n                        fragment.apply(token, newFormatRange, options);\r\n                    });\r\n                }\r\n            }\r\n            else if (item instanceof BackboneAbstractComponent) {\r\n                newFormat = null;\r\n                if (coverChild) {\r\n                    for (const fragment of item) {\r\n                        const newFormatRange = Object.assign({}, lineFormatRange);\r\n                        newFormatRange.startIndex = 0;\r\n                        newFormatRange.endIndex = fragment.length;\r\n                        fragment.apply(token, newFormatRange, options);\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                if (!newFormat) {\r\n                    newFormat = {\r\n                        startIndex: lineFormatRange.startIndex + index,\r\n                        endIndex: lineFormatRange.startIndex + index + item.length,\r\n                        effect: lineFormatRange.effect,\r\n                        formatData: lineFormatRange.formatData\r\n                    };\r\n                    cacheFormats.push({\r\n                        token,\r\n                        params: newFormat\r\n                    });\r\n                }\r\n                else {\r\n                    newFormat.endIndex = formatRange.startIndex + index + item.length;\r\n                }\r\n            }\r\n            index += item.length;\r\n        });\r\n        cacheFormats.forEach(f => this.formatMap.merge(f.token, f.params, important));\r\n    }\r\n    _append(content, insertAdjacentInlineFormat = false) {\r\n        const offset = content.length;\r\n        const length = this.length;\r\n        this.contents.append(content);\r\n        if (content instanceof AbstractComponent) {\r\n            this.gourdComponentInSelf(content);\r\n            this.eventMap.set(content, content.onChange.subscribe(() => {\r\n                this.markAsChanged();\r\n            }));\r\n        }\r\n        if (insertAdjacentInlineFormat) {\r\n            this.getFormatKeys().forEach(token => {\r\n                if (token instanceof InlineFormatter) {\r\n                    this.getFormatRanges(token).forEach(range => {\r\n                        if (range.endIndex === length) {\r\n                            range.endIndex += offset;\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        }\r\n    }\r\n    _clean() {\r\n        Array.from(this.eventMap.values()).map(i => i.unsubscribe());\r\n        this.eventMap.clear();\r\n        this.sliceContents().forEach(i => {\r\n            if (i instanceof AbstractComponent && i[parentFragmentAccessToken] === this) {\r\n                i[parentFragmentAccessToken] = null;\r\n            }\r\n        });\r\n        this.contents = new Contents();\r\n        this.formatMap = new FormatMap();\r\n    }\r\n    gourdComponentInSelf(component) {\r\n        const parentFragment = component.parentFragment;\r\n        if (parentFragment) {\r\n            const index = parentFragment.indexOf(component);\r\n            parentFragment.remove(index, index + 1);\r\n        }\r\n        component[parentFragmentAccessToken] = this;\r\n    }\r\n}\r\n_a = parentComponentAccessToken;\r\n//# sourceMappingURL=fragment.js.map","var _a;\r\nimport { makeError } from '../_utils/make-error';\r\nimport { Subject } from 'rxjs';\r\nconst parentNode = Symbol('parentNode');\r\n/**\r\n * \r\n */\r\nexport class VTextNode {\r\n    constructor(textContent = '') {\r\n        this.textContent = textContent;\r\n    }\r\n    get parentNode() {\r\n        return this[parentNode];\r\n    }\r\n    clone() {\r\n        return new VTextNode(this.textContent);\r\n    }\r\n}\r\nconst vElementErrorFn = makeError('VElement');\r\n/**\r\n *  DOM \r\n */\r\nexport class VElement {\r\n    constructor(tagName, options) {\r\n        this.tagName = tagName;\r\n        this[_a] = null;\r\n        this.attrs = new Map();\r\n        this.styles = new Map();\r\n        this.classes = [];\r\n        this._childNodes = [];\r\n        this.unbindFns = [];\r\n        this.destroyEvent = new Subject();\r\n        this.onDestroy = this.destroyEvent.asObservable();\r\n        if (options) {\r\n            if (options.attrs) {\r\n                Object.keys(options.attrs).forEach(key => {\r\n                    const value = options.attrs[key];\r\n                    if (value !== null && typeof value !== 'undefined') {\r\n                        this.attrs.set(key, options.attrs[key]);\r\n                    }\r\n                });\r\n            }\r\n            if (options.styles) {\r\n                Object.keys(options.styles).forEach(key => {\r\n                    const value = options.styles[key];\r\n                    if (value !== null && typeof value !== 'undefined') {\r\n                        this.styles.set(key, options.styles[key]);\r\n                    }\r\n                });\r\n            }\r\n            if (options.classes) {\r\n                this.classes.push(...options.classes);\r\n            }\r\n            if (options.childNodes) {\r\n                this.appendChild(...options.childNodes);\r\n            }\r\n            this.listeners = options.on || {};\r\n        }\r\n    }\r\n    static createElement(tagName, attrs, ...children) {\r\n        if (typeof tagName === 'function') {\r\n            return tagName(Object.assign(Object.assign({}, attrs), { children }));\r\n        }\r\n        attrs = attrs || {};\r\n        const className = (attrs.class || '').trim();\r\n        const classes = className ? className.split(/\\s+/g) : [];\r\n        Reflect.deleteProperty(attrs, 'class');\r\n        const style = attrs.style || '';\r\n        let styles;\r\n        if (style && typeof style === 'string') {\r\n            styles = {};\r\n            style.split(';').map(s => s.split(':')).forEach(v => {\r\n                if (!v[0] || !v[1]) {\r\n                    return;\r\n                }\r\n                styles[v[0].trim()] = v[1].trim();\r\n            });\r\n        }\r\n        else {\r\n            styles = style;\r\n        }\r\n        Reflect.deleteProperty(attrs, 'style');\r\n        const listeners = {};\r\n        const attrs2 = {};\r\n        Object.keys(attrs).forEach(key => {\r\n            if (/^on[A-Z]/.test(key)) {\r\n                listeners[key.replace(/^on/, '').toLowerCase()] = attrs[key];\r\n            }\r\n            else {\r\n                attrs2[key] = attrs[key];\r\n            }\r\n        });\r\n        const childNodes = [];\r\n        const addChild = function (contents) {\r\n            for (const c of contents) {\r\n                if (c instanceof VElement) {\r\n                    childNodes.push(c);\r\n                }\r\n                else if (typeof c === 'string' && c) {\r\n                    childNodes.push(new VTextNode(c));\r\n                }\r\n                else if (Array.isArray(c)) {\r\n                    addChild(c);\r\n                }\r\n                else if (c !== false) {\r\n                    childNodes.push(new VTextNode(c + ''));\r\n                }\r\n            }\r\n        };\r\n        addChild(children);\r\n        return new VElement(tagName, {\r\n            styles,\r\n            attrs: attrs2,\r\n            classes,\r\n            on: listeners,\r\n            childNodes\r\n        });\r\n    }\r\n    get parentNode() {\r\n        return this[parentNode];\r\n    }\r\n    get childNodes() {\r\n        return this._childNodes.map(i => i);\r\n    }\r\n    clone() {\r\n        const attrs = {};\r\n        const styles = {};\r\n        this.attrs.forEach(((value, key) => {\r\n            attrs[key] = value;\r\n        }));\r\n        this.styles.forEach((value, key) => {\r\n            styles[key] = value;\r\n        });\r\n        return new VElement(this.tagName, {\r\n            classes: [...this.classes],\r\n            attrs,\r\n            styles,\r\n            childNodes: this._childNodes.map(i => i.clone())\r\n        });\r\n    }\r\n    /**\r\n     * \r\n     * @param newNodes\r\n     */\r\n    appendChild(...newNodes) {\r\n        newNodes.forEach(node => {\r\n            var _b;\r\n            (_b = node.parentNode) === null || _b === void 0 ? void 0 : _b.removeChild(node);\r\n            node[parentNode] = this;\r\n            this._childNodes.push(node);\r\n        });\r\n    }\r\n    removeChild(node) {\r\n        const index = this._childNodes.indexOf(node);\r\n        if (index > -1) {\r\n            this._childNodes.splice(index, 1);\r\n            node[parentNode] = null;\r\n            return;\r\n        }\r\n        throw vElementErrorFn('node to be deleted is not a child of the current node.');\r\n    }\r\n    replaceChild(newNode, oldNode) {\r\n        var _b;\r\n        const index = this._childNodes.indexOf(oldNode);\r\n        if (index > -1) {\r\n            (_b = newNode.parentNode) === null || _b === void 0 ? void 0 : _b.removeChild(newNode);\r\n            this._childNodes.splice(index, 1, newNode);\r\n            oldNode[parentNode] = null;\r\n            newNode[parentNode] = this;\r\n            return;\r\n        }\r\n        throw vElementErrorFn('node to be replaced is not a child of the current node.');\r\n    }\r\n    /**\r\n     *  DOM  JSON \r\n     */\r\n    toJSON() {\r\n        return {\r\n            tagName: this.tagName,\r\n            styles: VElement.mapToJSON(this.styles),\r\n            attrs: VElement.mapToJSON(this.attrs),\r\n            classes: this.classes.map(i => i),\r\n            childNodes: this._childNodes.map(c => {\r\n                if (c instanceof VElement) {\r\n                    return c.toJSON();\r\n                }\r\n                return c.textContent;\r\n            })\r\n        };\r\n    }\r\n    onRendered(nativeNode) {\r\n        Object.keys(this.listeners || {}).forEach(listenKey => {\r\n            const callback = this.listeners[listenKey];\r\n            if (typeof callback === 'function') {\r\n                nativeNode.addEventListener(listenKey, this.listeners[listenKey]);\r\n                this.unbindFns.push(function () {\r\n                    nativeNode.removeEventListener(listenKey, callback);\r\n                });\r\n            }\r\n        });\r\n    }\r\n    destroy() {\r\n        this.unbindFns.forEach(i => i());\r\n        this.destroyEvent.next();\r\n    }\r\n    static mapToJSON(map) {\r\n        const obj = {};\r\n        map.forEach((value, key) => {\r\n            obj[key] = value;\r\n        });\r\n        return obj;\r\n    }\r\n}\r\n_a = parentNode;\r\n//# sourceMappingURL=element.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nvar _a;\r\nvar BrComponent_1;\r\nimport { Fragment, parentComponentAccessToken } from './fragment';\r\nimport { VElement } from './element';\r\nimport { Marker } from './marker';\r\nimport { Component } from './di/component';\r\n/**\r\n *  TextBus  DOM  Component  Fragment \r\n */\r\nexport class ComponentLoader {\r\n}\r\nexport const parentFragmentAccessToken = Symbol('ParentFragmentAccessToken');\r\n/**\r\n * TextBus  Component \r\n *  DivisionAbstractComponentBranchAbstractComponentBackboneAbstractComponent  LeafAbstractComponent \r\n */\r\nexport class AbstractComponent extends Marker {\r\n    constructor(tagName) {\r\n        super();\r\n        this.tagName = tagName;\r\n        this[_a] = null;\r\n        /**\r\n         *  TextBus  1\r\n         */\r\n        this.length = 1;\r\n        this.canDispatchDataChange = true;\r\n        this.canDispatchContentChange = true;\r\n    }\r\n    get parentFragment() {\r\n        return this[parentFragmentAccessToken];\r\n    }\r\n    markAsDirtied() {\r\n        if (this.canDispatchDataChange === false) {\r\n            return;\r\n        }\r\n        if (typeof this.componentDataChange === 'function') {\r\n            this.canDispatchDataChange = false;\r\n            this.componentDataChange();\r\n            this.canDispatchDataChange = true;\r\n        }\r\n        super.markAsDirtied();\r\n    }\r\n    markAsChanged() {\r\n        if (this.canDispatchContentChange === false) {\r\n            return;\r\n        }\r\n        if (typeof this.componentContentChange === 'function') {\r\n            this.canDispatchContentChange = false;\r\n            this.componentContentChange();\r\n            this.canDispatchContentChange = true;\r\n        }\r\n        super.markAsChanged();\r\n    }\r\n}\r\n_a = parentFragmentAccessToken;\r\n/**\r\n *  pdivh1~h6blockquote \r\n * \r\n */\r\nexport class DivisionAbstractComponent extends AbstractComponent {\r\n    constructor(tagName) {\r\n        super(tagName);\r\n        this.slot = new Fragment();\r\n        this.slot[parentComponentAccessToken] = this;\r\n        this.slot.onChange.subscribe(() => {\r\n            this.markAsChanged();\r\n        });\r\n    }\r\n}\r\n/**\r\n * \r\n *  ulol  li \r\n * \r\n */\r\nexport class BranchAbstractComponent extends AbstractComponent {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.eventMap = new Map();\r\n        /**\r\n         * \r\n         */\r\n        this.slots = new Proxy([], {\r\n            set: (target, p, value, receiver) => {\r\n                if (value instanceof Fragment) {\r\n                    if (!value.dirty && !target.includes(value)) {\r\n                        value.markAsDirtied();\r\n                    }\r\n                    if (!this.eventMap.has(value)) {\r\n                        this.eventMap.set(value, value.onChange.subscribe(() => {\r\n                            this.markAsChanged();\r\n                        }));\r\n                    }\r\n                }\r\n                if (p === 'length' && typeof value === 'number') {\r\n                    for (const item of target) {\r\n                        if (item) {\r\n                            item[parentComponentAccessToken] = null;\r\n                        }\r\n                    }\r\n                }\r\n                const b = Reflect.set(target, p, value, receiver);\r\n                this.eventMap.forEach(v => v.unsubscribe());\r\n                this.eventMap.clear();\r\n                target.forEach(f => {\r\n                    this.eventMap.set(f, f.onChange.subscribe(() => {\r\n                        this.markAsChanged();\r\n                    }));\r\n                    f[parentComponentAccessToken] = this;\r\n                });\r\n                this.markAsDirtied();\r\n                return b;\r\n            },\r\n            deleteProperty: (target, p) => {\r\n                var _b;\r\n                const deletedValue = target[p];\r\n                const b = Reflect.deleteProperty(target, p);\r\n                if (typeof p === 'string' && /\\d+/.test(p) && deletedValue && !target.includes(deletedValue)) {\r\n                    (_b = this.eventMap.get(deletedValue)) === null || _b === void 0 ? void 0 : _b.unsubscribe();\r\n                    this.eventMap.delete(deletedValue);\r\n                    deletedValue[parentComponentAccessToken] = null;\r\n                    this.markAsDirtied();\r\n                }\r\n                return b;\r\n            }\r\n        });\r\n    }\r\n}\r\n/**\r\n * \r\n *  table td td  table \r\n */\r\nexport class BackboneAbstractComponent extends AbstractComponent {\r\n    constructor() {\r\n        super(...arguments);\r\n        /**\r\n         * \r\n         */\r\n        this.eventMap = new Map();\r\n        this.slots = [];\r\n        this.iteratorIndex = 0;\r\n    }\r\n    get slotCount() {\r\n        return this.slots.length;\r\n    }\r\n    [Symbol.iterator]() {\r\n        this.iteratorIndex = 0;\r\n        return this;\r\n    }\r\n    next() {\r\n        if (this.iteratorIndex < this.slotCount) {\r\n            const value = this.slots[this.iteratorIndex];\r\n            this.iteratorIndex++;\r\n            return {\r\n                done: false,\r\n                value\r\n            };\r\n        }\r\n        return {\r\n            done: true,\r\n            value: undefined\r\n        };\r\n    }\r\n    getSlotAtIndex(index) {\r\n        return this.slots[index];\r\n    }\r\n    indexOf(fragment) {\r\n        return this.slots.indexOf(fragment);\r\n    }\r\n    forEach(callbackFn, thisArg) {\r\n        this.slots.forEach(callbackFn, thisArg);\r\n    }\r\n    clean() {\r\n        this.slots.forEach(f => {\r\n            f[parentComponentAccessToken] = null;\r\n            this.eventMap.get(f).unsubscribe();\r\n        });\r\n        this.eventMap.clear();\r\n        this.slots = [];\r\n    }\r\n    push(...fragments) {\r\n        this.setup(fragments);\r\n        this.slots.push(...fragments);\r\n        this.markAsDirtied();\r\n    }\r\n    pop() {\r\n        const f = this.slots.pop();\r\n        if (f) {\r\n            f[parentComponentAccessToken] = null;\r\n            this.eventMap.get(f).unsubscribe();\r\n            this.eventMap.delete(f);\r\n        }\r\n        this.markAsDirtied();\r\n        return f;\r\n    }\r\n    splice(start, deleteCount, ...items) {\r\n        const deletedSlots = this.slots.splice(start, deleteCount, ...items);\r\n        deletedSlots.forEach(f => {\r\n            f[parentComponentAccessToken] = null;\r\n            this.eventMap.get(f).unsubscribe();\r\n            this.eventMap.delete(f);\r\n        });\r\n        if (items) {\r\n            this.setup(items);\r\n        }\r\n        this.markAsDirtied();\r\n        return deletedSlots;\r\n    }\r\n    map(callbackFn, thisArg) {\r\n        return this.slots.map(callbackFn, thisArg);\r\n    }\r\n    setup(fragments) {\r\n        fragments.forEach(f => {\r\n            f[parentComponentAccessToken] = this;\r\n            if (!f.dirty && !this.slots.includes(f)) {\r\n                f.markAsDirtied();\r\n            }\r\n            this.eventMap.set(f, f.onChange.subscribe(() => {\r\n                this.markAsChanged();\r\n            }));\r\n        });\r\n    }\r\n}\r\n/**\r\n *  brimg\r\n * \r\n */\r\nexport class LeafAbstractComponent extends AbstractComponent {\r\n    constructor(tagName) {\r\n        super(tagName);\r\n    }\r\n}\r\nclass BrComponentLoader {\r\n    match(component) {\r\n        return component.nodeName.toLowerCase() === 'br';\r\n    }\r\n    read() {\r\n        const component = new BrComponent();\r\n        return {\r\n            component: component,\r\n            slotsMap: []\r\n        };\r\n    }\r\n}\r\nlet BrComponent = BrComponent_1 = class BrComponent extends LeafAbstractComponent {\r\n    constructor() {\r\n        super('br');\r\n        this.block = false;\r\n    }\r\n    clone() {\r\n        return new BrComponent_1();\r\n    }\r\n    render() {\r\n        return new VElement(this.tagName);\r\n    }\r\n};\r\nBrComponent = BrComponent_1 = __decorate([\r\n    Component({\r\n        loader: new BrComponentLoader()\r\n    }),\r\n    __metadata(\"design:paramtypes\", [])\r\n], BrComponent);\r\nexport { BrComponent };\r\n//# sourceMappingURL=component.js.map","import { Subject } from 'rxjs';\r\nimport { VElement, VTextNode } from './element';\r\nimport { BackboneAbstractComponent, BranchAbstractComponent, AbstractComponent, DivisionAbstractComponent, LeafAbstractComponent, BrComponent } from './component';\r\nimport { BlockFormatter, FormatEffect } from './formatter';\r\nimport { makeError } from '../_utils/make-error';\r\n/**\r\n *  DOM  DOM \r\n */\r\nclass NativeElementMappingTable {\r\n    constructor() {\r\n        this.nativeVDomMapping = new WeakMap();\r\n        this.vDomNativeMapping = new WeakMap();\r\n    }\r\n    set(key, value) {\r\n        if (this.get(key)) {\r\n            this.delete(key);\r\n        }\r\n        if (this.get(value)) {\r\n            this.delete(value);\r\n        }\r\n        if (key instanceof VElement || key instanceof VTextNode) {\r\n            this.vDomNativeMapping.set(key, value);\r\n            this.nativeVDomMapping.set(value, key);\r\n        }\r\n        else {\r\n            this.vDomNativeMapping.set(value, key);\r\n            this.nativeVDomMapping.set(key, value);\r\n        }\r\n    }\r\n    get(key) {\r\n        if (key instanceof VTextNode || key instanceof VElement) {\r\n            return this.vDomNativeMapping.get(key);\r\n        }\r\n        return this.nativeVDomMapping.get(key);\r\n    }\r\n    delete(key) {\r\n        if (key instanceof VTextNode || key instanceof VElement) {\r\n            const v = this.vDomNativeMapping.get(key);\r\n            this.vDomNativeMapping.delete(key);\r\n            this.nativeVDomMapping.delete(v);\r\n        }\r\n        else {\r\n            const v = this.nativeVDomMapping.get(key);\r\n            this.nativeVDomMapping.delete(key);\r\n            this.vDomNativeMapping.delete(v);\r\n        }\r\n    }\r\n}\r\nconst rendererErrorFn = makeError('Renderer');\r\nexport class Renderer {\r\n    constructor(host) {\r\n        this.host = host;\r\n        this.rendingEvent = new Subject();\r\n        this.viewUpdateEvent = new Subject();\r\n        // \r\n        this.vDomPositionMapping = new WeakMap();\r\n        //  fragment \r\n        this.fragmentVDomMapping = new WeakMap();\r\n        //  fragment \r\n        this.fragmentContentContainerMapping = new WeakMap();\r\n        // \r\n        this.rendererVNodeMap = new WeakMap();\r\n        //  DOM \r\n        this.NVMappingTable = new NativeElementMappingTable();\r\n        // \r\n        this.componentVDomCacheMap = new WeakMap();\r\n        this.onViewUpdated = this.viewUpdateEvent.asObservable();\r\n        this.onRendingBefore = this.rendingEvent.asObservable();\r\n    }\r\n    /**\r\n     *  DOM \r\n     * @param component \r\n     */\r\n    render(component) {\r\n        this.rendingEvent.next();\r\n        if (component.changed) {\r\n            const dirty = component.dirty;\r\n            const root = this.rendingComponent(component);\r\n            // hack  DOM \r\n            new VElement('html', {\r\n                childNodes: [root]\r\n            });\r\n            // hack end\r\n            this.NVMappingTable.set(this.host, root);\r\n            if (dirty) {\r\n                if (this.oldVDom) {\r\n                    this.diffAndUpdate(root, this.oldVDom, this.host);\r\n                }\r\n                else {\r\n                    this.patch(root, this.host);\r\n                }\r\n                this.oldVDom = root;\r\n            }\r\n        }\r\n        this.viewUpdateEvent.next();\r\n        return this.oldVDom;\r\n    }\r\n    /**\r\n     *  DOM  fragment \r\n     * @param node\r\n     */\r\n    getPositionByNode(node) {\r\n        const vDom = this.NVMappingTable.get(node);\r\n        return this.vDomPositionMapping.get(vDom);\r\n    }\r\n    /**\r\n     *  DOM  fragment \r\n     * @param vDom\r\n     */\r\n    getPositionByVDom(vDom) {\r\n        return this.vDomPositionMapping.get(vDom);\r\n    }\r\n    /**\r\n     *  DOM  DOM \r\n     * @param vDom\r\n     */\r\n    getNativeNodeByVDom(vDom) {\r\n        return this.NVMappingTable.get(vDom);\r\n    }\r\n    /**\r\n     *  DOM  DOM \r\n     * @param node\r\n     */\r\n    getVDomByNativeNode(node) {\r\n        return this.NVMappingTable.get(node);\r\n    }\r\n    /**\r\n     *  fragment  DOM \r\n     * @param fragment\r\n     */\r\n    getVElementByFragment(fragment) {\r\n        return this.fragmentContentContainerMapping.get(fragment);\r\n    }\r\n    /**\r\n     *  DOM \r\n     * @param component\r\n     */\r\n    getComponentRootVNode(component) {\r\n        return this.componentVDomCacheMap.get(component);\r\n    }\r\n    /**\r\n     *  DOM \r\n     * @param component\r\n     */\r\n    getComponentRootNativeNode(component) {\r\n        return this.getNativeNodeByVDom(this.getComponentRootVNode(component));\r\n    }\r\n    diffAndUpdate(vDom, oldVDom, host) {\r\n        if (!host) {\r\n            host = this.createElement(vDom);\r\n        }\r\n        const childNodes = [];\r\n        vDom.childNodes.forEach(child => {\r\n            const oldNativeNode = this.NVMappingTable.get(child);\r\n            if (oldNativeNode) {\r\n                childNodes.push(oldNativeNode);\r\n            }\r\n            else {\r\n                // TODO  DOM \r\n                childNodes.push(this.patch(child));\r\n            }\r\n        });\r\n        oldVDom.childNodes.forEach(child => {\r\n            const abandonedNativeNode = this.NVMappingTable.get(child);\r\n            abandonedNativeNode.parentNode.removeChild(abandonedNativeNode);\r\n        });\r\n        // \r\n        childNodes.forEach((child, index) => {\r\n            const nativeChildNodes = host.childNodes;\r\n            const oldChild = nativeChildNodes[index];\r\n            if (oldChild) {\r\n                if (oldChild !== child) {\r\n                    host.insertBefore(child, oldChild);\r\n                }\r\n            }\r\n            else {\r\n                host.appendChild(child);\r\n            }\r\n        });\r\n        return host;\r\n    }\r\n    patch(vDom, host) {\r\n        const newNode = host || (vDom instanceof VElement ? this.createElement(vDom) : this.createTextNode(vDom));\r\n        if (vDom instanceof VElement) {\r\n            vDom.childNodes.forEach(child => {\r\n                if (this.rendererVNodeMap.get(child)) {\r\n                    newNode.appendChild(this.getNativeNodeByVDom(child));\r\n                }\r\n                else {\r\n                    newNode.appendChild(this.patch(child));\r\n                }\r\n            });\r\n        }\r\n        return newNode;\r\n    }\r\n    rendingFragment(fragment, host, forceUpdate = false) {\r\n        if (fragment.length === 0) {\r\n            fragment.append(new BrComponent());\r\n        }\r\n        if (fragment.dirty || forceUpdate) {\r\n            const { childFormats, containerFormats } = Renderer.formatSeparate(fragment);\r\n            const elements = this.rendingSlotFormats(containerFormats, host);\r\n            const root = elements[0];\r\n            const slot = elements[elements.length - 1];\r\n            if (root !== host) {\r\n                throw rendererErrorFn('slot elements cannot be replaced.');\r\n            }\r\n            this.rendingContents(fragment, childFormats, 0, fragment.length).forEach(child => {\r\n                (slot || host).appendChild(child);\r\n            });\r\n            fragment.rendered();\r\n            this.fragmentContentContainerMapping.set(fragment, host);\r\n            elements.forEach(el => {\r\n                this.vDomPositionMapping.set(el, {\r\n                    fragment,\r\n                    startIndex: 0,\r\n                    endIndex: fragment.length\r\n                });\r\n            });\r\n            return host;\r\n        }\r\n        fragment.sliceContents().forEach(content => {\r\n            if (content instanceof AbstractComponent && content.changed) {\r\n                const isDirty = content.dirty;\r\n                const oldVDom = this.componentVDomCacheMap.get(content);\r\n                const newVDom = this.rendingComponent(content);\r\n                if (isDirty) {\r\n                    this.vDomPositionMapping.set(newVDom, this.vDomPositionMapping.get(oldVDom));\r\n                    const isEqual = equal(newVDom, oldVDom);\r\n                    const oldNativeNode = this.NVMappingTable.get(oldVDom);\r\n                    const newNativeNode = this.diffAndUpdate(newVDom, oldVDom, isEqual && oldNativeNode);\r\n                    this.componentVDomCacheMap.set(content, newVDom);\r\n                    this.NVMappingTable.set(newVDom, newNativeNode);\r\n                    oldVDom.parentNode.replaceChild(newVDom, oldVDom);\r\n                    this.destroyVDom(oldVDom);\r\n                    if (isEqual) {\r\n                        newVDom.onRendered(oldNativeNode);\r\n                    }\r\n                    else {\r\n                        oldNativeNode.parentNode.replaceChild(newNativeNode, oldNativeNode);\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        return host;\r\n    }\r\n    rendingComponent(component) {\r\n        if (component.dirty) {\r\n            let vElement;\r\n            if (component instanceof DivisionAbstractComponent) {\r\n                vElement = component.render(false, slot => {\r\n                    if (slot.dirty) {\r\n                        const host = component.slotRender(false, (s, contentContainer) => {\r\n                            contentContainer.attrs.set('textbus-editable', 'on');\r\n                            return this.rendingFragment(s, contentContainer);\r\n                        });\r\n                        this.fragmentVDomMapping.set(slot, host);\r\n                        return host;\r\n                    }\r\n                    else {\r\n                        return this.fragmentVDomMapping.get(slot);\r\n                    }\r\n                });\r\n            }\r\n            else if (component instanceof BranchAbstractComponent || component instanceof BackboneAbstractComponent) {\r\n                vElement = component.render(false, slot => {\r\n                    if (slot.dirty) {\r\n                        const host = component.slotRender(slot, false, (s, contentContainer) => {\r\n                            contentContainer.attrs.set('textbus-editable', 'on');\r\n                            return this.rendingFragment(s, contentContainer);\r\n                        });\r\n                        this.fragmentVDomMapping.set(slot, host);\r\n                        return host;\r\n                    }\r\n                    else {\r\n                        return this.fragmentVDomMapping.get(slot);\r\n                    }\r\n                });\r\n            }\r\n            else if (component instanceof LeafAbstractComponent) {\r\n                vElement = component.render(false);\r\n            }\r\n            if (!(vElement instanceof VElement)) {\r\n                throw rendererErrorFn(`component render method must return a virtual element.`);\r\n            }\r\n            this.componentVDomCacheMap.set(component, vElement);\r\n            component.rendered();\r\n            if (component instanceof DivisionAbstractComponent) {\r\n                const slotView = this.fragmentContentContainerMapping.get(component.slot);\r\n                if (slotView === vElement) {\r\n                    slotView.attrs.delete('textbus-editable');\r\n                }\r\n                else {\r\n                    vElement.attrs.set('textbus-editable', 'off');\r\n                }\r\n            }\r\n            else if (component instanceof BranchAbstractComponent ||\r\n                component instanceof BackboneAbstractComponent ||\r\n                component instanceof LeafAbstractComponent && vElement.childNodes.length > 0) {\r\n                vElement.attrs.set('textbus-editable', 'off');\r\n            }\r\n            return vElement;\r\n        }\r\n        if (component instanceof DivisionAbstractComponent) {\r\n            if (component.slot.dirty) {\r\n                this.replaceSlotView(component, component.slot);\r\n            }\r\n            else if (component.slot.changed) {\r\n                this.rendingFragment(component.slot, this.fragmentContentContainerMapping.get(component.slot));\r\n            }\r\n        }\r\n        else if (component instanceof BranchAbstractComponent) {\r\n            component.slots.forEach(fragment => {\r\n                if (fragment.dirty) {\r\n                    this.replaceSlotView(component, fragment);\r\n                }\r\n                else if (fragment.changed) {\r\n                    this.rendingFragment(fragment, this.fragmentContentContainerMapping.get(fragment));\r\n                }\r\n            });\r\n        }\r\n        else if (component instanceof BackboneAbstractComponent) {\r\n            Array.from(component).forEach(fragment => {\r\n                if (fragment.dirty) {\r\n                    this.replaceSlotView(component, fragment);\r\n                }\r\n                else if (fragment.changed) {\r\n                    this.rendingFragment(fragment, this.fragmentContentContainerMapping.get(fragment));\r\n                }\r\n            });\r\n        }\r\n        component.rendered();\r\n        return this.componentVDomCacheMap.get(component);\r\n    }\r\n    replaceSlotView(component, slot) {\r\n        const oldView = this.fragmentVDomMapping.get(slot);\r\n        let newView;\r\n        if (component instanceof DivisionAbstractComponent) {\r\n            const componentRootView = this.componentVDomCacheMap.get(component);\r\n            let container = null;\r\n            newView = component.slotRender(false, (slot, contentContainer) => {\r\n                container = contentContainer;\r\n                return this.rendingFragment(slot, contentContainer, true);\r\n            });\r\n            if (componentRootView === oldView) {\r\n                this.componentVDomCacheMap.set(component, container);\r\n            }\r\n            else {\r\n                container.attrs.set('textbus-editable', 'on');\r\n            }\r\n            this.fragmentVDomMapping.set(slot, newView);\r\n        }\r\n        else {\r\n            newView = component.slotRender(slot, false, (slot, contentContainer) => {\r\n                const view = this.rendingFragment(slot, contentContainer, true);\r\n                view.attrs.set('textbus-editable', 'on');\r\n                return view;\r\n            });\r\n            this.fragmentVDomMapping.set(slot, newView);\r\n        }\r\n        const isEqual = equal(newView, oldView);\r\n        const oldNativeNode = this.getNativeNodeByVDom(oldView);\r\n        const newNativeNode = this.diffAndUpdate(newView, oldView, isEqual && oldNativeNode);\r\n        this.destroyVDom(oldView);\r\n        if (isEqual) {\r\n            newView.onRendered(oldNativeNode);\r\n        }\r\n        else {\r\n            oldNativeNode.parentNode.replaceChild(newNativeNode, oldNativeNode);\r\n        }\r\n        this.NVMappingTable.set(newNativeNode, newView);\r\n        oldView.parentNode.replaceChild(newView, oldView);\r\n        return newView;\r\n    }\r\n    rendingSlotFormats(formats, vDom) {\r\n        let elements = [];\r\n        if (vDom) {\r\n            elements.push(vDom);\r\n        }\r\n        formats.reduce((vEle, next) => {\r\n            const context = {\r\n                isOutputMode: false,\r\n                effect: next.params.effect,\r\n                formatData: next.params.formatData,\r\n            };\r\n            const newVElement = next.token.render(context, vEle);\r\n            if (newVElement && newVElement !== vEle) {\r\n                elements.push(newVElement);\r\n                return newVElement;\r\n            }\r\n            return vEle;\r\n        }, vDom);\r\n        if (!elements.length) {\r\n            if (vDom) {\r\n                elements = [vDom];\r\n            }\r\n            else {\r\n                return [];\r\n            }\r\n        }\r\n        elements.reduce((parent, child) => {\r\n            parent.appendChild(child);\r\n            return child;\r\n        });\r\n        return elements;\r\n    }\r\n    createVDOMByExtractContent(fragment, startIndex, endIndex) {\r\n        const children = [];\r\n        const contents = fragment.sliceContents(startIndex, endIndex);\r\n        let i = startIndex;\r\n        contents.forEach(item => {\r\n            if (typeof item === 'string') {\r\n                const textNode = new VTextNode(item);\r\n                this.vDomPositionMapping.set(textNode, {\r\n                    fragment,\r\n                    startIndex: i,\r\n                    endIndex: i + item.length\r\n                });\r\n                i += item.length;\r\n                children.push(textNode);\r\n            }\r\n            else {\r\n                const oldVDom = this.componentVDomCacheMap.get(item);\r\n                const vDom = this.rendingComponent(item);\r\n                if (oldVDom && oldVDom !== vDom) {\r\n                    this.destroyVDom(oldVDom);\r\n                }\r\n                this.vDomPositionMapping.set(vDom, {\r\n                    fragment,\r\n                    startIndex: i,\r\n                    endIndex: i + 1\r\n                });\r\n                children.push(vDom);\r\n                i++;\r\n            }\r\n        });\r\n        return children;\r\n    }\r\n    rendingContents(fragment, formats, startIndex, endIndex) {\r\n        const children = [];\r\n        while (startIndex < endIndex) {\r\n            const firstRange = formats.shift();\r\n            if (firstRange) {\r\n                if (startIndex < firstRange.params.startIndex) {\r\n                    children.push(...this.createVDOMByExtractContent(fragment, startIndex, firstRange.params.startIndex));\r\n                }\r\n                const childFormats = [firstRange];\r\n                while (true) {\r\n                    const f = formats[0];\r\n                    if (f && f.params.startIndex === firstRange.params.startIndex && f.params.endIndex === firstRange.params.endIndex) {\r\n                        childFormats.push(formats.shift());\r\n                    }\r\n                    else {\r\n                        break;\r\n                    }\r\n                }\r\n                const elements = this.rendingSlotFormats(childFormats);\r\n                elements.forEach(el => {\r\n                    this.vDomPositionMapping.set(el, {\r\n                        fragment,\r\n                        startIndex: firstRange.params.startIndex,\r\n                        endIndex: firstRange.params.endIndex\r\n                    });\r\n                });\r\n                const host = elements[0];\r\n                const slot = elements[elements.length - 1];\r\n                const progenyFormats = [];\r\n                let index = 0;\r\n                while (true) {\r\n                    const f = formats[index];\r\n                    if (f && f.params.startIndex < firstRange.params.endIndex) {\r\n                        if (f.params.endIndex <= firstRange.params.endIndex) {\r\n                            progenyFormats.push(formats.splice(index, 1)[0]);\r\n                        }\r\n                        else {\r\n                            const cloneRange = {\r\n                                token: f.token,\r\n                                params: Object.assign(Object.assign({}, f.params), { endIndex: firstRange.params.endIndex })\r\n                            };\r\n                            progenyFormats.push(cloneRange);\r\n                            f.params.startIndex = firstRange.params.endIndex;\r\n                            index++;\r\n                        }\r\n                    }\r\n                    else {\r\n                        break;\r\n                    }\r\n                }\r\n                formats = Renderer.calculatePriority(formats);\r\n                if (progenyFormats.length) {\r\n                    this.rendingContents(fragment, progenyFormats, firstRange.params.startIndex, firstRange.params.endIndex).forEach(item => {\r\n                        slot ? slot.appendChild(item) : children.push(item);\r\n                    });\r\n                }\r\n                else {\r\n                    this.createVDOMByExtractContent(fragment, firstRange.params.startIndex, firstRange.params.endIndex).forEach(item => {\r\n                        slot ? slot.appendChild(item) : children.push(item);\r\n                    });\r\n                }\r\n                host && children.push(host);\r\n                startIndex = firstRange.params.endIndex;\r\n            }\r\n            else {\r\n                children.push(...this.createVDOMByExtractContent(fragment, startIndex, endIndex));\r\n                break;\r\n            }\r\n        }\r\n        return children;\r\n    }\r\n    createElement(vDom) {\r\n        this.rendererVNodeMap.set(vDom, true);\r\n        const el = document.createElement(vDom.tagName);\r\n        vDom.attrs.forEach((value, key) => {\r\n            if (value === false) {\r\n                return;\r\n            }\r\n            if (value === true) {\r\n                el[key] = true;\r\n                return;\r\n            }\r\n            el.setAttribute(key, value + '');\r\n        });\r\n        vDom.styles.forEach((value, key) => {\r\n            el.style[key] = value;\r\n        });\r\n        vDom.classes.forEach(k => el.classList.add(k));\r\n        this.NVMappingTable.set(el, vDom);\r\n        if (typeof vDom.onRendered === 'function') {\r\n            vDom.onRendered(el);\r\n        }\r\n        return el;\r\n    }\r\n    createTextNode(vDom) {\r\n        this.rendererVNodeMap.set(vDom, true);\r\n        const el = document.createTextNode(Renderer.replaceEmpty(vDom.textContent, '\\u00a0'));\r\n        this.NVMappingTable.set(el, vDom);\r\n        return el;\r\n    }\r\n    destroyVDom(vEle) {\r\n        for (const child of vEle.childNodes) {\r\n            if (child instanceof VElement) {\r\n                this.destroyVDom(child);\r\n            }\r\n        }\r\n        vEle.destroy();\r\n    }\r\n    /**\r\n     *  unicode DOM Text \r\n     * @param s\r\n     * @param target\r\n     */\r\n    static replaceEmpty(s, target) {\r\n        return s.replace(/\\s\\s+/g, str => {\r\n            return ' ' + Array.from({\r\n                length: str.length - 1\r\n            }).fill(target).join('');\r\n        }).replace(/^\\s|\\s$/g, target);\r\n    }\r\n    static calculatePriority(formats) {\r\n        return formats.filter(i => {\r\n            return i.params.effect !== FormatEffect.Inherit;\r\n        }).sort((next, prev) => {\r\n            const a = next.params.startIndex - prev.params.startIndex;\r\n            if (a === 0) {\r\n                const b = prev.params.endIndex - next.params.endIndex;\r\n                if (b === 0) {\r\n                    return next.token.priority - prev.token.priority;\r\n                }\r\n                return b;\r\n            }\r\n            return a;\r\n        });\r\n    }\r\n    static formatSeparate(fragment) {\r\n        const containerFormats = [];\r\n        const childFormats = [];\r\n        const formatRangeConfigList = [];\r\n        fragment.getFormatKeys().forEach(token => {\r\n            fragment.getFormatRanges(token).forEach(f => {\r\n                formatRangeConfigList.push({\r\n                    token,\r\n                    params: Object.assign({}, f)\r\n                });\r\n            });\r\n        });\r\n        Renderer.calculatePriority(formatRangeConfigList).forEach(f => {\r\n            if (f.token instanceof BlockFormatter || f.params.startIndex === 0 && f.params.endIndex === fragment.length) {\r\n                containerFormats.push(f);\r\n            }\r\n            else {\r\n                childFormats.push(f);\r\n            }\r\n        });\r\n        return {\r\n            containerFormats,\r\n            childFormats\r\n        };\r\n    }\r\n}\r\n/**\r\n *  DOM \r\n * @param left\r\n * @param right\r\n */\r\nfunction equal(left, right) {\r\n    if (left === right) {\r\n        return true;\r\n    }\r\n    return left.tagName == right.tagName &&\r\n        equalMap(left.attrs, right.attrs) &&\r\n        equalMap(left.styles, right.styles) &&\r\n        equalClasses(left.classes, right.classes);\r\n}\r\nfunction equalMap(left, right) {\r\n    if (left === right || !left === true && !right === true) {\r\n        return true;\r\n    }\r\n    if (!left !== !right || left.size !== right.size) {\r\n        return false;\r\n    }\r\n    return Array.from(left.keys()).reduce((v, key) => {\r\n        return v && left.get(key) === right.get(key);\r\n    }, true);\r\n}\r\nfunction equalClasses(left, right) {\r\n    if (left === right) {\r\n        return true;\r\n    }\r\n    if (left.length !== right.length) {\r\n        return false;\r\n    }\r\n    for (const k of left) {\r\n        if (!right.includes(k)) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\n//# sourceMappingURL=renderer.js.map","import { VElement, VTextNode } from './element';\r\nimport { BackboneAbstractComponent, BranchAbstractComponent, AbstractComponent, DivisionAbstractComponent, LeafAbstractComponent } from './component';\r\nimport { Renderer } from './renderer';\r\nimport { makeError } from '../_utils/make-error';\r\nconst outputRendererErrorFn = makeError('OutputRenderer');\r\nexport class OutputRenderer {\r\n    constructor() {\r\n        // \r\n        this.componentVDomCacheMap = new WeakMap();\r\n        //  fragment \r\n        this.fragmentVDomMapping = new WeakMap();\r\n        //  fragment \r\n        this.fragmentContentContainerMapping = new WeakMap();\r\n    }\r\n    render(component) {\r\n        const root = this.rendingComponent(component);\r\n        // hack  DOM \r\n        new VElement('html', {\r\n            childNodes: [root]\r\n        });\r\n        // hack end\r\n        return root;\r\n    }\r\n    rendingFragment(fragment, host, forceUpdate = false) {\r\n        if (fragment.outputDirty || forceUpdate) {\r\n            const { childFormats, containerFormats } = Renderer.formatSeparate(fragment);\r\n            const elements = this.rendingSlotFormats(containerFormats, host);\r\n            const root = elements[0];\r\n            const slot = elements[elements.length - 1];\r\n            if (root !== host) {\r\n                throw outputRendererErrorFn('slot elements cannot be replaced.');\r\n            }\r\n            this.rendingContents(fragment, childFormats, 0, fragment.length).forEach(child => {\r\n                (slot || host).appendChild(child);\r\n            });\r\n            fragment.outputRendered();\r\n            this.fragmentContentContainerMapping.set(fragment, host);\r\n            return host;\r\n        }\r\n        fragment.sliceContents().forEach(content => {\r\n            if (content instanceof AbstractComponent && content.outputChanged) {\r\n                const isDirty = content.outputDirty;\r\n                const oldVDom = this.componentVDomCacheMap.get(content);\r\n                const newVDom = this.rendingComponent(content);\r\n                if (isDirty) {\r\n                    this.componentVDomCacheMap.set(content, newVDom);\r\n                    oldVDom.parentNode.replaceChild(newVDom, oldVDom);\r\n                }\r\n            }\r\n        });\r\n        return host;\r\n    }\r\n    rendingComponent(component) {\r\n        if (component.outputDirty) {\r\n            let vElement;\r\n            if (component instanceof DivisionAbstractComponent) {\r\n                vElement = component.render(true, slot => {\r\n                    if (slot.outputDirty) {\r\n                        const host = component.slotRender(true, (s, contentContainer) => {\r\n                            return this.rendingFragment(s, contentContainer);\r\n                        });\r\n                        this.fragmentVDomMapping.set(slot, host);\r\n                        return host;\r\n                    }\r\n                    else {\r\n                        return this.fragmentVDomMapping.get(slot);\r\n                    }\r\n                });\r\n            }\r\n            else if (component instanceof BranchAbstractComponent || component instanceof BackboneAbstractComponent) {\r\n                vElement = component.render(true, slot => {\r\n                    if (slot.outputDirty) {\r\n                        const host = component.slotRender(slot, true, (s, contentContainer) => {\r\n                            return this.rendingFragment(s, contentContainer);\r\n                        });\r\n                        this.fragmentVDomMapping.set(slot, host);\r\n                        return host;\r\n                    }\r\n                    else {\r\n                        return this.fragmentVDomMapping.get(slot);\r\n                    }\r\n                });\r\n            }\r\n            else if (component instanceof LeafAbstractComponent) {\r\n                vElement = component.render(true);\r\n            }\r\n            if (!(vElement instanceof VElement)) {\r\n                throw outputRendererErrorFn(`component render method must return a virtual element.`);\r\n            }\r\n            this.componentVDomCacheMap.set(component, vElement);\r\n            component.outputRendered();\r\n            return vElement;\r\n        }\r\n        if (component instanceof DivisionAbstractComponent) {\r\n            if (component.slot.outputDirty) {\r\n                this.replaceSlotView(component, component.slot);\r\n            }\r\n            else if (component.slot.outputChanged) {\r\n                this.rendingFragment(component.slot, this.fragmentContentContainerMapping.get(component.slot));\r\n            }\r\n        }\r\n        else if (component instanceof BranchAbstractComponent) {\r\n            component.slots.forEach(fragment => {\r\n                if (fragment.outputDirty) {\r\n                    this.replaceSlotView(component, fragment);\r\n                }\r\n                else if (fragment.outputChanged) {\r\n                    this.rendingFragment(fragment, this.fragmentContentContainerMapping.get(fragment));\r\n                }\r\n            });\r\n        }\r\n        else if (component instanceof BackboneAbstractComponent) {\r\n            Array.from(component).forEach(fragment => {\r\n                if (fragment.outputDirty) {\r\n                    this.replaceSlotView(component, fragment);\r\n                }\r\n                else if (fragment.outputChanged) {\r\n                    this.rendingFragment(fragment, this.fragmentContentContainerMapping.get(fragment));\r\n                }\r\n            });\r\n        }\r\n        component.outputRendered();\r\n        return this.componentVDomCacheMap.get(component);\r\n    }\r\n    replaceSlotView(component, slot) {\r\n        const oldView = this.fragmentVDomMapping.get(slot);\r\n        let newView;\r\n        if (component instanceof DivisionAbstractComponent) {\r\n            const componentRootView = this.componentVDomCacheMap.get(component);\r\n            newView = component.slotRender(true, (slot, contentContainer) => {\r\n                return this.rendingFragment(slot, contentContainer);\r\n            });\r\n            if (oldView === componentRootView) {\r\n                this.componentVDomCacheMap.set(component, newView);\r\n            }\r\n            this.fragmentVDomMapping.set(slot, newView);\r\n        }\r\n        else {\r\n            newView = component.slotRender(slot, true, (slot, contentContainer) => {\r\n                return this.rendingFragment(slot, contentContainer);\r\n            });\r\n            this.fragmentVDomMapping.set(slot, newView);\r\n        }\r\n        oldView.parentNode.replaceChild(newView, oldView);\r\n    }\r\n    rendingSlotFormats(formats, vDom) {\r\n        let elements = [];\r\n        if (vDom) {\r\n            elements.push(vDom);\r\n        }\r\n        formats.reduce((vEle, next) => {\r\n            const context = {\r\n                isOutputMode: true,\r\n                effect: next.params.effect,\r\n                formatData: next.params.formatData,\r\n            };\r\n            const newVElement = next.token.render(context, vEle);\r\n            if (newVElement && newVElement !== vEle) {\r\n                elements.push(newVElement);\r\n                return newVElement;\r\n            }\r\n            return vEle;\r\n        }, vDom);\r\n        if (!elements.length) {\r\n            if (vDom) {\r\n                elements = [vDom];\r\n            }\r\n            else {\r\n                return [];\r\n            }\r\n        }\r\n        elements.reduce((parent, child) => {\r\n            parent.appendChild(child);\r\n            return child;\r\n        });\r\n        return elements;\r\n    }\r\n    createVDOMByExtractContent(fragment, startIndex, endIndex) {\r\n        const children = [];\r\n        const contents = fragment.sliceContents(startIndex, endIndex);\r\n        contents.forEach(item => {\r\n            if (typeof item === 'string') {\r\n                const textNode = new VTextNode(item);\r\n                children.push(textNode);\r\n            }\r\n            else {\r\n                const vDom = this.rendingComponent(item);\r\n                children.push(vDom);\r\n            }\r\n        });\r\n        return children;\r\n    }\r\n    rendingContents(fragment, formats, startIndex, endIndex) {\r\n        const children = [];\r\n        while (startIndex < endIndex) {\r\n            const firstRange = formats.shift();\r\n            if (firstRange) {\r\n                if (startIndex < firstRange.params.startIndex) {\r\n                    children.push(...this.createVDOMByExtractContent(fragment, startIndex, firstRange.params.startIndex));\r\n                }\r\n                const childFormats = [firstRange];\r\n                while (true) {\r\n                    const f = formats[0];\r\n                    if (f && f.params.startIndex === firstRange.params.startIndex && f.params.endIndex === firstRange.params.endIndex) {\r\n                        childFormats.push(formats.shift());\r\n                    }\r\n                    else {\r\n                        break;\r\n                    }\r\n                }\r\n                const elements = this.rendingSlotFormats(childFormats);\r\n                const host = elements[0];\r\n                const slot = elements[elements.length - 1];\r\n                const progenyFormats = [];\r\n                let index = 0;\r\n                while (true) {\r\n                    const f = formats[index];\r\n                    if (f && f.params.startIndex < firstRange.params.endIndex) {\r\n                        if (f.params.endIndex <= firstRange.params.endIndex) {\r\n                            progenyFormats.push(formats.splice(index, 1)[0]);\r\n                        }\r\n                        else {\r\n                            const cloneRange = {\r\n                                token: f.token,\r\n                                params: Object.assign(Object.assign({}, f.params), { endIndex: firstRange.params.endIndex })\r\n                            };\r\n                            progenyFormats.push(cloneRange);\r\n                            f.params.startIndex = firstRange.params.endIndex;\r\n                            index++;\r\n                        }\r\n                    }\r\n                    else {\r\n                        break;\r\n                    }\r\n                }\r\n                formats = Renderer.calculatePriority(formats);\r\n                if (progenyFormats.length) {\r\n                    this.rendingContents(fragment, progenyFormats, firstRange.params.startIndex, firstRange.params.endIndex).forEach(item => {\r\n                        slot ? slot.appendChild(item) : children.push(item);\r\n                    });\r\n                }\r\n                else {\r\n                    this.createVDOMByExtractContent(fragment, firstRange.params.startIndex, firstRange.params.endIndex).forEach(item => {\r\n                        slot ? slot.appendChild(item) : children.push(item);\r\n                    });\r\n                }\r\n                host && children.push(host);\r\n                startIndex = firstRange.params.endIndex;\r\n            }\r\n            else {\r\n                children.push(...this.createVDOMByExtractContent(fragment, startIndex, endIndex));\r\n                break;\r\n            }\r\n        }\r\n        return children;\r\n    }\r\n}\r\n//# sourceMappingURL=output-renderer.js.map","import { Fragment } from './fragment';\r\nimport { FormatEffect } from './formatter';\r\nimport { BranchAbstractComponent, DivisionAbstractComponent, BackboneAbstractComponent } from './component';\r\n/**\r\n * Parser  DOM ComponentFragment\r\n */\r\nexport class Parser {\r\n    constructor(componentLoaders = [], formatters = []) {\r\n        this.componentLoaders = componentLoaders;\r\n        this.formatters = formatters;\r\n    }\r\n    static parseHTML(html) {\r\n        return new DOMParser().parseFromString(html, 'text/html').body;\r\n    }\r\n    /** @deprecated */\r\n    static parserHTML(html) {\r\n        return Parser.parseHTML(html);\r\n    }\r\n    parse(el) {\r\n        const rootSlot = new Fragment();\r\n        this.readComponent(el, rootSlot);\r\n        return rootSlot;\r\n    }\r\n    readComponent(el, slot) {\r\n        if (el.nodeType === Node.ELEMENT_NODE) {\r\n            for (const t of this.componentLoaders) {\r\n                if (t.match(el)) {\r\n                    const viewData = t.read(el);\r\n                    slot.append(viewData.component, false);\r\n                    viewData.slotsMap.forEach(item => {\r\n                        if (!item.from) {\r\n                            return;\r\n                        }\r\n                        if (viewData.component instanceof DivisionAbstractComponent ||\r\n                            viewData.component instanceof BranchAbstractComponent ||\r\n                            viewData.component instanceof BackboneAbstractComponent ||\r\n                            item.from === el) {\r\n                            this.readFormats(item.from, item.toSlot);\r\n                        }\r\n                        else {\r\n                            this.readComponent(item.from, item.toSlot);\r\n                        }\r\n                    });\r\n                    return;\r\n                }\r\n            }\r\n            this.readFormats(el, slot);\r\n        }\r\n        else if (el.nodeType === Node.TEXT_NODE) {\r\n            const textContent = el.textContent;\r\n            if (/^\\s*[\\r\\n]+\\s*$/.test(textContent)) {\r\n                return;\r\n            }\r\n            slot.append(textContent, false);\r\n        }\r\n    }\r\n    readFormats(el, slot) {\r\n        const maps = this.formatters.map(f => {\r\n            return {\r\n                formatter: f,\r\n                effect: f.match(el)\r\n            };\r\n        }).filter(p => p.effect !== FormatEffect.Invalid).map(p => {\r\n            return Object.assign(Object.assign({}, p), { formatData: p.formatter.read(el) });\r\n        });\r\n        const startIndex = slot.length;\r\n        Array.from(el.childNodes).forEach(child => {\r\n            this.readComponent(child, slot);\r\n        });\r\n        maps.forEach(item => {\r\n            slot.apply(item.formatter, {\r\n                startIndex,\r\n                endIndex: slot.length,\r\n                formatData: item.formatData,\r\n                effect: item.effect\r\n            }, {\r\n                important: false\r\n            });\r\n        });\r\n    }\r\n}\r\n//# sourceMappingURL=parser.js.map","import { Fragment } from './fragment';\r\nimport { VElement, VTextNode } from './element';\r\nimport { BranchAbstractComponent, LeafAbstractComponent, DivisionAbstractComponent, AbstractComponent, BackboneAbstractComponent, BrComponent } from './component';\r\n/**\r\n * TextBus  Fragment  Component \r\n */\r\nexport class TBRange {\r\n    constructor(nativeRange, renderer) {\r\n        var _a;\r\n        this.nativeRange = nativeRange;\r\n        this.renderer = renderer;\r\n        const startPosition = renderer.getPositionByNode(nativeRange.startContainer);\r\n        const endPosition = renderer.getPositionByNode(nativeRange.endContainer);\r\n        if ([Node.ELEMENT_NODE, Node.TEXT_NODE].includes((_a = nativeRange.commonAncestorContainer) === null || _a === void 0 ? void 0 : _a.nodeType) &&\r\n            startPosition && endPosition) {\r\n            const start = TBRange.findPosition(nativeRange.startContainer, nativeRange.startOffset, startPosition, renderer);\r\n            if (start) {\r\n                this.setStart(start.fragment, start.index);\r\n            }\r\n            const end = TBRange.findPosition(nativeRange.endContainer, nativeRange.endOffset, endPosition, renderer);\r\n            if (end) {\r\n                this.setEnd(end.fragment, end.index);\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     *  Fragment\r\n     */\r\n    get commonAncestorFragment() {\r\n        return this.getCommonAncestorFragment();\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    get commonAncestorComponent() {\r\n        return this.getCommonAncestorComponent();\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    get collapsed() {\r\n        return this.startFragment === this.commonAncestorFragment &&\r\n            this.endFragment === this.commonAncestorFragment &&\r\n            this.startIndex === this.endIndex;\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    clone() {\r\n        const r = new TBRange(this.nativeRange.cloneRange(), this.renderer);\r\n        Object.assign(r, this);\r\n        return r;\r\n    }\r\n    /**\r\n     *  startFragment  startIndexendFragment  endIndex\r\n     */\r\n    restore() {\r\n        if (this.startFragment.dirty || this.endFragment.dirty) {\r\n            console.info('');\r\n            return this;\r\n        }\r\n        const start = this.findFocusNodeAndOffset(this.startFragment, this.startIndex);\r\n        const end = this.findFocusNodeAndOffset(this.endFragment, this.endIndex);\r\n        if (start && end) {\r\n            this.nativeRange.setStart(start.node, start.offset);\r\n            this.nativeRange.setEnd(end.node, end.offset);\r\n        }\r\n        else {\r\n            console.warn('');\r\n        }\r\n        return this;\r\n    }\r\n    /**\r\n     * \r\n     * @param fragment \r\n     * @param offset  0 \r\n     */\r\n    setStart(fragment, offset) {\r\n        this.startFragment = fragment;\r\n        this.startIndex = offset;\r\n    }\r\n    /**\r\n     * \r\n     * @param fragment \r\n     * @param offset  0 \r\n     */\r\n    setEnd(fragment, offset) {\r\n        this.endFragment = fragment;\r\n        this.endIndex = offset;\r\n    }\r\n    setPosition(fragment, offset) {\r\n        this.setStart(fragment, offset);\r\n        this.setEnd(fragment, offset);\r\n    }\r\n    /**\r\n     *  Fragment \r\n     */\r\n    getCommonAncestorFragmentScope() {\r\n        let startFragment = this.startFragment;\r\n        let endFragment = this.endFragment;\r\n        let startChildFragment = this.startFragment;\r\n        let endChildFragment = this.endFragment;\r\n        let startIndex = this.startIndex;\r\n        let endIndex = this.endIndex;\r\n        const commonAncestorFragment = this.commonAncestorFragment;\r\n        const commonAncestorComponent = this.commonAncestorComponent;\r\n        let startChildComponent = null;\r\n        let endChildComponent = null;\r\n        while (startFragment !== commonAncestorFragment) {\r\n            startChildComponent = startFragment.parentComponent;\r\n            if (startChildComponent === commonAncestorComponent) {\r\n                startChildFragment = startFragment;\r\n            }\r\n            startFragment = startChildComponent.parentFragment;\r\n            startIndex = startFragment.indexOf(startChildComponent);\r\n        }\r\n        while (endFragment !== commonAncestorFragment) {\r\n            endChildComponent = endFragment.parentComponent;\r\n            if (endChildComponent === commonAncestorComponent) {\r\n                endChildFragment = endFragment;\r\n            }\r\n            endFragment = endChildComponent.parentFragment;\r\n            endIndex = endFragment.indexOf(endChildComponent);\r\n        }\r\n        return {\r\n            startIndex,\r\n            startFragment,\r\n            startChildComponent,\r\n            endIndex: endIndex + 1,\r\n            endFragment,\r\n            endChildComponent,\r\n            startChildFragment,\r\n            endChildFragment\r\n        };\r\n    }\r\n    /**\r\n     *  T \r\n     * @param of  class\r\n     * @param filter  T \r\n     */\r\n    getSlotRange(of, filter) {\r\n        const maps = [];\r\n        this.getSelectedScope().forEach(scope => {\r\n            const context = scope.fragment.getContext(of, filter);\r\n            let fragment = scope.fragment;\r\n            while (fragment) {\r\n                const parentComponent = fragment.parentComponent;\r\n                if (parentComponent === context) {\r\n                    maps.push({\r\n                        component: context,\r\n                        index: context instanceof BackboneAbstractComponent ?\r\n                            context.indexOf(fragment) :\r\n                            context.slots.indexOf(fragment)\r\n                    });\r\n                    break;\r\n                }\r\n                fragment = parentComponent.parentFragment;\r\n            }\r\n        });\r\n        const components = [];\r\n        const rangeMark = new Map();\r\n        maps.forEach(item => {\r\n            if (!components.includes(item.component)) {\r\n                components.push(item.component);\r\n                rangeMark.set(item.component, { startIndex: item.index, endIndex: item.index + 1 });\r\n            }\r\n            else {\r\n                rangeMark.get(item.component).endIndex = item.index + 1;\r\n            }\r\n        });\r\n        return components.map(t => {\r\n            return Object.assign({ component: t }, rangeMark.get(t));\r\n        });\r\n    }\r\n    /**\r\n     * \r\n     * [])\r\n     * <Fragment>\r\n     *   <Inline>00[00</Inline>\r\n     *   <ChildFragmentA>11111</ChildFragmentA>\r\n     *   <ChildFragmentB>222]22</ChildFragmentB>\r\n     * </Fragment>\r\n     * \r\n     * [{\r\n     *   fragment: Fragment,\r\n     *   startIndex: 2,\r\n     *   endIndex: 4,\r\n     * }, {\r\n     *   fragment: ChildFragmentA,\r\n     *   startIndex: 0,\r\n     *   endIndex: 5\r\n     * }, {\r\n     *   fragment: ChildFragmentB,\r\n     *   startIndex: 0,\r\n     *   endIndex: 3\r\n     * }]\r\n     */\r\n    getSelectedScope() {\r\n        if (this.collapsed) {\r\n            return [{\r\n                    fragment: this.commonAncestorFragment,\r\n                    startIndex: this.startIndex,\r\n                    endIndex: this.endIndex\r\n                }];\r\n        }\r\n        return this.getScopes(this.startFragment, this.endFragment, this.startIndex, this.endIndex);\r\n    }\r\n    /**\r\n     *  Inline\r\n     * [])\r\n     * <Fragment>\r\n     *   <Inline>00[00</Inline>\r\n     *   <ChildFragmentA>11111</ChildFragmentA>\r\n     *   <ChildFragmentB>222]22</ChildFragmentB>\r\n     * </Fragment>\r\n     * \r\n     * [{\r\n     *   fragment: Fragment,\r\n     *   startIndex: 0,\r\n     *   endIndex: 4,\r\n     * }, {\r\n     *   fragment: ChildFragmentA,\r\n     *   startIndex: 0,\r\n     *   endIndex: 5\r\n     * }, {\r\n     *   fragment: ChildFragmentB,\r\n     *   startIndex: 0,\r\n     *   endIndex: 5\r\n     * }]\r\n     */\r\n    getExpandedScope() {\r\n        return this.getScopes(this.startFragment, this.endFragment, TBRange.findExpandedStartIndex(this.startFragment, this.startIndex), TBRange.findExpandedEndIndex(this.endFragment, this.endIndex));\r\n    }\r\n    /**\r\n     *  Inline\r\n     * [])\r\n     * <Fragment>\r\n     *   <Inline>00[00</Inline>\r\n     *   <ChildFragmentA>11111</ChildFragmentA>\r\n     *   <ChildFragmentB>222]22</ChildFragmentB>\r\n     * </Fragment>\r\n     * \r\n     * [{\r\n     *   fragment: Fragment,\r\n     *   startIndex: 0,\r\n     *   endIndex: 4,\r\n     * }, {\r\n     *   fragment: ChildFragmentA,\r\n     *   startIndex: 0,\r\n     *   endIndex: 5\r\n     * }, {\r\n     *   fragment: ChildFragmentB,\r\n     *   startIndex: 0,\r\n     *   endIndex: 5\r\n     * }]\r\n     */\r\n    getSuccessiveContents() {\r\n        function fn(fragment, startIndex, endIndex) {\r\n            const scopes = [];\r\n            if (startIndex >= endIndex) {\r\n                return scopes;\r\n            }\r\n            let newScope;\r\n            let i = 0;\r\n            const contents = fragment.sliceContents(startIndex, endIndex);\r\n            contents.forEach(c => {\r\n                if (c instanceof DivisionAbstractComponent) {\r\n                    newScope = null;\r\n                    scopes.push(...fn(c.slot, 0, c.slot.length));\r\n                }\r\n                else if (c instanceof BranchAbstractComponent) {\r\n                    newScope = null;\r\n                    c.slots.forEach(childFragment => {\r\n                        scopes.push(...fn(childFragment, 0, childFragment.length));\r\n                    });\r\n                }\r\n                else if (c instanceof BackboneAbstractComponent) {\r\n                    newScope = null;\r\n                    for (const childFragment of c) {\r\n                        scopes.push(...fn(childFragment, 0, childFragment.length));\r\n                    }\r\n                }\r\n                else {\r\n                    if (c instanceof LeafAbstractComponent && c.block) {\r\n                        newScope = null;\r\n                    }\r\n                    if (!newScope) {\r\n                        newScope = {\r\n                            startIndex: startIndex + i,\r\n                            endIndex: startIndex + i + c.length,\r\n                            fragment\r\n                        };\r\n                        scopes.push(newScope);\r\n                    }\r\n                    else {\r\n                        newScope.endIndex = startIndex + i + c.length;\r\n                    }\r\n                }\r\n                i += c.length;\r\n            });\r\n            return scopes;\r\n        }\r\n        const result = [];\r\n        this.getExpandedScope().forEach(scope => {\r\n            result.push(...fn(scope.fragment, scope.startIndex, scope.endIndex));\r\n        });\r\n        return result;\r\n    }\r\n    delete() {\r\n        if (!this.collapsed) {\r\n            this.deleteRange();\r\n            return;\r\n        }\r\n        if (this.startIndex === 0) {\r\n            /**\r\n             * xxx ?\r\n             * <Block>[]<br></Block>\r\n             * xxx\r\n             *\r\n             * to\r\n             *\r\n             * []xxx\r\n             */\r\n            const currentContent = this.startFragment.getContentAtIndex(this.startIndex);\r\n            if (currentContent instanceof BrComponent && this.startFragment.length === 1) {\r\n                let position = this.getPreviousPosition();\r\n                if (position.fragment === this.startFragment) {\r\n                    position = this.getNextPosition();\r\n                }\r\n                this.deleteEmptyTree(this.startFragment);\r\n                this.setStart(position.fragment, position.index);\r\n                this.collapse();\r\n                return;\r\n            }\r\n            /**\r\n             * <br>\r\n             * <Block>[]xxx</Block>\r\n             *\r\n             * to\r\n             *\r\n             * <Block>xxx</Block>\r\n             */\r\n            const prevPosition = this.getPreviousPosition();\r\n            if (prevPosition.fragment !== this.startFragment) {\r\n                const startFragment = this.startFragment;\r\n                this.setStart(prevPosition.fragment, prevPosition.index);\r\n                const startContent = this.startFragment.getContentAtIndex(this.startIndex);\r\n                const scopes = this.getSelectedScope();\r\n                if (scopes.length === 1 &&\r\n                    this.startFragment === this.commonAncestorFragment &&\r\n                    startContent instanceof BrComponent) {\r\n                    this.deleteRange();\r\n                    this.collapse(true);\r\n                    return;\r\n                }\r\n                this.setStart(startFragment, 0);\r\n            }\r\n            /**\r\n             * <Leaf>\r\n             * <Block>[]xxx</Block>\r\n             *\r\n             * to\r\n             *\r\n             * <Block>xxx</Block>\r\n             */\r\n            if (prevPosition.fragment !== this.startFragment) {\r\n                const startFragment = this.startFragment;\r\n                this.setStart(prevPosition.fragment, prevPosition.index);\r\n                const scopes = this.getSelectedScope();\r\n                if (scopes.length === 0 &&\r\n                    this.startFragment === this.commonAncestorFragment &&\r\n                    this.startFragment.getContentAtIndex(this.startIndex - 1) instanceof LeafAbstractComponent) {\r\n                    this.startIndex--;\r\n                    this.deleteRange();\r\n                    this.collapse(true);\r\n                    return;\r\n                }\r\n                this.setStart(startFragment, 0);\r\n            }\r\n            /**\r\n             * string\r\n             * <Block>[]xxx</Block>\r\n             *\r\n             * to\r\n             *\r\n             * string[]xxx\r\n             */\r\n            if (prevPosition.fragment !== this.startFragment) {\r\n                const startFragment = this.startFragment;\r\n                this.setStart(prevPosition.fragment, prevPosition.index);\r\n                const scopes = this.getSelectedScope();\r\n                if (scopes.length === 0 &&\r\n                    this.startFragment === this.commonAncestorFragment &&\r\n                    typeof this.startFragment.getContentAtIndex(this.startIndex - 1) === 'string') {\r\n                    const afterContents = this.startFragment.cut(this.startIndex);\r\n                    this.startFragment.concat(this.endFragment);\r\n                    this.deleteEmptyTree(this.endFragment);\r\n                    this.startFragment.concat(afterContents);\r\n                    this.collapse();\r\n                    return;\r\n                }\r\n                this.setStart(startFragment, 0);\r\n            }\r\n            /**\r\n             * <Block>xxx</Block>\r\n             * <Block>[]xxx</Block>\r\n             *\r\n             * to\r\n             *\r\n             * <Block>xxx[]xxx</Block>\r\n             */\r\n            if (prevPosition.fragment !== this.startFragment) {\r\n                const startFragment = this.startFragment;\r\n                this.setStart(prevPosition.fragment, prevPosition.index);\r\n                const scopes = this.getSelectedScope();\r\n                if (scopes.length === 0 &&\r\n                    this.startFragment !== this.commonAncestorFragment) {\r\n                    this.startFragment.concat(this.endFragment.cut(0));\r\n                    this.deleteEmptyTree(this.endFragment);\r\n                    this.collapse();\r\n                    return;\r\n                }\r\n                this.setStart(startFragment, 0);\r\n            }\r\n            /**\r\n             * <Block><br></Block>\r\n             * <Block>[]xxx</Block>\r\n             *\r\n             * to\r\n             *\r\n             * <Block>[]xxx</Block>\r\n             */\r\n            if (prevPosition.fragment !== this.startFragment) {\r\n                const startFragment = this.startFragment;\r\n                this.setStart(prevPosition.fragment, prevPosition.index);\r\n                const scopes = this.getSelectedScope();\r\n                if (scopes.length === 1 &&\r\n                    this.startFragment !== this.commonAncestorFragment &&\r\n                    this.startFragment.length === 1 &&\r\n                    this.startFragment.getContentAtIndex(0) instanceof BrComponent) {\r\n                    this.deleteEmptyTree(this.startFragment);\r\n                    this.collapse(true);\r\n                    return;\r\n                }\r\n                this.setStart(startFragment, 0);\r\n            }\r\n            /**\r\n             * empty[]<br>\r\n             *\r\n             * to\r\n             *\r\n             * empty[]\r\n             */\r\n            if (prevPosition.fragment === this.startFragment && currentContent instanceof BrComponent) {\r\n                this.endIndex++;\r\n                this.deleteRange();\r\n                this.collapse();\r\n                return;\r\n            }\r\n        }\r\n        else {\r\n            /**\r\n             * <Block>xxx</Block>\r\n             * []<br>\r\n             * <Block>xxx</Block>\r\n             *\r\n             * to\r\n             *\r\n             * <Block>xxx[]<Block>\r\n             * <Block>xxx</Block>\r\n             */\r\n            const currentContent = this.startFragment.getContentAtIndex(this.startIndex);\r\n            const prevContent = this.startFragment.getContentAtIndex(this.startIndex - 1);\r\n            if ((prevContent instanceof DivisionAbstractComponent ||\r\n                prevContent instanceof BranchAbstractComponent ||\r\n                prevContent instanceof BackboneAbstractComponent) &&\r\n                currentContent instanceof BrComponent) {\r\n                const prevPosition = this.getPreviousPosition();\r\n                this.endIndex++;\r\n                this.deleteRange();\r\n                this.setStart(prevPosition.fragment, prevPosition.index);\r\n                this.collapse();\r\n                return;\r\n            }\r\n            /**\r\n             * <Block>xxx</Block>\r\n             * []xxx\r\n             * <Block>xxx</Block>\r\n             *\r\n             * to\r\n             *\r\n             * <Block>xxx[]xxx</Block>\r\n             * <Block>xxx</Block>\r\n             */\r\n            if ((prevContent instanceof DivisionAbstractComponent ||\r\n                prevContent instanceof BranchAbstractComponent ||\r\n                prevContent instanceof BackboneAbstractComponent) && (currentContent instanceof LeafAbstractComponent && !currentContent.block ||\r\n                typeof currentContent === 'string')) {\r\n                const scope = this.getExpandedScope()[0];\r\n                const afterContents = scope.fragment.cut(scope.startIndex, scope.endIndex);\r\n                const prevPosition = this.getPreviousPosition();\r\n                prevPosition.fragment.remove(prevPosition.index);\r\n                prevPosition.fragment.concat(afterContents);\r\n                this.setPosition(prevPosition.fragment, prevPosition.index);\r\n                return;\r\n            }\r\n            /**\r\n             * <Block>xxx</Block>\r\n             * []<Leaf block=true>\r\n             * <Block>xxx</Block>\r\n             *\r\n             * to\r\n             *\r\n             * <Block>xxx[]<Leaf block=true></Block>\r\n             * <Block>xxx</Block>\r\n             */\r\n            if ((prevContent instanceof DivisionAbstractComponent ||\r\n                prevContent instanceof BranchAbstractComponent ||\r\n                prevContent instanceof BackboneAbstractComponent) && (currentContent instanceof LeafAbstractComponent && currentContent.block)) {\r\n                const afterContents = this.startFragment.cut(this.startIndex, this.startIndex + 1);\r\n                const prevPosition = this.getPreviousPosition();\r\n                prevPosition.fragment.remove(prevPosition.index);\r\n                prevPosition.fragment.concat(afterContents);\r\n                this.setPosition(prevPosition.fragment, prevPosition.index);\r\n                return;\r\n            }\r\n            /**\r\n             * <Block>xxx</Block>\r\n             * x[]xx\r\n             * <Block>xxx</Block>\r\n             *\r\n             * to\r\n             *\r\n             * <Block>xxx</Block>\r\n             * []xx\r\n             * <Block>xxx</Block>\r\n             */\r\n            if ((prevContent instanceof LeafAbstractComponent ||\r\n                typeof prevContent === 'string') && (currentContent instanceof LeafAbstractComponent ||\r\n                typeof currentContent === 'string')) {\r\n                this.startFragment.remove(this.startIndex - 1, this.startIndex);\r\n                this.startIndex--;\r\n                this.collapse();\r\n                return;\r\n            }\r\n            /**\r\n             * <Block>xxx</Block>\r\n             * <Block>x[]</Block>\r\n             *\r\n             * to\r\n             *\r\n             * <Block>xxx</Block>\r\n             * <Block>[]<br><Block>\r\n             */\r\n            if ((prevContent instanceof LeafAbstractComponent ||\r\n                typeof prevContent === 'string') && (this.startFragment.length === 1 && this.startIndex === 1)) {\r\n                this.startFragment.append(new BrComponent(), true);\r\n                this.startFragment.remove(this.startIndex - 1, this.startIndex);\r\n                this.startIndex--;\r\n                this.collapse();\r\n                return;\r\n            }\r\n            this.startIndex--;\r\n            this.deleteRange();\r\n        }\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    deleteRange() {\r\n        if (this.collapsed) {\r\n            return;\r\n        }\r\n        const recordPath = () => {\r\n            const paths = [{\r\n                    index: this.startIndex,\r\n                    data: this.startFragment\r\n                }];\r\n            let startFragment = this.startFragment;\r\n            while (true) {\r\n                const parentComponent = startFragment.parentComponent;\r\n                let index;\r\n                if (parentComponent instanceof DivisionAbstractComponent) {\r\n                    index = 0;\r\n                }\r\n                else if (parentComponent instanceof BranchAbstractComponent) {\r\n                    index = parentComponent.slots.indexOf(startFragment);\r\n                }\r\n                else if (parentComponent instanceof BackboneAbstractComponent) {\r\n                    index = parentComponent.indexOf(startFragment);\r\n                }\r\n                paths.push({\r\n                    index,\r\n                    data: parentComponent\r\n                });\r\n                startFragment = parentComponent.parentFragment;\r\n                if (startFragment) {\r\n                    paths.push({\r\n                        index: startFragment.indexOf(parentComponent),\r\n                        data: startFragment\r\n                    });\r\n                }\r\n                else {\r\n                    break;\r\n                }\r\n            }\r\n            return paths;\r\n        };\r\n        const commonAncestorFragment = this.commonAncestorFragment;\r\n        const endFragmentIsCommon = this.endFragment === commonAncestorFragment;\r\n        const selectedScopes = this.getSelectedScope();\r\n        const firstScope = selectedScopes[0];\r\n        if (this.startFragment === commonAncestorFragment &&\r\n            this.endFragment !== commonAncestorFragment &&\r\n            selectedScopes.length === 1 &&\r\n            firstScope.fragment === this.startFragment &&\r\n            firstScope.endIndex - firstScope.startIndex === 1) {\r\n            /**\r\n             * [<Inline>\r\n             * <Block>]xxxx</Block>\r\n             */\r\n            const prevContent = this.startFragment.getContentAtIndex(this.startIndex);\r\n            if (prevContent instanceof LeafAbstractComponent) {\r\n                this.deleteSelectedScope(this.getSelectedScope());\r\n                this.collapse(true);\r\n                return;\r\n            }\r\n        }\r\n        const paths = recordPath();\r\n        this.deleteSelectedScope(selectedScopes);\r\n        const findPath = () => {\r\n            while (true) {\r\n                const parentData = paths.pop();\r\n                const path = paths[paths.length - 1];\r\n                if (!path) {\r\n                    return parentData;\r\n                }\r\n                if (path.data instanceof Fragment) {\r\n                    if (!path.data.parentComponent) {\r\n                        return parentData;\r\n                    }\r\n                }\r\n                else {\r\n                    if (!path.data.parentFragment) {\r\n                        return parentData;\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        const root = paths[paths.length - 1].data;\r\n        const path = findPath();\r\n        let endFragmentInDoc = false;\r\n        let endFragment = this.endFragment;\r\n        while (endFragment) {\r\n            const parentComponent = endFragment.parentComponent;\r\n            if (!parentComponent) {\r\n                break;\r\n            }\r\n            if (parentComponent === root) {\r\n                endFragmentInDoc = true;\r\n            }\r\n            endFragment = parentComponent.parentFragment;\r\n        }\r\n        if (path.data instanceof Fragment) {\r\n            let position = {\r\n                fragment: path.data,\r\n                index: path.index\r\n            };\r\n            const content = path.data.getContentAtIndex(path.index);\r\n            if (!(content instanceof LeafAbstractComponent && !content.block)) {\r\n                const prevContent = path.data.getContentAtIndex(path.index - 1);\r\n                if (prevContent instanceof DivisionAbstractComponent) {\r\n                    position = this.findLastPosition(prevContent.slot);\r\n                }\r\n                else if (prevContent instanceof BranchAbstractComponent) {\r\n                    position = this.findLastPosition(prevContent.slots[prevContent.slots.length - 1]);\r\n                }\r\n                else if (prevContent instanceof BackboneAbstractComponent) {\r\n                    position = this.findLastPosition(prevContent.getSlotAtIndex(prevContent.slotCount - 1));\r\n                }\r\n                else if (!prevContent) {\r\n                    position = this.findFirstPosition(position.fragment);\r\n                }\r\n            }\r\n            this.setStart(position.fragment, position.index);\r\n        }\r\n        else {\r\n            const component = path.data;\r\n            let position;\r\n            if (component instanceof BranchAbstractComponent) {\r\n                position = this.findLastPosition(component.slots[Math.max(path.index - 1, 0)]);\r\n            }\r\n            else if (component instanceof BackboneAbstractComponent) {\r\n                position = this.findLastPosition(component.getSlotAtIndex(Math.max(path.index - 1, 0)));\r\n            }\r\n            this.setStart(position.fragment, position.index);\r\n        }\r\n        if (endFragmentInDoc && this.endFragment !== this.startFragment) {\r\n            if (endFragmentIsCommon) {\r\n                /**\r\n                 * source:\r\n                 * <Block>xxx[</Block>\r\n                 * ]<Inline>\r\n                 * <Block>xxx</Block>\r\n                 *\r\n                 * target:\r\n                 * <Block>xxx<Inline></Block>\r\n                 * <Block>xxx</Block>\r\n                 */\r\n                const scope = this.getCommonAncestorFragmentScope();\r\n                const afterContent = scope.endFragment.cut(scope.endIndex - 1);\r\n                let index = 0;\r\n                const contents = afterContent.sliceContents();\r\n                for (const item of contents) {\r\n                    if (item instanceof LeafAbstractComponent && item.block === false || typeof item === 'string') {\r\n                        index += item.length;\r\n                    }\r\n                    else {\r\n                        break;\r\n                    }\r\n                }\r\n                this.endFragment.concat(afterContent.cut(index));\r\n                this.startFragment.concat(afterContent);\r\n            }\r\n            else {\r\n                //  br\r\n                this.startFragment.remove(this.startIndex);\r\n                this.startFragment.concat(this.endFragment);\r\n                this.deleteEmptyTree(this.endFragment);\r\n            }\r\n        }\r\n        this.collapse();\r\n    }\r\n    /**\r\n     *  Fragment  Fragment  Component \r\n     *  Fragment  Fragment  endFragment\r\n     * @param fragment  fragment\r\n     * @param endFragment  fragment fragment\r\n     * @return  component  fragment\r\n     */\r\n    deleteEmptyTree(fragment, endFragment) {\r\n        if (fragment === endFragment) {\r\n            return fragment;\r\n        }\r\n        const parentComponent = fragment.parentComponent;\r\n        if (!parentComponent.parentFragment) {\r\n            return fragment;\r\n        }\r\n        if (parentComponent instanceof DivisionAbstractComponent) {\r\n            const parentFragment = parentComponent.parentFragment;\r\n            const index = parentFragment.indexOf(parentComponent);\r\n            parentFragment.cut(index, index + 1);\r\n            if (parentFragment.length === 0) {\r\n                return this.deleteEmptyTree(parentFragment, endFragment);\r\n            }\r\n            return parentFragment;\r\n        }\r\n        else if (parentComponent instanceof BranchAbstractComponent) {\r\n            parentComponent.slots.splice(parentComponent.slots.indexOf(fragment), 1);\r\n            if (parentComponent.slots.length === 0) {\r\n                const parentFragment = parentComponent.parentFragment;\r\n                const index = parentFragment.indexOf(parentComponent);\r\n                parentFragment.cut(index, index + 1);\r\n                if (parentFragment.length === 0) {\r\n                    return this.deleteEmptyTree(parentFragment, endFragment);\r\n                }\r\n                return parentFragment;\r\n            }\r\n            return parentComponent;\r\n        }\r\n        else if (parentComponent instanceof BackboneAbstractComponent) {\r\n            fragment.clean();\r\n            const b = parentComponent.canDelete(fragment);\r\n            if (b) {\r\n                const parentFragment = parentComponent.parentFragment;\r\n                const index = parentFragment.indexOf(parentComponent);\r\n                parentFragment.cut(index, index + 1);\r\n                if (parentFragment.length === 0) {\r\n                    return this.deleteEmptyTree(parentFragment, endFragment);\r\n                }\r\n                return parentFragment;\r\n            }\r\n            return parentComponent;\r\n        }\r\n        return fragment;\r\n    }\r\n    /**\r\n     * \r\n     * @param toEnd \r\n     */\r\n    collapse(toEnd = false) {\r\n        if (toEnd) {\r\n            this.setStart(this.endFragment, this.endIndex);\r\n        }\r\n        else {\r\n            this.setEnd(this.startFragment, this.startIndex);\r\n        }\r\n        return this;\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    getPreviousPosition() {\r\n        let fragment = this.startFragment;\r\n        if (this.startIndex > 0) {\r\n            const prev = fragment.getContentAtIndex(this.startIndex - 1);\r\n            if (prev instanceof DivisionAbstractComponent) {\r\n                return this.findLastChild(prev.slot);\r\n            }\r\n            if (prev instanceof BranchAbstractComponent) {\r\n                return this.findLastChild(prev.slots[prev.slots.length - 1]);\r\n            }\r\n            if (prev instanceof BackboneAbstractComponent) {\r\n                return this.findLastChild(prev.getSlotAtIndex(prev.slotCount - 1));\r\n            }\r\n            return {\r\n                fragment,\r\n                index: this.startIndex - 1\r\n            };\r\n        }\r\n        //  fragment\r\n        //  fragment\r\n        const cacheFragment = fragment;\r\n        while (true) {\r\n            const parentComponent = fragment.parentComponent;\r\n            if (parentComponent instanceof BranchAbstractComponent) {\r\n                const fragmentIndex = parentComponent.slots.indexOf(fragment);\r\n                if (fragmentIndex > 0) {\r\n                    return this.findLastChild(parentComponent.slots[fragmentIndex - 1]);\r\n                }\r\n            }\r\n            if (parentComponent instanceof BackboneAbstractComponent) {\r\n                const fragmentIndex = parentComponent.indexOf(fragment);\r\n                if (fragmentIndex > 0) {\r\n                    return this.findLastChild(parentComponent.getSlotAtIndex(fragmentIndex - 1));\r\n                }\r\n            }\r\n            const parentFragment = parentComponent.parentFragment;\r\n            if (!parentFragment) {\r\n                return {\r\n                    fragment: cacheFragment,\r\n                    index: 0\r\n                };\r\n            }\r\n            const componentIndex = parentFragment.indexOf(parentComponent);\r\n            if (componentIndex > 0) {\r\n                const prevContent = parentFragment.getContentAtIndex(componentIndex - 1);\r\n                if (prevContent instanceof DivisionAbstractComponent) {\r\n                    return this.findLastChild(prevContent.slot);\r\n                }\r\n                if (prevContent instanceof BranchAbstractComponent) {\r\n                    return this.findLastChild(prevContent.slots[prevContent.slots.length - 1]);\r\n                }\r\n                if (prevContent instanceof BackboneAbstractComponent) {\r\n                    return this.findLastChild(prevContent.getSlotAtIndex(prevContent.slotCount - 1));\r\n                }\r\n                return {\r\n                    fragment: parentFragment,\r\n                    index: prevContent instanceof BrComponent ? componentIndex - 1 : componentIndex\r\n                };\r\n            }\r\n            else {\r\n                fragment = parentFragment;\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    getNextPosition() {\r\n        let fragment = this.endFragment;\r\n        let offset = this.endIndex;\r\n        if (offset === fragment.length - 1) {\r\n            const current = fragment.getContentAtIndex(offset);\r\n            if (current instanceof BrComponent) {\r\n                offset++;\r\n            }\r\n        }\r\n        if (offset < fragment.length) {\r\n            let current = fragment.getContentAtIndex(offset);\r\n            if (current instanceof BrComponent) {\r\n                current = fragment.getContentAtIndex(offset + 1);\r\n            }\r\n            if (current instanceof DivisionAbstractComponent) {\r\n                return this.findFirstPosition(current.slot);\r\n            }\r\n            if (current instanceof BranchAbstractComponent) {\r\n                return this.findFirstPosition(current.slots[0]);\r\n            }\r\n            if (current instanceof BackboneAbstractComponent) {\r\n                return this.findFirstPosition(current.getSlotAtIndex(0));\r\n            }\r\n            return {\r\n                fragment,\r\n                index: offset + 1\r\n            };\r\n        }\r\n        //  fragment\r\n        //  fragment\r\n        const cacheFragment = fragment;\r\n        while (true) {\r\n            const parentComponent = fragment.parentComponent;\r\n            if (!parentComponent) {\r\n                const len = cacheFragment.length;\r\n                const last = cacheFragment.getContentAtIndex(len - 1);\r\n                return {\r\n                    fragment: cacheFragment,\r\n                    index: last instanceof BrComponent ? len - 1 : len\r\n                };\r\n            }\r\n            if (parentComponent instanceof BranchAbstractComponent) {\r\n                const fragmentIndex = parentComponent.slots.indexOf(fragment);\r\n                if (fragmentIndex < parentComponent.slots.length - 1) {\r\n                    return this.findFirstPosition(parentComponent.slots[fragmentIndex + 1]);\r\n                }\r\n            }\r\n            if (parentComponent instanceof BackboneAbstractComponent) {\r\n                const fragmentIndex = parentComponent.indexOf(fragment);\r\n                if (fragmentIndex < parentComponent.slotCount - 1) {\r\n                    return this.findFirstPosition(parentComponent.getSlotAtIndex(fragmentIndex + 1));\r\n                }\r\n            }\r\n            const parentFragment = parentComponent.parentFragment;\r\n            if (!parentFragment) {\r\n                const len = cacheFragment.length;\r\n                const last = cacheFragment.getContentAtIndex(len - 1);\r\n                return {\r\n                    fragment: cacheFragment,\r\n                    index: last instanceof BrComponent ? len - 1 : len\r\n                };\r\n            }\r\n            const componentIndex = parentFragment.indexOf(parentComponent);\r\n            if (componentIndex < parentFragment.length - 1) {\r\n                const nextContent = parentFragment.getContentAtIndex(componentIndex + 1);\r\n                if (nextContent instanceof DivisionAbstractComponent) {\r\n                    return this.findFirstPosition(nextContent.slot);\r\n                }\r\n                if (nextContent instanceof BranchAbstractComponent) {\r\n                    return this.findFirstPosition(nextContent.slots[0]);\r\n                }\r\n                if (nextContent instanceof BackboneAbstractComponent) {\r\n                    return this.findFirstPosition(nextContent.getSlotAtIndex(0));\r\n                }\r\n                return {\r\n                    fragment: parentFragment,\r\n                    index: componentIndex + 1\r\n                };\r\n            }\r\n            else {\r\n                fragment = parentFragment;\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * \r\n     * @param startLeft \r\n     */\r\n    getPreviousLinePosition(startLeft) {\r\n        const range2 = this.clone();\r\n        let isToPrevLine = false;\r\n        let loopCount = 0;\r\n        let minLeft = startLeft;\r\n        let minTop = this.getRangePosition().top;\r\n        let position;\r\n        let oldPosition;\r\n        let oldLeft = 0;\r\n        while (true) {\r\n            loopCount++;\r\n            position = range2.getPreviousPosition();\r\n            range2.setPosition(position.fragment, position.index);\r\n            range2.restore();\r\n            const rect2 = range2.getRangePosition();\r\n            if (!isToPrevLine) {\r\n                if (rect2.left > minLeft || rect2.top < minTop) {\r\n                    isToPrevLine = true;\r\n                }\r\n                else if (rect2.left === minLeft && rect2.top === minTop) {\r\n                    return position;\r\n                }\r\n                minLeft = rect2.left;\r\n                minTop = rect2.top;\r\n            }\r\n            if (isToPrevLine) {\r\n                if (rect2.left < startLeft) {\r\n                    return position;\r\n                }\r\n                if (oldPosition) {\r\n                    if (rect2.left >= oldLeft) {\r\n                        return oldPosition;\r\n                    }\r\n                }\r\n                oldLeft = rect2.left;\r\n                oldPosition = position;\r\n            }\r\n            if (loopCount > 10000) {\r\n                break;\r\n            }\r\n        }\r\n        return position || {\r\n            index: 0,\r\n            fragment: this.startFragment\r\n        };\r\n    }\r\n    /**\r\n     * \r\n     * @param startLeft \r\n     */\r\n    getNextLinePosition(startLeft) {\r\n        const range2 = this.clone();\r\n        let isToNextLine = false;\r\n        let loopCount = 0;\r\n        let maxRight = startLeft;\r\n        let minTop = this.getRangePosition().top;\r\n        let oldPosition;\r\n        let oldLeft = 0;\r\n        while (true) {\r\n            loopCount++;\r\n            const position = range2.getNextPosition();\r\n            range2.setPosition(position.fragment, position.index);\r\n            range2.restore();\r\n            const rect2 = range2.getRangePosition();\r\n            if (!isToNextLine) {\r\n                if (rect2.left < maxRight || rect2.top > minTop) {\r\n                    isToNextLine = true;\r\n                }\r\n                else if (rect2.left === maxRight && rect2.top === minTop) {\r\n                    return position;\r\n                }\r\n                maxRight = rect2.left;\r\n                minTop = rect2.top;\r\n                oldPosition = position;\r\n            }\r\n            if (isToNextLine) {\r\n                if (rect2.left > startLeft) {\r\n                    return oldPosition;\r\n                }\r\n                if (oldPosition) {\r\n                    if (rect2.left <= oldLeft) {\r\n                        return oldPosition;\r\n                    }\r\n                }\r\n                oldPosition = position;\r\n                oldLeft = rect2.left;\r\n            }\r\n            if (loopCount > 10000) {\r\n                break;\r\n            }\r\n        }\r\n        return oldPosition || {\r\n            index: this.endFragment.length,\r\n            fragment: this.endFragment\r\n        };\r\n    }\r\n    /**\r\n     *  fragment \r\n     * @param fragment\r\n     */\r\n    findFirstPosition(fragment) {\r\n        const first = fragment.getContentAtIndex(0);\r\n        if (first instanceof DivisionAbstractComponent) {\r\n            return this.findFirstPosition(first.slot);\r\n        }\r\n        if (first instanceof BranchAbstractComponent) {\r\n            const firstFragment = first.slots[0];\r\n            return this.findFirstPosition(firstFragment);\r\n        }\r\n        if (first instanceof BackboneAbstractComponent) {\r\n            const firstFragment = first.getSlotAtIndex(0);\r\n            return this.findFirstPosition(firstFragment);\r\n        }\r\n        return {\r\n            index: 0,\r\n            fragment\r\n        };\r\n    }\r\n    /**\r\n     *  fragment \r\n     * @param fragment\r\n     */\r\n    findLastPosition(fragment) {\r\n        const last = fragment.getContentAtIndex(fragment.length - 1);\r\n        if (last instanceof DivisionAbstractComponent) {\r\n            return this.findLastPosition(last.slot);\r\n        }\r\n        if (last instanceof BranchAbstractComponent) {\r\n            const firstFragment = last.slots[last.slots.length - 1];\r\n            return this.findLastPosition(firstFragment);\r\n        }\r\n        if (last instanceof BackboneAbstractComponent) {\r\n            const firstFragment = last.getSlotAtIndex(last.slotCount - 1);\r\n            return this.findLastPosition(firstFragment);\r\n        }\r\n        if (last instanceof BrComponent) {\r\n            return {\r\n                index: fragment.length - 1,\r\n                fragment\r\n            };\r\n        }\r\n        return {\r\n            index: fragment.length,\r\n            fragment\r\n        };\r\n    }\r\n    /**\r\n     *  fragment \r\n     * @param fragment\r\n     */\r\n    findLastChild(fragment) {\r\n        const last = fragment.getContentAtIndex(fragment.length - 1);\r\n        if (last instanceof DivisionAbstractComponent) {\r\n            return this.findLastChild(last.slot);\r\n        }\r\n        if (last instanceof BranchAbstractComponent) {\r\n            const lastFragment = last.slots[last.slots.length - 1];\r\n            return this.findLastChild(lastFragment);\r\n        }\r\n        if (last instanceof BackboneAbstractComponent) {\r\n            const lastFragment = last.getSlotAtIndex(last.slotCount - 1);\r\n            return this.findLastChild(lastFragment);\r\n        }\r\n        return {\r\n            index: last instanceof BrComponent ?\r\n                fragment.length - 1 :\r\n                fragment.length,\r\n            fragment\r\n        };\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    getRangePosition() {\r\n        const range = this.nativeRange;\r\n        const { startContainer, startOffset } = range;\r\n        if (startContainer.nodeType === Node.ELEMENT_NODE) {\r\n            const offsetNode = startContainer.childNodes[startOffset];\r\n            let isInsertBefore = false;\r\n            if (offsetNode) {\r\n                if (offsetNode.nodeType === Node.ELEMENT_NODE) {\r\n                    return offsetNode.getBoundingClientRect();\r\n                }\r\n                else {\r\n                    isInsertBefore = true;\r\n                }\r\n            }\r\n            const span = startContainer.ownerDocument.createElement('span');\r\n            span.innerText = '\\u200b';\r\n            span.style.display = 'inline-block';\r\n            if (isInsertBefore) {\r\n                startContainer.insertBefore(span, offsetNode);\r\n            }\r\n            else {\r\n                startContainer.appendChild(span);\r\n            }\r\n            const rect = span.getBoundingClientRect();\r\n            startContainer.removeChild(span);\r\n            return rect;\r\n        }\r\n        return range.getBoundingClientRect();\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    deleteSelectedScope(scopes) {\r\n        scopes.reverse().forEach(scope => {\r\n            if (scope.startIndex === 0 && scope.endIndex === scope.fragment.length) {\r\n                const parentComponent = scope.fragment.parentComponent;\r\n                scope.fragment.remove(0);\r\n                if (parentComponent instanceof BackboneAbstractComponent) {\r\n                    if (parentComponent.canDelete(scope.fragment)) {\r\n                        const parentFragment = parentComponent.parentFragment;\r\n                        const index = parentFragment.indexOf(parentComponent);\r\n                        parentFragment.remove(index, index + 1);\r\n                        if (parentFragment.length === 0) {\r\n                            this.deleteEmptyTree(parentFragment);\r\n                        }\r\n                    }\r\n                }\r\n                else if (scope.fragment !== this.startFragment && scope.fragment !== this.endFragment) {\r\n                    this.deleteEmptyTree(scope.fragment);\r\n                }\r\n            }\r\n            else {\r\n                scope.fragment.cut(scope.startIndex, scope.endIndex);\r\n            }\r\n        });\r\n        return this;\r\n    }\r\n    getScopes(startFragment, endFragment, startIndex, endIndex) {\r\n        const start = [];\r\n        const end = [];\r\n        let startParentComponent = null;\r\n        let endParentComponent = null;\r\n        let startFragmentPosition = null;\r\n        let endFragmentPosition = null;\r\n        const commonAncestorComponent = this.commonAncestorComponent;\r\n        while (startFragment !== this.commonAncestorFragment) {\r\n            if (commonAncestorComponent && startParentComponent === this.commonAncestorComponent) {\r\n                return;\r\n            }\r\n            start.push({\r\n                startIndex,\r\n                endIndex: startFragment.length,\r\n                fragment: startFragment\r\n            });\r\n            startParentComponent = startFragment.parentComponent;\r\n            if (startParentComponent instanceof BranchAbstractComponent || startParentComponent instanceof BackboneAbstractComponent) {\r\n                const childSlots = startParentComponent instanceof BranchAbstractComponent ?\r\n                    startParentComponent.slots :\r\n                    Array.from(startParentComponent);\r\n                const end = childSlots.indexOf(this.endFragment);\r\n                startFragmentPosition = childSlots.indexOf(startFragment);\r\n                if (startParentComponent !== this.commonAncestorComponent && end === -1) {\r\n                    start.push(...childSlots.slice(startFragmentPosition + 1, childSlots.length).map(fragment => {\r\n                        return {\r\n                            startIndex: 0,\r\n                            endIndex: fragment.length,\r\n                            fragment\r\n                        };\r\n                    }));\r\n                }\r\n            }\r\n            startFragment = startParentComponent.parentFragment;\r\n            startIndex = startFragment.indexOf(startParentComponent) + 1;\r\n        }\r\n        while (endFragment !== this.commonAncestorFragment) {\r\n            if (commonAncestorComponent && endParentComponent === this.commonAncestorComponent) {\r\n                return;\r\n            }\r\n            endParentComponent = endFragment.parentComponent;\r\n            if (endParentComponent instanceof BranchAbstractComponent || endParentComponent instanceof BackboneAbstractComponent) {\r\n                const childSlots = endParentComponent instanceof BranchAbstractComponent ?\r\n                    endParentComponent.slots :\r\n                    Array.from(endParentComponent);\r\n                const index = childSlots.indexOf(this.startFragment);\r\n                endFragmentPosition = childSlots.indexOf(endFragment);\r\n                if (endParentComponent !== this.commonAncestorComponent && index === -1) {\r\n                    end.push(...childSlots.slice(0, endFragmentPosition).map(fragment => {\r\n                        return {\r\n                            startIndex: 0,\r\n                            endIndex: fragment.length,\r\n                            fragment\r\n                        };\r\n                    }));\r\n                }\r\n            }\r\n            end.push({\r\n                startIndex: 0,\r\n                endIndex,\r\n                fragment: endFragment\r\n            });\r\n            endFragment = endParentComponent.parentFragment;\r\n            endIndex = endFragment.indexOf(endParentComponent);\r\n        }\r\n        const result = [...start];\r\n        if (startParentComponent === endParentComponent &&\r\n            (startParentComponent instanceof BranchAbstractComponent || startParentComponent instanceof BackboneAbstractComponent)) {\r\n            const slots = (startParentComponent instanceof BranchAbstractComponent ?\r\n                startParentComponent.slots :\r\n                Array.from(startParentComponent)).slice(startFragmentPosition + 1, endFragmentPosition);\r\n            result.push(...slots.map(f => {\r\n                return {\r\n                    startIndex: 0,\r\n                    endIndex: f.length,\r\n                    fragment: f\r\n                };\r\n            }));\r\n        }\r\n        else {\r\n            result.push({\r\n                startIndex,\r\n                endIndex,\r\n                fragment: this.commonAncestorFragment\r\n            });\r\n        }\r\n        // result.push(...end.reverse()); // \r\n        result.push(...end);\r\n        return result.filter(item => {\r\n            return item.startIndex < item.endIndex;\r\n        });\r\n    }\r\n    getCommonAncestorFragment() {\r\n        let startFragment = this.startFragment;\r\n        let endFragment = this.endFragment;\r\n        if (startFragment === endFragment) {\r\n            return startFragment;\r\n        }\r\n        const startPaths = [];\r\n        const endPaths = [];\r\n        while (startFragment) {\r\n            startPaths.push(startFragment);\r\n            const parentComponent = startFragment.parentComponent;\r\n            if (!parentComponent.parentFragment) {\r\n                break;\r\n            }\r\n            startFragment = parentComponent.parentFragment;\r\n        }\r\n        while (endFragment) {\r\n            endPaths.push(endFragment);\r\n            const parentComponent = endFragment.parentComponent;\r\n            if (!parentComponent.parentFragment) {\r\n                break;\r\n            }\r\n            endFragment = parentComponent.parentFragment;\r\n        }\r\n        let f = null;\r\n        while (startPaths.length && endPaths.length) {\r\n            const s = startPaths.pop();\r\n            const e = endPaths.pop();\r\n            if (s === e) {\r\n                f = s;\r\n            }\r\n            else {\r\n                break;\r\n            }\r\n        }\r\n        return f;\r\n    }\r\n    getCommonAncestorComponent() {\r\n        var _a, _b;\r\n        let startComponent = (_a = this.startFragment) === null || _a === void 0 ? void 0 : _a.parentComponent;\r\n        let endComponent = (_b = this.endFragment) === null || _b === void 0 ? void 0 : _b.parentComponent;\r\n        if (startComponent === endComponent) {\r\n            return startComponent;\r\n        }\r\n        const startPaths = [];\r\n        const endPaths = [];\r\n        while (startComponent) {\r\n            startPaths.push(startComponent);\r\n            const parentFragment = startComponent.parentFragment;\r\n            if (!parentFragment) {\r\n                break;\r\n            }\r\n            startComponent = parentFragment.parentComponent;\r\n        }\r\n        while (endComponent) {\r\n            endPaths.push(endComponent);\r\n            const parentFragment = endComponent.parentFragment;\r\n            if (!parentFragment) {\r\n                break;\r\n            }\r\n            endComponent = parentFragment.parentComponent;\r\n        }\r\n        let f = null;\r\n        while (startPaths.length && endPaths.length) {\r\n            const s = startPaths.pop();\r\n            const e = endPaths.pop();\r\n            if (s === e) {\r\n                f = s;\r\n            }\r\n            else {\r\n                break;\r\n            }\r\n        }\r\n        return f;\r\n    }\r\n    findFocusNodeAndOffset(fragment, offset) {\r\n        function findFocusNativeTextNode(renderer, vElement, offset, toLeft) {\r\n            for (const item of vElement.childNodes) {\r\n                const position = renderer.getPositionByVDom(item);\r\n                if (toLeft ? position.endIndex < offset : position.endIndex <= offset) {\r\n                    continue;\r\n                }\r\n                if (item instanceof VTextNode) {\r\n                    return {\r\n                        node: renderer.getNativeNodeByVDom(item),\r\n                        offset: offset - position.startIndex\r\n                    };\r\n                }\r\n                return findFocusNativeTextNode(renderer, item, offset, toLeft);\r\n            }\r\n        }\r\n        function findComponentNativeNode(renderer, vElement, offset) {\r\n            for (const item of vElement.childNodes) {\r\n                const position = renderer.getPositionByVDom(item);\r\n                if (position.endIndex <= offset) {\r\n                    continue;\r\n                }\r\n                if (item instanceof VElement) {\r\n                    if (position.startIndex === offset && position.endIndex === offset + 1) {\r\n                        const node = renderer.getNativeNodeByVDom(item);\r\n                        const parent = node.parentNode;\r\n                        return {\r\n                            node: parent,\r\n                            offset: Array.from(parent.childNodes).indexOf(node)\r\n                        };\r\n                    }\r\n                    return findComponentNativeNode(renderer, item, offset);\r\n                }\r\n            }\r\n        }\r\n        const vElement = this.renderer.getVElementByFragment(fragment);\r\n        const current = fragment.getContentAtIndex(offset);\r\n        if (typeof current === 'string') {\r\n            const prev = fragment.getContentAtIndex(offset - 1);\r\n            return findFocusNativeTextNode(this.renderer, vElement, offset, typeof prev === 'string');\r\n        }\r\n        else if (current instanceof AbstractComponent) {\r\n            const prev = fragment.getContentAtIndex(offset - 1);\r\n            if (typeof prev === 'string') {\r\n                return findFocusNativeTextNode(this.renderer, vElement, offset, true);\r\n            }\r\n            else if (prev instanceof LeafAbstractComponent && !(prev instanceof BrComponent)) {\r\n                const nativeNode = this.renderer.getComponentRootNativeNode(prev);\r\n                return {\r\n                    node: nativeNode.parentNode,\r\n                    offset: Array.from(nativeNode.parentNode.childNodes).indexOf(nativeNode) + 1\r\n                };\r\n            }\r\n            return findComponentNativeNode(this.renderer, vElement, offset);\r\n        }\r\n        const container = this.renderer.getNativeNodeByVDom(vElement);\r\n        const lastChild = container.lastChild;\r\n        if (lastChild.nodeType === Node.TEXT_NODE) {\r\n            return {\r\n                node: lastChild,\r\n                offset: lastChild.textContent.length\r\n            };\r\n        }\r\n        return {\r\n            node: container,\r\n            offset: container.childNodes.length\r\n        };\r\n    }\r\n    static findExpandedStartIndex(fragment, index) {\r\n        const contents = fragment.sliceContents(0, index);\r\n        const len = contents.length;\r\n        for (let i = len - 1; i >= 0; i--) {\r\n            const item = contents[i];\r\n            if (item instanceof DivisionAbstractComponent ||\r\n                item instanceof BranchAbstractComponent ||\r\n                item instanceof BackboneAbstractComponent ||\r\n                item instanceof LeafAbstractComponent && item.block) {\r\n                break;\r\n            }\r\n            index -= item.length;\r\n        }\r\n        return index;\r\n    }\r\n    static findExpandedEndIndex(fragment, index) {\r\n        const contents = fragment.sliceContents(index);\r\n        for (let i = 0; i < contents.length; i++) {\r\n            const item = contents[i];\r\n            if (item instanceof DivisionAbstractComponent ||\r\n                item instanceof BranchAbstractComponent ||\r\n                item instanceof BackboneAbstractComponent ||\r\n                item instanceof LeafAbstractComponent && item.block) {\r\n                break;\r\n            }\r\n            index += item.length;\r\n        }\r\n        return index;\r\n    }\r\n    static findPosition(container, offset, position, renderer) {\r\n        if (container.nodeType === Node.TEXT_NODE) {\r\n            return {\r\n                fragment: position.fragment,\r\n                index: position.startIndex + offset\r\n            };\r\n        }\r\n        else if (container.nodeType === Node.ELEMENT_NODE) {\r\n            const childNodes = container.childNodes;\r\n            if (childNodes.length === 0) {\r\n                return null;\r\n            }\r\n            if (childNodes.length === offset) {\r\n                const child = childNodes[childNodes.length - 1];\r\n                const childPosition = renderer.getPositionByNode(child);\r\n                if (!childPosition) {\r\n                    return null;\r\n                }\r\n                return {\r\n                    fragment: childPosition.fragment,\r\n                    index: childPosition.endIndex\r\n                };\r\n            }\r\n            else {\r\n                const child = childNodes[offset];\r\n                const childPosition = renderer.getPositionByNode(child);\r\n                if (!childPosition) {\r\n                    return null;\r\n                }\r\n                return {\r\n                    fragment: childPosition.fragment,\r\n                    index: childPosition.startIndex\r\n                };\r\n            }\r\n        }\r\n    }\r\n}\r\n//# sourceMappingURL=range.js.map","import { of, Subject, merge } from 'rxjs';\r\nimport { tap } from 'rxjs/operators';\r\nimport { TBRange } from './range';\r\nvar CursorMoveDirection;\r\n(function (CursorMoveDirection) {\r\n    CursorMoveDirection[CursorMoveDirection[\"Left\"] = 0] = \"Left\";\r\n    CursorMoveDirection[CursorMoveDirection[\"Right\"] = 1] = \"Right\";\r\n    CursorMoveDirection[CursorMoveDirection[\"Up\"] = 2] = \"Up\";\r\n    CursorMoveDirection[CursorMoveDirection[\"Down\"] = 3] = \"Down\";\r\n})(CursorMoveDirection || (CursorMoveDirection = {}));\r\n/**\r\n * TextBus \r\n */\r\nexport class TBSelection {\r\n    constructor(context, selectionChange, renderer) {\r\n        this.context = context;\r\n        this.selectionChange = selectionChange;\r\n        this.renderer = renderer;\r\n        this._ranges = [];\r\n        this.selectionChangeEvent = new Subject();\r\n        this.isChanged = false;\r\n        this.oldCursorPosition = null;\r\n        this.nativeSelection = context.getSelection();\r\n        this.onChange = merge(selectionChange, this.selectionChangeEvent.asObservable()).pipe(tap(() => {\r\n            this.isChanged = true;\r\n            this._ranges = [];\r\n            for (let i = 0; i < this.nativeSelection.rangeCount; i++) {\r\n                const nativeRange = this.nativeSelection.getRangeAt(i);\r\n                const startFocusNode = this.findFocusNode(nativeRange.startContainer);\r\n                const endFocusNode = this.findFocusNode(nativeRange.endContainer);\r\n                if (!startFocusNode || !endFocusNode || !startFocusNode.parentNode || !endFocusNode.parentNode) {\r\n                    continue;\r\n                }\r\n                if (startFocusNode !== nativeRange.startContainer) {\r\n                    const startNextSibling = startFocusNode.nextSibling;\r\n                    if (startNextSibling && startNextSibling.nodeType === Node.TEXT_NODE) {\r\n                        nativeRange.setStart(startNextSibling, 0);\r\n                    }\r\n                    else {\r\n                        nativeRange.setStart(startFocusNode.parentNode, Array.from(startFocusNode.parentNode.childNodes).indexOf(startFocusNode) + 1);\r\n                    }\r\n                }\r\n                if (endFocusNode !== nativeRange.endContainer) {\r\n                    const endNextSibling = endFocusNode.nextSibling;\r\n                    if (endNextSibling && endNextSibling.nodeType === Node.TEXT_NODE) {\r\n                        nativeRange.setEnd(endNextSibling, 0);\r\n                    }\r\n                    else {\r\n                        nativeRange.setEnd(endFocusNode.parentNode, Array.from(endFocusNode.parentNode.childNodes).indexOf(endFocusNode) + 1);\r\n                    }\r\n                }\r\n                this._ranges.push(new TBRange(nativeRange.cloneRange(), this.renderer));\r\n            }\r\n        }));\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    get rangeCount() {\r\n        return this._ranges.length;\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    get ranges() {\r\n        return this._ranges;\r\n    }\r\n    /**\r\n     *  fragment\r\n     */\r\n    get commonAncestorFragment() {\r\n        return this.getCommonFragment();\r\n    }\r\n    get commonAncestorComponent() {\r\n        return this.getCommonComponent();\r\n    }\r\n    /**\r\n     *  Selection  Range\r\n     */\r\n    get firstRange() {\r\n        return this.ranges[0] || null;\r\n    }\r\n    /**\r\n     *  Selection  Range\r\n     */\r\n    get lastRange() {\r\n        return this.ranges[this.ranges.length - 1] || null;\r\n    }\r\n    /**\r\n     *  Selection \r\n     */\r\n    get collapsed() {\r\n        return this.ranges.length === 1 && this.firstRange.collapsed || this.ranges.length === 0;\r\n    }\r\n    /**\r\n     *  TBRange \r\n     */\r\n    restore() {\r\n        var _a, _b;\r\n        this.isChanged = false;\r\n        this._ranges.forEach(range => {\r\n            if (range.commonAncestorComponent) {\r\n                range.restore();\r\n            }\r\n        });\r\n        const startNativeRange = (_a = this.firstRange) === null || _a === void 0 ? void 0 : _a.nativeRange;\r\n        const endNativeRange = (_b = this.lastRange) === null || _b === void 0 ? void 0 : _b.nativeRange;\r\n        if (startNativeRange && endNativeRange) {\r\n            let nativeRange;\r\n            if (this.nativeSelection.rangeCount) {\r\n                nativeRange = this.nativeSelection.getRangeAt(0);\r\n            }\r\n            else {\r\n                nativeRange = this.context.createRange();\r\n                this.nativeSelection.addRange(nativeRange);\r\n            }\r\n            nativeRange.setStart(startNativeRange.startContainer, startNativeRange.startOffset);\r\n            nativeRange.setEnd(endNativeRange.endContainer, endNativeRange.endOffset);\r\n        }\r\n        if (!this.isChanged) {\r\n            this.selectionChangeEvent.next();\r\n        }\r\n    }\r\n    toPrevious() {\r\n        this.moveCursor(CursorMoveDirection.Left);\r\n    }\r\n    toNext() {\r\n        this.moveCursor(CursorMoveDirection.Right);\r\n    }\r\n    toPreviousLine() {\r\n        this.moveCursor(CursorMoveDirection.Up);\r\n    }\r\n    toNextLine() {\r\n        this.moveCursor(CursorMoveDirection.Down);\r\n    }\r\n    /**\r\n     *  Range\r\n     * @param syncNative\r\n     */\r\n    removeAllRanges(syncNative = false) {\r\n        if (syncNative) {\r\n            this.nativeSelection.removeAllRanges();\r\n        }\r\n        this._ranges = [];\r\n    }\r\n    /**\r\n     *  Range\r\n     * @param range\r\n     */\r\n    addRange(range) {\r\n        this._ranges.push(range);\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    createRange() {\r\n        return new TBRange(this.context.createRange(), this.renderer);\r\n    }\r\n    /**\r\n     *  Selection \r\n     */\r\n    clone() {\r\n        const t = new TBSelection(this.context, of(), this.renderer);\r\n        t._ranges = this.ranges.map(r => r.clone());\r\n        return t;\r\n    }\r\n    selectAll() {\r\n        this.nativeSelection.selectAllChildren(this.context.body);\r\n    }\r\n    getCommonComponent() {\r\n        const ranges = this.ranges || [];\r\n        if (ranges.length === 1) {\r\n            return ranges[0].commonAncestorComponent;\r\n        }\r\n        const depth = [];\r\n        ranges.map(range => range.commonAncestorComponent).forEach(component => {\r\n            var _a;\r\n            const tree = [];\r\n            while (component) {\r\n                tree.push(component);\r\n                component = (_a = component.parentFragment) === null || _a === void 0 ? void 0 : _a.parentComponent;\r\n            }\r\n            depth.push(tree);\r\n        });\r\n        let component = null;\r\n        while (true) {\r\n            const firstComponents = depth.map(arr => arr.pop()).filter(i => i);\r\n            if (firstComponents.length === depth.length) {\r\n                if (new Set(firstComponents).size === 1) {\r\n                    component = firstComponents[0];\r\n                }\r\n                else {\r\n                    break;\r\n                }\r\n            }\r\n            else {\r\n                break;\r\n            }\r\n        }\r\n        return component;\r\n    }\r\n    getCommonFragment() {\r\n        const ranges = this.ranges || [];\r\n        if (ranges.length === 1) {\r\n            return ranges[0].commonAncestorFragment;\r\n        }\r\n        const depth = [];\r\n        ranges.map(range => range.commonAncestorFragment).forEach(fragment => {\r\n            var _a;\r\n            const tree = [];\r\n            while (fragment) {\r\n                tree.push(fragment);\r\n                fragment = (_a = fragment.parentComponent) === null || _a === void 0 ? void 0 : _a.parentFragment;\r\n            }\r\n            depth.push(tree);\r\n        });\r\n        let fragment = null;\r\n        while (true) {\r\n            const firstFragments = depth.map(arr => arr.pop()).filter(i => i);\r\n            if (firstFragments.length === depth.length) {\r\n                if (new Set(firstFragments).size === 1) {\r\n                    fragment = firstFragments[0];\r\n                }\r\n                else {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        return fragment;\r\n    }\r\n    findFocusNode(node) {\r\n        const position = this.renderer.getPositionByNode(node);\r\n        if (!position) {\r\n            const parentNode = node.parentNode;\r\n            if (parentNode) {\r\n                return this.findFocusNode(parentNode);\r\n            }\r\n            return null;\r\n        }\r\n        return node;\r\n    }\r\n    moveCursor(direction) {\r\n        const range = direction === CursorMoveDirection.Down ? this.lastRange : this.firstRange;\r\n        if (!range) {\r\n            return;\r\n        }\r\n        this.removeAllRanges();\r\n        this.addRange(range);\r\n        let p;\r\n        let range2;\r\n        switch (direction) {\r\n            case CursorMoveDirection.Left:\r\n                p = range.getPreviousPosition();\r\n                break;\r\n            case CursorMoveDirection.Right:\r\n                p = range.getNextPosition();\r\n                break;\r\n            case CursorMoveDirection.Up:\r\n                clearTimeout(this.cleanOldCursorTimer);\r\n                range2 = range.clone().restore();\r\n                if (this.oldCursorPosition) {\r\n                    p = range2.getPreviousLinePosition(this.oldCursorPosition.left);\r\n                }\r\n                else {\r\n                    const rect = range2.getRangePosition();\r\n                    this.oldCursorPosition = rect;\r\n                    p = range.getPreviousLinePosition(rect.left);\r\n                }\r\n                this.cleanOldCursorTimer = setTimeout(() => {\r\n                    this.oldCursorPosition = null;\r\n                }, 3000);\r\n                break;\r\n            case CursorMoveDirection.Down:\r\n                clearTimeout(this.cleanOldCursorTimer);\r\n                range2 = range.clone().restore();\r\n                if (this.oldCursorPosition) {\r\n                    p = range2.getNextLinePosition(this.oldCursorPosition.left);\r\n                }\r\n                else {\r\n                    const rect = range2.getRangePosition();\r\n                    this.oldCursorPosition = rect;\r\n                    p = range.getNextLinePosition(rect.left);\r\n                }\r\n                this.cleanOldCursorTimer = setTimeout(() => {\r\n                    this.oldCursorPosition = null;\r\n                }, 3000);\r\n                break;\r\n        }\r\n        range.setPosition(p.fragment, p.index);\r\n        this.restore();\r\n    }\r\n}\r\n//# sourceMappingURL=selection.js.map","/** PURE_IMPORTS_START tslib,_Subscriber,_scheduler_async PURE_IMPORTS_END */\nimport * as tslib_1 from \"tslib\";\nimport { Subscriber } from '../Subscriber';\nimport { async } from '../scheduler/async';\nexport function sampleTime(period, scheduler) {\n    if (scheduler === void 0) {\n        scheduler = async;\n    }\n    return function (source) { return source.lift(new SampleTimeOperator(period, scheduler)); };\n}\nvar SampleTimeOperator = /*@__PURE__*/ (function () {\n    function SampleTimeOperator(period, scheduler) {\n        this.period = period;\n        this.scheduler = scheduler;\n    }\n    SampleTimeOperator.prototype.call = function (subscriber, source) {\n        return source.subscribe(new SampleTimeSubscriber(subscriber, this.period, this.scheduler));\n    };\n    return SampleTimeOperator;\n}());\nvar SampleTimeSubscriber = /*@__PURE__*/ (function (_super) {\n    tslib_1.__extends(SampleTimeSubscriber, _super);\n    function SampleTimeSubscriber(destination, period, scheduler) {\n        var _this = _super.call(this, destination) || this;\n        _this.period = period;\n        _this.scheduler = scheduler;\n        _this.hasValue = false;\n        _this.add(scheduler.schedule(dispatchNotification, period, { subscriber: _this, period: period }));\n        return _this;\n    }\n    SampleTimeSubscriber.prototype._next = function (value) {\n        this.lastValue = value;\n        this.hasValue = true;\n    };\n    SampleTimeSubscriber.prototype.notifyNext = function () {\n        if (this.hasValue) {\n            this.hasValue = false;\n            this.destination.next(this.lastValue);\n        }\n    };\n    return SampleTimeSubscriber;\n}(Subscriber));\nfunction dispatchNotification(state) {\n    var subscriber = state.subscriber, period = state.period;\n    subscriber.notifyNext();\n    this.schedule(state, period);\n}\n//# sourceMappingURL=sampleTime.js.map\n"],"sourceRoot":""}