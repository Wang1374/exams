(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-21e49f0c"],{"083d":function(t,e,n){"use strict";n.d(e,"a",(function(){return f}));var s,r=n("25dd"),i=n("fe69"),o=n("2386"),a=n("20d3"),c=function(t,e,n,s){var r,i=arguments.length,o=i<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,n):s;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(t,e,n,s);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(i<3?r(o):i>3?r(e,n,o):r(e,n))||o);return i>3&&o&&Object.defineProperty(e,n,o),o},h=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},u=function(t,e){return function(n,s){e(n,s,t)}};let d=class{constructor(t,e,n,s){this.selection=t,this.input=e,this.editorController=s,this.contentSnapshot=[],this.formatterSnapshot=new Map,this.rootComponent=n}onInputReady(){this.recordSnapshotFromEditingBefore()}onInput(){const t=this.selection,e=this.selectionSnapshot.firstRange.startIndex,n=new i["m"],s=this.contentSnapshot;s.forEach(t=>n.append(t)),this.mergeFormats(n);const r=this.input;let o=0;r.value.replace(/\n+|[^\n]+/g,t=>{if(/\n+/.test(t))for(let s=0;s<t.length;s++){const t=new i["d"];n.insert(t,o+e),o++}else n.insert(t,e+o),o+=t.length;return t});const a=1===s.length&&s[0]instanceof i["d"];a&&n.length>1&&n.remove(n.length-1),t.firstRange.startIndex=t.firstRange.endIndex=e+r.selectionStart;const c=n.getContentAtIndex(n.length-1);e+r.selectionStart===n.length&&c instanceof i["d"]&&n.append(new i["d"],!0),t.commonAncestorFragment.from(n)}onEnter(){const t=this.selection.firstRange,e=t.startFragment;e.insert(new i["d"],t.startIndex),t.startIndex=t.endIndex=t.startIndex+1;const n=e.getContentAtIndex(t.startIndex);"string"!==typeof n&&(t.startIndex===e.length||n instanceof i["p"]&&n.block||n instanceof i["a"]&&!(n instanceof i["p"]))&&e.insert(new i["d"],t.startIndex)}onPaste(t){const e=this.selection.firstRange,n=t.data.fragment,s=e.startFragment,r=n.sliceContents(),o=0===s.length||1===s.length&&s.getContentAtIndex(0)instanceof i["d"],a=r.map(t=>t instanceof i["a"]&&!(t instanceof i["p"])).includes(!0);if(!a){const t=n.length,r=[];return o&&0===e.startIndex&&s.getFormatKeys().forEach(t=>{r.push(...s.getFormatRanges(t))}),s.insert(n,e.startIndex),r.forEach(t=>t.startIndex=0),void(e.startIndex=e.endIndex=e.startIndex+t)}const c=n.getContentAtIndex(0),h=1===n.length&&c instanceof i["a"]&&!(c instanceof i["p"]),u=s.parentComponent,d=u.parentFragment;if(!d)return void s.insert(n,e.startIndex);const l=d.indexOf(u);if(o&&h)return void d.insert(c,l);const f=s.length;if(h&&(e.endIndex===f||e.endIndex===f-1&&s.getContentAtIndex(f-1)instanceof i["d"]))return void d.insertAfter(c,u);const p=!r.map(t=>t instanceof i["a"]&&!(t instanceof i["p"])).includes(!1);if(p&&o)return void r.reverse().forEach(t=>{d.insert(t,l)});const g=n.length;s.insert(n,e.startIndex),e.startIndex=e.endIndex=e.startIndex+g}onDeleteRange(){this.selection.ranges.forEach(t=>{t.deleteRange()})}onDelete(){this.selection.ranges.forEach(t=>{t.delete()})}mergeFormats(t){this.formatterSnapshot.forEach((e,n)=>{n instanceof i["n"]?e.forEach(e=>{var s;t.apply(n,Object.assign(Object.assign({},e),{formatData:null===(s=e.formatData)||void 0===s?void 0:s.clone()}))}):e.forEach(e=>{var s;t.apply(n,{get startIndex(){return 0},get endIndex(){return t.length},effect:e.effect,formatData:null===(s=e.formatData)||void 0===s?void 0:s.clone()})})})}recordSnapshotFromEditingBefore(){this.selectionSnapshot=this.selection.clone();const t=this.selectionSnapshot.commonAncestorFragment;this.contentSnapshot=t.sliceContents(),this.formatterSnapshot.clear(),t.getFormatKeys().forEach(e=>{this.formatterSnapshot.set(e,t.getFormatRanges(e).map(t=>{var n,s;return e instanceof i["n"]?Object.assign(Object.assign({},t),{formatData:null===(n=t.formatData)||void 0===n?void 0:n.clone()}):{startIndex:0,endIndex:t.endIndex,effect:t.effect,formatData:null===(s=t.formatData)||void 0===s?void 0:s.clone()}}))})}};d=c([Object(r["c"])(),u(0,Object(r["a"])(Object(r["i"])(()=>i["w"]))),u(1,Object(r["a"])(Object(r["i"])(()=>o["a"]))),u(2,Object(r["a"])(Object(r["i"])(()=>f))),u(3,Object(r["a"])(Object(r["i"])(()=>a["a"]))),h("design:paramtypes",[i["w"],o["a"],Object,a["a"]])],d);class l{match(){return!1}read(t){const e=new f;return{component:e,slotsMap:[{toSlot:e.slot,from:t}]}}}let f=s=class extends i["h"]{constructor(){super("body")}clone(){const t=new s;return t.slot.from(this.slot.clone()),t}slotRender(t,e){return e(this.slot,new i["x"](this.tagName))}render(t,e){return e(this.slot)}};f=s=c([Object(i["f"])({loader:new l,providers:[{provide:i["o"],useClass:d}],styles:["body{word-break: break-word;}"]}),Object(r["c"])(),h("design:paramtypes",[])],f)},"0ca4":function(t,e,n){"use strict";function s(t){setTimeout((function(){throw t}),0)}n.d(e,"a",(function(){return s}))},"127f":function(t,e,n){"use strict";function s(){return"function"===typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}n.d(e,"a",(function(){return r}));var r=s()},1453:function(t,e,n){"use strict";n.d(e,"a",(function(){return u}));var s=n("9ab4"),r=n("d817"),i=n("e9a8"),o=n("a6e8"),a=n("2ff5"),c=n("88bc"),h=n("0ca4"),u=function(t){function e(n,s,r){var o=t.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=i["a"];break;case 1:if(!n){o.destination=i["a"];break}if("object"===typeof n){n instanceof e?(o.syncErrorThrowable=n.syncErrorThrowable,o.destination=n,n.add(o)):(o.syncErrorThrowable=!0,o.destination=new d(o,n));break}default:o.syncErrorThrowable=!0,o.destination=new d(o,n,s,r);break}return o}return s["a"](e,t),e.prototype[a["a"]]=function(){return this},e.create=function(t,n,s){var r=new e(t,n,s);return r.syncErrorThrowable=!1,r},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},e}(o["a"]),d=function(t){function e(e,n,s,o){var a,c=t.call(this)||this;c._parentSubscriber=e;var h=c;return Object(r["a"])(n)?a=n:n&&(a=n.next,s=n.error,o=n.complete,n!==i["a"]&&(h=Object.create(n),Object(r["a"])(h.unsubscribe)&&c.add(h.unsubscribe.bind(h)),h.unsubscribe=c.unsubscribe.bind(c))),c._context=h,c._next=a,c._error=s,c._complete=o,c}return s["a"](e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;c["a"].useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,n=c["a"].useDeprecatedSynchronousErrorHandling;if(this._error)n&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)n?(e.syncErrorValue=t,e.syncErrorThrown=!0):Object(h["a"])(t),this.unsubscribe();else{if(this.unsubscribe(),n)throw t;Object(h["a"])(t)}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var n=function(){return t._complete.call(t._context)};c["a"].useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(n){if(this.unsubscribe(),c["a"].useDeprecatedSynchronousErrorHandling)throw n;Object(h["a"])(n)}},e.prototype.__tryOrSetError=function(t,e,n){if(!c["a"].useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,n)}catch(s){return c["a"].useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=s,t.syncErrorThrown=!0,!0):(Object(h["a"])(s),!0)}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},e}(u)},1716:function(t,e,n){"use strict";n.d(e,"a",(function(){return f}));var s=n("fad2"),r=n("0ca4"),i=function(t){return function(e){return t.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,r["a"]),e}},o=n("127f"),a=function(t){return function(e){var n=t[o["a"]]();do{var s=void 0;try{s=n.next()}catch(r){return e.error(r),e}if(s.done){e.complete();break}if(e.next(s.value),e.closed)break}while(1);return"function"===typeof n.return&&e.add((function(){n.return&&n.return()})),e}},c=n("c539"),h=function(t){return function(e){var n=t[c["a"]]();if("function"!==typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(e)}},u=n("d9e3"),d=n("fd66"),l=n("31c4"),f=function(t){if(t&&"function"===typeof t[c["a"]])return h(t);if(Object(u["a"])(t))return Object(s["a"])(t);if(Object(d["a"])(t))return i(t);if(t&&"function"===typeof t[o["a"]])return a(t);var e=Object(l["a"])(t)?"an invalid object":"'"+t+"'",n="You provided "+e+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.";throw new TypeError(n)}},"17f5":function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var s=n("9e46"),r=n("2144"),i=n("245f");function o(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t[t.length-1];return Object(s["a"])(n)?(t.pop(),Object(i["a"])(t,n)):Object(r["a"])(t)}},"1a2de":function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var s=n("9ab4"),r=n("1453"),i=n("4f50");function o(t,e){return void 0===e&&(e=i["a"]),function(n){return n.lift(new a(t,e))}}var a=function(){function t(t,e){this.dueTime=t,this.scheduler=e}return t.prototype.call=function(t,e){return e.subscribe(new c(t,this.dueTime,this.scheduler))},t}(),c=function(t){function e(e,n,s){var r=t.call(this,e)||this;return r.dueTime=n,r.scheduler=s,r.debouncedSubscription=null,r.lastValue=null,r.hasValue=!1,r}return s["a"](e,t),e.prototype._next=function(t){this.clearDebounce(),this.lastValue=t,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(h,this.dueTime,this))},e.prototype._complete=function(){this.debouncedNext(),this.destination.complete()},e.prototype.debouncedNext=function(){if(this.clearDebounce(),this.hasValue){var t=this.lastValue;this.lastValue=null,this.hasValue=!1,this.destination.next(t)}},e.prototype.clearDebounce=function(){var t=this.debouncedSubscription;null!==t&&(this.remove(t),t.unsubscribe(),this.debouncedSubscription=null)},e}(r["a"]);function h(t){t.debouncedNext()}},"20d3":function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var s=n("9ab4"),r=n("2bd2"),i=n("f20f"),o=function(t){function e(e){var n=t.call(this)||this;return n._value=e,n}return s["a"](e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),e.prototype._subscribe=function(e){var n=t.prototype._subscribe.call(this,e);return n&&!n.closed&&e.next(this._value),n},e.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new i["a"];return this._value},e.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},e}(r["a"]);class a{constructor(t){this.status=t,this.stateChangeEvent=new o(this.status),this.onStateChange=this.stateChangeEvent.asObservable()}set supportMarkdown(t){this.status.supportMarkdown=t,this.dispatch()}get supportMarkdown(){return this.status.supportMarkdown}set readonly(t){this.status.readonly=t,this.dispatch()}get readonly(){return this.status.readonly}set sourceCodeMode(t){this.status.sourcecodeMode=t,this.dispatch()}get sourceCodeMode(){return this.status.sourcecodeMode}dispatch(){this.stateChangeEvent.next(Object.assign({},this.status))}}},2144:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var s=n("e9b9"),r=n("fad2"),i=n("245f");function o(t,e){return e?Object(i["a"])(t,e):new s["a"](Object(r["a"])(t))}},2386:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));class s{}},"245f":function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var s=n("e9b9"),r=n("a6e8");function i(t,e){return new s["a"]((function(n){var s=new r["a"],i=0;return s.add(e.schedule((function(){i!==t.length?(n.next(t[i++]),n.closed||s.add(this.schedule())):n.complete()}))),s}))}},"25dd":function(t,e,n){"use strict";function s(t){if("string"===typeof t)return t;if(Array.isArray(t))return"["+t.map(s).join(", ")+"]";if(null==t)return""+t;if(t.name)return""+t.name;if(t.token)return""+t.token;const e=t.toString();if(null==e)return""+e;const n=e.indexOf("\n");return-1===n?e:e.substring(0,n)}function r(t){return function(e){const n=new Error(`No provide for \`${s(e)}\`!`);return n.name=t,n}}function i(t){return function(e){const n=new Error(`Can not found provide scope \`${s(e)}\`!`);return n.name=t,n}}n.d(e,"k",(function(){return c})),n.d(e,"j",(function(){return h})),n.d(e,"i",(function(){return d})),n.d(e,"c",(function(){return l})),n.d(e,"d",(function(){return f})),n.d(e,"b",(function(){return p})),n.d(e,"e",(function(){return g})),n.d(e,"a",(function(){return v})),n.d(e,"g",(function(){return w})),n.d(e,"f",(function(){return b})),n.d(e,"h",(function(){return R}));class o{constructor(){this.classes=new Map,this.props=new Map,this.methods=new Map,this.params=new Map}setClassMetadata(t,e){this.classes.set(t,e)}getClassMetadata(t){return this.classes.get(t)}getClassMetadataKeys(){return Array.from(this.classes.keys())}pushParamMetadata(t,e){this.params.has(t)?this.params.get(t).push(e):this.params.set(t,[e])}getParamMetadata(t){return this.params.get(t)}getParamMetadataKeys(){return Array.from(this.params.keys())}getPropMetadataKeys(){return Array.from(this.props.keys())}pushPropMetadata(t,e){this.props.has(t)?this.props.get(t).push(e):this.props.set(t,[e])}getPropMetadata(t){return this.props.get(t)}pushMethodMetadata(t,e){this.methods.has(t)?this.methods.get(t).push(e):this.methods.set(t,[e])}getMethodMetadata(t){return this.methods.get(t)}}function a(t,e){return function(n,s,r){const i=h(n);i.pushParamMetadata(t,{propertyKey:s,parameterIndex:r,metadata:e})}}function c(t,e){return function(n){const s=h(n);s.setClassMetadata(t,{paramTypes:Reflect.getMetadata("design:paramtypes",n),metadata:e})}}function h(t){if(!t.hasOwnProperty("__annotaions__")){const e=new o;Reflect.defineProperty(t,"__annotations__",{get(){return e}})}return t.__annotations__}class u{constructor(t){this.forwardRefFn=t}getRef(){return this.forwardRefFn()}}function d(t){return new u(t)}const l=function t(e){if(!(this instanceof t))return c(l,new l(e));this.provideIn=(null===e||void 0===e?void 0:e.provideIn)||null};class f{constructor(t){this.description=t}toString(){return this.description||"[anonymous injection token]"}}var p;(function(t){t["Default"]="Default",t["Self"]="Self",t["SkipSelf"]="SkipSelf",t["Optional"]="Optional"})(p||(p={}));class g{}const m={__debug_value__:"THROW_IF_NOT_FOUND"},y=r("NullInjectorError");class b extends g{constructor(){super(...arguments),this.parentInjector=null}get(t,e=m){if(e===m)throw y(t);return e}}const v=function(t){if(!(this instanceof v))return a(v,new v(t));this.token=t},x=function(){if(!(this instanceof x))return a(x,new x)},C=function(){if(!(this instanceof C))return a(C,new C)},w=function(){if(!(this instanceof w))return a(w,new w)};function I(t){return t.useValue?E(t):t.useClass?O(t):t.useExisting?S(t):t.useFactory?_(t):t.provide?t.provide instanceof f?E(t):j(t):M(t)}function E(t){return{provide:t.provide,scope:null,generateFactory(){return function(){return t.useValue}},deps:[]}}function O(t){let e,n;if(t.deps)e=F(t.provide,t.deps);else{const s=k(t.useClass);n=s.scope,e=F(t.provide,s.deps)}return{provide:t.provide,scope:n,deps:e,generateFactory(e,n){return function(...s){if(t.provide!==t.useClass){const n=e.get(t.useClass,null,p.Optional);if(n)return n}const r=new t.useClass(...s),i=h(t.useClass).getPropMetadataKeys();return i.forEach(n=>{const s=h(t.useClass).getPropMetadata(n)||[];s.forEach(t=>{t.contextCallback(r,t.propertyKey,e)})}),n(t.provide,r),t.provide!==t.useClass&&n(t.useClass,r),r}}}}function S(t){return{provide:t.provide,scope:null,generateFactory(e){return function(){return e.get(t.useExisting)}},deps:[]}}function _(t){return{provide:t.provide,scope:null,generateFactory(){return function(...e){return t.useFactory(...e)}},deps:F(t.provide,t.deps||[])}}function j(t){return O(Object.assign(Object.assign({},t),{useClass:t.provide}))}function M(t){return O({provide:t,useClass:t})}function k(t){const e=h(t),n=e.getClassMetadata(l);if("undefined"===typeof n)throw new Error(`Class \`${s(t)}\` is not injectable!`);const r=(n.paramTypes||[]).map(t=>[t]),i=[v,x,C,w];return i.forEach(t=>{(e.getParamMetadata(t)||[]).forEach(t=>{r[t.parameterIndex].push(t.metadata)})}),{scope:n.metadata.provideIn,deps:r}}function F(t,e){return e.map((e,n)=>{const r={injectKey:null,optional:!1,visibility:null};if(Array.isArray(e))for(let t=0;t<e.length;t++){const n=e[t];n instanceof v?r.injectKey=n.token:n instanceof x||n instanceof C?r.visibility=n:n instanceof w?r.optional=!0:r.injectKey=n}else r.injectKey=e;if("undefined"===typeof r.injectKey)throw new Error(`The ${n} th dependent parameter type of \`${s(t)}\` was not obtained,\nif the dependency is declared later, you can refer to it using \`constructor(@Inject(forwardRef(() => [Type|InjectionToken])) paramName: [Type]) {}\``);return r})}const D=r("ReflectiveInjectorError"),A=i("ReflectiveInjectorError");class R extends g{constructor(t,e,n){super(),this.parentInjector=t,this.staticProviders=e,this.scope=n,this.recordValues=new Map,this.normalizedProviders=e.map(t=>I(t))}get(t,e=m,n){var s;if(n=n||p.Default,n===p.SkipSelf){if(this.parentInjector)return this.parentInjector.get(t,e);if(e!==m)return e;throw D(t)}if(this.recordValues.has(t))return this.recordValues.get(t);for(let r=0;r<this.normalizedProviders.length;r++){const n=this.normalizedProviders[r];if(n.provide===t)return this.getValue(t,e,n)}if(!(t instanceof f)){const n=null===(s=h(t).getClassMetadata(l))||void 0===s?void 0:s.metadata.provideIn;if(n){const s=I(t);if(this.scope===n)return this.normalizedProviders.push(s),this.getValue(t,e,s);const r=this.parentInjector;if(!r||r instanceof b){if("root"===s.scope)return this.normalizedProviders.push(s),this.getValue(t,e,s);if(e!==m)return e;throw A(s.scope)}}}if(n===p.Self){if(e===m)throw D(t);return e}if(this.parentInjector)return this.parentInjector.get(t,e,n===p.Optional?p.Optional:p.Default);if(e===m)throw D(t);return e}getValue(t,e=m,n){const{generateFactory:s,deps:r}=n,i=s(this,(t,e)=>{this.recordValues.set(t,e)}),o=this.resolveDeps(r||[],e),a=i(...o);return this.recordValues.set(t,a),a}resolveDeps(t,e){return t.map(t=>{let n;const s={},r=t.injectKey instanceof u?t.injectKey.getRef():t.injectKey;if(t.visibility instanceof x)n=this.get(r,s,p.Self);else if(t.visibility instanceof C){if(!this.parentInjector){if(t.optional&&e===m)return null;throw D(r)}n=this.parentInjector.get(r,s)}else n=this.get(r,s);if(n===s){if(t.optional)return e===m?null:e;throw D(r)}return n})}}},"2bd2":function(t,e,n){"use strict";n.d(e,"a",(function(){return d}));var s=n("9ab4"),r=n("e9b9"),i=n("1453"),o=n("a6e8"),a=n("f20f"),c=function(t){function e(e,n){var s=t.call(this)||this;return s.subject=e,s.subscriber=n,s.closed=!1,s}return s["a"](e,t),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var n=e.indexOf(this.subscriber);-1!==n&&e.splice(n,1)}}},e}(o["a"]),h=n("2ff5"),u=function(t){function e(e){var n=t.call(this,e)||this;return n.destination=e,n}return s["a"](e,t),e}(i["a"]),d=function(t){function e(){var e=t.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return s["a"](e,t),e.prototype[h["a"]]=function(){return new u(this)},e.prototype.lift=function(t){var e=new l(this,this);return e.operator=t,e},e.prototype.next=function(t){if(this.closed)throw new a["a"];if(!this.isStopped)for(var e=this.observers,n=e.length,s=e.slice(),r=0;r<n;r++)s[r].next(t)},e.prototype.error=function(t){if(this.closed)throw new a["a"];this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,n=e.length,s=e.slice(),r=0;r<n;r++)s[r].error(t);this.observers.length=0},e.prototype.complete=function(){if(this.closed)throw new a["a"];this.isStopped=!0;for(var t=this.observers,e=t.length,n=t.slice(),s=0;s<e;s++)n[s].complete();this.observers.length=0},e.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},e.prototype._trySubscribe=function(e){if(this.closed)throw new a["a"];return t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){if(this.closed)throw new a["a"];return this.hasError?(t.error(this.thrownError),o["a"].EMPTY):this.isStopped?(t.complete(),o["a"].EMPTY):(this.observers.push(t),new c(this,t))},e.prototype.asObservable=function(){var t=new r["a"];return t.source=this,t},e.create=function(t,e){return new l(t,e)},e}(r["a"]),l=function(t){function e(e,n){var s=t.call(this)||this;return s.destination=e,s.source=n,s}return s["a"](e,t),e.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},e.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},e.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},e.prototype._subscribe=function(t){var e=this.source;return e?this.source.subscribe(t):o["a"].EMPTY},e}(d)},"2ff5":function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var s=function(){return"function"===typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}()},"31c4":function(t,e,n){"use strict";function s(t){return null!==t&&"object"===typeof t}n.d(e,"a",(function(){return s}))},"3c87":function(t,e,n){"use strict";var s=n("98db");n.o(s,"AbstractComponent")&&n.d(e,"AbstractComponent",(function(){return s["AbstractComponent"]})),n.o(s,"BackboneAbstractComponent")&&n.d(e,"BackboneAbstractComponent",(function(){return s["BackboneAbstractComponent"]})),n.o(s,"BlockFormatter")&&n.d(e,"BlockFormatter",(function(){return s["BlockFormatter"]})),n.o(s,"BrComponent")&&n.d(e,"BrComponent",(function(){return s["BrComponent"]})),n.o(s,"BranchAbstractComponent")&&n.d(e,"BranchAbstractComponent",(function(){return s["BranchAbstractComponent"]})),n.o(s,"Component")&&n.d(e,"Component",(function(){return s["Component"]})),n.o(s,"ComponentSetter")&&n.d(e,"ComponentSetter",(function(){return s["ComponentSetter"]})),n.o(s,"DivisionAbstractComponent")&&n.d(e,"DivisionAbstractComponent",(function(){return s["DivisionAbstractComponent"]})),n.o(s,"DynamicKeymap")&&n.d(e,"DynamicKeymap",(function(){return s["DynamicKeymap"]})),n.o(s,"EDITABLE_DOCUMENT")&&n.d(e,"EDITABLE_DOCUMENT",(function(){return s["EDITABLE_DOCUMENT"]})),n.o(s,"Editor")&&n.d(e,"Editor",(function(){return s["Editor"]})),n.o(s,"EditorController")&&n.d(e,"EditorController",(function(){return s["EditorController"]})),n.o(s,"FileUploader")&&n.d(e,"FileUploader",(function(){return s["FileUploader"]})),n.o(s,"FormatData")&&n.d(e,"FormatData",(function(){return s["FormatData"]})),n.o(s,"FormatEffect")&&n.d(e,"FormatEffect",(function(){return s["FormatEffect"]})),n.o(s,"FormatterPriority")&&n.d(e,"FormatterPriority",(function(){return s["FormatterPriority"]})),n.o(s,"Fragment")&&n.d(e,"Fragment",(function(){return s["Fragment"]})),n.o(s,"I18n")&&n.d(e,"I18n",(function(){return s["I18n"]})),n.o(s,"Inject")&&n.d(e,"Inject",(function(){return s["Inject"]})),n.o(s,"Injectable")&&n.d(e,"Injectable",(function(){return s["Injectable"]})),n.o(s,"InjectionToken")&&n.d(e,"InjectionToken",(function(){return s["InjectionToken"]})),n.o(s,"Injector")&&n.d(e,"Injector",(function(){return s["Injector"]})),n.o(s,"InlineFormatter")&&n.d(e,"InlineFormatter",(function(){return s["InlineFormatter"]})),n.o(s,"Input")&&n.d(e,"Input",(function(){return s["Input"]})),n.o(s,"Interceptor")&&n.d(e,"Interceptor",(function(){return s["Interceptor"]})),n.o(s,"Layout")&&n.d(e,"Layout",(function(){return s["Layout"]})),n.o(s,"LeafAbstractComponent")&&n.d(e,"LeafAbstractComponent",(function(){return s["LeafAbstractComponent"]})),n.o(s,"MarkdownSupport")&&n.d(e,"MarkdownSupport",(function(){return s["MarkdownSupport"]})),n.o(s,"Optional")&&n.d(e,"Optional",(function(){return s["Optional"]})),n.o(s,"Renderer")&&n.d(e,"Renderer",(function(){return s["Renderer"]})),n.o(s,"RootComponent")&&n.d(e,"RootComponent",(function(){return s["RootComponent"]})),n.o(s,"TBHistory")&&n.d(e,"TBHistory",(function(){return s["TBHistory"]})),n.o(s,"TBRange")&&n.d(e,"TBRange",(function(){return s["TBRange"]})),n.o(s,"TBSelection")&&n.d(e,"TBSelection",(function(){return s["TBSelection"]})),n.o(s,"Tab")&&n.d(e,"Tab",(function(){return s["Tab"]})),n.o(s,"UIDialog")&&n.d(e,"UIDialog",(function(){return s["UIDialog"]})),n.o(s,"VElement")&&n.d(e,"VElement",(function(){return s["VElement"]})),n.o(s,"VTextNode")&&n.d(e,"VTextNode",(function(){return s["VTextNode"]})),n.o(s,"createEditor")&&n.d(e,"createEditor",(function(){return s["createEditor"]})),n.o(s,"createElement")&&n.d(e,"createElement",(function(){return s["createElement"]})),n.o(s,"createTextNode")&&n.d(e,"createTextNode",(function(){return s["createTextNode"]})),n.o(s,"isMac")&&n.d(e,"isMac",(function(){return s["isMac"]}));var r=n("25dd");n.d(e,"Inject",(function(){return r["a"]})),n.d(e,"Injectable",(function(){return r["c"]})),n.d(e,"InjectionToken",(function(){return r["d"]})),n.d(e,"Injector",(function(){return r["e"]})),n.d(e,"Optional",(function(){return r["g"]}));n("c628");var i=n("f706");n.d(e,"I18n",(function(){return i["a"]}));var o=n("fe69");n.d(e,"AbstractComponent",(function(){return o["a"]})),n.d(e,"BackboneAbstractComponent",(function(){return o["b"]})),n.d(e,"BlockFormatter",(function(){return o["c"]})),n.d(e,"BrComponent",(function(){return o["d"]})),n.d(e,"BranchAbstractComponent",(function(){return o["e"]})),n.d(e,"Component",(function(){return o["f"]})),n.d(e,"ComponentSetter",(function(){return o["g"]})),n.d(e,"DivisionAbstractComponent",(function(){return o["h"]})),n.d(e,"DynamicKeymap",(function(){return o["i"]})),n.d(e,"FormatData",(function(){return o["j"]})),n.d(e,"FormatEffect",(function(){return o["k"]})),n.d(e,"FormatterPriority",(function(){return o["l"]})),n.d(e,"Fragment",(function(){return o["m"]})),n.d(e,"InlineFormatter",(function(){return o["n"]})),n.d(e,"Interceptor",(function(){return o["o"]})),n.d(e,"LeafAbstractComponent",(function(){return o["p"]})),n.d(e,"MarkdownSupport",(function(){return o["q"]})),n.d(e,"Renderer",(function(){return o["t"]})),n.d(e,"TBRange",(function(){return o["v"]})),n.d(e,"TBSelection",(function(){return o["w"]})),n.d(e,"VElement",(function(){return o["x"]})),n.d(e,"VTextNode",(function(){return o["y"]}));var a=n("f836");n.d(e,"FileUploader",(function(){return a["a"]})),n.d(e,"Input",(function(){return a["b"]})),n.d(e,"Layout",(function(){return a["c"]})),n.d(e,"Tab",(function(){return a["d"]})),n.d(e,"UIDialog",(function(){return a["f"]})),n.d(e,"createElement",(function(){return a["h"]})),n.d(e,"createTextNode",(function(){return a["i"]})),n.d(e,"isMac",(function(){return a["j"]}));n("a5ca");var c=n("9233");n.d(e,"Editor",(function(){return c["a"]}));var h=n("20d3");n.d(e,"EditorController",(function(){return h["a"]}));n("7dc8");var u=n("94cc");n.d(e,"TBHistory",(function(){return u["a"]}));var d=n("8679");n.d(e,"EDITABLE_DOCUMENT",(function(){return d["a"]}));n("3f58"),n("abfd");var l=n("083d");n.d(e,"RootComponent",(function(){return l["a"]}))},"3f58":function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"a",(function(){return i}));var s=n("fe69");class r{}class i{constructor(){this.singleTagTest=new RegExp(`^(${i.singleTags.join("|")})$`,"i")}transform(t){return t.childNodes.map(t=>this.vDomToHTMLString(t)).join("")}vDomToHTMLString(t){const e=i.simpleXSSFilter;if(t instanceof s["y"])return s["t"].replaceEmpty(e.text(t.textContent),"&nbsp;");const n=Array.from(t.styles.keys()).filter(e=>{const n=t.styles.get(e);return!(void 0===n||null===n||""===n)}).map(n=>{const s=n.replace(/(?=[A-Z])/g,"-").toLowerCase();return e.attrValue(`${s}:${t.styles.get(n)}`)}).join(";"),r=Array.from(t.attrs.keys()).filter(e=>!1!==t.attrs.get(e)).map(n=>{const s=e.attrName(n),r=t.attrs.get(n);return!0===r?""+s:`${s}="${e.attrValue(""+r)}"`});n&&r.push(`style="${n}"`),t.classes&&t.classes.length&&r.push(`class="${e.attrValue(t.classes.join(" "))}"`);let o=r.join(" ");if(o=o?" "+o:"",this.singleTagTest.test(t.tagName))return`<${t.tagName}${o}>`;const a=t.childNodes.map(t=>this.vDomToHTMLString(t)).join("");return[`<${t.tagName}${o}>`,a,`</${t.tagName}>`].join("")}}i.singleTags="br,img,hr".split(","),i.simpleXSSFilter={text(t){return t.replace(/[><&]/g,t=>({"<":"&lt;",">":"&gt;","&":"&amp;"}[t]))},attrName(t){return this.symbolTransfer(t.replace(/=/g,""))},attrValue(t){return this.symbolTransfer(t)},symbolTransfer(t){return t.replace(/[><"'&/]/g,t=>({"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","&":"&amp;","/":"&#x2F;"}[t]))}}},"4f50":function(t,e,n){"use strict";n.d(e,"a",(function(){return u}));var s=n("9ab4"),r=n("a6e8"),i=function(t){function e(e,n){return t.call(this)||this}return s["a"](e,t),e.prototype.schedule=function(t,e){return void 0===e&&(e=0),this},e}(r["a"]),o=function(t){function e(e,n){var s=t.call(this,e,n)||this;return s.scheduler=e,s.work=n,s.pending=!1,s}return s["a"](e,t),e.prototype.schedule=function(t,e){if(void 0===e&&(e=0),this.closed)return this;this.state=t;var n=this.id,s=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(s,n,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(s,this.id,e),this},e.prototype.requestAsyncId=function(t,e,n){return void 0===n&&(n=0),setInterval(t.flush.bind(t,this),n)},e.prototype.recycleAsyncId=function(t,e,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return e;clearInterval(e)},e.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(t,e);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,e){var n=!1,s=void 0;try{this.work(t)}catch(r){n=!0,s=!!r&&r||new Error(r)}if(n)return this.unsubscribe(),s},e.prototype._unsubscribe=function(){var t=this.id,e=this.scheduler,n=e.actions,s=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==s&&n.splice(s,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null},e}(i),a=function(){function t(e,n){void 0===n&&(n=t.now),this.SchedulerAction=e,this.now=n}return t.prototype.schedule=function(t,e,n){return void 0===e&&(e=0),new this.SchedulerAction(this,t).schedule(n,e)},t.now=function(){return Date.now()},t}(),c=function(t){function e(n,s){void 0===s&&(s=a.now);var r=t.call(this,n,(function(){return e.delegate&&e.delegate!==r?e.delegate.now():s()}))||this;return r.actions=[],r.active=!1,r.scheduled=void 0,r}return s["a"](e,t),e.prototype.schedule=function(n,s,r){return void 0===s&&(s=0),e.delegate&&e.delegate!==this?e.delegate.schedule(n,s,r):t.prototype.schedule.call(this,n,s,r)},e.prototype.flush=function(t){var e=this.actions;if(this.active)e.push(t);else{var n;this.active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,n){while(t=e.shift())t.unsubscribe();throw n}}},e}(a),h=new c(o),u=h},"6e77":function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var s=n("e9b9"),r=n("8ac6"),i=n("d817"),o=n("ebb6");function a(t,e,n,h){return Object(i["a"])(n)&&(h=n,n=void 0),h?a(t,e,n).pipe(Object(o["a"])((function(t){return Object(r["a"])(t)?h.apply(void 0,t):h(t)}))):new s["a"]((function(s){function r(t){arguments.length>1?s.next(Array.prototype.slice.call(arguments)):s.next(t)}c(t,e,r,s,n)}))}function c(t,e,n,s,r){var i;if(d(t)){var o=t;t.addEventListener(e,n,r),i=function(){return o.removeEventListener(e,n,r)}}else if(u(t)){var a=t;t.on(e,n),i=function(){return a.off(e,n)}}else if(h(t)){var l=t;t.addListener(e,n),i=function(){return l.removeListener(e,n)}}else{if(!t||!t.length)throw new TypeError("Invalid event target");for(var f=0,p=t.length;f<p;f++)c(t[f],e,n,s,r)}s.add(i)}function h(t){return t&&"function"===typeof t.addListener&&"function"===typeof t.removeListener}function u(t){return t&&"function"===typeof t.on&&"function"===typeof t.off}function d(t){return t&&"function"===typeof t.addEventListener&&"function"===typeof t.removeEventListener}},"7dc8":function(t,e,n){},8679:function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"a",(function(){return i}));var s=n("25dd");const r=new s["d"]("EDITOR_OPTIONS"),i=new s["d"]("EDITABLE_DOCUMENT")},"88bc":function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var s=!1,r={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){if(t){var e=new Error;e.stack}s=t},get useDeprecatedSynchronousErrorHandling(){return s}}},"8ac6":function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var s=function(){return Array.isArray||function(t){return t&&"number"===typeof t.length}}()},9233:function(t,e,n){"use strict";n.d(e,"a",(function(){return w}));var s=n("2bd2"),r=n("6e77"),i=n("e9b9"),o=n("d3fb"),a=n("17f5"),c=n("1a2de"),h=n("25dd"),u=n("fe69"),d=n("f836"),l=n("3f58"),f=n("20d3"),p=n("c628"),g=n("a5ca"),m=n("8679"),y=n("083d"),b=n("94cc"),v=n("f706"),x=n("2386");const C=Object(p["a"])("Editor");class w{constructor(t,e={}){if(this.selector=t,this.options=e,this.stateController=null,this.injector=null,this.defaultPlugins=[d["f"],d["e"],d["g"]],this.readyState=!1,this.tasks=[],this.readyEvent=new s["a"],this.subs=[],this.changeEvent=new s["a"],this.container="string"===typeof t?document.querySelector(t):t,!this.container||!(this.container instanceof HTMLElement))throw C("selector is not an HTMLElement, or the CSS selector cannot find a DOM element in the document.");this.onReady=this.readyEvent.asObservable(),this.onChange=this.changeEvent.asObservable(),this.stateController=new f["a"]({readonly:!1,sourcecodeMode:!1,supportMarkdown:!0});const n=new v["a"](v["b"],e.i18n),r=new h["h"](new h["f"],[d["c"],{provide:f["a"],useValue:this.stateController},{provide:v["a"],useValue:n}]),i=r.get(d["c"]);i.setTheme(e.theme),this.layout=i,this.subs.push(i.onReady.subscribe(t=>{const e=this.bootstrap(r,t);this.init(e)})),this.container.appendChild(i.container)}set readonly(t){this.stateController.readonly=t}get readonly(){return this.stateController.readonly}set supportMarkdown(t){this.stateController.supportMarkdown=t}get supportMarkdown(){return this.stateController.supportMarkdown}setContents(t){return new Promise(e=>{this.run(()=>{const n=this.injector.get(u["s"]),s=n.parse(u["s"].parserHTML(t));this.injector.get(y["a"]).slot.from(s),setTimeout(()=>{const t=this.injector.get(d["c"]);t.scroller.scrollTop=0,this.updateDocHeight(t.iframe,t.workbench,this.injector.get(m["a"])),e()},30)})})}getContents(){const t=this.getOutputComponentMetadata(),e=this.injector.get(l["b"]),n=this.injector.get(u["r"]),s=this.injector.get(y["a"]),r=e.transform(n.render(s));return{content:r,links:t.links,styleSheets:t.styles,scripts:t.scripts}}getJSONLiteral(){const t=this.injector.get(u["r"]),e=this.injector.get(y["a"]),n=t.render(e).toJSON(),s=this.getOutputComponentMetadata();return{content:n,links:s.links,styleSheets:s.styles,scripts:s.scripts}}destroy(){this.subs.forEach(t=>t.unsubscribe()),[d["b"],d["c"],g["a"]].forEach(t=>{this.injector.get(t).destroy()}),[...this.defaultPlugins,...this.options.plugins||[]].forEach(t=>{var e,n;null===(n=(e=this.injector.get(t)).onDestroy)||void 0===n||n.call(e)}),this.container.removeChild(this.layout.container)}getOutputComponentMetadata(){const t=this.getReferencedComponents(),e=[...this.options.styleSheets||""],n=[],s=[];return t.forEach(t=>{const r=Object(h["j"])(t).getClassMetadata(u["f"]).metadata;r.styles&&e.push(...r.styles.filter(t=>t)),r.scripts&&n.push(...r.scripts.filter(t=>t)),r.links&&s.push(...r.links)}),{links:s,styles:Array.from(new Set(e)).map(t=>w.cssMin(t)),scripts:Array.from(new Set(n))}}getReferencedComponents(){function t(e){const n=[e],s=[];return e instanceof u["h"]?s.push(e.slot):e instanceof u["e"]?s.push(...e.slots):e instanceof u["b"]&&s.push(...Array.from(e)),s.forEach(e=>{e.sliceContents().forEach(e=>{e instanceof u["a"]&&n.push(...t(e))})}),n}const e=t(this.injector.get(y["a"]));return Array.from(new Set(e.map(t=>t.constructor)))}init(t){this.injector=t;const e=t.get(m["a"]),n=t.get(d["c"]),s=t.get(y["a"]),i=t.get(u["w"]),o=t.get(u["t"]),a=t.get(u["s"]);this.subs.push(s.onChange.pipe(Object(c["a"])(1)).subscribe(()=>{o.render(s),Promise.resolve().then(()=>i.restore())}),Object(r["a"])(e,"click").subscribe(t=>{const n=t.target,s=this.findFocusNode(n,o);if(!s||s===n)return;const r=o.getPositionByNode(s);if(r.endIndex-r.startIndex===1){const t=r.fragment.getContentAtIndex(r.startIndex);if(t instanceof u["p"]){if(!i.firstRange){const t=new u["v"](e.createRange(),o);i.addRange(t)}i.firstRange.setStart(r.fragment,r.endIndex),i.firstRange.collapse(),i.restore()}}}),o.onViewUpdated.subscribe(()=>{this.changeEvent.next()}));const h=u["s"].parserHTML(this.options.contents||"<p><br></p>");s.slot.from(a.parse(h)),this.listen(n.iframe,n.workbench,e),this.defaultPlugins.forEach(e=>{t.get(e).setup()});const l=t.get(d["b"]);"function"===typeof this.options.onSave&&l.addKeymap({keymap:{ctrlKey:!0,key:"s"},action:()=>{this.options.onSave()}}),t.get(b["a"]).record();const f=this.options.plugins||[];let p=0;f.length?f.forEach(e=>{setTimeout(()=>{p++,t.get(e).setup(),p===f.length&&(this.readyState=!0,this.readyEvent.next(),this.tasks.forEach(t=>t()))})}):(this.readyState=!0,this.readyEvent.next(),this.tasks.forEach(t=>t()))}bootstrap(t,e){const n=new u["t"](e.body),s=new u["w"](e,Object(r["a"])(e,"selectionchange"),n);this.componentAnnotations=[y["a"],...this.options.components||[],u["d"]].map(t=>Object(h["j"])(t).getClassMetadata(u["f"]).metadata),this.setDocStyle(this.componentAnnotations,e);const c=new u["s"](this.componentAnnotations.map(t=>t.loader),this.options.formatters),f=new g["a"],p=new h["h"](t,[...this.defaultPlugins,d["b"],b["a"],y["a"],{provide:x["a"],useClass:d["b"]},{provide:m["a"],useValue:e},{provide:m["b"],useValue:this.options},{provide:w,useValue:this},{provide:u["r"],useValue:new u["r"]},{provide:l["b"],useValue:new l["a"]},{provide:u["s"],useValue:c},{provide:u["w"],useValue:s},{provide:u["t"],useValue:n},{provide:g["a"],useValue:f},{provide:d["a"],useFactory:(t,e,n,s)=>({upload:(r,c)=>{if(0===n.rangeCount){const t=n.createRange(),e=t.findLastPosition(s.slot);t.setPosition(e.fragment,e.index),n.addRange(t)}if("function"===typeof this.options.uploader){const t=this.options.uploader(r,c);if(t instanceof i["a"])return t;if(t instanceof Promise)return Object(o["a"])(t);if("string"===typeof t)return Object(a["a"])(t)}return t.message(e.get("editor.noUploader")),Object(a["a"])("")}}),deps:[d["g"],v["a"],u["w"],y["a"]]}]),C=new h["h"](p,[...this.options.providers||[],...this.options.plugins||[],{provide:h["e"],useFactory(){return C}}]),I=C.get(d["b"]);return[y["a"],...this.options.components||[]].forEach(t=>{const e=Object(h["j"])(t).getClassMetadata(u["f"]),n=e.metadata,s=new h["h"](C,n.providers||[]);f.set(t,s);const r=s.get(u["q"],null,h["b"].Optional);if(r){const t=r.provide();I.addMarkdownSupport(t)}}),C}setDocStyle(t,e){const n=[],s=t.map(t=>{var e,s;return Array.isArray(t.links)&&n.push(...t.links),[(null===(e=t.styles)||void 0===e?void 0:e.join(""))||"",(null===(s=t.editModeStyles)||void 0===s?void 0:s.join(""))||""].join("")}).join("");n.forEach(t=>{const n=e.createElement("link");Object.assign(n,t),e.head.appendChild(n)});const r=w.cssMin([s,...this.options.styleSheets||[]].join("")),i=e.createElement("style");i.innerHTML=w.cssMin([...r,...this.options.editingStyleSheets||[]].join("")),e.head.append(i)}run(t){this.readyState?t():this.tasks.push(t)}listen(t,e,n){(null===n||void 0===n?void 0:n.body)&&(this.resizeObserver=new ResizeObserver(()=>{this.updateDocHeight(t,e,n)}),this.resizeObserver.observe(n.body))}updateDocHeight(t,e,n){const s=n.body,r=s.lastChild;let i=0;if(r)if(r.nodeType===Node.ELEMENT_NODE)i=r.getBoundingClientRect().bottom;else{const t=n.createElement("div");s.appendChild(t),i=t.getBoundingClientRect().bottom,s.removeChild(t)}t.style.height=Math.max(i,e.offsetHeight)+"px"}findFocusNode(t,e){const n=e.getPositionByNode(t);if(!n){const n=t.parentNode;return n?this.findFocusNode(n,e):null}return t}static cssMin(t){return t.replace(/\s*(?=[>{}:;,[])/g,"").replace(/([>{}:;,])\s*/g,"$1").replace(/;}/g,"}").replace(/\s+/," ").trim()}}},9237:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var s,r=n("25dd"),i=function(t,e,n,s){var r,i=arguments.length,o=i<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,n):s;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(t,e,n,s);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(i<3?r(o):i>3?r(e,n,o):r(e,n))||o);return i>3&&o&&Object.defineProperty(e,n,o),o},o=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)};let a=s=class{constructor(t,e){this.defaultConfig=t,this.customConfig=e}get(t){const e=this.parse(t),n=this.getLabelByTokens(this.customConfig,e);if("string"===typeof n)return n;const s=this.getLabelByTokens(this.defaultConfig,e);return"string"===typeof s?s:""}getContext(t){const e=this.parse(t),n=this.getLabelByTokens(this.customConfig,e)||{},r=this.getLabelByTokens(this.defaultConfig,e)||{};return new s(r,n)}joinTemplate(t,...e){return t.replace(/{\d+}/g,t=>e[t.replace(/{\s*|\s*}/g,"")]||t)}parse(t){return t.split(/[.\[\]'"]+/g).map(t=>t.trim()).filter(t=>t)}getLabelByTokens(t,e){if(!t||0===e.length)return null;let n=t;for(let s=0;s<e.length;s++)if(n=n[e[s]],"undefined"===typeof n)return null;return n}};a=s=i([Object(r["c"])(),o("design:paramtypes",[Object,Object])],a)},"94cc":function(t,e,n){"use strict";n.d(e,"a",(function(){return m}));var s,r=n("2bd2"),i=n("fe88"),o=n("25dd"),a=n("fe69"),c=n("8679"),h=n("083d"),u=n("20d3"),d=n("c628"),l=function(t,e,n,s){var r,i=arguments.length,o=i<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,n):s;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(t,e,n,s);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(i<3?r(o):i>3?r(e,n,o):r(e,n))||o);return i>3&&o&&Object.defineProperty(e,n,o),o},f=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},p=function(t,e){return function(n,s){e(n,s,t)}};const g=Object(d["a"])("History");let m=s=class{constructor(t,e,n,s,i,o){this.options=t,this.selection=e,this.context=n,this.renderer=s,this.editorController=i,this.rootComponent=o,this.historySequence=[],this.historyIndex=0,this.historyChangeEvent=new r["a"],this.historyUsedEvent=new r["a"],this.historyStackSize=t.historyStackSize||50,this.onChange=this.historyChangeEvent.asObservable(),this.onUsed=this.historyUsedEvent.asObservable()}get canBack(){return this.historySequence.length>0&&this.historyIndex>0}get canForward(){return this.historySequence.length>0&&this.historyIndex<this.historySequence.length-1}back(){if(this.canBack){this.historyIndex--,this.historyIndex=Math.max(0,this.historyIndex);const t=s.cloneHistoryData(this.historySequence[this.historyIndex]);this.rootComponent.slot.from(t.component.slot),this.usePaths(t.paths,this.rootComponent.slot),this.listen(),this.historyUsedEvent.next()}}forward(){if(this.canForward){this.historyIndex++;const t=s.cloneHistoryData(this.historySequence[this.historyIndex]);this.rootComponent.slot.from(t.component.slot),this.usePaths(t.paths,this.rootComponent.slot),this.listen(),this.historyUsedEvent.next()}}destroy(){var t;this.historySequence=null,null===(t=this.stateChangeSubscription)||void 0===t||t.unsubscribe(),this.stopListen()}clean(){this.historyIndex=0,this.historySequence=[]}record(){this.recordSnapshot(),this.listen()}stopListen(){this.snapshotSubscription&&this.snapshotSubscription.unsubscribe()}listen(){this.stopListen(),this.snapshotSubscription=this.rootComponent.onChange.pipe(Object(i["a"])(5e3)).subscribe(()=>{this.recordSnapshot()})}recordSnapshot(){this.historySequence.length!==this.historyIndex&&(this.historySequence.length=this.historyIndex+1),this.historySequence.push({component:this.rootComponent.clone(),paths:this.getRangePaths()}),this.historySequence.length>this.historyStackSize&&this.historySequence.shift(),this.historyIndex=this.historySequence.length-1,this.historyChangeEvent.next()}static cloneHistoryData(t){return{component:t.component.clone(),paths:t.paths.map(t=>t)}}getRangePaths(){const t=t=>{const e=[];while(t){const n=t.parentComponent;if(!n.parentFragment)break;n instanceof a["e"]?e.push(n.slots.indexOf(t)):n instanceof a["b"]?e.push(n.indexOf(t)):e.push(0),t=n.parentFragment,t&&e.push(t.indexOf(n))}return e.reverse()};return this.selection.ranges.map(e=>{const n=t(e.startFragment);if(n.push(e.startIndex),e.collapsed)return{startPaths:n,endPaths:n};{const s=t(e.endFragment);return s.push(e.endIndex),{startPaths:n,endPaths:s}}})}usePaths(t,e){const n=(t,e)=>{const n=t.map(t=>t).reverse();while(1){const t=n.pop();if(0===n.length)return{fragment:e,index:t};const s=e.getContentAtIndex(t),r=n.pop();if(s instanceof a["h"]&&0===r)e=s.slot;else if(s instanceof a["e"])e=s.slots[r];else{if(!(s instanceof a["b"]))throw g("location of the history range could not be found.");e=s.getSlotAtIndex(r)}if(1===n.length)return{fragment:e,index:n.pop()}}};let s;s=this.selection.nativeSelection.rangeCount?this.selection.nativeSelection.getRangeAt(0):this.context.createRange();const r=t.length;if(0===r)return;const i=t[0].startPaths,o=t[r-1].endPaths,c=n(i,e),h=new a["v"](s,this.renderer);if(h.setStart(c.fragment,c.index),o===i)h.setEnd(c.fragment,c.index);else{const t=n(o,e);h.setEnd(t.fragment,t.index)}this.selection.removeAllRanges(),this.selection.addRange(h)}};m=s=l([Object(o["c"])(),p(0,Object(o["a"])(Object(o["i"])(()=>c["b"]))),p(1,Object(o["a"])(Object(o["i"])(()=>a["w"]))),p(2,Object(o["a"])(Object(o["i"])(()=>c["a"]))),p(3,Object(o["a"])(Object(o["i"])(()=>a["t"]))),p(4,Object(o["a"])(Object(o["i"])(()=>u["a"]))),p(5,Object(o["a"])(Object(o["i"])(()=>h["a"]))),f("design:paramtypes",[Object,a["w"],Document,a["t"],u["a"],h["a"]])],m)},9828:function(t,e,n){"use strict";function s(t){return t}n.d(e,"a",(function(){return s}))},"98db":function(t,e,n){(function(t,e){
/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var n;(function(n){(function(t){var s="object"===typeof e?e:"object"===typeof self?self:"object"===typeof this?this:Function("return this;")(),r=i(n);function i(t,e){return function(n,s){"function"!==typeof t[n]&&Object.defineProperty(t,n,{configurable:!0,writable:!0,value:s}),e&&e(n,s)}}"undefined"===typeof s.Reflect?s.Reflect=n:r=i(s.Reflect,r),t(r)})((function(e){var n=Object.prototype.hasOwnProperty,s="function"===typeof Symbol,r=s&&"undefined"!==typeof Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",i=s&&"undefined"!==typeof Symbol.iterator?Symbol.iterator:"@@iterator",o="function"===typeof Object.create,a={__proto__:[]}instanceof Array,c=!o&&!a,h={create:o?function(){return it(Object.create(null))}:a?function(){return it({__proto__:null})}:function(){return it({})},has:c?function(t,e){return n.call(t,e)}:function(t,e){return e in t},get:c?function(t,e){return n.call(t,e)?t[e]:void 0}:function(t,e){return t[e]}},u=Object.getPrototypeOf(Function),d="object"===typeof t&&Object({NODE_ENV:"production",BASE_URL:"/"})&&"true"===Object({NODE_ENV:"production",BASE_URL:"/"})["REFLECT_METADATA_USE_MAP_POLYFILL"],l=d||"function"!==typeof Map||"function"!==typeof Map.prototype.entries?nt():Map,f=d||"function"!==typeof Set||"function"!==typeof Set.prototype.entries?st():Set,p=d||"function"!==typeof WeakMap?rt():WeakMap,g=new p;function m(t,e,n,s){if(P(n)){if(!q(t))throw new TypeError;if(!Y(e))throw new TypeError;return S(t,e)}if(!q(t))throw new TypeError;if(!B(e))throw new TypeError;if(!B(s)&&!P(s)&&!V(s))throw new TypeError;return V(s)&&(s=void 0),n=$(n),_(t,e,n,s)}function y(t,e){function n(n,s){if(!B(n))throw new TypeError;if(!P(s)&&!X(s))throw new TypeError;A(t,e,n,s)}return n}function b(t,e,n,s){if(!B(n))throw new TypeError;return P(s)||(s=$(s)),A(t,e,n,s)}function v(t,e,n){if(!B(e))throw new TypeError;return P(n)||(n=$(n)),M(t,e,n)}function x(t,e,n){if(!B(e))throw new TypeError;return P(n)||(n=$(n)),k(t,e,n)}function C(t,e,n){if(!B(e))throw new TypeError;return P(n)||(n=$(n)),F(t,e,n)}function w(t,e,n){if(!B(e))throw new TypeError;return P(n)||(n=$(n)),D(t,e,n)}function I(t,e){if(!B(t))throw new TypeError;return P(e)||(e=$(e)),R(t,e)}function E(t,e){if(!B(t))throw new TypeError;return P(e)||(e=$(e)),T(t,e)}function O(t,e,n){if(!B(e))throw new TypeError;P(n)||(n=$(n));var s=j(e,n,!1);if(P(s))return!1;if(!s.delete(t))return!1;if(s.size>0)return!0;var r=g.get(e);return r.delete(n),r.size>0||g.delete(e),!0}function S(t,e){for(var n=t.length-1;n>=0;--n){var s=t[n],r=s(e);if(!P(r)&&!V(r)){if(!Y(r))throw new TypeError;e=r}}return e}function _(t,e,n,s){for(var r=t.length-1;r>=0;--r){var i=t[r],o=i(e,n,s);if(!P(o)&&!V(o)){if(!B(o))throw new TypeError;s=o}}return s}function j(t,e,n){var s=g.get(t);if(P(s)){if(!n)return;s=new l,g.set(t,s)}var r=s.get(e);if(P(r)){if(!n)return;r=new l,s.set(e,r)}return r}function M(t,e,n){var s=k(t,e,n);if(s)return!0;var r=et(e);return!V(r)&&M(t,r,n)}function k(t,e,n){var s=j(e,n,!1);return!P(s)&&H(s.has(t))}function F(t,e,n){var s=k(t,e,n);if(s)return D(t,e,n);var r=et(e);return V(r)?void 0:F(t,r,n)}function D(t,e,n){var s=j(e,n,!1);if(!P(s))return s.get(t)}function A(t,e,n,s){var r=j(n,s,!0);r.set(t,e)}function R(t,e){var n=T(t,e),s=et(t);if(null===s)return n;var r=R(s,e);if(r.length<=0)return n;if(n.length<=0)return r;for(var i=new f,o=[],a=0,c=n;a<c.length;a++){var h=c[a],u=i.has(h);u||(i.add(h),o.push(h))}for(var d=0,l=r;d<l.length;d++){h=l[d],u=i.has(h);u||(i.add(h),o.push(h))}return o}function T(t,e){var n=[],s=j(t,e,!1);if(P(s))return n;var r=s.keys(),i=Z(r),o=0;while(1){var a=Q(i);if(!a)return n.length=o,n;var c=G(a);try{n[o]=c}catch(h){try{tt(i)}finally{throw h}}o++}}function N(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}function P(t){return void 0===t}function V(t){return null===t}function L(t){return"symbol"===typeof t}function B(t){return"object"===typeof t?null!==t:"function"===typeof t}function K(t,e){switch(N(t)){case 0:return t;case 1:return t;case 2:return t;case 3:return t;case 4:return t;case 5:return t}var n=3===e?"string":5===e?"number":"default",s=J(t,r);if(void 0!==s){var i=s.call(t,n);if(B(i))throw new TypeError;return i}return U(t,"default"===n?"number":n)}function U(t,e){if("string"===e){var n=t.toString;if(W(n)){var s=n.call(t);if(!B(s))return s}var r=t.valueOf;if(W(r)){s=r.call(t);if(!B(s))return s}}else{r=t.valueOf;if(W(r)){s=r.call(t);if(!B(s))return s}var i=t.toString;if(W(i)){s=i.call(t);if(!B(s))return s}}throw new TypeError}function H(t){return!!t}function z(t){return""+t}function $(t){var e=K(t,3);return L(e)?e:z(e)}function q(t){return Array.isArray?Array.isArray(t):t instanceof Object?t instanceof Array:"[object Array]"===Object.prototype.toString.call(t)}function W(t){return"function"===typeof t}function Y(t){return"function"===typeof t}function X(t){switch(N(t)){case 3:return!0;case 4:return!0;default:return!1}}function J(t,e){var n=t[e];if(void 0!==n&&null!==n){if(!W(n))throw new TypeError;return n}}function Z(t){var e=J(t,i);if(!W(e))throw new TypeError;var n=e.call(t);if(!B(n))throw new TypeError;return n}function G(t){return t.value}function Q(t){var e=t.next();return!e.done&&e}function tt(t){var e=t["return"];e&&e.call(t)}function et(t){var e=Object.getPrototypeOf(t);if("function"!==typeof t||t===u)return e;if(e!==u)return e;var n=t.prototype,s=n&&Object.getPrototypeOf(n);if(null==s||s===Object.prototype)return e;var r=s.constructor;return"function"!==typeof r||r===t?e:r}function nt(){var t={},e=[],n=function(){function t(t,e,n){this._index=0,this._keys=t,this._values=e,this._selector=n}return t.prototype["@@iterator"]=function(){return this},t.prototype[i]=function(){return this},t.prototype.next=function(){var t=this._index;if(t>=0&&t<this._keys.length){var n=this._selector(this._keys[t],this._values[t]);return t+1>=this._keys.length?(this._index=-1,this._keys=e,this._values=e):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},t.prototype.throw=function(t){throw this._index>=0&&(this._index=-1,this._keys=e,this._values=e),t},t.prototype.return=function(t){return this._index>=0&&(this._index=-1,this._keys=e,this._values=e),{value:t,done:!0}},t}();return function(){function e(){this._keys=[],this._values=[],this._cacheKey=t,this._cacheIndex=-2}return Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return this._find(t,!1)>=0},e.prototype.get=function(t){var e=this._find(t,!1);return e>=0?this._values[e]:void 0},e.prototype.set=function(t,e){var n=this._find(t,!0);return this._values[n]=e,this},e.prototype.delete=function(e){var n=this._find(e,!1);if(n>=0){for(var s=this._keys.length,r=n+1;r<s;r++)this._keys[r-1]=this._keys[r],this._values[r-1]=this._values[r];return this._keys.length--,this._values.length--,e===this._cacheKey&&(this._cacheKey=t,this._cacheIndex=-2),!0}return!1},e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=t,this._cacheIndex=-2},e.prototype.keys=function(){return new n(this._keys,this._values,s)},e.prototype.values=function(){return new n(this._keys,this._values,r)},e.prototype.entries=function(){return new n(this._keys,this._values,o)},e.prototype["@@iterator"]=function(){return this.entries()},e.prototype[i]=function(){return this.entries()},e.prototype._find=function(t,e){return this._cacheKey!==t&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=t)),this._cacheIndex<0&&e&&(this._cacheIndex=this._keys.length,this._keys.push(t),this._values.push(void 0)),this._cacheIndex},e}();function s(t,e){return t}function r(t,e){return e}function o(t,e){return[t,e]}}function st(){return function(){function t(){this._map=new l}return Object.defineProperty(t.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),t.prototype.has=function(t){return this._map.has(t)},t.prototype.add=function(t){return this._map.set(t,t),this},t.prototype.delete=function(t){return this._map.delete(t)},t.prototype.clear=function(){this._map.clear()},t.prototype.keys=function(){return this._map.keys()},t.prototype.values=function(){return this._map.values()},t.prototype.entries=function(){return this._map.entries()},t.prototype["@@iterator"]=function(){return this.keys()},t.prototype[i]=function(){return this.keys()},t}()}function rt(){var t=16,e=h.create(),s=r();return function(){function t(){this._key=r()}return t.prototype.has=function(t){var e=i(t,!1);return void 0!==e&&h.has(e,this._key)},t.prototype.get=function(t){var e=i(t,!1);return void 0!==e?h.get(e,this._key):void 0},t.prototype.set=function(t,e){var n=i(t,!0);return n[this._key]=e,this},t.prototype.delete=function(t){var e=i(t,!1);return void 0!==e&&delete e[this._key]},t.prototype.clear=function(){this._key=r()},t}();function r(){var t;do{t="@@WeakMap@@"+c()}while(h.has(e,t));return e[t]=!0,t}function i(t,e){if(!n.call(t,s)){if(!e)return;Object.defineProperty(t,s,{value:h.create()})}return t[s]}function o(t,e){for(var n=0;n<e;++n)t[n]=255*Math.random()|0;return t}function a(t){return"function"===typeof Uint8Array?"undefined"!==typeof crypto?crypto.getRandomValues(new Uint8Array(t)):"undefined"!==typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(t)):o(new Uint8Array(t),t):o(new Array(t),t)}function c(){var e=a(t);e[6]=79&e[6]|64,e[8]=191&e[8]|128;for(var n="",s=0;s<t;++s){var r=e[s];4!==s&&6!==s&&8!==s||(n+="-"),r<16&&(n+="0"),n+=r.toString(16).toLowerCase()}return n}}function it(t){return t.__=void 0,delete t.__,t}e("decorate",m),e("metadata",y),e("defineMetadata",b),e("hasMetadata",v),e("hasOwnMetadata",x),e("getMetadata",C),e("getOwnMetadata",w),e("getMetadataKeys",I),e("getOwnMetadataKeys",E),e("deleteMetadata",O)}))})(n||(n={}))}).call(this,n("4362"),n("c8ba"))},"9ab4":function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var s=function(t,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},s(t,e)};function r(t,e){function n(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}},"9e46":function(t,e,n){"use strict";function s(t){return t&&"function"===typeof t.schedule}n.d(e,"a",(function(){return s}))},a5ca:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var s=n("25dd"),r=n("fe69"),i=function(t,e,n,s){var r,i=arguments.length,o=i<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,n):s;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(t,e,n,s);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(i<3?r(o):i>3?r(e,n,o):r(e,n))||o);return i>3&&o&&Object.defineProperty(e,n,o),o};let o=class{constructor(){this.injectors=new Map}set(t,e){this.injectors.set(t,e)}get(t){return this.injectors.get(t)||new s["h"](null,[])}destroy(){this.injectors.forEach(t=>{var e,n,i,o;null===(n=null===(e=t.get(r["o"],null,s["b"].Self))||void 0===e?void 0:e.onDestroy)||void 0===n||n.call(e),null===(o=null===(i=t.get(r["g"],null,s["b"].Self))||void 0===i?void 0:i.onDestroy)||void 0===o||o.call(i)})}};o=i([Object(s["c"])()],o)},a6e8:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var s=n("8ac6"),r=n("31c4"),i=n("d817"),o=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}(),a=o,c=function(){function t(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return t.prototype.unsubscribe=function(){var e;if(!this.closed){var n=this,o=n._parentOrParents,c=n._ctorUnsubscribe,u=n._unsubscribe,d=n._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,o instanceof t)o.remove(this);else if(null!==o)for(var l=0;l<o.length;++l){var f=o[l];f.remove(this)}if(Object(i["a"])(u)){c&&(this._unsubscribe=void 0);try{u.call(this)}catch(m){e=m instanceof a?h(m.errors):[m]}}if(Object(s["a"])(d)){l=-1;var p=d.length;while(++l<p){var g=d[l];if(Object(r["a"])(g))try{g.unsubscribe()}catch(m){e=e||[],m instanceof a?e=e.concat(h(m.errors)):e.push(m)}}}if(e)throw new a(e)}},t.prototype.add=function(e){var n=e;if(!e)return t.EMPTY;switch(typeof e){case"function":n=new t(e);case"object":if(n===this||n.closed||"function"!==typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof t)){var s=n;n=new t,n._subscriptions=[s]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}var r=n._parentOrParents;if(null===r)n._parentOrParents=this;else if(r instanceof t){if(r===this)return n;n._parentOrParents=[r,this]}else{if(-1!==r.indexOf(this))return n;r.push(this)}var i=this._subscriptions;return null===i?this._subscriptions=[n]:i.push(n),n},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}},t.EMPTY=function(t){return t.closed=!0,t}(new t),t}();function h(t){return t.reduce((function(t,e){return t.concat(e instanceof a?e.errors:e)}),[])}},a748:function(t,e,n){"use strict";n.d(e,"a",(function(){return g}));var s=n("e9b9"),r=n("9e46"),i=n("9ab4"),o=n("ebb6"),a=n("d3fb"),c=n("cf86");function h(t,e,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"===typeof e?function(s){return s.pipe(h((function(n,s){return Object(a["a"])(t(n,s)).pipe(Object(o["a"])((function(t,r){return e(n,t,s,r)})))}),n))}:("number"===typeof e&&(n=e),function(e){return e.lift(new u(t,n))})}var u=function(){function t(t,e){void 0===e&&(e=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=e}return t.prototype.call=function(t,e){return e.subscribe(new d(t,this.project,this.concurrent))},t}(),d=function(t){function e(e,n,s){void 0===s&&(s=Number.POSITIVE_INFINITY);var r=t.call(this,e)||this;return r.project=n,r.concurrent=s,r.hasCompleted=!1,r.buffer=[],r.active=0,r.index=0,r}return i["a"](e,t),e.prototype._next=function(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)},e.prototype._tryNext=function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(s){return void this.destination.error(s)}this.active++,this._innerSub(e)},e.prototype._innerSub=function(t){var e=new c["a"](this),n=this.destination;n.add(e);var s=Object(c["c"])(t,e);s!==e&&n.add(s)},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyComplete=function(){var t=this.buffer;this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},e}(c["b"]),l=n("9828");function f(t){return void 0===t&&(t=Number.POSITIVE_INFINITY),h(l["a"],t)}var p=n("2144");function g(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Number.POSITIVE_INFINITY,i=null,o=t[t.length-1];return Object(r["a"])(o)?(i=t.pop(),t.length>1&&"number"===typeof t[t.length-1]&&(n=t.pop())):"number"===typeof o&&(n=t.pop()),null===i&&1===t.length&&t[0]instanceof s["a"]?t[0]:f(n)(Object(p["a"])(t,i))}},abfd:function(t,e,n){},c4cc:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var s=n("9ab4"),r=n("1453");function i(){}var o=n("d817");function a(t,e,n){return function(s){return s.lift(new c(t,e,n))}}var c=function(){function t(t,e,n){this.nextOrObserver=t,this.error=e,this.complete=n}return t.prototype.call=function(t,e){return e.subscribe(new h(t,this.nextOrObserver,this.error,this.complete))},t}(),h=function(t){function e(e,n,s,r){var a=t.call(this,e)||this;return a._tapNext=i,a._tapError=i,a._tapComplete=i,a._tapError=s||i,a._tapComplete=r||i,Object(o["a"])(n)?(a._context=a,a._tapNext=n):n&&(a._context=n,a._tapNext=n.next||i,a._tapError=n.error||i,a._tapComplete=n.complete||i),a}return s["a"](e,t),e.prototype._next=function(t){try{this._tapNext.call(this._context,t)}catch(e){return void this.destination.error(e)}this.destination.next(t)},e.prototype._error=function(t){try{this._tapError.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.error(t)},e.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(t){return void this.destination.error(t)}return this.destination.complete()},e}(r["a"])},c539:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var s=function(){return"function"===typeof Symbol&&Symbol.observable||"@@observable"}()},c628:function(t,e,n){"use strict";function s(t){return function(e){const n=new Error(e);return n.name=`[TextBusError: ${t}]`,n.stack=n.stack.replace(/\n.*?(?=\n)/,""),n}}n.d(e,"a",(function(){return s}))},cf86:function(t,e,n){"use strict";n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return c})),n.d(e,"c",(function(){return h}));var s=n("9ab4"),r=n("1453"),i=n("e9b9"),o=n("1716"),a=function(t){function e(e){var n=t.call(this)||this;return n.parent=e,n}return s["a"](e,t),e.prototype._next=function(t){this.parent.notifyNext(t)},e.prototype._error=function(t){this.parent.notifyError(t),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},e}(r["a"]),c=(r["a"],function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s["a"](e,t),e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyError=function(t){this.destination.error(t)},e.prototype.notifyComplete=function(){this.destination.complete()},e}(r["a"]));r["a"];function h(t,e){if(!e.closed){if(t instanceof i["a"])return t.subscribe(e);var n;try{n=Object(o["a"])(t)(e)}catch(s){e.error(s)}return n}}},d3fb:function(t,e,n){"use strict";n.d(e,"a",(function(){return y}));var s=n("e9b9"),r=n("1716"),i=n("a6e8"),o=n("c539");function a(t,e){return new s["a"]((function(n){var s=new i["a"];return s.add(e.schedule((function(){var r=t[o["a"]]();s.add(r.subscribe({next:function(t){s.add(e.schedule((function(){return n.next(t)})))},error:function(t){s.add(e.schedule((function(){return n.error(t)})))},complete:function(){s.add(e.schedule((function(){return n.complete()})))}}))}))),s}))}function c(t,e){return new s["a"]((function(n){var s=new i["a"];return s.add(e.schedule((function(){return t.then((function(t){s.add(e.schedule((function(){n.next(t),s.add(e.schedule((function(){return n.complete()})))})))}),(function(t){s.add(e.schedule((function(){return n.error(t)})))}))}))),s}))}var h=n("245f"),u=n("127f");function d(t,e){if(!t)throw new Error("Iterable cannot be null");return new s["a"]((function(n){var s,r=new i["a"];return r.add((function(){s&&"function"===typeof s.return&&s.return()})),r.add(e.schedule((function(){s=t[u["a"]](),r.add(e.schedule((function(){if(!n.closed){var t,e;try{var r=s.next();t=r.value,e=r.done}catch(i){return void n.error(i)}e?n.complete():(n.next(t),this.schedule())}})))}))),r}))}function l(t){return t&&"function"===typeof t[o["a"]]}var f=n("fd66"),p=n("d9e3");function g(t){return t&&"function"===typeof t[u["a"]]}function m(t,e){if(null!=t){if(l(t))return a(t,e);if(Object(f["a"])(t))return c(t,e);if(Object(p["a"])(t))return Object(h["a"])(t,e);if(g(t)||"string"===typeof t)return d(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}function y(t,e){return e?m(t,e):t instanceof s["a"]?t:new s["a"](Object(r["a"])(t))}},d817:function(t,e,n){"use strict";function s(t){return"function"===typeof t}n.d(e,"a",(function(){return s}))},d9e3:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var s=function(t){return t&&"number"===typeof t.length&&"function"!==typeof t}},e9a8:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var s=n("88bc"),r=n("0ca4"),i={closed:!0,next:function(t){},error:function(t){if(s["a"].useDeprecatedSynchronousErrorHandling)throw t;Object(r["a"])(t)},complete:function(){}}},e9b9:function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));var s=n("1453");function r(t){while(t){var e=t,n=e.closed,r=e.destination,i=e.isStopped;if(n||i)return!1;t=r&&r instanceof s["a"]?r:null}return!0}var i=n("2ff5"),o=n("e9a8");function a(t,e,n){if(t){if(t instanceof s["a"])return t;if(t[i["a"]])return t[i["a"]]()}return t||e||n?new s["a"](t,e,n):new s["a"](o["a"])}var c=n("c539"),h=n("9828");function u(t){return 0===t.length?h["a"]:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var d=n("88bc"),l=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var s=this.operator,r=a(t,e,n);if(s?r.add(s.call(r,this.source)):r.add(this.source||d["a"].useDeprecatedSynchronousErrorHandling&&!r.syncErrorThrowable?this._subscribe(r):this._trySubscribe(r)),d["a"].useDeprecatedSynchronousErrorHandling&&r.syncErrorThrowable&&(r.syncErrorThrowable=!1,r.syncErrorThrown))throw r.syncErrorValue;return r},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){d["a"].useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),r(t)?t.error(e):console.warn(e)}},t.prototype.forEach=function(t,e){var n=this;return e=f(e),new e((function(e,s){var r;r=n.subscribe((function(e){try{t(e)}catch(n){s(n),r&&r.unsubscribe()}}),s,e)}))},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[c["a"]]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?this:u(t)(this)},t.prototype.toPromise=function(t){var e=this;return t=f(t),new t((function(t,n){var s;e.subscribe((function(t){return s=t}),(function(t){return n(t)}),(function(){return t(s)}))}))},t.create=function(e){return new t(e)},t}();function f(t){if(t||(t=d["a"].Promise||Promise),!t)throw new Error("no Promise impl found");return t}},ebb6:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var s=n("9ab4"),r=n("1453");function i(t,e){return function(n){if("function"!==typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new o(t,e))}}var o=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new a(t,this.project,this.thisArg))},t}(),a=function(t){function e(e,n,s){var r=t.call(this,e)||this;return r.project=n,r.count=0,r.thisArg=s||r,r}return s["a"](e,t),e.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(n){return void this.destination.error(n)}this.destination.next(e)},e}(r["a"])},f20f:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var s=function(){function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t}(),r=s},f706:function(t,e,n){"use strict";n.d(e,"a",(function(){return s["a"]})),n.d(e,"b",(function(){return r}));var s=n("9237");const r={editor:{noUploader:" uploader ",copy:"",paste:"",cut:"",selectAll:"",input:{noAccessClipboard:""},controlPanel:{cancelFixed:"",fixed:""}},plugins:{},components:{}}},f836:function(t,e,n){"use strict";n.d(e,"d",(function(){return s})),n.d(e,"h",(function(){return r})),n.d(e,"i",(function(){return i})),n.d(e,"e",(function(){return y})),n.d(e,"f",(function(){return x})),n.d(e,"g",(function(){return I})),n.d(e,"a",(function(){return E})),n.d(e,"j",(function(){return L})),n.d(e,"b",(function(){return B})),n.d(e,"c",(function(){return f}));class s{constructor(){this.elementRef=r("div",{classes:["textbus-tab"],children:[this.head=r("div",{classes:["textbus-tab-head"],children:[this.btnWrapper=r("div",{classes:["textbus-tab-btn-wrapper"]})]}),this.viewContainer=r("div",{classes:["textbus-tab-view"]})]})}show(t){this.btnWrapper.innerHTML="",this.viewContainer.innerHTML="";const e=t.map((t,n)=>{const s=r("button",{classes:["textbus-tab-btn"],children:[i(t.label)]});return s.addEventListener("click",()=>{e.forEach(t=>t.classList.remove("textbus-tab-btn-active")),s.classList.add("textbus-tab-btn-active"),this.viewContainer.innerHTML="",this.viewContainer.appendChild(t.view)}),this.btnWrapper.appendChild(s),0===n&&(s.classList.add("textbus-tab-btn-active"),this.viewContainer.appendChild(t.view)),s})}}function r(t,e={}){const n=document.createElement(t);return e.classes&&n.classList.add(...e.classes),e.attrs&&Object.keys(e.attrs).forEach(t=>{n.setAttribute(t,e.attrs[t])}),e.props&&Object.keys(e.props).forEach(t=>{n[t]=e.props[t]}),e.children&&e.children.filter(t=>t).forEach(t=>{n.appendChild(t)}),e.onCreated&&e.onCreated(n),n}function i(t){return document.createTextNode(t)}var o=n("25dd"),a=n("20d3"),c=n("2bd2"),h=n("ebb6");const u='\n<!DOCTYPE html>\n<html lang="zh">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport"\n        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">\n  <meta http-equiv="X-UA-Compatible" content="ie=edge">\n  <title>@tanbo/textbus</title>\n  <style>\n    html {\n      height: 100%\n    }\n    body {\n      padding: 0 8px;\n      margin: 0;\n      min-height: 100%;\n      box-sizing: border-box;\n      text-size-adjust: none;\n      cursor: text;\n      text-rendering: optimizeLegibility;\n      -webkit-font-smoothing: antialiased;\n    }\n    ::selection {\n      background-color: rgba(18, 150, 219, .2);\n    }\n    [textbus-editable=off] > * {\n      user-select: none;\n      cursor: default;\n    }\n    [textbus-editable=on] {\n      user-select: text;\n      cursor: text;\n    }\n  </style>\n</head>\n<body></body>\n</html>\n'.replace(/\n/g,"").replace(/\s+/g," ").replace(/'/g,"\\'");var d=function(t,e,n,s){var r,i=arguments.length,o=i<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,n):s;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(t,e,n,s);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(i<3?r(o):i>3?r(e,n,o):r(e,n))||o);return i>3&&o&&Object.defineProperty(e,n,o),o},l=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)};let f=class{constructor(t){this.editorController=t,this._topBar=r("div",{classes:["textbus-ui-top"]}),this._bottomBar=r("div",{classes:["textbus-ui-bottom","textbus-status-bar"]}),this.isAppendTop=!1,this.isAppendBottom=!1,this.onReadyEvent=new c["a"],this.subs=[],this.onReady=this.onReadyEvent.asObservable(),this.iframe=this.createEditableFrame();const e=t=>{"complete"===t.data&&this.iframe.contentDocument&&(window.removeEventListener("message",e),this.onReadyEvent.next(this.iframe.contentDocument),this.ready())};window.addEventListener("message",e),this.container=r("div",{classes:["textbus-container"],children:[this.workbench=r("div",{classes:["textbus-ui-workbench"],children:[this.dashboard=r("div",{classes:["textbus-ui-dashboard"],children:[this.leftContainer=r("div",{classes:["textbus-ui-left"]}),this.viewer=r("div",{classes:["textbus-ui-viewer"],children:[this.scroller=r("div",{classes:["textbus-ui-scroll"],children:[this.pageContainer=r("div",{classes:["textbus-ui-page"],children:[this.docContainer=r("div",{classes:["textbus-ui-doc"],children:[this.iframe]})]}),this.loading=r("div",{classes:["textbus-loading"],props:{innerHTML:"TextBus".split("").map(t=>`<div>${t}</div>`).join("")}})]})]}),this.rightContainer=r("div",{classes:["textbus-ui-right"]})]})]})]}),this.subs.push(this.editorController.onStateChange.pipe(Object(h["a"])(t=>t.readonly)).subscribe(t=>{t?this.container.classList.add("textbus-readonly"):this.container.classList.remove("textbus-readonly")}))}get topBar(){return this.isAppendTop||(this.container.prepend(this._topBar),this.isAppendTop=!0),this._topBar}get bottomBar(){return this.isAppendBottom||(this.container.append(this._bottomBar),this.isAppendBottom=!0),this._bottomBar}setTheme(t){this.container.classList.add("textbus-theme-"+t)}destroy(){this.subs.forEach(t=>t.unsubscribe())}ready(){this.loading.classList.add("textbus-loading-done"),this.pageContainer.classList.add("textbus-ui-page-ready"),setTimeout(()=>{this.scroller.removeChild(this.loading)},300)}createEditableFrame(){return r("iframe",{attrs:{src:`javascript:void(\n      (function () {\n        document.open();\n        if('${document.domain}') {\n          document.domain='${document.domain}';\n        }\n        document.write('${u}');\n        document.close();\n        window.parent.postMessage('complete','${document.domain?location.origin:"*"}');\n      })()\n      )`,scrolling:"no"},classes:["textbus-frame"]})}};f=d([Object(o["c"])(),l("design:paramtypes",[a["a"]])],f);var p=n("9237"),g=function(t,e,n,s){var r,i=arguments.length,o=i<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,n):s;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(t,e,n,s);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(i<3?r(o):i>3?r(e,n,o):r(e,n))||o);return i>3&&o&&Object.defineProperty(e,n,o),o},m=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)};let y=class{constructor(t,e,n){this.editorController=t,this.i18n=e,this.layout=n,this._fixed=!1,this.subs=[],this.oldViews=[],this.tab=new s}set fixed(t){this._fixed=t,t?(this.layout.dashboard.insertBefore(this.elementRef,this.layout.rightContainer),this.elementRef.classList.add("textbus-control-panel-fixed"),this.fixedBtn.classList.add("textbus-control-panel-fixed-btn-active"),this.fixedBtn.title=this.i18n.get("editor.controlPanel.cancelFixed")):(this.layout.viewer.append(this.elementRef),this.elementRef.classList.remove("textbus-control-panel-fixed"),this.fixedBtn.classList.remove("textbus-control-panel-fixed-btn-active"),this.fixedBtn.title=this.i18n.get("editor.controlPanel.fixed"))}get fixed(){return this._fixed}setup(){this.elementRef=r("div",{classes:["textbus-control-panel"],children:[this.container=r("div",{classes:["textbus-control-panel-container"],children:[this.tab.elementRef]})]}),this.fixedBtn=r("button",{attrs:{type:"button",title:this.i18n.get("editor.controlPanel.fixed")},classes:["textbus-control-panel-fixed-btn"],children:[r("span",{classes:["textbus-icon-pushpin"]})]}),this.fixedBtn.addEventListener("click",()=>{this.fixed=!this.fixed}),this.tab.head.insertBefore(this.fixedBtn,this.tab.head.children[0]),this.subs.push(this.editorController.onStateChange.subscribe(t=>{t.readonly&&(this.fixed=!1)})),this.fixed=!1}showPanels(t){if(this.oldViews.forEach(t=>{var e;null===(e=t.onDestroy)||void 0===e||e.call(t)}),this.oldViews=t,0===t.length)return this.tab.show([]),void this.elementRef.classList.remove("textbus-control-panel-show");this.elementRef.classList.add("textbus-control-panel-show");const e=t.map(t=>({label:t.title,view:t.view}));this.tab.show(e)}onDestroy(){this.subs.forEach(t=>t.unsubscribe())}};y=g([Object(o["c"])(),m("design:paramtypes",[a["a"],p["a"],f])],y);var b=function(t,e,n,s){var r,i=arguments.length,o=i<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,n):s;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(t,e,n,s);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(i<3?r(o):i>3?r(e,n,o):r(e,n))||o);return i>3&&o&&Object.defineProperty(e,n,o),o},v=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)};let x=class{constructor(t,e){this.layout=t,this.editorController=e,this.timer=null,this.subs=[]}setup(){this.elementRef=r("div",{classes:["textbus-dialog"],children:[this.dialogWrapper=r("div",{classes:["textbus-dialog-wrapper"]})]}),this.layout.workbench.appendChild(this.elementRef),this.subs.push(this.editorController.onStateChange.subscribe(t=>{(t.readonly||t.sourcecodeMode)&&this.close()}))}dialog(t){this.dialogWrapper.innerHTML="",this.dialogWrapper.appendChild(t),this.elementRef.classList.add("textbus-dialog-active"),this.timer=setTimeout(()=>{this.dialogWrapper.classList.add("textbus-dialog-wrapper-active")},200)}close(){this.dialogWrapper.classList.remove("textbus-dialog-wrapper-active"),this.timer=setTimeout(()=>{this.elementRef.classList.remove("textbus-dialog-active"),this.dialogWrapper.innerHTML=""},200)}onDestroy(){clearTimeout(this.timer),this.subs.forEach(t=>t.unsubscribe())}};x=b([Object(o["c"])(),v("design:paramtypes",[f,a["a"]])],x);var C=function(t,e,n,s){var r,i=arguments.length,o=i<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,n):s;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(t,e,n,s);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(i<3?r(o):i>3?r(e,n,o):r(e,n))||o);return i>3&&o&&Object.defineProperty(e,n,o),o},w=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)};let I=class{constructor(t){this.layout=t}setup(){this.messageBox=r("div",{classes:["textbus-message"]}),this.layout.workbench.append(this.messageBox)}message(t,e){this.createMessage("message",t,e)}info(t,e){this.createMessage("info",t,e)}success(t,e){this.createMessage("success",t,e)}warning(t,e){this.createMessage("warning",t,e)}danger(t,e){this.createMessage("danger",t,e)}createMessage(t,e,n=3e3){const s=r("div",{classes:["textbus-message-item","textbus-message-item-"+t],children:[i(e)]});this.messageBox.append(s),setTimeout(()=>{s.remove()},n)}};I=C([Object(o["c"])(),w("design:paramtypes",[f])],I);class E{}var O=n("6e77"),S=n("9ab4"),_=n("1453");function j(t,e){return function(n){return n.lift(new M(t,e))}}var M=function(){function t(t,e){this.predicate=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new k(t,this.predicate,this.thisArg))},t}(),k=function(t){function e(e,n,s){var r=t.call(this,e)||this;return r.predicate=n,r.thisArg=s,r.count=0,r}return S["a"](e,t),e.prototype._next=function(t){var e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(n){return void this.destination.error(n)}e&&this.destination.next(t)},e}(_["a"]),F=n("fe69"),D=n("8679"),A=n("94cc"),R=n("a5ca"),T=function(t,e,n,s){var r,i=arguments.length,o=i<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,n):s;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(t,e,n,s);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(i<3?r(o):i>3?r(e,n,o):r(e,n))||o);return i>3&&o&&Object.defineProperty(e,n,o),o},N=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)},P=function(t,e){return function(n,s){e(n,s,t)}};const V=/win(dows|32|64)/i.test(navigator.userAgent),L=/mac os/i.test(navigator.userAgent);let B=class{constructor(t,e,n,s,r,i,o,a,c,u,d){this.context=t,this.layout=e,this.controlPanel=n,this.i18n=s,this.editorController=r,this.componentInjectors=i,this.renderer=o,this.message=a,this.parser=c,this.selection=u,this.history=d,this._readonly=!1,this.pasteMiddlewares=[],this.markdownMatchers=[],this.input=document.createElement("textarea"),this.keymaps=[],this.elementRef=document.createElement("div"),this.cursor=document.createElement("span"),this.inputWrap=document.createElement("span"),this.timer=null,this._display=!0,this.flashing=!0,this.subs=[],this.customContextmenuActions=[],this.prevComponent=null,this.contextmenu=new K(this.history),this.layout.docContainer.append(this.elementRef),this.elementRef.classList.add("textbus-selection"),this.cursor.classList.add("textbus-cursor"),this.inputWrap.classList.add("textbus-input-wrap"),this.input.classList.add("textbus-input"),this.inputWrap.appendChild(this.input),this.elementRef.appendChild(this.inputWrap),this.elementRef.appendChild(this.cursor),this.init(),this.initEvent(),this.bindDefaultKeymap(),this.subs.push(d.onUsed.subscribe(()=>{this.dispatchInputReadyEvent()})),this.subs.push(r.onStateChange.pipe(Object(h["a"])(t=>t.readonly)).subscribe(t=>{this.readonly=t}))}get value(){return this.input.value}get selectionStart(){return this.input.selectionStart}set readonly(t){this._readonly=t,this.hide(),this.input.disabled=t}get readonly(){return this._readonly}set display(t){this._display=t,this.cursor.style.visibility=t?"visible":"hidden"}get display(){return this._display}addPasteMiddleware(t){this.pasteMiddlewares.push(t)}addContextMenus(t){this.customContextmenuActions.push(t)}addMarkdownSupport(t){this.markdownMatchers.unshift(t)}addKeymap(t){this.keymaps.unshift(t)}destroy(){this.contextmenu.destroy(),this.subs.forEach(t=>t.unsubscribe())}updateStateBySelection(){if(!this.readonly&&this.selection.rangeCount){if(this.selection.collapsed){const t=this.selection.firstRange.nativeRange.startContainer,e=this.renderer.getPositionByNode(t);if(!e||e&&t.nodeType===Node.ELEMENT_NODE&&0===t.childNodes.length)return void this.hide()}this.updateCursorPosition(),this.selection.collapsed?this.show():this.hide(),this.input.focus()}else this.hide()}updateCursorPosition(){const t=this.selection.firstRange.nativeRange.startContainer,e=t.nodeType===Node.ELEMENT_NODE?t:t.parentNode;if((null===e||void 0===e?void 0:e.nodeType)!==Node.ELEMENT_NODE)return;const n=this.selection.firstRange.getRangePosition(),{fontSize:s,lineHeight:r,color:i}=getComputedStyle(e);let o;if(V&&(this.inputWrap.style.top=s),isNaN(+r)){const t=parseFloat(r);o=isNaN(t)?parseFloat(s):t}else o=parseFloat(s)*parseFloat(r);const a=Math.max(o,n.height);let c=n.top;if(n.height<o&&(c-=(o-n.height)/2),this.elementRef.style.left=n.left+"px",this.elementRef.style.top=c+"px",this.elementRef.style.height=a+"px",this.cursor.style.backgroundColor=i,this.input.style.lineHeight=a+"px",this.input.style.fontSize=s,this.selection.collapsed&&1===this.selection.rangeCount){const t=this.layout.scroller,e=t.scrollTop,n=t.offsetHeight,s=parseInt(getComputedStyle(t).paddingTop)||0,r=c+a+s+5,i=e+n;r>i?t.scrollTop=r-n:c<e&&(t.scrollTop=c)}}init(){let t=!1;this.subs.push(Object(O["a"])(this.context,"mousedown").subscribe(t=>{2!==t.button&&(this.contextmenu.hide(),this.selection.removeAllRanges(!0))}),Object(O["a"])(this.context,"contextmenu").pipe(j(()=>!this.readonly)).subscribe(t=>{const e=this.context.getSelection(),n=e.focusNode,s=e.focusOffset,r=e.isCollapsed;setTimeout(()=>{r&&(e.isCollapsed||e.collapse(n,s))});const i=this.layout.docContainer.getBoundingClientRect();this.contextmenu.show([[{iconClasses:["textbus-icon-copy"],label:this.i18n.get("editor.copy"),disabled:this.selection.collapsed,action:()=>{this.copy()}},{iconClasses:["textbus-icon-paste"],label:this.i18n.get("editor.paste"),action:()=>{this.paste()}},{iconClasses:["textbus-icon-cut"],label:this.i18n.get("editor.cut"),disabled:this.selection.collapsed,action:()=>{this.cut(),this.history.record()}},{iconClasses:["textbus-icon-select"],label:this.i18n.get("editor.selectAll"),action:()=>{this.selection.selectAll()}}],...this.makeContextmenu(),...this.customContextmenuActions],t.pageX+i.x,t.pageY+i.y),t.preventDefault()}),Object(O["a"])(this.input,"compositionstart").pipe(j(()=>!this.readonly)).subscribe(()=>{t=!0}),Object(O["a"])(this.input,"compositionend").pipe(j(()=>!this.readonly)).subscribe(()=>{t=!1}),Object(O["a"])(this.input,"keydown").pipe(j(()=>!this.readonly)).pipe(j(()=>!t||!this.input.value)).subscribe(t=>{const e=/\w+/.test(t.key)?new RegExp(`^${t.key}$`,"i"):new RegExp(`^[${t.key.replace(/([-\\])/g,"\\$1")}]$`,"i");if(this.editorController.supportMarkdown&&!(L?t.metaKey:t.ctrlKey)&&!t.shiftKey&&!t.altKey)for(const r of this.markdownMatchers){const n=Array.isArray(r.key)?r.key.some(t=>e.test(t)):e.test(r.key);if(n){const e=this.selection.commonAncestorFragment,n=e.sliceContents(),s=n[0];if(n.length>2||"string"!==typeof s)continue;if(n[1]&&!(n[1]instanceof F["d"]))continue;let i=!1;if(r.match instanceof RegExp?i=r.match.test(s):"function"===typeof r.match&&(i=r.match(s)),i){const n=r.componentFactory(s);if(!(n instanceof F["a"]))continue;const i=e.parentComponent,o=this.selection.firstRange;if(n instanceof F["h"])o.setPosition(n.slot,0);else if(n instanceof F["e"])o.setPosition(n.slots[0],0);else{if(!(n instanceof F["b"]))return e.clean(),e.append(n),o.setPosition(e,1),this.dispatchInputReadyEvent(),void t.preventDefault();o.setPosition(n.getSlotAtIndex(0),0)}if(i){const t=i.parentFragment;if(i instanceof F["h"]){const e=t.indexOf(i);t.remove(e,e+1),t.insert(n,e),this.dispatchInputReadyEvent()}else e.clean(),e.append(n),this.dispatchInputReadyEvent()}else e.clean(),e.append(n),this.dispatchInputReadyEvent();return void t.preventDefault()}}}let n=!1;const s=s=>{for(const r of s){const s=Array.isArray(r.keymap.key)?r.keymap.key.map(t=>e.test(t)).includes(!0):e.test(r.keymap.key);if(s&&!!r.keymap.altKey===t.altKey&&!!r.keymap.shiftKey===t.shiftKey&&!!r.keymap.ctrlKey===(L?t.metaKey:t.ctrlKey)){n=!0,this.dispatchInputReadyEvent(),r.action(t),this.dispatchInputReadyEvent();break}}};if(this.dispatchEvent((t,e)=>{const r=t.get(F["i"],null,o["b"].Self);if(r){const t=r.provide(e);if(s(t),n)return!1}return!0}),n||s(this.keymaps),n)return t.preventDefault(),!1}),Object(O["a"])(this.context,"mousedown").subscribe(()=>{this.flashing=!1}),Object(O["a"])(this.context,"mouseup").subscribe(()=>{this.flashing=!0}),this.selection.onChange.pipe(j(()=>!this.readonly)).subscribe(()=>{this.updateStateBySelection(),this.dispatchComponentPresetEvent()}))}makeContextmenu(){var t,e;let n=this.selection.commonAncestorComponent;if(!n)return[];const s=[];while(n){const r=this.componentInjectors.get(n.constructor),i=r.get(F["o"],null,o["b"].Self),a=null===(t=null===i||void 0===i?void 0:i.onContextmenu)||void 0===t?void 0:t.call(i,n);a&&s.push(a),n=null===(e=n.parentFragment)||void 0===e?void 0:e.parentComponent}return s}initEvent(){this.subs.push(Object(O["a"])(this.input,"blur").subscribe(()=>{this.hide()}),Object(O["a"])(this.input,"focus").pipe(j(()=>!this.readonly)).subscribe(()=>{this.dispatchInputReadyEvent()}),Object(O["a"])(this.input,"input").pipe(j(()=>!this.readonly)).subscribe(()=>{this.dispatchInputEvent()}),Object(O["a"])(this.input,"paste").pipe(j(()=>!this.readonly)).subscribe(t=>{const e=t.clipboardData.getData("Text"),n=document.createElement("div");n.style.cssText="width:10px; height:10px; overflow: hidden; position: fixed; left: -9999px";const s=Array.from(t.clipboardData.files);s.length?Promise.all(s.filter(t=>/image/i.test(t.type)).map(t=>{const e=new FileReader;return new Promise(n=>{e.onload=t=>{n(t.target.result)},e.readAsDataURL(t)})})).then(t=>{n.innerHTML=t.map(t=>`<img src=${t}>`).join(""),this.handlePaste(n,e)}):(n.contentEditable="true",document.body.appendChild(n),n.focus(),setTimeout(()=>{let t=n.innerHTML,s=!0;const r=/<(?!(?:td|th))(\w+)[^>]*?>\s*?<\/\1>/g;while(s)s=!1,t=t.replace(r,(function(){return s=!0,""}));n.innerHTML=t,this.handlePaste(n,e),document.body.removeChild(n)}))}),Object(O["a"])(this.input,"copy").pipe(j(()=>!this.readonly)).subscribe(()=>{this.copy()}),Object(O["a"])(this.input,"cut").pipe(j(()=>!this.readonly)).subscribe(()=>{this.cut(),this.history.record()}))}bindDefaultKeymap(){this.addKeymap({keymap:{key:"Tab"},action:()=>{this.input.value="    ",this.dispatchInputEvent()}}),this.addKeymap({keymap:{key:["Backspace","Delete"]},action:()=>{this.selection.collapsed?this.dispatchEvent((t,e)=>{var n;const s=new F["u"](e),r=t.get(F["o"],null,o["b"].Self);return r&&(null===(n=r.onDelete)||void 0===n||n.call(r,s)),!s.stopped}):this.dispatchEvent((t,e)=>{var n;const s=new F["u"](e),r=t.get(F["o"],null,o["b"].Self);return r&&(null===(n=r.onDeleteRange)||void 0===n||n.call(r,s)),!s.stopped}),this.dispatchInputReadyEvent()}}),this.addKeymap({keymap:{key:"Enter"},action:()=>{this.selection.collapsed||this.dispatchEvent((t,e)=>{var n;const s=new F["u"](e),r=t.get(F["o"],null,o["b"].Self);return r&&(null===(n=r.onDeleteRange)||void 0===n||n.call(r,s)),!s.stopped}),this.selection.collapsed&&this.dispatchEvent((t,e)=>{var n;const s=new F["u"](e),r=t.get(F["o"],null,o["b"].Self);return r&&(null===(n=r.onEnter)||void 0===n||n.call(r,s)),!s.stopped}),this.dispatchInputReadyEvent()}}),this.addKeymap({keymap:{key:"a",ctrlKey:!0},action:()=>{this.selection.selectAll()}}),this.addKeymap({keymap:{key:["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"]},action:t=>{switch(t.key){case"ArrowLeft":this.selection.toPrevious();break;case"ArrowRight":this.selection.toNext();break;case"ArrowUp":this.selection.toPreviousLine();break;case"ArrowDown":this.selection.toNextLine();break}this.dispatchInputReadyEvent()}}),this.addKeymap({keymap:{key:"z",ctrlKey:!0},action:()=>{this.history.back()}}),this.addKeymap({keymap:{key:"y",ctrlKey:!0},action:()=>{this.history.forward()}}),this.addKeymap({keymap:{key:"Home"},action:()=>{let t=this.selection.firstRange.getRangePosition();while(1){this.selection.toPrevious();const e=this.selection.firstRange.getRangePosition();if(Math.abs(t.bottom-e.bottom)>5){this.selection.toNext();break}if(e.left===t.left&&e.top===t.top)break;t=e}}}),this.addKeymap({keymap:{key:"End"},action:()=>{let t=this.selection.firstRange.getRangePosition();while(1){this.selection.toNext();const e=this.selection.firstRange.getRangePosition();if(Math.abs(t.bottom-e.bottom)>5){this.selection.toPrevious();break}if(t.left===e.left&&t.top===e.top)break;t=e}}})}dispatchInputEvent(){this.selection.collapsed||(this.dispatchEvent((t,e)=>{var n;const s=new F["u"](e),r=t.get(F["o"],null,o["b"].Self);return r&&(null===(n=r.onDeleteRange)||void 0===n||n.call(r,s)),!s.stopped}),this.dispatchInputReadyEvent(!0)),this.selection.collapsed&&this.dispatchEvent((t,e)=>{var n;const s=new F["u"](e),r=t.get(F["o"],null,o["b"].Self);return r&&(null===(n=r.onInput)||void 0===n||n.call(r,s)),!s.stopped})}dispatchComponentPresetEvent(){var t;let e=this.selection.commonAncestorComponent;if(!e)return void this.controlPanel.showPanels([]);const n=[],s=t=>{const e=this.componentInjectors.get(t.constructor),n=e.get(F["g"],null,o["b"].Self);return n?n.create(t):null};if(this.selection.collapsed){const t=this.selection.firstRange,n=t.startFragment.getContentAtIndex(t.startIndex-1);n instanceof F["p"]&&(e=n)}if(e!==this.prevComponent){this.prevComponent=e;while(e){const r=s(e);r&&n.push(r),e=null===(t=e.parentFragment)||void 0===t?void 0:t.parentComponent}this.controlPanel.showPanels(n)}}dispatchInputReadyEvent(t=!1){t||(this.input.value=""),this.selection.collapsed&&1===this.selection.rangeCount&&this.dispatchEvent((t,e)=>{var n;const s=new F["u"](e),r=t.get(F["o"],null,o["b"].Self);return r&&(null===(n=r.onInputReady)||void 0===n||n.call(r,s)),!s.stopped})}handlePaste(t,e){const n=t=>{let n=this.parser.parse(t);const s=n.getContentAtIndex(0);1===n.length&&s instanceof F["h"]&&(n=s.slot),this.selection.collapsed||this.dispatchEvent((t,e)=>{var n;const s=new F["u"](e),r=t.get(F["o"],null,o["b"].Self);return r&&(null===(n=r.onDeleteRange)||void 0===n||n.call(r,s)),!s.stopped}),this.selection.collapsed&&this.dispatchEvent((t,s)=>{var r;const i=new F["u"](s,{fragment:n,text:e}),a=t.get(F["o"],null,o["b"].Self);return a&&(null===(r=a.onPaste)||void 0===r||r.call(a,i)),!i.stopped}),this.dispatchInputReadyEvent()};if(!this.pasteMiddlewares.length)return n(t),void this.history.record();this.pasteMiddlewares.reduce((t,e)=>t.then(t=>e(t)),Promise.resolve(t)).then(t=>{n(t),this.history.record()})}dispatchEvent(t){var e;let n=this.selection.commonAncestorComponent;while(n){const s=this.componentInjectors.get(n.constructor);if(!t(s,n))break;n=null===(e=n.parentFragment)||void 0===e?void 0:e.parentComponent}}paste(){navigator.permissions.query({name:"clipboard-write"}).then(t=>{"granted"===t.state?navigator.clipboard.read().then(t=>{const e=t[0];e.types.filter(t=>"text/html"===t).forEach(t=>{e.getType(t).then(t=>t.text()).then(t=>{const e=document.createElement("div");e.innerHTML=t,this.handlePaste(e,e.innerText),this.history.record()})})}):this.message.danger(this.i18n.get("editor.input.noAccessClipboard"))})}cut(){this.context.execCommand("copy"),this.selection.ranges.forEach(t=>{t.deleteRange()}),this.dispatchInputReadyEvent()}copy(){this.context.execCommand("copy")}show(){this.display=!0,clearTimeout(this.timer);const t=()=>{this.display=!this.display||!this.flashing,this.timer=setTimeout(t,400)};this.timer=setTimeout(t,400)}hide(){this.display=!1,clearTimeout(this.timer)}};B=T([Object(o["c"])(),P(0,Object(o["a"])(D["a"])),N("design:paramtypes",[Document,f,y,p["a"],a["a"],R["a"],F["t"],I,F["s"],F["w"],A["a"]])],B);class K{constructor(t){this.history=t,this.eventFromSelf=!1,this.subs=[],this.elementRef=r("div",{classes:["textbus-contextmenu"],children:[r("div",{classes:["textbus-contextmenu-container"],children:[this.groups=r("div",{classes:["textbus-contextmenu-groups"]})]})]}),this.elementRef.addEventListener("click",()=>{this.hide()}),this.elementRef.addEventListener("contextmenu",t=>t.preventDefault())}hide(){var t;this.subs.forEach(t=>t.unsubscribe()),this.subs=[],null===(t=this.elementRef.parentNode)||void 0===t||t.removeChild(this.elementRef)}show(t,e,n){this.subs.push(Object(O["a"])(document,"mousedown").subscribe(()=>{this.eventFromSelf||this.hide()}),Object(O["a"])(window,"resize").subscribe(()=>{s()})),this.groups.innerHTML="";const s=()=>{const t=document.documentElement.clientWidth,s=document.documentElement.clientHeight;e+a>=t&&(e-=a),n+c>=s-20&&(n=s-c-20),n<20&&(n=20),Object.assign(this.elementRef.style,{left:e+"px",top:n+"px"}),this.elementRef.style.maxHeight=s-n-20+"px"};let o=0;t.forEach(t=>{o+=t.length,0!==t.length&&this.groups.appendChild(r("div",{classes:["textbus-contextmenu-group"],children:t.map(t=>{const e=r("button",{attrs:{type:"button"},props:{disabled:t.disabled},classes:["textbus-contextmenu-item"],children:[r("span",{classes:["textbus-contextmenu-item-icon"],children:[r("span",{classes:t.iconClasses?t.iconClasses:[]})]}),r("span",{classes:["textbus-contextmenu-item-label"],children:[i(t.label)]})]});return t.disabled||(e.addEventListener("mousedown",()=>{this.eventFromSelf=!0}),e.addEventListener("click",()=>{t.action(),!1!==t.autoRecordingHistory&&this.history.record(),this.eventFromSelf=!1})),e})}))});const a=190,c=26*o+10*t.length+t.length+10;s(),document.body.appendChild(this.elementRef)}destroy(){this.hide()}}},fad2:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var s=function(t){return function(e){for(var n=0,s=t.length;n<s&&!e.closed;n++)e.next(t[n]);e.complete()}}},fd66:function(t,e,n){"use strict";function s(t){return!!t&&"function"!==typeof t.subscribe&&"function"===typeof t.then}n.d(e,"a",(function(){return s}))},fe69:function(t,e,n){"use strict";n.d(e,"f",(function(){return r})),n.d(e,"g",(function(){return i})),n.d(e,"i",(function(){return o})),n.d(e,"u",(function(){return a})),n.d(e,"o",(function(){return c})),n.d(e,"q",(function(){return h})),n.d(e,"a",(function(){return T})),n.d(e,"h",(function(){return N})),n.d(e,"e",(function(){return P})),n.d(e,"b",(function(){return V})),n.d(e,"p",(function(){return L})),n.d(e,"d",(function(){return K})),n.d(e,"y",(function(){return _})),n.d(e,"x",(function(){return M})),n.d(e,"j",(function(){return d})),n.d(e,"k",(function(){return l})),n.d(e,"l",(function(){return f})),n.d(e,"n",(function(){return g})),n.d(e,"c",(function(){return m})),n.d(e,"m",(function(){return E})),n.d(e,"r",(function(){return X})),n.d(e,"s",(function(){return J})),n.d(e,"v",(function(){return Z})),n.d(e,"t",(function(){return z})),n.d(e,"w",(function(){return nt}));var s=n("25dd");const r=function t(e){if(!(this instanceof t))return Object(s["k"])(t,e)};class i{}class o{}class a{constructor(t,e=null){this.instance=t,this.data=e,this._stopped=!1}get stopped(){return this._stopped}stopPropagation(){this._stopped=!0}}class c{}class h{}class u{constructor(){this.elements=[]}get length(){return this.elements.reduce((t,e)=>t+e.length,0)}append(t){if(""===t)return;const e=this.elements.length-1,n=this.elements[e];"string"===typeof n&&"string"===typeof t?this.elements[e]=n+t:this.elements.push(t)}slice(t,e=this.length){if(t>=e)return[];let n=0;const s=[];for(const r of this.elements){const i=n,o=n+r.length;if(n+=r.length,t<o&&e>i)if("string"===typeof r){const n=Math.max(0,t-i),a=Math.min(o,e)-i;s.push(r.slice(n,a))}else s.push(r)}return s}indexOf(t){let e=0;for(const n of this.elements){if(n===t)return e;e+=n.length}return-1}insert(t,e){if(""===t)return;if(e>=this.length)return void this.append(t);let n=0,s=0;for(const r of this.elements){if(e>=n){if(r instanceof T&&e===n){const e=this.elements[s-1];"string"===typeof e&&"string"===typeof t?this.elements[s-1]=e+t:0===n?this.elements.unshift(t):this.elements.splice(s,0,t);break}if("string"===typeof r&&e>=n&&e<n+r.length){const i=[r.slice(0,e-n),t,r.slice(e-n)].filter(t=>t);t instanceof T?this.elements.splice(s,1,...i):this.elements.splice(s,1,i.join(""));break}}s++,n+=r.length}}cut(t,e){if(e<=t)return[];const n=this.slice(t,e),s=this.slice(0,t).concat(this.slice(e,this.length));return this.elements=[],s.forEach(t=>this.append(t)),n.map(t=>(t instanceof T&&(t[R]=null),t))}getContentAtIndex(t){return this.slice(t,t+1)[0]}clone(){const t=new u;return this.elements.forEach(e=>{if("string"===typeof e)t.append(e);else{const n=e.clone();n[R]=null,t.append(n)}}),t}}class d{constructor(t={}){this.attrs=new Map,this.styles=new Map,this.classes=[],this.tag=t.tag,t.attrs&&(t.attrs instanceof Map?this.attrs=t.attrs:(this.attrs=new Map,Object.keys(t.attrs).forEach(e=>{this.attrs.set(e,t.attrs[e])}))),t.styles&&(t.styles instanceof Map?this.styles=t.styles:(this.styles=new Map,Object.keys(t.styles).forEach(e=>{this.styles.set(e,t.styles[e])}))),t.classes&&(this.classes=[...t.classes])}clone(){return new d({tag:this.tag,attrs:this.attrs.size?(()=>{const t={};return this.attrs.forEach((e,n)=>{t[n]=e}),t})():null,styles:this.styles.size?(()=>{const t={};return this.styles.forEach((e,n)=>{t[n]=e}),t})():null,classes:this.classes})}equal(t){if(t===this)return!0;if(!t)return!1;const e=t;return e.tag==this.tag&&d.equalMap(e.attrs,this.attrs)&&d.equalMap(e.styles,this.styles)&&d.equalStringList(e.classes,this.classes)}static equalStringList(t,e){if(t.length!==e.length)return!1;for(const n of t)if(!e.includes(n))return!1;return!0}static equalMap(t,e){return t===e||!0===!t&&!0===!e||!t===!e&&t.size===e.size&&Array.from(t.keys()).reduce((n,s)=>n&&t.get(s)===e.get(s),!0)}}var l,f;(function(t){t["Valid"]="Valid",t["Invalid"]="Invalid",t["Exclude"]="Exclude",t["Inherit"]="Inherit"})(l||(l={})),function(t){t[t["BlockStyle"]=0]="BlockStyle",t[t["InlineTag"]=100]="InlineTag",t[t["InlineStyle"]=200]="InlineStyle",t[t["Attribute"]=300]="Attribute"}(f||(f={}));class p{constructor(t,e){this.rule=t,this.priority=e,this.inheritValidators=[],this.validators=[],this.excludeValidators=[],t.extendTags&&this.inheritValidators.push(this.makeTagsMatcher(t.extendTags)),t.tags&&this.validators.push(this.makeTagsMatcher(t.tags)),t.styles&&this.validators.push(this.makeStyleMatcher(t.styles)),t.attrs&&this.validators.push(this.makeAttrsMatcher(t.attrs)),t.excludeStyles&&this.excludeValidators.push(this.makeStyleMatcher(t.excludeStyles)),t.excludeAttrs&&this.excludeValidators.push(this.makeAttrsMatcher(t.excludeAttrs))}match(t){if(this.rule.filter){const e=this.rule.filter(t);if(!e)return l.Invalid}const e=this.excludeValidators.map(e=>e(t)).includes(!0);if(e)return l.Exclude;const n=this.inheritValidators.map(e=>e(t)).includes(!0);return n?l.Inherit:this.validators.map(e=>e(t)).includes(!0)?l.Valid:l.Invalid}extractData(t,e){if(!e)return new d;const n=new Map;e.attrs&&e.attrs.forEach(e=>{n.set(e,t.getAttribute(e))});const s={};return e.styleName&&(Array.isArray(e.styleName)?e.styleName:[e.styleName]).forEach(e=>{const n=t.style[e];n&&(s[e]=n)}),new d({tag:e.tag?t.nodeName.toLowerCase():null,attrs:n.size?n:null,styles:s})}makeTagsMatcher(t){return e=>{const n=e.nodeName.toLowerCase();return Array.isArray(t)?t.includes(n):t.test(n)}}makeAttrsMatcher(t){return e=>t.map(t=>t.value?e.getAttribute(t.key)===t.value:e.hasAttribute(t.key)).includes(!0)}makeStyleMatcher(t){return e=>!Object.keys(t).map(n=>{const s=Array.isArray(t[n])?t[n]:[t[n]];let r=e.style[n];return"fontFamily"===n&&"string"===typeof r&&(r=r.replace(/['"]/g,"")),!!r&&s.map(t=>t instanceof RegExp?t.test(r):t===r).includes(!0)}).includes(!1)}}class g extends p{}class m extends p{}class y{constructor(){this.map=new Map}keys(){return this.map.keys()}get(t){return this.map.get(t)}set(t,e){this.map.set(t,e)}merge(t,e,n){if(t instanceof m)return void(e.effect===l.Invalid?this.map.delete(t):this.map.set(t,[e]));const s=this.map.get(t);if(!Array.isArray(s))return void(e.effect!==l.Invalid&&this.map.set(t,[e]));const r=[],i=[];n?s.push(e):s.unshift(e);while(s.length){const t=s.shift();r.length<t.endIndex&&(r.length=t.endIndex),r.fill(t,t.startIndex,t.endIndex)}let o=null;for(let c=0;c<r.length;c++){const t=r[c];t?o&&t.effect===o.effect&&(t.formatData&&o.formatData&&t.formatData.equal(o.formatData)||!0===!t.formatData&&!0===!o.formatData)?o.endIndex=c+1:(o={startIndex:c,endIndex:c+1,formatData:t.formatData,effect:t.effect},i.push(o)):o=null}const a=i.filter(t=>t.effect!==l.Invalid);a.length?this.map.set(t,a):this.map.delete(t)}}var b=n("2bd2");class v{constructor(){this._dirty=!0,this._changed=!0,this._outputDirty=!0,this._outputChanged=!0,this.changeEvent=new b["a"],this.onChange=this.changeEvent.asObservable()}get dirty(){return this._dirty}get changed(){return this._changed}get outputDirty(){return this._outputDirty}get outputChanged(){return this._outputChanged}markAsDirtied(){this._dirty=!0,this._outputDirty=!0,this.markAsChanged()}markAsChanged(){this._changed=!0,this._outputChanged=!0,this.changeEvent.next()}rendered(){this._dirty=this._changed=!1}outputRendered(){this._outputDirty=this._outputChanged=!1}}var x,C=n("c628");const w=Symbol("ParentComponentAccessToken"),I=Object(C["a"])("Fragment");class E extends v{constructor(){super(),this[x]=null,this.contents=new u,this.formatMap=new y,this.eventMap=new Map}get parentComponent(){return this[w]}get length(){return this.contents.length}from(t){this._clean();const e=this;Array.from(t.formatMap.keys()).forEach(n=>{this.formatMap.set(n,[...t.formatMap.get(n).map(t=>{var s;return n instanceof g?Object.assign(Object.assign({},t),{formatData:null===(s=t.formatData)||void 0===s?void 0:s.clone()}):{get startIndex(){return 0},get endIndex(){return e.length},effect:t.effect,formatData:t.formatData}})])}),t.contents.slice(0).forEach(t=>{this.contents.append(t),t instanceof T&&(t[R]=this,this.eventMap.set(t,t.onChange.subscribe(()=>{this.markAsChanged()})))}),t.clean(),this.markAsDirtied()}concat(t){const e=this.length;t.sliceContents(0).forEach(t=>{this.contents.append(t),t instanceof T&&(t[R]=this,this.eventMap.set(t,t.onChange.subscribe(()=>{this.markAsChanged()})))}),t.getFormatKeys().filter(t=>!(t instanceof m)).forEach(n=>{const s=t.getFormatRanges(n)||[];s.forEach(t=>{t.startIndex+=e,t.endIndex+=e,this._apply(n,t)})}),t.clean(),this.markAsDirtied()}append(t,e=!1){this._append(t,e),this.markAsDirtied()}sliceContents(t=0,e){return this.contents.slice(t,e)}insertBefore(t,e){const n=this.indexOf(e);if(-1===n)throw I("component referenced is not a member of the current editable fragment");this.insert(t,n)}insertAfter(t,e){const n=this.indexOf(e);if(-1===n)throw I("component referenced is not a member of the current editable fragment");this.insert(t,n+1)}insert(t,e){0!==t.length&&(t instanceof E?this.insertFragment(t,e):this._insert(t,e),this.markAsDirtied())}clone(){const t=new E;return Array.from(this.formatMap.keys()).forEach(e=>{t.formatMap.set(e,[...this.formatMap.get(e).map(n=>{var s;return e instanceof g?Object.assign(Object.assign({},n),{formatData:null===(s=n.formatData)||void 0===s?void 0:s.clone()}):{get startIndex(){return 0},get endIndex(){return t.length},effect:n.effect,formatData:n.formatData}})])}),this.contents.clone().slice(0).forEach(e=>t._append(e)),t}clean(){this._clean(),this.markAsDirtied()}getContentAtIndex(t){return this.contents.getContentAtIndex(t)}remove(t,e=this.contents.length){this.cut(t,e).sliceContents().forEach(t=>{t instanceof T&&(t[R]=null)})}cut(t,e=this.length){const n=new E;if(e<=t)return n;const s=e-t,r=new y,i=new y;Array.from(this.formatMap.keys()).forEach(o=>{const a=this.formatMap.get(o);if(o instanceof m)return r.set(o,[...a]),void i.set(o,a.map(t=>{var e;return{effect:t.effect,formatData:null===(e=t.formatData)||void 0===e?void 0:e.clone(),get startIndex(){return 0},get endIndex(){return n.length}}}));a.forEach(n=>{var a,c,h,u;if(n.startIndex>=e)r.merge(o,Object.assign(Object.assign({},n),{startIndex:n.startIndex-s,endIndex:n.endIndex-s}),!0);else{if(!(n.endIndex<=t))return n.startIndex>t&&n.startIndex<e&&n.endIndex>=e?(r.merge(o,Object.assign(Object.assign({},n),{startIndex:t,endIndex:n.endIndex-s}),!0),void i.merge(o,{effect:n.effect,formatData:null===(a=n.formatData)||void 0===a?void 0:a.clone(),startIndex:n.startIndex-t,endIndex:s},!0)):n.startIndex<=t&&n.endIndex>=e?(n.endIndex-s>n.startIndex&&r.merge(o,Object.assign(Object.assign({},n),{endIndex:n.endIndex-s}),!0),void i.merge(o,{effect:n.effect,formatData:null===(c=n.formatData)||void 0===c?void 0:c.clone(),startIndex:0,endIndex:s},!0)):n.startIndex<=t&&n.endIndex>t&&n.endIndex<e?(r.merge(o,Object.assign(Object.assign({},n),{endIndex:t}),!0),void i.merge(o,{effect:n.effect,formatData:null===(h=n.formatData)||void 0===h?void 0:h.clone(),startIndex:0,endIndex:n.endIndex-t},!0)):void(n.startIndex>t&&n.endIndex<e&&i.merge(o,{effect:n.effect,formatData:null===(u=n.formatData)||void 0===u?void 0:u.clone(),startIndex:n.startIndex-t,endIndex:n.endIndex-t},!0));r.merge(o,Object.assign({},n),!0)}})}),this.formatMap=r,this.contents.cut(t,e).forEach(t=>{n._append(t),t instanceof T&&(this.eventMap.get(t).unsubscribe(),this.eventMap.delete(t))});let o=new y;if(1===n.length&&n.getContentAtIndex(0)instanceof K){const t=this.length;this.getFormatKeys().forEach(e=>{e instanceof g&&this.getFormatRanges(e).forEach(n=>{var s;n.endIndex===t&&o.set(e,[{effect:n.effect,formatData:null===(s=n.formatData)||void 0===s?void 0:s.clone(),startIndex:0,endIndex:1}])})}),Array.from(i.keys()).filter(t=>t instanceof m).forEach(t=>{o.set(t,i.get(t))})}else o=i;return n.formatMap=o,this.markAsDirtied(),n}getFormatKeys(){return Array.from(this.formatMap.keys())}getFormatRanges(t){return this.formatMap.get(t)||[]}indexOf(t){return this.contents.indexOf(t)}apply(t,e,n={important:!0,coverChild:!0}){this._apply(t,e,n),this.markAsDirtied()}getContext(t,e){const n=this.parentComponent;if(!n)return null;if(n instanceof t){if("function"!==typeof e)return n;if(e(n))return n}const s=n.parentFragment;return s?s.getContext(t,e):null}insertFragment(t,e){const n=t.sliceContents(0).reverse(),s=0===this.length||1===this.length&&this.getContentAtIndex(0)instanceof K;n.forEach(t=>{this.contents.insert(t,e),t instanceof T&&(t[R]=this,this.eventMap.set(t,t.onChange.subscribe(()=>{this.markAsChanged()})))});const r=t.length,i=new y;this.getFormatKeys().filter(t=>t instanceof g).forEach(t=>{const n=this.getFormatRanges(t);n.forEach(n=>{var s;if(!(n.endIndex<=e))if(n.startIndex>=e)n.startIndex+=r,n.endIndex+=r;else{const o={startIndex:e+r,endIndex:n.endIndex+r,effect:n.effect,formatData:null===(s=n.formatData)||void 0===s?void 0:s.clone()};n.endIndex=e,i.set(t,[o])}})}),Array.from(i.keys()).forEach(t=>{i.get(t).forEach(e=>{this.formatMap.merge(t,e,!0)})}),t.getFormatKeys().forEach(n=>{t.getFormatRanges(n).forEach(t=>{var r;this.formatMap.merge(n,{startIndex:t.startIndex+e,endIndex:t.endIndex+e,effect:t.effect,formatData:null===(r=t.formatData)||void 0===r?void 0:r.clone()},n instanceof g||!s)})}),t.clean(),this.markAsDirtied()}_insert(t,e){t instanceof T&&(this.gourdComponentInSelf(t),this.eventMap.set(t,t.onChange.subscribe(()=>{this.markAsChanged()}))),this.contents.insert(t,e);const n=new y;Array.from(this.formatMap.keys()).forEach(s=>{const r=this.formatMap.get(s)||[];r.forEach(r=>{s instanceof m?n.merge(s,r,!0):r.startIndex<e&&r.endIndex>=e?t instanceof N||t instanceof P||t instanceof V?(n.merge(s,Object.assign(Object.assign({},r),{endIndex:e}),!0),n.merge(s,{startIndex:e,endIndex:e+1,effect:l.Invalid,formatData:r.formatData.clone()},!0),r.endIndex>e&&n.merge(s,Object.assign(Object.assign({},r),{startIndex:e+1,endIndex:r.endIndex+1}),!0)):n.merge(s,Object.assign(Object.assign({},r),{endIndex:r.endIndex+t.length}),!0):(r.startIndex>=e&&r.startIndex>0&&r.startIndex<r.endIndex&&(r.startIndex+=t.length),r.endIndex>=e&&(r.endIndex+=t.length),n.merge(s,r,!0))})}),this.formatMap=n,this.markAsDirtied()}_apply(t,e,n={important:!0,coverChild:!0}){const{coverChild:s,important:r}=n;if(t instanceof m){const n=this;return void this.formatMap.merge(t,Object.assign(Object.assign({},e),{get startIndex(){return 0},get endIndex(){return n.length}}),r)}e.startIndex<0&&(e.startIndex=0),e.endIndex>this.length&&(e.endIndex=this.length),this.getContentAtIndex(e.endIndex)instanceof K&&e.endIndex++;const i=e,o=this.sliceContents(i.startIndex,i.endIndex);let a=0;const c=[];let h;o.forEach(r=>{if(r instanceof N){if(h=null,s){const e=Object.assign({},i);e.startIndex=0,e.endIndex=r.slot.length,r.slot.apply(t,e,n)}}else if(r instanceof P)h=null,s&&r.slots.forEach(e=>{const s=Object.assign({},i);s.startIndex=0,s.endIndex=e.length,e.apply(t,s,n)});else if(r instanceof V){if(h=null,s)for(const e of r){const s=Object.assign({},i);s.startIndex=0,s.endIndex=e.length,e.apply(t,s,n)}}else h?h.endIndex=e.startIndex+a+r.length:(h={startIndex:i.startIndex+a,endIndex:i.startIndex+a+r.length,effect:i.effect,formatData:i.formatData},c.push({token:t,params:h}));a+=r.length}),c.forEach(t=>this.formatMap.merge(t.token,t.params,r))}_append(t,e=!1){const n=t.length,s=this.length;this.contents.append(t),t instanceof T&&(this.gourdComponentInSelf(t),this.eventMap.set(t,t.onChange.subscribe(()=>{this.markAsChanged()}))),e&&this.getFormatKeys().forEach(t=>{t instanceof g&&this.getFormatRanges(t).forEach(t=>{t.endIndex===s&&(t.endIndex+=n)})})}_clean(){Array.from(this.eventMap.values()).map(t=>t.unsubscribe()),this.eventMap.clear(),this.sliceContents().forEach(t=>{t instanceof T&&t[R]===this&&(t[R]=null)}),this.contents=new u,this.formatMap=new y}gourdComponentInSelf(t){const e=t.parentFragment;if(e){const n=e.indexOf(t);e.remove(n,n+1)}t[R]=this}}var O;x=w;const S=Symbol("parentNode");class _{constructor(t=""){this.textContent=t}get parentNode(){return this[S]}clone(){return new _(this.textContent)}}const j=Object(C["a"])("VElement");class M{constructor(t,e){this.tagName=t,this[O]=null,this.attrs=new Map,this.styles=new Map,this.classes=[],this._childNodes=[],this.unbindFns=[],this.destroyEvent=new b["a"],this.onDestroy=this.destroyEvent.asObservable(),e&&(e.attrs&&Object.keys(e.attrs).forEach(t=>{const n=e.attrs[t];null!==n&&"undefined"!==typeof n&&this.attrs.set(t,e.attrs[t])}),e.styles&&Object.keys(e.styles).forEach(t=>{const n=e.styles[t];null!==n&&"undefined"!==typeof n&&this.styles.set(t,e.styles[t])}),e.classes&&this.classes.push(...e.classes),e.childNodes&&this.appendChild(...e.childNodes),this.listeners=e.on||{})}static createElement(t,e,...n){if("function"===typeof t)return t(Object.assign(Object.assign({},e),{children:n}));e=e||{};const s=(e.class||"").trim(),r=s?s.split(/\s+/g):[];Reflect.deleteProperty(e,"class");const i=e.style||"";let o;i&&"string"===typeof i?(o={},i.split(";").map(t=>t.split(":")).forEach(t=>{t[0]&&t[1]&&(o[t[0].trim()]=t[1].trim())})):o=i,Reflect.deleteProperty(e,"style");const a={},c={};Object.keys(e).forEach(t=>{/^on[A-Z]/.test(t)?a[t.replace(/^on/,"").toLowerCase()]=e[t]:c[t]=e[t]});const h=[],u=function(t){for(const e of t)e instanceof M?h.push(e):"string"===typeof e&&e?h.push(new _(e)):Array.isArray(e)?u(e):!1!==e&&h.push(new _(e+""))};return u(n),new M(t,{styles:o,attrs:c,classes:r,on:a,childNodes:h})}get parentNode(){return this[S]}get childNodes(){return this._childNodes.map(t=>t)}clone(){const t={},e={};return this.attrs.forEach((e,n)=>{t[n]=e}),this.styles.forEach((t,n)=>{e[n]=t}),new M(this.tagName,{classes:[...this.classes],attrs:t,styles:e,childNodes:this._childNodes.map(t=>t.clone())})}appendChild(...t){t.forEach(t=>{var e;null===(e=t.parentNode)||void 0===e||e.removeChild(t),t[S]=this,this._childNodes.push(t)})}removeChild(t){const e=this._childNodes.indexOf(t);if(e>-1)return this._childNodes.splice(e,1),void(t[S]=null);throw j("node to be deleted is not a child of the current node.")}replaceChild(t,e){var n;const s=this._childNodes.indexOf(e);if(s>-1)return null===(n=t.parentNode)||void 0===n||n.removeChild(t),this._childNodes.splice(s,1,t),e[S]=null,void(t[S]=this);throw j("node to be replaced is not a child of the current node.")}toJSON(){return{tagName:this.tagName,styles:M.mapToJSON(this.styles),attrs:M.mapToJSON(this.attrs),classes:this.classes.map(t=>t),childNodes:this._childNodes.map(t=>t instanceof M?t.toJSON():t.textContent)}}onRendered(t){Object.keys(this.listeners||{}).forEach(e=>{const n=this.listeners[e];"function"===typeof n&&(t.addEventListener(e,this.listeners[e]),this.unbindFns.push((function(){t.removeEventListener(e,n)})))})}destroy(){this.unbindFns.forEach(t=>t()),this.destroyEvent.next()}static mapToJSON(t){const e={};return t.forEach((t,n)=>{e[n]=t}),e}}O=S;var k,F,D=function(t,e,n,s){var r,i=arguments.length,o=i<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,n):s;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(t,e,n,s);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(i<3?r(o):i>3?r(e,n,o):r(e,n))||o);return i>3&&o&&Object.defineProperty(e,n,o),o},A=function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)};const R=Symbol("ParentFragmentAccessToken");class T extends v{constructor(t){super(),this.tagName=t,this[k]=null,this.length=1,this.canDispatchDataChange=!0,this.canDispatchContentChange=!0}get parentFragment(){return this[R]}markAsDirtied(){!1!==this.canDispatchDataChange&&("function"===typeof this.componentDataChange&&(this.canDispatchDataChange=!1,this.componentDataChange(),this.canDispatchDataChange=!0),super.markAsDirtied())}markAsChanged(){!1!==this.canDispatchContentChange&&("function"===typeof this.componentContentChange&&(this.canDispatchContentChange=!1,this.componentContentChange(),this.canDispatchContentChange=!0),super.markAsChanged())}}k=R;class N extends T{constructor(t){super(t),this.slot=new E,this.slot[w]=this,this.slot.onChange.subscribe(()=>{this.markAsChanged()})}}class P extends T{constructor(){super(...arguments),this.eventMap=new Map,this.slots=new Proxy([],{set:(t,e,n,s)=>{if(n instanceof E&&(n.dirty||t.includes(n)||n.markAsDirtied(),this.eventMap.has(n)||this.eventMap.set(n,n.onChange.subscribe(()=>{this.markAsChanged()}))),"length"===e&&"number"===typeof n)for(const i of t)i&&(i[w]=null);const r=Reflect.set(t,e,n,s);return this.eventMap.forEach(t=>t.unsubscribe()),this.eventMap.clear(),t.forEach(t=>{this.eventMap.set(t,t.onChange.subscribe(()=>{this.markAsChanged()})),t[w]=this}),this.markAsDirtied(),r},deleteProperty:(t,e)=>{var n;const s=t[e],r=Reflect.deleteProperty(t,e);return"string"===typeof e&&/\d+/.test(e)&&s&&!t.includes(s)&&(null===(n=this.eventMap.get(s))||void 0===n||n.unsubscribe(),this.eventMap.delete(s),s[w]=null,this.markAsDirtied()),r}})}}class V extends T{constructor(){super(...arguments),this.eventMap=new Map,this.slots=[],this.iteratorIndex=0}get slotCount(){return this.slots.length}[Symbol.iterator](){return this.iteratorIndex=0,this}next(){if(this.iteratorIndex<this.slotCount){const t=this.slots[this.iteratorIndex];return this.iteratorIndex++,{done:!1,value:t}}return{done:!0,value:void 0}}getSlotAtIndex(t){return this.slots[t]}indexOf(t){return this.slots.indexOf(t)}forEach(t,e){this.slots.forEach(t,e)}clean(){this.slots.forEach(t=>{t[w]=null,this.eventMap.get(t).unsubscribe()}),this.eventMap.clear(),this.slots=[]}push(...t){this.setup(t),this.slots.push(...t),this.markAsDirtied()}pop(){const t=this.slots.pop();return t&&(t[w]=null,this.eventMap.get(t).unsubscribe(),this.eventMap.delete(t)),this.markAsDirtied(),t}splice(t,e,...n){const s=this.slots.splice(t,e,...n);return s.forEach(t=>{t[w]=null,this.eventMap.get(t).unsubscribe(),this.eventMap.delete(t)}),n&&this.setup(n),this.markAsDirtied(),s}map(t,e){return this.slots.map(t,e)}setup(t){t.forEach(t=>{t[w]=this,t.dirty||this.slots.includes(t)||t.markAsDirtied(),this.eventMap.set(t,t.onChange.subscribe(()=>{this.markAsChanged()}))})}}class L extends T{constructor(t){super(t)}}class B{match(t){return"br"===t.nodeName.toLowerCase()}read(){const t=new K;return{component:t,slotsMap:[]}}}let K=F=class extends L{constructor(){super("br"),this.block=!1}clone(){return new F}render(){return new M(this.tagName)}};K=F=D([r({loader:new B}),A("design:paramtypes",[])],K);class U{constructor(){this.nativeVDomMapping=new WeakMap,this.vDomNativeMapping=new WeakMap}set(t,e){this.get(t)&&this.delete(t),this.get(e)&&this.delete(e),t instanceof M||t instanceof _?(this.vDomNativeMapping.set(t,e),this.nativeVDomMapping.set(e,t)):(this.vDomNativeMapping.set(e,t),this.nativeVDomMapping.set(t,e))}get(t){return t instanceof _||t instanceof M?this.vDomNativeMapping.get(t):this.nativeVDomMapping.get(t)}delete(t){if(t instanceof _||t instanceof M){const e=this.vDomNativeMapping.get(t);this.vDomNativeMapping.delete(t),this.nativeVDomMapping.delete(e)}else{const e=this.nativeVDomMapping.get(t);this.nativeVDomMapping.delete(t),this.vDomNativeMapping.delete(e)}}}const H=Object(C["a"])("Renderer");class z{constructor(t){this.host=t,this.rendingEvent=new b["a"],this.viewUpdateEvent=new b["a"],this.vDomPositionMapping=new WeakMap,this.fragmentVDomMapping=new WeakMap,this.fragmentContentContainerMapping=new WeakMap,this.rendererVNodeMap=new WeakMap,this.NVMappingTable=new U,this.componentVDomCacheMap=new WeakMap,this.onViewUpdated=this.viewUpdateEvent.asObservable(),this.onRendingBefore=this.rendingEvent.asObservable()}render(t){if(this.rendingEvent.next(),t.changed){const e=t.dirty,n=this.rendingComponent(t);new M("html",{childNodes:[n]}),this.NVMappingTable.set(this.host,n),e&&(this.oldVDom?this.diffAndUpdate(n,this.oldVDom,this.host):this.patch(n,this.host),this.oldVDom=n)}return this.viewUpdateEvent.next(),this.oldVDom}getPositionByNode(t){const e=this.NVMappingTable.get(t);return this.vDomPositionMapping.get(e)}getPositionByVDom(t){return this.vDomPositionMapping.get(t)}getNativeNodeByVDom(t){return this.NVMappingTable.get(t)}getVDomByNativeNode(t){return this.NVMappingTable.get(t)}getVElementByFragment(t){return this.fragmentContentContainerMapping.get(t)}getComponentRootVNode(t){return this.componentVDomCacheMap.get(t)}getComponentRootNativeNode(t){return this.getNativeNodeByVDom(this.getComponentRootVNode(t))}diffAndUpdate(t,e,n){n||(n=this.createElement(t));const s=[];return t.childNodes.forEach(t=>{const e=this.NVMappingTable.get(t);e?s.push(e):s.push(this.patch(t))}),e.childNodes.forEach(t=>{const e=this.NVMappingTable.get(t);e.parentNode.removeChild(e)}),s.forEach((t,e)=>{const s=n.childNodes,r=s[e];r?r!==t&&n.insertBefore(t,r):n.appendChild(t)}),n}patch(t,e){const n=e||(t instanceof M?this.createElement(t):this.createTextNode(t));return t instanceof M&&t.childNodes.forEach(t=>{this.rendererVNodeMap.get(t)?n.appendChild(this.getNativeNodeByVDom(t)):n.appendChild(this.patch(t))}),n}rendingFragment(t,e,n=!1){if(0===t.length&&t.append(new K),t.dirty||n){const{childFormats:n,containerFormats:s}=z.formatSeparate(t),r=this.rendingSlotFormats(s,e),i=r[0],o=r[r.length-1];if(i!==e)throw H("slot elements cannot be replaced.");return this.rendingContents(t,n,0,t.length).forEach(t=>{(o||e).appendChild(t)}),t.rendered(),this.fragmentContentContainerMapping.set(t,e),r.forEach(e=>{this.vDomPositionMapping.set(e,{fragment:t,startIndex:0,endIndex:t.length})}),e}return t.sliceContents().forEach(t=>{if(t instanceof T&&t.changed){const e=t.dirty,n=this.componentVDomCacheMap.get(t),s=this.rendingComponent(t);if(e){this.vDomPositionMapping.set(s,this.vDomPositionMapping.get(n));const e=$(s,n),r=this.NVMappingTable.get(n),i=this.diffAndUpdate(s,n,e&&r);this.componentVDomCacheMap.set(t,s),this.NVMappingTable.set(s,i),n.parentNode.replaceChild(s,n),this.destroyVDom(n),e?s.onRendered(r):r.parentNode.replaceChild(i,r)}}}),e}rendingComponent(t){if(t.dirty){let e;if(t instanceof N?e=t.render(!1,e=>{if(e.dirty){const n=t.slotRender(!1,(t,e)=>(e.attrs.set("textbus-editable","on"),this.rendingFragment(t,e)));return this.fragmentVDomMapping.set(e,n),n}return this.fragmentVDomMapping.get(e)}):t instanceof P||t instanceof V?e=t.render(!1,e=>{if(e.dirty){const n=t.slotRender(e,!1,(t,e)=>(e.attrs.set("textbus-editable","on"),this.rendingFragment(t,e)));return this.fragmentVDomMapping.set(e,n),n}return this.fragmentVDomMapping.get(e)}):t instanceof L&&(e=t.render(!1)),!(e instanceof M))throw H("component render method must return a virtual element.");if(this.componentVDomCacheMap.set(t,e),t.rendered(),t instanceof N){const n=this.fragmentContentContainerMapping.get(t.slot);n===e?n.attrs.delete("textbus-editable"):e.attrs.set("textbus-editable","off")}else(t instanceof P||t instanceof V||t instanceof L&&e.childNodes.length>0)&&e.attrs.set("textbus-editable","off");return e}return t instanceof N?t.slot.dirty?this.replaceSlotView(t,t.slot):t.slot.changed&&this.rendingFragment(t.slot,this.fragmentContentContainerMapping.get(t.slot)):t instanceof P?t.slots.forEach(e=>{e.dirty?this.replaceSlotView(t,e):e.changed&&this.rendingFragment(e,this.fragmentContentContainerMapping.get(e))}):t instanceof V&&Array.from(t).forEach(e=>{e.dirty?this.replaceSlotView(t,e):e.changed&&this.rendingFragment(e,this.fragmentContentContainerMapping.get(e))}),t.rendered(),this.componentVDomCacheMap.get(t)}replaceSlotView(t,e){const n=this.fragmentVDomMapping.get(e);let s;if(t instanceof N){const r=this.componentVDomCacheMap.get(t);let i=null;s=t.slotRender(!1,(t,e)=>(i=e,this.rendingFragment(t,e,!0))),r===n?this.componentVDomCacheMap.set(t,i):i.attrs.set("textbus-editable","on"),this.fragmentVDomMapping.set(e,s)}else s=t.slotRender(e,!1,(t,e)=>{const n=this.rendingFragment(t,e,!0);return n.attrs.set("textbus-editable","on"),n}),this.fragmentVDomMapping.set(e,s);const r=$(s,n),i=this.getNativeNodeByVDom(n),o=this.diffAndUpdate(s,n,r&&i);return this.destroyVDom(n),r?s.onRendered(i):i.parentNode.replaceChild(o,i),this.NVMappingTable.set(o,s),n.parentNode.replaceChild(s,n),s}rendingSlotFormats(t,e){let n=[];if(e&&n.push(e),t.reduce((t,e)=>{const s={isOutputMode:!1,effect:e.params.effect,formatData:e.params.formatData},r=e.token.render(s,t);return r&&r!==t?(n.push(r),r):t},e),!n.length){if(!e)return[];n=[e]}return n.reduce((t,e)=>(t.appendChild(e),e)),n}createVDOMByExtractContent(t,e,n){const s=[],r=t.sliceContents(e,n);let i=e;return r.forEach(e=>{if("string"===typeof e){const n=new _(e);this.vDomPositionMapping.set(n,{fragment:t,startIndex:i,endIndex:i+e.length}),i+=e.length,s.push(n)}else{const n=this.componentVDomCacheMap.get(e),r=this.rendingComponent(e);n&&n!==r&&this.destroyVDom(n),this.vDomPositionMapping.set(r,{fragment:t,startIndex:i,endIndex:i+1}),s.push(r),i++}}),s}rendingContents(t,e,n,s){const r=[];while(n<s){const i=e.shift();if(!i){r.push(...this.createVDOMByExtractContent(t,n,s));break}{n<i.params.startIndex&&r.push(...this.createVDOMByExtractContent(t,n,i.params.startIndex));const s=[i];while(1){const t=e[0];if(!t||t.params.startIndex!==i.params.startIndex||t.params.endIndex!==i.params.endIndex)break;s.push(e.shift())}const o=this.rendingSlotFormats(s);o.forEach(e=>{this.vDomPositionMapping.set(e,{fragment:t,startIndex:i.params.startIndex,endIndex:i.params.endIndex})});const a=o[0],c=o[o.length-1],h=[];let u=0;while(1){const t=e[u];if(!(t&&t.params.startIndex<i.params.endIndex))break;if(t.params.endIndex<=i.params.endIndex)h.push(e.splice(u,1)[0]);else{const e={token:t.token,params:Object.assign(Object.assign({},t.params),{endIndex:i.params.endIndex})};h.push(e),t.params.startIndex=i.params.endIndex,u++}}e=z.calculatePriority(e),h.length?this.rendingContents(t,h,i.params.startIndex,i.params.endIndex).forEach(t=>{c?c.appendChild(t):r.push(t)}):this.createVDOMByExtractContent(t,i.params.startIndex,i.params.endIndex).forEach(t=>{c?c.appendChild(t):r.push(t)}),a&&r.push(a),n=i.params.endIndex}}return r}createElement(t){this.rendererVNodeMap.set(t,!0);const e=document.createElement(t.tagName);return t.attrs.forEach((t,n)=>{!1!==t&&(!0!==t?e.setAttribute(n,t+""):e[n]=!0)}),t.styles.forEach((t,n)=>{e.style[n]=t}),t.classes.forEach(t=>e.classList.add(t)),this.NVMappingTable.set(e,t),"function"===typeof t.onRendered&&t.onRendered(e),e}createTextNode(t){this.rendererVNodeMap.set(t,!0);const e=document.createTextNode(z.replaceEmpty(t.textContent,""));return this.NVMappingTable.set(e,t),e}destroyVDom(t){for(const e of t.childNodes)e instanceof M&&this.destroyVDom(e);t.destroy()}static replaceEmpty(t,e){return t.replace(/\s\s+/g,t=>" "+Array.from({length:t.length-1}).fill(e).join("")).replace(/^\s|\s$/g,e)}static calculatePriority(t){return t.filter(t=>t.params.effect!==l.Inherit).sort((t,e)=>{const n=t.params.startIndex-e.params.startIndex;if(0===n){const n=e.params.endIndex-t.params.endIndex;return 0===n?t.token.priority-e.token.priority:n}return n})}static formatSeparate(t){const e=[],n=[],s=[];return t.getFormatKeys().forEach(e=>{t.getFormatRanges(e).forEach(t=>{s.push({token:e,params:Object.assign({},t)})})}),z.calculatePriority(s).forEach(s=>{s.token instanceof m||0===s.params.startIndex&&s.params.endIndex===t.length?e.push(s):n.push(s)}),{containerFormats:e,childFormats:n}}}function $(t,e){return t===e||t.tagName==e.tagName&&q(t.attrs,e.attrs)&&q(t.styles,e.styles)&&W(t.classes,e.classes)}function q(t,e){return t===e||!0===!t&&!0===!e||!t===!e&&t.size===e.size&&Array.from(t.keys()).reduce((n,s)=>n&&t.get(s)===e.get(s),!0)}function W(t,e){if(t===e)return!0;if(t.length!==e.length)return!1;for(const n of t)if(!e.includes(n))return!1;return!0}const Y=Object(C["a"])("OutputRenderer");class X{constructor(){this.componentVDomCacheMap=new WeakMap,this.fragmentVDomMapping=new WeakMap,this.fragmentContentContainerMapping=new WeakMap}render(t){const e=this.rendingComponent(t);return new M("html",{childNodes:[e]}),e}rendingFragment(t,e,n=!1){if(t.outputDirty||n){const{childFormats:n,containerFormats:s}=z.formatSeparate(t),r=this.rendingSlotFormats(s,e),i=r[0],o=r[r.length-1];if(i!==e)throw Y("slot elements cannot be replaced.");return this.rendingContents(t,n,0,t.length).forEach(t=>{(o||e).appendChild(t)}),t.outputRendered(),this.fragmentContentContainerMapping.set(t,e),e}return t.sliceContents().forEach(t=>{if(t instanceof T&&t.outputChanged){const e=t.outputDirty,n=this.componentVDomCacheMap.get(t),s=this.rendingComponent(t);e&&(this.componentVDomCacheMap.set(t,s),n.parentNode.replaceChild(s,n))}}),e}rendingComponent(t){if(t.outputDirty){let e;if(t instanceof N?e=t.render(!0,e=>{if(e.outputDirty){const n=t.slotRender(!0,(t,e)=>this.rendingFragment(t,e));return this.fragmentVDomMapping.set(e,n),n}return this.fragmentVDomMapping.get(e)}):t instanceof P||t instanceof V?e=t.render(!0,e=>{if(e.outputDirty){const n=t.slotRender(e,!0,(t,e)=>this.rendingFragment(t,e));return this.fragmentVDomMapping.set(e,n),n}return this.fragmentVDomMapping.get(e)}):t instanceof L&&(e=t.render(!0)),!(e instanceof M))throw Y("component render method must return a virtual element.");return this.componentVDomCacheMap.set(t,e),t.outputRendered(),e}return t instanceof N?t.slot.outputDirty?this.replaceSlotView(t,t.slot):t.slot.outputChanged&&this.rendingFragment(t.slot,this.fragmentContentContainerMapping.get(t.slot)):t instanceof P?t.slots.forEach(e=>{e.outputDirty?this.replaceSlotView(t,e):e.outputChanged&&this.rendingFragment(e,this.fragmentContentContainerMapping.get(e))}):t instanceof V&&Array.from(t).forEach(e=>{e.outputDirty?this.replaceSlotView(t,e):e.outputChanged&&this.rendingFragment(e,this.fragmentContentContainerMapping.get(e))}),t.outputRendered(),this.componentVDomCacheMap.get(t)}replaceSlotView(t,e){const n=this.fragmentVDomMapping.get(e);let s;if(t instanceof N){const r=this.componentVDomCacheMap.get(t);s=t.slotRender(!0,(t,e)=>this.rendingFragment(t,e)),n===r&&this.componentVDomCacheMap.set(t,s),this.fragmentVDomMapping.set(e,s)}else s=t.slotRender(e,!0,(t,e)=>this.rendingFragment(t,e)),this.fragmentVDomMapping.set(e,s);n.parentNode.replaceChild(s,n)}rendingSlotFormats(t,e){let n=[];if(e&&n.push(e),t.reduce((t,e)=>{const s={isOutputMode:!0,effect:e.params.effect,formatData:e.params.formatData},r=e.token.render(s,t);return r&&r!==t?(n.push(r),r):t},e),!n.length){if(!e)return[];n=[e]}return n.reduce((t,e)=>(t.appendChild(e),e)),n}createVDOMByExtractContent(t,e,n){const s=[],r=t.sliceContents(e,n);return r.forEach(t=>{if("string"===typeof t){const e=new _(t);s.push(e)}else{const e=this.rendingComponent(t);s.push(e)}}),s}rendingContents(t,e,n,s){const r=[];while(n<s){const i=e.shift();if(!i){r.push(...this.createVDOMByExtractContent(t,n,s));break}{n<i.params.startIndex&&r.push(...this.createVDOMByExtractContent(t,n,i.params.startIndex));const s=[i];while(1){const t=e[0];if(!t||t.params.startIndex!==i.params.startIndex||t.params.endIndex!==i.params.endIndex)break;s.push(e.shift())}const o=this.rendingSlotFormats(s),a=o[0],c=o[o.length-1],h=[];let u=0;while(1){const t=e[u];if(!(t&&t.params.startIndex<i.params.endIndex))break;if(t.params.endIndex<=i.params.endIndex)h.push(e.splice(u,1)[0]);else{const e={token:t.token,params:Object.assign(Object.assign({},t.params),{endIndex:i.params.endIndex})};h.push(e),t.params.startIndex=i.params.endIndex,u++}}e=z.calculatePriority(e),h.length?this.rendingContents(t,h,i.params.startIndex,i.params.endIndex).forEach(t=>{c?c.appendChild(t):r.push(t)}):this.createVDOMByExtractContent(t,i.params.startIndex,i.params.endIndex).forEach(t=>{c?c.appendChild(t):r.push(t)}),a&&r.push(a),n=i.params.endIndex}}return r}}class J{constructor(t=[],e=[]){this.componentLoaders=t,this.formatters=e}static parseHTML(t){return(new DOMParser).parseFromString(t,"text/html").body}static parserHTML(t){return J.parseHTML(t)}parse(t){const e=new E;return this.readComponent(t,e),e}readComponent(t,e){if(t.nodeType===Node.ELEMENT_NODE){for(const n of this.componentLoaders)if(n.match(t)){const s=n.read(t);return e.append(s.component,!1),void s.slotsMap.forEach(e=>{e.from&&(s.component instanceof N||s.component instanceof P||s.component instanceof V||e.from===t?this.readFormats(e.from,e.toSlot):this.readComponent(e.from,e.toSlot))})}this.readFormats(t,e)}else if(t.nodeType===Node.TEXT_NODE){const n=t.textContent;if(/^\s*[\r\n]+\s*$/.test(n))return;e.append(n,!1)}}readFormats(t,e){const n=this.formatters.map(e=>({formatter:e,effect:e.match(t)})).filter(t=>t.effect!==l.Invalid).map(e=>Object.assign(Object.assign({},e),{formatData:e.formatter.read(t)})),s=e.length;Array.from(t.childNodes).forEach(t=>{this.readComponent(t,e)}),n.forEach(t=>{e.apply(t.formatter,{startIndex:s,endIndex:e.length,formatData:t.formatData,effect:t.effect},{important:!1})})}}class Z{constructor(t,e){var n;this.nativeRange=t,this.renderer=e;const s=e.getPositionByNode(t.startContainer),r=e.getPositionByNode(t.endContainer);if([Node.ELEMENT_NODE,Node.TEXT_NODE].includes(null===(n=t.commonAncestorContainer)||void 0===n?void 0:n.nodeType)&&s&&r){const n=Z.findPosition(t.startContainer,t.startOffset,s,e);n&&this.setStart(n.fragment,n.index);const i=Z.findPosition(t.endContainer,t.endOffset,r,e);i&&this.setEnd(i.fragment,i.index)}}get commonAncestorFragment(){return this.getCommonAncestorFragment()}get commonAncestorComponent(){return this.getCommonAncestorComponent()}get collapsed(){return this.startFragment===this.commonAncestorFragment&&this.endFragment===this.commonAncestorFragment&&this.startIndex===this.endIndex}clone(){const t=new Z(this.nativeRange.cloneRange(),this.renderer);return Object.assign(t,this),t}restore(){if(this.startFragment.dirty||this.endFragment.dirty)return console.info(""),this;const t=this.findFocusNodeAndOffset(this.startFragment,this.startIndex),e=this.findFocusNodeAndOffset(this.endFragment,this.endIndex);return t&&e?(this.nativeRange.setStart(t.node,t.offset),this.nativeRange.setEnd(e.node,e.offset)):console.warn(""),this}setStart(t,e){this.startFragment=t,this.startIndex=e}setEnd(t,e){this.endFragment=t,this.endIndex=e}setPosition(t,e){this.setStart(t,e),this.setEnd(t,e)}getCommonAncestorFragmentScope(){let t=this.startFragment,e=this.endFragment,n=this.startFragment,s=this.endFragment,r=this.startIndex,i=this.endIndex;const o=this.commonAncestorFragment,a=this.commonAncestorComponent;let c=null,h=null;while(t!==o)c=t.parentComponent,c===a&&(n=t),t=c.parentFragment,r=t.indexOf(c);while(e!==o)h=e.parentComponent,h===a&&(s=e),e=h.parentFragment,i=e.indexOf(h);return{startIndex:r,startFragment:t,startChildComponent:c,endIndex:i+1,endFragment:e,endChildComponent:h,startChildFragment:n,endChildFragment:s}}getSlotRange(t,e){const n=[];this.getSelectedScope().forEach(s=>{const r=s.fragment.getContext(t,e);let i=s.fragment;while(i){const t=i.parentComponent;if(t===r){n.push({component:r,index:r instanceof V?r.indexOf(i):r.slots.indexOf(i)});break}i=t.parentFragment}});const s=[],r=new Map;return n.forEach(t=>{s.includes(t.component)?r.get(t.component).endIndex=t.index+1:(s.push(t.component),r.set(t.component,{startIndex:t.index,endIndex:t.index+1}))}),s.map(t=>Object.assign({component:t},r.get(t)))}getSelectedScope(){return this.collapsed?[{fragment:this.commonAncestorFragment,startIndex:this.startIndex,endIndex:this.endIndex}]:this.getScopes(this.startFragment,this.endFragment,this.startIndex,this.endIndex)}getExpandedScope(){return this.getScopes(this.startFragment,this.endFragment,Z.findExpandedStartIndex(this.startFragment,this.startIndex),Z.findExpandedEndIndex(this.endFragment,this.endIndex))}getSuccessiveContents(){function t(e,n,s){const r=[];if(n>=s)return r;let i,o=0;const a=e.sliceContents(n,s);return a.forEach(s=>{if(s instanceof N)i=null,r.push(...t(s.slot,0,s.slot.length));else if(s instanceof P)i=null,s.slots.forEach(e=>{r.push(...t(e,0,e.length))});else if(s instanceof V){i=null;for(const e of s)r.push(...t(e,0,e.length))}else s instanceof L&&s.block&&(i=null),i?i.endIndex=n+o+s.length:(i={startIndex:n+o,endIndex:n+o+s.length,fragment:e},r.push(i));o+=s.length}),r}const e=[];return this.getExpandedScope().forEach(n=>{e.push(...t(n.fragment,n.startIndex,n.endIndex))}),e}delete(){if(this.collapsed)if(0===this.startIndex){const t=this.startFragment.getContentAtIndex(this.startIndex);if(t instanceof K&&1===this.startFragment.length){let t=this.getPreviousPosition();return t.fragment===this.startFragment&&(t=this.getNextPosition()),this.deleteEmptyTree(this.startFragment),this.setStart(t.fragment,t.index),void this.collapse()}const e=this.getPreviousPosition();if(e.fragment!==this.startFragment){const t=this.startFragment;this.setStart(e.fragment,e.index);const n=this.startFragment.getContentAtIndex(this.startIndex),s=this.getSelectedScope();if(1===s.length&&this.startFragment===this.commonAncestorFragment&&n instanceof K)return this.deleteRange(),void this.collapse(!0);this.setStart(t,0)}if(e.fragment!==this.startFragment){const t=this.startFragment;this.setStart(e.fragment,e.index);const n=this.getSelectedScope();if(0===n.length&&this.startFragment===this.commonAncestorFragment&&this.startFragment.getContentAtIndex(this.startIndex-1)instanceof L)return this.startIndex--,this.deleteRange(),void this.collapse(!0);this.setStart(t,0)}if(e.fragment!==this.startFragment){const t=this.startFragment;this.setStart(e.fragment,e.index);const n=this.getSelectedScope();if(0===n.length&&this.startFragment===this.commonAncestorFragment&&"string"===typeof this.startFragment.getContentAtIndex(this.startIndex-1)){const t=this.startFragment.cut(this.startIndex);return this.startFragment.concat(this.endFragment),this.deleteEmptyTree(this.endFragment),this.startFragment.concat(t),void this.collapse()}this.setStart(t,0)}if(e.fragment!==this.startFragment){const t=this.startFragment;this.setStart(e.fragment,e.index);const n=this.getSelectedScope();if(0===n.length&&this.startFragment!==this.commonAncestorFragment)return this.startFragment.concat(this.endFragment.cut(0)),this.deleteEmptyTree(this.endFragment),void this.collapse();this.setStart(t,0)}if(e.fragment!==this.startFragment){const t=this.startFragment;this.setStart(e.fragment,e.index);const n=this.getSelectedScope();if(1===n.length&&this.startFragment!==this.commonAncestorFragment&&1===this.startFragment.length&&this.startFragment.getContentAtIndex(0)instanceof K)return this.deleteEmptyTree(this.startFragment),void this.collapse(!0);this.setStart(t,0)}if(e.fragment===this.startFragment&&t instanceof K)return this.endIndex++,this.deleteRange(),void this.collapse()}else{const t=this.startFragment.getContentAtIndex(this.startIndex),e=this.startFragment.getContentAtIndex(this.startIndex-1);if((e instanceof N||e instanceof P||e instanceof V)&&t instanceof K){const t=this.getPreviousPosition();return this.endIndex++,this.deleteRange(),this.setStart(t.fragment,t.index),void this.collapse()}if((e instanceof N||e instanceof P||e instanceof V)&&(t instanceof L&&!t.block||"string"===typeof t)){const t=this.getExpandedScope()[0],e=t.fragment.cut(t.startIndex,t.endIndex),n=this.getPreviousPosition();return n.fragment.remove(n.index),n.fragment.concat(e),void this.setPosition(n.fragment,n.index)}if((e instanceof N||e instanceof P||e instanceof V)&&t instanceof L&&t.block){const t=this.startFragment.cut(this.startIndex,this.startIndex+1),e=this.getPreviousPosition();return e.fragment.remove(e.index),e.fragment.concat(t),void this.setPosition(e.fragment,e.index)}if((e instanceof L||"string"===typeof e)&&(t instanceof L||"string"===typeof t))return this.startFragment.remove(this.startIndex-1,this.startIndex),this.startIndex--,void this.collapse();if((e instanceof L||"string"===typeof e)&&1===this.startFragment.length&&1===this.startIndex)return this.startFragment.append(new K,!0),this.startFragment.remove(this.startIndex-1,this.startIndex),this.startIndex--,void this.collapse();this.startIndex--,this.deleteRange()}else this.deleteRange()}deleteRange(){if(this.collapsed)return;const t=()=>{const t=[{index:this.startIndex,data:this.startFragment}];let e=this.startFragment;while(1){const n=e.parentComponent;let s;if(n instanceof N?s=0:n instanceof P?s=n.slots.indexOf(e):n instanceof V&&(s=n.indexOf(e)),t.push({index:s,data:n}),e=n.parentFragment,!e)break;t.push({index:e.indexOf(n),data:e})}return t},e=this.commonAncestorFragment,n=this.endFragment===e,s=this.getSelectedScope(),r=s[0];if(this.startFragment===e&&this.endFragment!==e&&1===s.length&&r.fragment===this.startFragment&&r.endIndex-r.startIndex===1){const t=this.startFragment.getContentAtIndex(this.startIndex);if(t instanceof L)return this.deleteSelectedScope(this.getSelectedScope()),void this.collapse(!0)}const i=t();this.deleteSelectedScope(s);const o=()=>{while(1){const t=i.pop(),e=i[i.length-1];if(!e)return t;if(e.data instanceof E){if(!e.data.parentComponent)return t}else if(!e.data.parentFragment)return t}},a=i[i.length-1].data,c=o();let h=!1,u=this.endFragment;while(u){const t=u.parentComponent;if(!t)break;t===a&&(h=!0),u=t.parentFragment}if(c.data instanceof E){let t={fragment:c.data,index:c.index};const e=c.data.getContentAtIndex(c.index);if(!(e instanceof L)||e.block){const e=c.data.getContentAtIndex(c.index-1);e instanceof N?t=this.findLastPosition(e.slot):e instanceof P?t=this.findLastPosition(e.slots[e.slots.length-1]):e instanceof V?t=this.findLastPosition(e.getSlotAtIndex(e.slotCount-1)):e||(t=this.findFirstPosition(t.fragment))}this.setStart(t.fragment,t.index)}else{const t=c.data;let e;t instanceof P?e=this.findLastPosition(t.slots[Math.max(c.index-1,0)]):t instanceof V&&(e=this.findLastPosition(t.getSlotAtIndex(Math.max(c.index-1,0)))),this.setStart(e.fragment,e.index)}if(h&&this.endFragment!==this.startFragment)if(n){const t=this.getCommonAncestorFragmentScope(),e=t.endFragment.cut(t.endIndex-1);let n=0;const s=e.sliceContents();for(const r of s){if(!(r instanceof L&&!1===r.block||"string"===typeof r))break;n+=r.length}this.endFragment.concat(e.cut(n)),this.startFragment.concat(e)}else this.startFragment.remove(this.startIndex),this.startFragment.concat(this.endFragment),this.deleteEmptyTree(this.endFragment);this.collapse()}deleteEmptyTree(t,e){if(t===e)return t;const n=t.parentComponent;if(!n.parentFragment)return t;if(n instanceof N){const t=n.parentFragment,s=t.indexOf(n);return t.cut(s,s+1),0===t.length?this.deleteEmptyTree(t,e):t}if(n instanceof P){if(n.slots.splice(n.slots.indexOf(t),1),0===n.slots.length){const t=n.parentFragment,s=t.indexOf(n);return t.cut(s,s+1),0===t.length?this.deleteEmptyTree(t,e):t}return n}if(n instanceof V){t.clean();const s=n.canDelete(t);if(s){const t=n.parentFragment,s=t.indexOf(n);return t.cut(s,s+1),0===t.length?this.deleteEmptyTree(t,e):t}return n}return t}collapse(t=!1){return t?this.setStart(this.endFragment,this.endIndex):this.setEnd(this.startFragment,this.startIndex),this}getPreviousPosition(){let t=this.startFragment;if(this.startIndex>0){const e=t.getContentAtIndex(this.startIndex-1);return e instanceof N?this.findLastChild(e.slot):e instanceof P?this.findLastChild(e.slots[e.slots.length-1]):e instanceof V?this.findLastChild(e.getSlotAtIndex(e.slotCount-1)):{fragment:t,index:this.startIndex-1}}const e=t;while(1){const n=t.parentComponent;if(n instanceof P){const e=n.slots.indexOf(t);if(e>0)return this.findLastChild(n.slots[e-1])}if(n instanceof V){const e=n.indexOf(t);if(e>0)return this.findLastChild(n.getSlotAtIndex(e-1))}const s=n.parentFragment;if(!s)return{fragment:e,index:0};const r=s.indexOf(n);if(r>0){const t=s.getContentAtIndex(r-1);return t instanceof N?this.findLastChild(t.slot):t instanceof P?this.findLastChild(t.slots[t.slots.length-1]):t instanceof V?this.findLastChild(t.getSlotAtIndex(t.slotCount-1)):{fragment:s,index:t instanceof K?r-1:r}}t=s}}getNextPosition(){let t=this.endFragment,e=this.endIndex;if(e===t.length-1){const n=t.getContentAtIndex(e);n instanceof K&&e++}if(e<t.length){let n=t.getContentAtIndex(e);return n instanceof K&&(n=t.getContentAtIndex(e+1)),n instanceof N?this.findFirstPosition(n.slot):n instanceof P?this.findFirstPosition(n.slots[0]):n instanceof V?this.findFirstPosition(n.getSlotAtIndex(0)):{fragment:t,index:e+1}}const n=t;while(1){const e=t.parentComponent;if(!e){const t=n.length,e=n.getContentAtIndex(t-1);return{fragment:n,index:e instanceof K?t-1:t}}if(e instanceof P){const n=e.slots.indexOf(t);if(n<e.slots.length-1)return this.findFirstPosition(e.slots[n+1])}if(e instanceof V){const n=e.indexOf(t);if(n<e.slotCount-1)return this.findFirstPosition(e.getSlotAtIndex(n+1))}const s=e.parentFragment;if(!s){const t=n.length,e=n.getContentAtIndex(t-1);return{fragment:n,index:e instanceof K?t-1:t}}const r=s.indexOf(e);if(r<s.length-1){const t=s.getContentAtIndex(r+1);return t instanceof N?this.findFirstPosition(t.slot):t instanceof P?this.findFirstPosition(t.slots[0]):t instanceof V?this.findFirstPosition(t.getSlotAtIndex(0)):{fragment:s,index:r+1}}t=s}}getPreviousLinePosition(t){const e=this.clone();let n,s,r=!1,i=0,o=t,a=this.getRangePosition().top,c=0;while(1){i++,n=e.getPreviousPosition(),e.setPosition(n.fragment,n.index),e.restore();const h=e.getRangePosition();if(!r){if(h.left>o||h.top<a)r=!0;else if(h.left===o&&h.top===a)return n;o=h.left,a=h.top}if(r){if(h.left<t)return n;if(s&&h.left>=c)return s;c=h.left,s=n}if(i>1e4)break}return n||{index:0,fragment:this.startFragment}}getNextLinePosition(t){const e=this.clone();let n,s=!1,r=0,i=t,o=this.getRangePosition().top,a=0;while(1){r++;const c=e.getNextPosition();e.setPosition(c.fragment,c.index),e.restore();const h=e.getRangePosition();if(!s){if(h.left<i||h.top>o)s=!0;else if(h.left===i&&h.top===o)return c;i=h.left,o=h.top,n=c}if(s){if(h.left>t)return n;if(n&&h.left<=a)return n;n=c,a=h.left}if(r>1e4)break}return n||{index:this.endFragment.length,fragment:this.endFragment}}findFirstPosition(t){const e=t.getContentAtIndex(0);if(e instanceof N)return this.findFirstPosition(e.slot);if(e instanceof P){const t=e.slots[0];return this.findFirstPosition(t)}if(e instanceof V){const t=e.getSlotAtIndex(0);return this.findFirstPosition(t)}return{index:0,fragment:t}}findLastPosition(t){const e=t.getContentAtIndex(t.length-1);if(e instanceof N)return this.findLastPosition(e.slot);if(e instanceof P){const t=e.slots[e.slots.length-1];return this.findLastPosition(t)}if(e instanceof V){const t=e.getSlotAtIndex(e.slotCount-1);return this.findLastPosition(t)}return e instanceof K?{index:t.length-1,fragment:t}:{index:t.length,fragment:t}}findLastChild(t){const e=t.getContentAtIndex(t.length-1);if(e instanceof N)return this.findLastChild(e.slot);if(e instanceof P){const t=e.slots[e.slots.length-1];return this.findLastChild(t)}if(e instanceof V){const t=e.getSlotAtIndex(e.slotCount-1);return this.findLastChild(t)}return{index:e instanceof K?t.length-1:t.length,fragment:t}}getRangePosition(){const t=this.nativeRange,{startContainer:e,startOffset:n}=t;if(e.nodeType===Node.ELEMENT_NODE){const t=e.childNodes[n];let s=!1;if(t){if(t.nodeType===Node.ELEMENT_NODE)return t.getBoundingClientRect();s=!0}const r=e.ownerDocument.createElement("span");r.innerText="",r.style.display="inline-block",s?e.insertBefore(r,t):e.appendChild(r);const i=r.getBoundingClientRect();return e.removeChild(r),i}return t.getBoundingClientRect()}deleteSelectedScope(t){return t.reverse().forEach(t=>{if(0===t.startIndex&&t.endIndex===t.fragment.length){const e=t.fragment.parentComponent;if(t.fragment.remove(0),e instanceof V){if(e.canDelete(t.fragment)){const t=e.parentFragment,n=t.indexOf(e);t.remove(n,n+1),0===t.length&&this.deleteEmptyTree(t)}}else t.fragment!==this.startFragment&&t.fragment!==this.endFragment&&this.deleteEmptyTree(t.fragment)}else t.fragment.cut(t.startIndex,t.endIndex)}),this}getScopes(t,e,n,s){const r=[],i=[];let o=null,a=null,c=null,h=null;const u=this.commonAncestorComponent;while(t!==this.commonAncestorFragment){if(u&&o===this.commonAncestorComponent)return;if(r.push({startIndex:n,endIndex:t.length,fragment:t}),o=t.parentComponent,o instanceof P||o instanceof V){const e=o instanceof P?o.slots:Array.from(o),n=e.indexOf(this.endFragment);c=e.indexOf(t),o!==this.commonAncestorComponent&&-1===n&&r.push(...e.slice(c+1,e.length).map(t=>({startIndex:0,endIndex:t.length,fragment:t})))}t=o.parentFragment,n=t.indexOf(o)+1}while(e!==this.commonAncestorFragment){if(u&&a===this.commonAncestorComponent)return;if(a=e.parentComponent,a instanceof P||a instanceof V){const t=a instanceof P?a.slots:Array.from(a),n=t.indexOf(this.startFragment);h=t.indexOf(e),a!==this.commonAncestorComponent&&-1===n&&i.push(...t.slice(0,h).map(t=>({startIndex:0,endIndex:t.length,fragment:t})))}i.push({startIndex:0,endIndex:s,fragment:e}),e=a.parentFragment,s=e.indexOf(a)}const d=[...r];if(o===a&&(o instanceof P||o instanceof V)){const t=(o instanceof P?o.slots:Array.from(o)).slice(c+1,h);d.push(...t.map(t=>({startIndex:0,endIndex:t.length,fragment:t})))}else d.push({startIndex:n,endIndex:s,fragment:this.commonAncestorFragment});return d.push(...i),d.filter(t=>t.startIndex<t.endIndex)}getCommonAncestorFragment(){let t=this.startFragment,e=this.endFragment;if(t===e)return t;const n=[],s=[];while(t){n.push(t);const e=t.parentComponent;if(!e.parentFragment)break;t=e.parentFragment}while(e){s.push(e);const t=e.parentComponent;if(!t.parentFragment)break;e=t.parentFragment}let r=null;while(n.length&&s.length){const t=n.pop(),e=s.pop();if(t!==e)break;r=t}return r}getCommonAncestorComponent(){var t,e;let n=null===(t=this.startFragment)||void 0===t?void 0:t.parentComponent,s=null===(e=this.endFragment)||void 0===e?void 0:e.parentComponent;if(n===s)return n;const r=[],i=[];while(n){r.push(n);const t=n.parentFragment;if(!t)break;n=t.parentComponent}while(s){i.push(s);const t=s.parentFragment;if(!t)break;s=t.parentComponent}let o=null;while(r.length&&i.length){const t=r.pop(),e=i.pop();if(t!==e)break;o=t}return o}findFocusNodeAndOffset(t,e){function n(t,e,s,r){for(const i of e.childNodes){const e=t.getPositionByVDom(i);if(!(r?e.endIndex<s:e.endIndex<=s))return i instanceof _?{node:t.getNativeNodeByVDom(i),offset:s-e.startIndex}:n(t,i,s,r)}}function s(t,e,n){for(const r of e.childNodes){const e=t.getPositionByVDom(r);if(!(e.endIndex<=n)&&r instanceof M){if(e.startIndex===n&&e.endIndex===n+1){const e=t.getNativeNodeByVDom(r),n=e.parentNode;return{node:n,offset:Array.from(n.childNodes).indexOf(e)}}return s(t,r,n)}}}const r=this.renderer.getVElementByFragment(t),i=t.getContentAtIndex(e);if("string"===typeof i){const s=t.getContentAtIndex(e-1);return n(this.renderer,r,e,"string"===typeof s)}if(i instanceof T){const i=t.getContentAtIndex(e-1);if("string"===typeof i)return n(this.renderer,r,e,!0);if(i instanceof L&&!(i instanceof K)){const t=this.renderer.getComponentRootNativeNode(i);return{node:t.parentNode,offset:Array.from(t.parentNode.childNodes).indexOf(t)+1}}return s(this.renderer,r,e)}const o=this.renderer.getNativeNodeByVDom(r),a=o.lastChild;return a.nodeType===Node.TEXT_NODE?{node:a,offset:a.textContent.length}:{node:o,offset:o.childNodes.length}}static findExpandedStartIndex(t,e){const n=t.sliceContents(0,e),s=n.length;for(let r=s-1;r>=0;r--){const t=n[r];if(t instanceof N||t instanceof P||t instanceof V||t instanceof L&&t.block)break;e-=t.length}return e}static findExpandedEndIndex(t,e){const n=t.sliceContents(e);for(let s=0;s<n.length;s++){const t=n[s];if(t instanceof N||t instanceof P||t instanceof V||t instanceof L&&t.block)break;e+=t.length}return e}static findPosition(t,e,n,s){if(t.nodeType===Node.TEXT_NODE)return{fragment:n.fragment,index:n.startIndex+e};if(t.nodeType===Node.ELEMENT_NODE){const n=t.childNodes;if(0===n.length)return null;if(n.length===e){const t=n[n.length-1],e=s.getPositionByNode(t);return e?{fragment:e.fragment,index:e.endIndex}:null}{const t=n[e],r=s.getPositionByNode(t);return r?{fragment:r.fragment,index:r.startIndex}:null}}}}var G,Q=n("a748"),tt=n("17f5"),et=n("c4cc");(function(t){t[t["Left"]=0]="Left",t[t["Right"]=1]="Right",t[t["Up"]=2]="Up",t[t["Down"]=3]="Down"})(G||(G={}));class nt{constructor(t,e,n){this.context=t,this.selectionChange=e,this.renderer=n,this._ranges=[],this.selectionChangeEvent=new b["a"],this.isChanged=!1,this.oldCursorPosition=null,this.nativeSelection=t.getSelection(),this.onChange=Object(Q["a"])(e,this.selectionChangeEvent.asObservable()).pipe(Object(et["a"])(()=>{this.isChanged=!0,this._ranges=[];for(let t=0;t<this.nativeSelection.rangeCount;t++){const e=this.nativeSelection.getRangeAt(t),n=this.findFocusNode(e.startContainer),s=this.findFocusNode(e.endContainer);if(n&&s&&n.parentNode&&s.parentNode){if(n!==e.startContainer){const t=n.nextSibling;t&&t.nodeType===Node.TEXT_NODE?e.setStart(t,0):e.setStart(n.parentNode,Array.from(n.parentNode.childNodes).indexOf(n)+1)}if(s!==e.endContainer){const t=s.nextSibling;t&&t.nodeType===Node.TEXT_NODE?e.setEnd(t,0):e.setEnd(s.parentNode,Array.from(s.parentNode.childNodes).indexOf(s)+1)}this._ranges.push(new Z(e.cloneRange(),this.renderer))}}}))}get rangeCount(){return this._ranges.length}get ranges(){return this._ranges}get commonAncestorFragment(){return this.getCommonFragment()}get commonAncestorComponent(){return this.getCommonComponent()}get firstRange(){return this.ranges[0]||null}get lastRange(){return this.ranges[this.ranges.length-1]||null}get collapsed(){return 1===this.ranges.length&&this.firstRange.collapsed||0===this.ranges.length}restore(){var t,e;this.isChanged=!1,this._ranges.forEach(t=>{t.commonAncestorComponent&&t.restore()});const n=null===(t=this.firstRange)||void 0===t?void 0:t.nativeRange,s=null===(e=this.lastRange)||void 0===e?void 0:e.nativeRange;if(n&&s){let t;this.nativeSelection.rangeCount?t=this.nativeSelection.getRangeAt(0):(t=this.context.createRange(),this.nativeSelection.addRange(t)),t.setStart(n.startContainer,n.startOffset),t.setEnd(s.endContainer,s.endOffset)}this.isChanged||this.selectionChangeEvent.next()}toPrevious(){this.moveCursor(G.Left)}toNext(){this.moveCursor(G.Right)}toPreviousLine(){this.moveCursor(G.Up)}toNextLine(){this.moveCursor(G.Down)}removeAllRanges(t=!1){t&&this.nativeSelection.removeAllRanges(),this._ranges=[]}addRange(t){this._ranges.push(t)}createRange(){return new Z(this.context.createRange(),this.renderer)}clone(){const t=new nt(this.context,Object(tt["a"])(),this.renderer);return t._ranges=this.ranges.map(t=>t.clone()),t}selectAll(){this.nativeSelection.selectAllChildren(this.context.body)}getCommonComponent(){const t=this.ranges||[];if(1===t.length)return t[0].commonAncestorComponent;const e=[];t.map(t=>t.commonAncestorComponent).forEach(t=>{var n;const s=[];while(t)s.push(t),t=null===(n=t.parentFragment)||void 0===n?void 0:n.parentComponent;e.push(s)});let n=null;while(1){const t=e.map(t=>t.pop()).filter(t=>t);if(t.length!==e.length)break;if(1!==new Set(t).size)break;n=t[0]}return n}getCommonFragment(){const t=this.ranges||[];if(1===t.length)return t[0].commonAncestorFragment;const e=[];t.map(t=>t.commonAncestorFragment).forEach(t=>{var n;const s=[];while(t)s.push(t),t=null===(n=t.parentComponent)||void 0===n?void 0:n.parentFragment;e.push(s)});let n=null;while(1){const t=e.map(t=>t.pop()).filter(t=>t);if(t.length===e.length){if(1!==new Set(t).size)break;n=t[0]}}return n}findFocusNode(t){const e=this.renderer.getPositionByNode(t);if(!e){const e=t.parentNode;return e?this.findFocusNode(e):null}return t}moveCursor(t){const e=t===G.Down?this.lastRange:this.firstRange;if(!e)return;let n,s;switch(this.removeAllRanges(),this.addRange(e),t){case G.Left:n=e.getPreviousPosition();break;case G.Right:n=e.getNextPosition();break;case G.Up:if(clearTimeout(this.cleanOldCursorTimer),s=e.clone().restore(),this.oldCursorPosition)n=s.getPreviousLinePosition(this.oldCursorPosition.left);else{const t=s.getRangePosition();this.oldCursorPosition=t,n=e.getPreviousLinePosition(t.left)}this.cleanOldCursorTimer=setTimeout(()=>{this.oldCursorPosition=null},3e3);break;case G.Down:if(clearTimeout(this.cleanOldCursorTimer),s=e.clone().restore(),this.oldCursorPosition)n=s.getNextLinePosition(this.oldCursorPosition.left);else{const t=s.getRangePosition();this.oldCursorPosition=t,n=e.getNextLinePosition(t.left)}this.cleanOldCursorTimer=setTimeout(()=>{this.oldCursorPosition=null},3e3);break}e.setPosition(n.fragment,n.index),this.restore()}}},fe88:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var s=n("9ab4"),r=n("1453"),i=n("4f50");function o(t,e){return void 0===e&&(e=i["a"]),function(n){return n.lift(new a(t,e))}}var a=function(){function t(t,e){this.period=t,this.scheduler=e}return t.prototype.call=function(t,e){return e.subscribe(new c(t,this.period,this.scheduler))},t}(),c=function(t){function e(e,n,s){var r=t.call(this,e)||this;return r.period=n,r.scheduler=s,r.hasValue=!1,r.add(s.schedule(h,n,{subscriber:r,period:n})),r}return s["a"](e,t),e.prototype._next=function(t){this.lastValue=t,this.hasValue=!0},e.prototype.notifyNext=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.lastValue))},e}(r["a"]);function h(t){var e=t.subscriber,n=t.period;e.notifyNext(),this.schedule(t,n)}}}]);
//# sourceMappingURL=chunk-21e49f0c.cbffcf9a.js.map