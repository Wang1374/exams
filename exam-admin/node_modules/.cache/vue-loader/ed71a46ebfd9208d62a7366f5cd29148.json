{"remainingRequest":"/Users/sw/Documents/examSystem/exams/exam-admin/node_modules/vue-loader-v16/dist/index.js??ref--0-1!/Users/sw/Documents/examSystem/exams/exam-admin/src/views/User.vue?vue&type=style&index=0&id=e0b47cf6&scoped=true&lang=css","dependencies":[{"path":"/Users/sw/Documents/examSystem/exams/exam-admin/src/views/User.vue","mtime":1638270666678},{"path":"/Users/sw/Documents/examSystem/exams/exam-admin/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/sw/Documents/examSystem/exams/exam-admin/node_modules/vue-loader-v16/dist/stylePostLoader.js","mtime":499162500000},{"path":"/Users/sw/Documents/examSystem/exams/exam-admin/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/sw/Documents/examSystem/exams/exam-admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/sw/Documents/examSystem/exams/exam-admin/node_modules/vue-loader-v16/dist/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5rZCB7CiAgd2lkdGg6IDEwMCU7CiAgaGVpZ2h0OiAxMDBweDsKfQo="},{"version":3,"sources":["/Users/sw/Documents/examSystem/exams/exam-admin/src/views/User.vue"],"names":[],"mappings":";AAugBA,CAAC,CAAC,EAAE;EACF,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;EACX,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;AACf","file":"/Users/sw/Documents/examSystem/exams/exam-admin/src/views/User.vue","sourceRoot":"","sourcesContent":["<template>\n  <div style=\"padding:10px;\" class=\"kd\">\n    <div style=\"margin: 10px 0\">\n      <!--功能区域-->\n      <el-button @click=\"addUser\">添加</el-button>\n      <el-input v-model=\"search\" placeholder=\"请输入关键词\" style=\"width: 200px;margin-left: 5px\" clearable></el-input>\n      <el-button type=\"primary\" style=\"margin-left: 5px\" @click=\"load\" icon=\"el-icon-search\">查询</el-button>\n    </div>\n    <el-table :data=\"tableData\" border stripe style=\"width: 99%;\" v-loading=\"loading\">\n      <el-table-column :width=\"cloumWidth.id\" label=\"序号\" type=\"index\" show-overflow-tooltip class=\"tableBox\">\n      </el-table-column>\n      <el-table-column prop=\"id\" label=\"ID\" v-if=\"false\">\n      </el-table-column>\n      <el-table-column prop=\"nickName\" label=\"昵称\" :width=\"cloumWidth.nickName\">\n      </el-table-column>\n      <el-table-column prop=\"name\" label=\"姓名\" :width=\"cloumWidth.name\">\n      </el-table-column>\n      <el-table-column prop=\"age\" label=\"年龄\" :width=\"cloumWidth.age\">\n      </el-table-column>\n      <el-table-column prop=\"sex\" label=\"性别\" :width=\"cloumWidth.sex\" :formatter=\"formatterSex\">\n      </el-table-column>\n      <el-table-column prop=\"phone\" label=\"手机号\" :width=\"cloumWidth.phone\">\n      </el-table-column>\n      <el-table-column prop=\"address\" label=\"地址\" :formatter=\"formatterAddress\" :show-overflow-tooltip=\"true\">\n      </el-table-column>\n      <el-table-column prop=\"role\" label=\"角色\" :width=\"cloumWidth.role\" :formatter=\"formatterRole\">\n      </el-table-column>\n      <el-table-column prop=\"useYn\" label=\"状态\" :width=\"cloumWidth.status\">\n        <template v-slot=\"scope\">\n          <el-tag @click=\"useYn(scope.row.id,scope.row.useYn)\" v-if=\"scope.row.useYn===0\" size=\"medium\" type=\"success\">正常</el-tag>\n          <el-tag @click=\"useYn(scope.row.id,scope.row.useYn)\" v-else size=\"medium\" type=\"danger\">禁用</el-tag>\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"registrationTime\" label=\"注册时间\" :width=\"cloumWidth.time\">\n      </el-table-column>\n      <el-table-column label=\"操作\" :width=\"cloumWidth.cz\">\n        <template #default=\"scope\">\n          <el-button size=\"small\" type=\"text\" @click=\"handleEdit(scope.row)\" icon=\"el-icon-edit\">编辑</el-button>\n          <el-popconfirm title=\"你确定要删除吗？\" @confirm=\"handleDelete(scope.row.id)\">\n            <template #reference>\n              <el-button size=\"small\" type=\"text\" icon=\"el-icon-delete\">删除</el-button>\n            </template>\n          </el-popconfirm>\n          <el-button size=\"small\" type=\"text\" @click=\"viewScore(scope.row)\" icon=\"el-icon-data-analysis\">查看成绩</el-button>\n          <el-popconfirm title=\"你确定要重置密码吗？\" @confirm=\"handlePassword(scope.row.phone)\">\n            <template #reference>\n              <el-button size=\"small\" type=\"text\" icon=\"el-icon-refresh-right\">重置密码</el-button>\n            </template>\n          </el-popconfirm>\n        </template>\n      </el-table-column>\n    </el-table>\n    <div style=\"margin: 10px 0\">\n      <el-pagination @size-change=\"handleSizeChange\" @current-change=\"handleCurrentChange\" :current-page=\"currentPage\" :page-sizes=\"[5, 10, 15, 20]\" :page-size=\"pageSize\" layout=\"total, sizes, prev, pager, next, jumper\" :total=\"total\">\n      </el-pagination>\n      <!--弹出框-->\n      <el-dialog :title=\"title\" v-model=\"dialogVisible\" width=\"30%\">\n        <el-form ref=\"form\" :model='form' label-width=\"70px\" :rules=\"rules\">\n          <el-form-item label=\"昵称\" prop=\"nickName\">\n            <el-input v-model=\"form.nickName\" style=\"width: 90%\"></el-input>\n          </el-form-item>\n          <el-form-item label=\"姓名\" prop=\"name\">\n            <el-input v-model=\"form.name\" style=\"width: 90%\"></el-input>\n          </el-form-item>\n          <el-form-item label=\"年龄\" prop=\"age\">\n            <el-input v-model=\"form.age\" style=\"width: 90%\"></el-input>\n          </el-form-item>\n          <el-form-item label=\"性别\">\n            <el-radio v-model=\"form.sex\" :label=\"1\">男</el-radio>\n            <el-radio v-model=\"form.sex\" :label=\"2\">女</el-radio>\n          </el-form-item>\n          <el-form-item label=\"手机号\" prop=\"phone\">\n            <el-input v-model=\"form.phone\" style=\"width: 90%\"></el-input>\n          </el-form-item>\n          <el-form-item label=\"地址\" prop=\"address\">\n            <el-row :gutter=\"20\">\n              <el-col :span=\"12\">\n                <elui-china-area-dht v-model=\"addrValue\"></elui-china-area-dht>\n              </el-col>\n              <el-col :span=\"12\">\n                <el-input v-model=\"form.address\" style=\"width: 90%;margin-left: -10%;\"></el-input>\n              </el-col>\n            </el-row>\n          </el-form-item>\n          <el-form-item label=\"角色\">\n            <el-select v-model=\"form.role\" placeholder=\"请选择\" style=\"width: 90%\">\n              <el-option v-for=\"item in options\" :key=\"item.value\" :label=\"item.label\" :value=\"item.value\">\n              </el-option>\n            </el-select>\n          </el-form-item>\n          <el-form-item label=\"状态\">\n            <el-select v-model=\"form.useYn\" placeholder=\"请选择\" style=\"width: 90%\">\n              <el-option v-for=\"item in useYns\" :key=\"item.value\" :label=\"item.label\" :value=\"item.value\">\n              </el-option>\n            </el-select>\n          </el-form-item>\n        </el-form>\n        <template #footer>\n          <span class=\"dialog-footer\">\n            <el-button @click=\"dialogVisible = false\">取 消</el-button>\n            <el-button type=\"primary\" @click=\"dialog()\">确 定</el-button>\n          </span>\n        </template>\n      </el-dialog>\n    </div>\n  </div>\n</template>\n\n<script>\n// @ is an alias to /src\nimport request from \"@/utils/request\";\nimport { ElMessage } from \"element-plus\";\nimport { defineComponent } from \"vue\"; // 参数取值\nimport { EluiChinaAreaDht } from \"elui-china-area-dht\";\nconst chinaData = new EluiChinaAreaDht.ChinaArea().chinaAreaflat;\nexport default {\n  name: \"Home\",\n  components: {\n    EluiChinaAreaDht,\n  },\n  data() {\n    return {\n      with: 0,\n      //下拉三栏\n      addrValue: [],\n      //加载\n      loading: false,\n      form: {},\n      dialogVisible: false,\n      tableData: [],\n      options: [\n        {\n          value: 2,\n          label: \"学生\",\n        },\n        {\n          value: 1,\n          label: \"老师\",\n        },\n        {\n          value: 0,\n          label: \"管理员\",\n        },\n      ],\n      value: \"\",\n      useYns: [\n        {\n          value: 0,\n          label: \"正常\",\n        },\n        {\n          value: 1,\n          label: \"禁用\",\n        },\n      ],\n      useYnValue: \"\",\n      currentPage: 1,\n      pageSize: 10,\n      total: 0,\n      search: \"\",\n      title: \"提示\",\n      cloumWidth: {\n        id: \"50\",\n        name: \"120\",\n        nickName: \"120\",\n        age: \"50\",\n        sex: \"50\",\n        phone: \"120\",\n        role: \"100\",\n        status: \"70\",\n        time: \"180\",\n        cz: \"200\",\n      },\n      rules: {\n        phone: [\n          { required: true, message: \"请输入手机号\", trigger: \"blur\" },\n          { pattern: /^1[3-9]\\d{9}$/, message: \"手机号格式错误\" },\n        ],\n        name: [\n          { required: true, message: \"请输入真实姓名\", trigger: \"blur\" },\n          { min: 2, max: 18, message: \"请输入2-10位字符\", trigger: \"blur\" },\n        ],\n        nickName: [\n          { required: true, message: \"请输入昵称\", trigger: \"blur\" },\n          { min: 2, max: 18, message: \"请输入2-18位字符\", trigger: \"blur\" },\n        ],\n        age: [\n          { required: true, message: \"请输入年龄\", trigger: \"blur\" },\n          {\n            pattern: /^(?:[1-9][0-9]?|1[01][0-9]|120)$/,\n            message: \"年龄输入不合法\",\n          },\n        ],\n\n        address: [\n          { required: true, message: \"请输入家庭地址\", trigger: \"blur\" },\n          { min: 2, max: 50, message: \"请输入5-50位字符\", trigger: \"blur\" },\n        ],\n      },\n    };\n  },\n  created() {\n    this.with = document.body.clientWidth - 210;\n    this.loading = true;\n    this.load();\n    //初始化表格宽度\n    this.defaultTableWith();\n  },\n  mounted() {\n    this.$nextTick(() => {\n      window.addEventListener(\"resize\", () => {\n        //监听浏览器窗口大小改变\n        //浏览器变化执行动作\n        //初始化表格宽度\n        this.defaultTableWith();\n      });\n    });\n  },\n  methods: {\n    //初始化表格宽度\n    defaultTableWith() {\n      let width = document.body.clientWidth - 241; //表格宽度\n      let kd = [50, 100, 100, 50, 50, 120, 100, 70, 180, 280];\n      let data = this.cloumWidth;\n      var i = 0;\n      for (var key in data) {\n        this.cloumWidth[key] = parseInt((kd[i] / 1295) * width);\n        i++;\n      }\n    },\n    load() {\n      request\n        .get(\"/user/getUserAll\", {\n          params: {\n            pageNumber: this.currentPage,\n            pageSize: this.pageSize,\n            search: this.search,\n          },\n        })\n        .then((ren) => {\n          //判断token是否过期\n          this.isToken(ren);\n          this.tableData = ren.date.records; //初始化表格数据\n          this.total = ren.date.total; //初始化总条数\n          this.loading = false;\n        });\n    },\n    formatterRole(row, column) {\n      if (row.role === 0) {\n        return \"管理员\";\n      } else if (row.role === 1) {\n        return \"老师\";\n      } else {\n        return \"学生\";\n      }\n    },\n    formatterSex(row, column) {\n      return row.sex === 1 ? \"男\" : \"女\";\n    },\n    formatterUseYn(row, column) {\n      return row.useYn === 0 ? \"正常\" : \"禁用\";\n    },\n    formatterAddress(row, column) {\n      const e = row.address.split(\"|\")[0].split(\",\");\n      const addr = row.address.split(\"|\")[1];\n      const province = chinaData[e[0]].label; //省\n      const city = chinaData[e[1]].label; //城市\n      const county = chinaData[e[2]].label; //县\n      return province + city + county + addr;\n    },\n    dialog() {\n      if (this.form.id) {\n        //存在id则更新\n        this.update();\n      } else {\n        this.saveUser();\n      }\n    },\n    //添加用户\n    addUser() {\n      this.title = \"添加用户\";\n      this.dialogVisible = true;\n      if (this.$refs[\"form\"] != undefined) {\n        this.$refs[\"form\"].resetFields();\n      }\n      this.form = {};\n      this.addrValue = [];\n    },\n    //保存用戶\n    saveUser() {\n      //表单验证\n      this.$refs[\"form\"].validate((valid) => {\n        if (valid) {\n          //判断地址是否勾选\n          if (this.addrValue.length == 0) {\n            ElMessage.warning({ message: \"地址未选择!\", type: \"warning\" });\n            return;\n          }\n          //判断性别是否勾选\n          if (this.form.sex == undefined) {\n            ElMessage.warning({ message: \"性别未选择!\", type: \"warning\" });\n            return;\n          }\n          //判断角色是否选择\n          if (this.form.role == undefined) {\n            ElMessage.warning({ message: \"角色未选择!\", type: \"warning\" });\n            return;\n          }\n          //判断状态是否选择\n          if (this.form.useYn == undefined) {\n            ElMessage.warning({ message: \"状态未选择!\", type: \"warning\" });\n            return;\n          }\n\n          const addr = this.addrValue;\n          this.form.address =\n            addr[0] + \",\" + addr[1] + \",\" + addr[2] + \"|\" + this.form.address;\n          request\n            .post(\"/user/save\", this.form)\n            .then((res) => {\n              //判断token是否过期\n              this.isToken(res);\n              if (res.code == 200) {\n                this.dialogVisible = false;\n                ElMessage.success({\n                  message: \"添加成功！\",\n                  type: \"success\",\n                });\n                this.load();\n              } else {\n                ElMessage.warning({\n                  message: res.msg,\n                  type: \"warning\",\n                });\n              }\n            })\n            .catch((res) => {\n              ElMessage.error(\"系统异常,添加失败！\");\n            });\n        }\n      });\n    },\n    handleEdit(row) {\n      this.title = \"编辑用户\";\n      this.dialogVisible = true;\n      this.form = JSON.parse(JSON.stringify(row));\n      this.addrValue = this.form.address.split(\"|\")[0].split(\",\");\n      this.form.address = this.form.address.split(\"|\")[1];\n    },\n    update() {\n      //表单验证\n      this.$refs[\"form\"].validate((valid) => {\n        if (valid) {\n          //判断地址是否勾选\n          if (this.addrValue.length == 0) {\n            ElMessage.warning({ message: \"地址未选择!\", type: \"warning\" });\n            return;\n          }\n          //判断性别是否勾选\n          if (this.form.sex == undefined) {\n            ElMessage.warning({ message: \"性别未选择!\", type: \"warning\" });\n            return;\n          }\n          //判断角色是否选择\n          if (this.form.role == undefined) {\n            ElMessage.warning({ message: \"角色未选择!\", type: \"warning\" });\n            return;\n          }\n          //判断状态是否选择\n          if (this.form.useYn == undefined) {\n            ElMessage.warning({ message: \"状态未选择!\", type: \"warning\" });\n            return;\n          }\n          const addr = this.addrValue;\n          this.form.address =\n            addr[0] + \",\" + addr[1] + \",\" + addr[2] + \"|\" + this.form.address;\n          //更新用户信息\n          request\n            .put(\"/user/updateUser\", this.form)\n            .then((res) => {\n              //判断token是否过期\n              this.isToken(res);\n              if (res.code == 200) {\n                this.dialogVisible = false;\n                ElMessage.success({\n                  message: \"更新成功！\",\n                  type: \"success\",\n                });\n                this.load();\n              } else {\n                ElMessage.warning({\n                  message: res.msg,\n                  type: \"warning\",\n                });\n              }\n            })\n            .catch((res) => {\n              ElMessage.error(\"系统异常,更新失败！\");\n            });\n        }\n      });\n    },\n    handleSizeChange(pageSize) {\n      //改变当前每页的个数触发\n      this.pageSize = pageSize;\n      this.load();\n    },\n    handleCurrentChange(pageNumber) {\n      //改变当前页码触发\n      this.currentPage = pageNumber;\n      this.load();\n    },\n    handleDelete(id) {\n      //删除用户\n      request\n        .delete(\"/user/deleteUser/\" + id)\n        .then((res) => {\n          //判断token是否过期\n          this.isToken(res);\n          if (res.code == 200) {\n            ElMessage.success({\n              message: \"删除成功！\",\n              type: \"success\",\n            });\n            this.load();\n          } else {\n            ElMessage.warning({\n              message: res.msg,\n              type: \"warning\",\n            });\n          }\n        })\n        .catch((res) => {\n          ElMessage.error(\"系统异常,删除失败！\");\n        });\n    },\n    //重置用户密码\n    handlePassword(value) {\n      //加密\n      const phone = this.$encryption(value);\n      request\n        .put(\"/user/resetPassword\", phone)\n        .then((res) => {\n          //判断token是否过期\n          this.isToken(res);\n          if (res.code == 200) {\n            ElMessage.success({\n              message: \"重置密码成功！\",\n              type: \"success\",\n            });\n          } else {\n            ElMessage.warning({\n              message: res.msg,\n              type: \"warning\",\n            });\n          }\n        })\n        .catch((res) => {\n          ElMessage.error(\"系统异常,重置密码失败！\");\n        });\n    },\n    useYn(id, yn) {\n      let j = 0;\n      if (yn == 0) {\n        j = 1;\n      }\n      let data = this.tableData;\n      for (let i = 0; i < data.length; i++) {\n        if (data[i].id == id) {\n          this.tableData[i].useYn = j;\n          this.updateUseYn(id, j);\n        }\n      }\n    },\n    updateUseYn(id, yn) {\n      //更新试卷状态\n      request\n        .post(\"/user/updateUserYn/\" + id + \"/\" + yn)\n        .then((res) => {\n          //判断token是否过期\n          this.isToken(res);\n          if (res.code == 200) {\n            ElMessage.success({\n              message: \"更新成功！\",\n              type: \"success\",\n            });\n            this.load();\n          } else {\n            ElMessage.warning({\n              message: res.msg,\n              type: \"warning\",\n            });\n          }\n        })\n        .catch((res) => {\n          ElMessage.error(\"系统异常,更新失败！\");\n        });\n    },\n    viewScore(row) {\n      //查看成绩\n      this.$router.push(\"/viewStudentScoreList\");\n      const userId = this.$encryption(JSON.stringify(row.id));\n      sessionStorage.setItem(\"userId\", userId);\n    },\n    isToken(res) {\n      if (res === \"\") {\n        ElMessage.error(\"token已过期,请重新登录!\");\n        //清空token\n        localStorage.removeItem(\"token\");\n        //清除session\n        sessionStorage.removeItem(\"phone\");\n        //跳转登录页面\n        this.$router.push(\"/\");\n      }\n    },\n  },\n};\n</script>\n<style scoped>\n.kd {\n  width: 100%;\n  height: 100px;\n}\n</style>\n<style lang=\"scss\">\n</style>"]}]}