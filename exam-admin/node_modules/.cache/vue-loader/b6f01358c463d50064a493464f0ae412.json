{"remainingRequest":"G:\\exams\\exam-admin\\node_modules\\vue-loader-v16\\dist\\index.js??ref--0-1!G:\\exams\\exam-admin\\src\\views\\MenuAll.vue?vue&type=style&index=0&id=36c933b9&scoped=true&lang=css","dependencies":[{"path":"G:\\exams\\exam-admin\\src\\views\\MenuAll.vue","mtime":1637309029548},{"path":"G:\\exams\\exam-admin\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\exams\\exam-admin\\node_modules\\vue-loader-v16\\dist\\stylePostLoader.js","mtime":499162500000},{"path":"G:\\exams\\exam-admin\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"G:\\exams\\exam-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\exams\\exam-admin\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5rZCB7CiAgd2lkdGg6IDEwMCU7Cn0K"},{"version":3,"sources":["G:\\exams\\exam-admin\\src\\views\\MenuAll.vue"],"names":[],"mappings":";AAoeA,CAAC,CAAC,EAAE;EACF,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;AACb","file":"G:/exams/exam-admin/src/views/MenuAll.vue","sourceRoot":"","sourcesContent":["<template>\n  <div style=\"padding:10px;\" class=\"kd\">\n    <div style=\"margin: 10px 0\">\n      <!--功能区域-->\n      <el-button @click=\"addMenu\">添加</el-button>\n      <el-input v-model=\"search\" placeholder=\"请输入名称\" style=\"width: 200px;margin-left: 5px\" clearable></el-input>\n      <el-button type=\"primary\" style=\"margin-left: 5px\" @click=\"load\" icon=\"el-icon-search\">查询</el-button>\n    </div>\n    <el-table :data=\"tableData\" stripe style=\"width: 99%\" row-key=\"id\" v-loading=\"loading\" element-loading-text=\"拼命加载中\" :tree-props=\"{children: 'menu', hasChildren: false }\">\n      <el-table-column :width=\"cloumWidth.id\" label=\"序号\" type=\"index\" shows-overflow-tooltip>\n      </el-table-column>\n      <el-table-column prop=\"id\" label=\"ID\" v-if=\"false\">\n      </el-table-column>\n      <el-table-column prop=\"title\" label=\"名称\" :width=\"cloumWidth.title\">\n      </el-table-column>\n      <el-table-column prop=\"icon\" label=\"图标\" :width=\"cloumWidth.icon\">\n        <template v-slot=\"scope\">\n          <i :class=\"scope.row.icon || ''\"></i>\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"type\" label=\"类型\" :width=\"cloumWidth.type\">\n        <template v-slot=\"scope\">\n          <el-tag v-if=\"scope.row.type===0\" size=\"medium\" type=\"info\">目录</el-tag>\n          <el-tag v-else size=\"medium\" type=\"success\">菜单</el-tag>\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"shows\" label=\"是否显示\" :width=\"cloumWidth.shows\">\n        <template v-slot=\"scope\">\n          <el-switch v-model=\"scope.row.shows\" active-color=\"#13ce66\" inactive-color=\"#ff4949\" @change=\"editActive(scope.row)\"></el-switch>\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"priority\" label=\"排序\" :width=\"cloumWidth.priority\">\n      </el-table-column>\n      <el-table-column prop=\"menus\" label=\"上级菜单\" :width=\"cloumWidth.menus\">\n      </el-table-column>\n      <el-table-column prop=\"role\" label=\"访问权限\" :width=\"cloumWidth.role\">\n        <template v-slot=\"scope\">\n          <el-tag v-if=\"scope.row.role===0\" size=\"medium\" type=\"danger\">管理员</el-tag>\n          <el-tag v-else-if=\"scope.row.role===1\" size=\"medium\" type=\"primary\">教师</el-tag>\n          <el-tag v-else-if=\"scope.row.role===2\" size=\"medium\" type=\"info\">学生</el-tag>\n          <el-tag v-else size=\"medium\" type=\"success\">所有者</el-tag>\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"url\" label=\"URL\" :width=\"cloumWidth.url\">\n      </el-table-column>\n      <el-table-column prop=\"name\" label=\"路由名称\" :width=\"cloumWidth.name\">\n      </el-table-column>\n      <el-table-column label=\"操作\" :width=\"cloumWidth.cz\">\n        <template #default=\"scope\">\n          <el-button size=\"small\" type=\"text\" @click=\"handleEdit(scope.row)\" icon=\"el-icon-edit\">编辑</el-button>\n          <el-popconfirm title=\"你确定要删除吗？\" @confirm=\"handleDelete(scope.row.id)\">\n            <template #reference>\n              <el-button size=\"small\" type=\"text\" icon=\"el-icon-delete\">删除</el-button>\n            </template>\n          </el-popconfirm>\n        </template>\n      </el-table-column>\n    </el-table>\n    <div style=\"margin: 10px 0\">\n      <!--弹出框-->\n      <el-dialog :title=\"title\" v-model=\"dialogVisible\" width=\"35%\">\n        <el-tabs v-model=\"activeName\" type=\"card\" @tab-click=\"handleClick\">\n          <el-tab-pane label=\"目录\" name=\"catalogue\">\n            <el-form ref=\"catalogueForm\" :model='catalogueForm' label-width=\"80px\" :rules=\"catalogue\">\n              <el-form-item label=\"目录名称\" prop=\"title\">\n                <el-input v-model=\"catalogueForm.title\" style=\"width: 90%\"></el-input>\n              </el-form-item>\n              <el-form-item label=\"目录图标\" prop=\"icon\">\n                <el-input v-model=\"catalogueForm.icon\" style=\"width: 90%\"></el-input>\n              </el-form-item>\n              <el-form-item label=\"目录显示\" prop=\"shows\">\n                <el-switch v-model=\"catalogueForm.shows\" active-color=\"#13ce66\" inactive-color=\"#ff4949\" style=\"width: 90%\"></el-switch>\n              </el-form-item>\n              <el-form-item label=\"目录排序\" prop=\"priority\">\n                <el-input-number v-model=\"catalogueForm.priority\" style=\"width: 90%\"></el-input-number>\n              </el-form-item>\n              <el-form-item label=\"目录权限\" prop=\"role\">\n                <el-select v-model=\"catalogueForm.role\" placeholder=\"请选择\" style=\"width: 90%\">\n                  <el-option v-for=\"item in options\" :key=\"item.value\" :label=\"item.label\" :value=\"item.value\">\n                  </el-option>\n                </el-select>\n              </el-form-item>\n            </el-form>\n          </el-tab-pane>\n          <el-tab-pane label=\"菜单\" name=\"menu\">\n            <el-form ref=\"menuForm\" :model='menuForm' label-width=\"80px\" :rules=\"menu\">\n              <el-form-item label=\"菜单名称\" prop=\"title\">\n                <el-input v-model=\"menuForm.title\" style=\"width: 90%\"></el-input>\n              </el-form-item>\n              <el-form-item label=\"上级目录\" prop=\"parentId\">\n                <el-select v-model=\"menuForm.parentId\" placeholder=\"请选择\" style=\"width: 90%\">\n                  <el-option v-for=\"item in catalogues\" :key=\"item.value\" :label=\"item.label\" :value=\"item.value\">\n                  </el-option>\n                </el-select>\n              </el-form-item>\n              <el-form-item label=\"菜单URL\" prop=\"url\">\n                <el-input v-model=\"menuForm.url\" style=\"width: 90%\"></el-input>\n              </el-form-item>\n              <el-form-item label=\"路由名称\" prop=\"name\">\n                <el-input v-model=\"menuForm.name\" style=\"width: 90%\"></el-input>\n              </el-form-item>\n              <el-form-item label=\"菜单显示\" prop=\"shows\">\n                <el-switch v-model=\"menuForm.shows\" active-color=\"#13ce66\" inactive-color=\"#ff4949\" style=\"width: 90%\"></el-switch>\n              </el-form-item>\n              <el-form-item label=\"菜单排序\" prop=\"priority\">\n                <el-input-number v-model=\"menuForm.priority\" style=\"width: 90%\"></el-input-number>\n              </el-form-item>\n              <el-form-item label=\"菜单权限\" prop=\"role\">\n                <el-select v-model=\"menuForm.role\" placeholder=\"请选择\" style=\"width: 90%\">\n                  <el-option v-for=\"item in options\" :key=\"item.value\" :label=\"item.label\" :value=\"item.value\">\n                  </el-option>\n                </el-select>\n              </el-form-item>\n            </el-form>\n          </el-tab-pane>\n        </el-tabs>\n        <template #footer>\n          <span class=\"dialog-footer\">\n            <el-button @click=\"dialogVisible = false\">取 消</el-button>\n            <el-button type=\"primary\" @click=\"dialog()\">确 定</el-button>\n          </span>\n        </template>\n      </el-dialog>\n    </div>\n  </div>\n</template>\n\n<script>\n// @ is an alias to /src\nimport request from \"@/utils/request\";\nimport { ElMessage } from \"element-plus\";\nexport default {\n  inject: [\"flushAside\"],\n  name: \"MenuAll\",\n  components: {},\n  data() {\n    return {\n      activeName: \"catalogue\",\n      loading: false,\n      catalogueForm: {},\n      catalogues: [],\n      menuForm: {},\n      dialogVisible: false,\n      tableData: [],\n      useYnValue: \"\",\n      currentPage: 1,\n      pageSize: 10,\n      search: \"\",\n      cloumWidth: {\n        id: \"50\",\n        title: \"120\",\n        icon: \"40\",\n        type: \"50\",\n        shows: \"100\",\n        priority: \"170\",\n        menus: \"100\",\n        role: \"70\",\n        url: \"70\",\n        name: \"70\",\n        cz: \"180\",\n      },\n      options: [\n        {\n          value: 3,\n          label: \"所有者\",\n        },\n        {\n          value: 2,\n          label: \"学生\",\n        },\n        {\n          value: 1,\n          label: \"老师\",\n        },\n        {\n          value: 0,\n          label: \"管理员\",\n        },\n      ],\n      catalogue: {\n        title: [\n          { required: true, message: \"请输入目录名称\", trigger: \"blur\" },\n          { min: 2, max: 10, message: \"请输入2-10位字符\", trigger: \"blur\" },\n        ],\n        icon: [{ required: true, message: \"请输入图标代码\", trigger: \"blur\" }],\n        priority: [\n          { required: true, message: \"请输入目录排序序号\", trigger: \"blur\" },\n        ],\n        role: [\n          { required: true, message: \"请选择目录权限所属者\", trigger: \"blur\" },\n        ],\n      },\n      menu: {\n        title: [\n          { required: true, message: \"请输入菜单名称\", trigger: \"blur\" },\n          { min: 2, max: 10, message: \"请输入2-10位字符\", trigger: \"blur\" },\n        ],\n        parentId: [\n          { required: true, message: \"请选择上级目录\", trigger: \"blur\" },\n        ],\n        name: [{ required: true, message: \"请输入路由名称\", trigger: \"blur\" }],\n        url: [{ required: true, message: \"请输入菜单URL\", trigger: \"blur\" }],\n        priority: [\n          { required: true, message: \"请输入菜单排序序号\", trigger: \"blur\" },\n        ],\n        role: [\n          { required: true, message: \"请选择菜单权限所属者\", trigger: \"blur\" },\n        ],\n      },\n    };\n  },\n  created() {\n    this.load();\n    this.defaultTableWith();\n  },\n  mounted() {\n    this.$nextTick(() => {\n      window.addEventListener(\"resize\", () => {\n        //监听浏览器窗口大小改变\n        //浏览器变化执行动作\n        //初始化表格宽度\n        this.defaultTableWith();\n      });\n    });\n  },\n  methods: {\n    //初始化表格宽度\n    defaultTableWith() {\n      let width = document.body.clientWidth - 241; //表格宽度\n      let kd = [50, 140, 60, 80, 80, 80, 100, 120, 200, 200, 170];\n      let data = this.cloumWidth;\n      var i = 0;\n      for (var key in data) {\n        this.cloumWidth[key] = parseInt((kd[i] / 1295) * width);\n        i++;\n      }\n    },\n    load() {\n      this.loading = true;\n      if (!this.search) {\n        this.search = null;\n      }\n      request\n        .get(\"/menu/getMenuAll/\" + this.search)\n        .then((res) => {\n          //判断token是否过期\n          this.isToken(res);\n          if (res.code == 200) {\n            //封装数据\n            const menuData = [];\n            res.date.forEach((item) => {\n              const list = [];\n              item.menu.forEach((value) => {\n                //拿到菜单列表\n                list.push({\n                  id: value.listId,\n                  title: value.listTitle,\n                  icon: \"\",\n                  type: 1,\n                  shows: value.listShow,\n                  priority: value.listPriority,\n                  role: value.listRole,\n                  url: value.url,\n                  menus: item.menuTitle,\n                  name: value.name,\n                  parentId: item.menuId,\n                });\n              });\n              menuData.push({\n                id: item.menuId,\n                title: item.menuTitle,\n                icon: item.icon,\n                type: 0,\n                shows: item.menuShow,\n                priority: item.menuPriority,\n                role: item.menuRole,\n                url: \"\",\n                menus: \"\",\n                name: \"\",\n                menu: list,\n              });\n              //封装上级目录\n              this.catalogues.push({\n                value: item.menuId,\n                label: item.menuTitle,\n              });\n            });\n            //打印最终数据\n            this.tableData = menuData;\n          } else {\n            ElMessage.warning({\n              message: res.msg,\n              type: \"warning\",\n            });\n          }\n        })\n        .catch((res) => {\n          ElMessage.error(\"系统异常,获取数据失败！\");\n        });\n      this.loading = false;\n    },\n    addMenu() {\n      this.title = \"添加\";\n      this.dialogVisible = true;\n      //更新前清空数据\n      if (this.$refs.catalogueForm) {\n        this.catalogueForm = {};\n        this.$refs.catalogueForm.resetFields();\n      }\n      if (this.$refs.menuForm) {\n        this.menuForm = {};\n        this.$refs.menuForm.resetFields();\n      }\n    },\n    dialog() {\n      if (this.catalogueForm.id) {\n        //存在id则更新\n        this.$refs[\"catalogueForm\"].validate((valid) => {\n          if (valid) {\n            if (!this.catalogueForm.shows) {\n              this.catalogueForm.shows = false;\n            }\n            this.catalogueForm.level = 1;\n            this.update(this.catalogueForm);\n          }\n        });\n      } else {\n        this.$refs[\"catalogueForm\"].validate((valid) => {\n          if (valid) {\n            //新增目录\n            if (!this.catalogueForm.shows) {\n              this.catalogueForm.shows = false;\n            }\n            this.catalogueForm.level = 1;\n            this.add(this.catalogueForm);\n          }\n        });\n      }\n\n      if (this.menuForm.id) {\n        //存在id则更新\n        this.$refs[\"menuForm\"].validate((valid) => {\n          if (valid) {\n            if (!this.menuForm.shows) {\n              this.menuForm.shows = false;\n            }\n            this.menuForm.level = 2;\n            this.update(this.menuForm);\n          }\n        });\n      } else {\n        this.$refs[\"menuForm\"].validate((valid) => {\n          if (valid) {\n            if (!this.menuForm.shows) {\n              this.menuForm.shows = false;\n            }\n            this.menuForm.level = 2;\n            this.add(this.menuForm);\n          }\n        });\n      }\n    },\n    //新增目录\n    add(value) {\n      this.dialogVisible = false;\n      request\n        .post(\"/menu/add\", value)\n        .then((res) => {\n          //判断token是否过期\n          this.isToken(res);\n          if (res.code == 200) {\n            this.dialogVisible = false;\n            ElMessage.success({\n              message: \"添加成功！\",\n              type: \"success\",\n            });\n            this.load();\n            this.flushAside();\n          } else {\n            ElMessage.warning({\n              message: res.msg,\n              type: \"warning\",\n            });\n          }\n        })\n        .catch((res) => {\n          ElMessage.error(\"系统异常,添加失败！\");\n        });\n    },\n    update(value) {\n      this.dialogVisible = false;\n      //更新数据\n      request\n        .put(\"/menu/update\", value)\n        .then((res) => {\n          //判断token是否过期\n          this.isToken(res);\n          if (res.code == 200) {\n            ElMessage.success({\n              message: \"更新成功！\",\n              type: \"success\",\n            });\n            this.load();\n            this.flushAside();\n          } else {\n            ElMessage.warning({\n              message: res.msg,\n              type: \"warning\",\n            });\n          }\n        })\n        .catch((res) => {\n          ElMessage.error(\"系统异常,更新失败！\");\n        });\n    },\n    handleDelete(id) {\n      //删除数据\n      request\n        .delete(\"/menu/delete/\" + id)\n        .then((res) => {\n          //判断token是否过期\n          this.isToken(res);\n          if (res.code == 200) {\n            ElMessage.success({\n              message: \"删除成功！\",\n              type: \"success\",\n            });\n            this.load();\n            this.flushAside();\n          } else {\n            ElMessage.warning({\n              message: res.msg,\n              type: \"warning\",\n            });\n          }\n        })\n        .catch((res) => {\n          ElMessage.error(\"系统异常,删除失败！\");\n        });\n    },\n    handleEdit(row) {\n      //更新前清空数据\n      if (this.$refs.catalogueForm) {\n        this.catalogueForm = {};\n        this.$refs.catalogueForm.resetFields();\n      }\n      if (this.$refs.menuForm) {\n        this.menuForm = {};\n        this.$refs.menuForm.resetFields();\n      }\n      this.title = \"修改\";\n      this.dialogVisible = true;\n      //判断是目录还是菜单\n      const type = row.type;\n      if (type == 0) {\n        //切换到目录\n        this.activeName = \"catalogue\";\n        //封装数据\n        this.catalogueForm = JSON.parse(JSON.stringify(row));\n      } else {\n        //切换到菜单\n        this.activeName = \"menu\";\n        //封装数据\n        this.menuForm = JSON.parse(JSON.stringify(row));\n      }\n    },\n    editActive(row) {\n      this.update(row);\n    },\n    isToken(res) {\n      if (res === \"\") {\n        ElMessage.error(\"token已过期,请重新登录!\");\n        //清空token\n        localStorage.removeItem(\"token\");\n        //清除session\n        sessionStorage.removeItem(\"phone\");\n        //跳转登录页面\n        this.$router.push(\"/\");\n      }\n    },\n  },\n};\n</script>\n<style scoped>\n.kd {\n  width: 100%;\n}\n</style>"]}]}