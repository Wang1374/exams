{"remainingRequest":"G:\\exams\\exam-admin\\node_modules\\vue-loader-v16\\dist\\index.js??ref--0-1!G:\\exams\\exam-admin\\src\\views\\UserInfo.vue?vue&type=style&index=0&id=7531dfe3&scoped=true&lang=css","dependencies":[{"path":"G:\\exams\\exam-admin\\src\\views\\UserInfo.vue","mtime":1637565898357},{"path":"G:\\exams\\exam-admin\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\exams\\exam-admin\\node_modules\\vue-loader-v16\\dist\\stylePostLoader.js","mtime":499162500000},{"path":"G:\\exams\\exam-admin\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"G:\\exams\\exam-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\exams\\exam-admin\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5jYXJkLWhlYWRlciB7CiAgZGlzcGxheTogZmxleDsKICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKfQoKLnRleHQgewogIGZvbnQtc2l6ZTogMTRweDsKfQoKLml0ZW0gewogIG1hcmdpbi1ib3R0b206IDE4cHg7Cn0KCi5ib3gtY2FyZCB7CiAgd2lkdGg6IDEwMCU7Cn0K"},{"version":3,"sources":["G:\\exams\\exam-admin\\src\\views\\UserInfo.vue"],"names":[],"mappings":";AA+PA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;EACX,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;EACb,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;EAC9B,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AACrB;;AAEA,CAAC,CAAC,CAAC,CAAC,EAAE;EACJ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;AACjB;;AAEA,CAAC,CAAC,CAAC,CAAC,EAAE;EACJ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;AACrB;;AAEA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;EACR,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;AACb","file":"G:/exams/exam-admin/src/views/UserInfo.vue","sourceRoot":"","sourcesContent":[" \n<template>\n  <el-dialog title=\"修改密码\" v-model=\"centerDialogVisible\" width=\"40%\">\n    <el-form :model=\"fromPassword\" :rules=\"rules\" label-width=\"80px\">\n      <el-form-item label=\"旧密码\" prop=\"oldPassWord\">\n        <el-input v-model=\"fromPassword.oldPassWord\" style=\"width: 80%\" show-password></el-input>\n      </el-form-item>\n      <el-form-item label=\"新密码\" prop=\"newPassWord\">\n        <el-input v-model=\"fromPassword.newPassWord\" style=\"width: 80%\" show-password></el-input>\n      </el-form-item>\n      <el-form-item label=\"确认密码\" prop=\"checkPassword\">\n        <el-input v-model=\"fromPassword.checkPassword\" style=\"width: 80%\" show-password></el-input>\n      </el-form-item>\n    </el-form>\n    <template #footer>\n      <span class=\"dialog-footer\">\n        <el-button @click=\"centerDialogVisible = false,cancel()\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"centerDialogVisible = false,updatePass()\">确 定</el-button>\n      </span>\n    </template>\n  </el-dialog>\n  <el-card class=\"box-card\" style=\"margin:10px;\">\n    <template #header>\n      <div style=\"text-align: center\">\n        个人信息 | {{userType}}\n      </div>\n    </template>\n    <el-form ref=\"form\" :model=\"form\" :rules=\"rules\" label-width=\"80px\">\n      <el-form-item label=\"手机号\">\n        <el-input v-model=\"form.phone\" disabled></el-input>\n      </el-form-item>\n      <el-form-item label=\"姓名\">\n        <el-input v-model=\"form.nickName\" disabled></el-input>\n      </el-form-item>\n      <el-form-item label=\"昵称\" prop=\"name\">\n        <el-input v-model=\"form.name\"></el-input>\n      </el-form-item>\n      <el-form-item label=\"年龄\" prop=\"age\">\n        <el-input v-model=\"form.age\"></el-input>\n      </el-form-item>\n      <el-form-item label=\"性别\">\n        <el-radio v-model=\"form.sex\" :label=\"1\">男</el-radio>\n        <el-radio v-model=\"form.sex\" :label=\"2\">女</el-radio>\n      </el-form-item>\n      <el-form-item label=\"地址\" prop=\"address\">\n        <elui-china-area-dht @change=\"onChange\" v-model=\"value\" style=\"width: 17%;\"></elui-china-area-dht>\n        <el-input style=\"width: 83%;\" v-model=\"form.address\"></el-input>\n      </el-form-item>\n    </el-form>\n    <div style=\"text-align:center\">\n      <el-button type=\"primary\" @click=\"updateUser()\">保存信息</el-button>\n      <el-button type=\"primary\" @click=\"updatePassword()\">修改密码</el-button>\n    </div>\n  </el-card>\n</template>\n\n<script>\nimport request from \"@/utils/request\";\nimport { ElMessage } from \"element-plus\";\nimport { inject } from \"@vue/runtime-core\";\nimport { defineComponent } from \"vue\"; // 参数取值\nimport { EluiChinaAreaDht } from \"elui-china-area-dht\";\nconst chinaData = new EluiChinaAreaDht.ChinaArea().chinaAreaflat;\nexport default {\n  inject: [\"reload\"],\n  name: \"userInfo\",\n  components: { EluiChinaAreaDht },\n  data() {\n    return {\n      value: [],\n      form: {},\n      fromPassword: {\n        phone: \"\",\n        oldPassWord: \"\",\n        newPassWord: \"\",\n        checkPassword: \"\",\n      },\n      userType: \"\",\n      rules: {\n        name: [\n          { required: true, message: \"请输入昵称\", trigger: \"blur\" },\n          { min: 2, max: 18, message: \"请输入2-18位字符\", trigger: \"blur\" },\n        ],\n        age: [\n          { required: true, message: \"请输入年龄\", trigger: \"blur\" },\n          {\n            pattern: /^(?:[1-9][0-9]?|1[01][0-9]|120)$/,\n            message: \"年龄输入不合法\",\n          },\n        ],\n        address: [\n          { required: true, message: \"请输入家庭地址\", trigger: \"blur\" },\n          { min: 2, max: 18, message: \"请输入5-50位字符\", trigger: \"blur\" },\n        ],\n        oldPassWord: [\n          { required: true, message: \"请输入密码\", trigger: \"blur\" },\n          {\n            pattern:\n              /^(?![a-zA-Z]+$)(?![0-9]+$)(?![._~!@#$^&*]+$)(?![0-9a-zA-Z]+$)(?![0-9._~!@#$^&*]+$)(?![a-zA-Z._~!@#$^&*]+$)[A-Za-z0-9._~!@#$^&*]{6,20}$/,\n            message: \"密码必须由字母、数字、特殊符号组成6-20位字符，区分大小写\",\n          },\n        ],\n        newPassWord: [\n          { required: true, message: \"请输入密码\", trigger: \"blur\" },\n          {\n            pattern:\n              /^(?![a-zA-Z]+$)(?![0-9]+$)(?![._~!@#$^&*]+$)(?![0-9a-zA-Z]+$)(?![0-9._~!@#$^&*]+$)(?![a-zA-Z._~!@#$^&*]+$)[A-Za-z0-9._~!@#$^&*]{6,20}$/,\n            message: \"密码必须由字母、数字、特殊符号组成6-20位字符，区分大小写\",\n          },\n        ],\n        checkPassword: [\n          { required: true, message: \"请输入密码\", trigger: \"blur\" },\n          {\n            pattern:\n              /^(?![a-zA-Z]+$)(?![0-9]+$)(?![._~!@#$^&*]+$)(?![0-9a-zA-Z]+$)(?![0-9._~!@#$^&*]+$)(?![a-zA-Z._~!@#$^&*]+$)[A-Za-z0-9._~!@#$^&*]{6,20}$/,\n            message: \"密码必须由字母、数字、特殊符号组成6-20位字符，区分大小写\",\n          },\n        ],\n      },\n      centerDialogVisible: false,\n    };\n  },\n  created() {\n    let phone = sessionStorage.getItem(\"phone\");\n    this.load(phone);\n  },\n  methods: {\n    load(phone) {\n      request.post(\"/user/getUserByPhone\",phone).then((res) => {\n        this.form = res.date;\n        let addr = res.date.address;\n        this.form.address = addr.split(\"|\")[1];\n        let city = addr.split(\"|\")[0];\n        this.value = city.split(\",\");\n        if (this.form.role == \"0\") {\n          this.userType = \"管理员\";\n        } else if (this.form.role == \"1\") {\n          this.userType = \"老师\";\n        } else {\n          this.userType = \"学生\";\n        }\n      });\n    },\n    updateUser() {\n      if (this.value.length < 1) {\n        ElMessage.warning({ message: \"地址未选择!\", type: \"warning\" });\n        return;\n      }\n      //校验表单是否正确\n      this.$refs[\"form\"].validate((valid) => {\n        if (valid) {\n          //补全地址信息\n          let addr = this.value;\n          this.form.address =\n            addr[0] + \",\" + addr[1] + \",\" + addr[2] + \"|\" + this.form.address;\n          //更新用户信息\n          request\n            .put(\"/user/updateUser\", this.form)\n            .then((res) => {\n              //判断token是否过期\n              this.isToken(res);\n              if (res.code == 200) {\n                ElMessage.success({\n                  message: \"更新成功！\",\n                  type: \"success\",\n                });\n                //刷新数据\n                sessionStorage.removeItem(\"user\"); //初始化清除session\n                sessionStorage.setItem(\"user\", JSON.stringify(res.date));\n                //刷新页面\n                this.reload();\n              } else {\n                ElMessage.warning({\n                  message: res.msg,\n                  type: \"warning\",\n                });\n              }\n            })\n            .catch((res) => {\n              ElMessage.error(\"系统异常,更新失败！\");\n            });\n        }\n      });\n    },\n    updatePassword() {\n      this.centerDialogVisible = true;\n      this.cancel();\n    },\n    cancel() {\n      this.fromPassword = {};\n    },\n    updatePass() {\n      //判断密码是否为空\n      let oldPassWord = this.fromPassword.oldPassWord;\n      let newPassWord = this.fromPassword.newPassWord;\n      let checkPassword = this.fromPassword.checkPassword;\n      this.fromPassword.phone = this.form.phone;\n      if (\n        oldPassWord === undefined ||\n        newPassWord === undefined ||\n        checkPassword === undefined ||\n        oldPassWord === \"\" ||\n        newPassWord === \"\" ||\n        checkPassword === \"\"\n      ) {\n        return false;\n      }\n      //判断两个密码是否一致\n      if (this.fromPassword.newPassWord != this.fromPassword.checkPassword) {\n        return false;\n      }\n      //判断密码是否重复\n\n      request\n        .put(\"/user/updatePass\", this.fromPassword)\n        .then((res) => {\n          //判断token是否过期\n          this.isToken(res);\n          if (res.code == 200) {\n            ElMessage.success({\n              message: \"密码修改成功,请重新登录！\",\n              type: \"success\",\n            });\n            this.logOut();\n          } else {\n            ElMessage.warning({\n              message: res.msg,\n              type: \"warning\",\n            });\n          }\n        })\n        .catch((res) => {\n          ElMessage.error(\"系统异常,修改失败！\");\n        });\n    },\n    logOut() {\n      //退出系统\n      //清空token\n      localStorage.removeItem(\"token\");\n      //清除session\n      sessionStorage.removeItem(\"phone\");\n      //跳转登录页面\n      this.$router.push(\"/\");\n    },\n    isToken(res) {\n      if (res === \"\") {\n        ElMessage.error(\"token已过期,请重新登录!\");\n        this.logOut();\n      }\n    },\n  },\n};\n</script>\n\n<style scoped>\n.card-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.text {\n  font-size: 14px;\n}\n\n.item {\n  margin-bottom: 18px;\n}\n\n.box-card {\n  width: 100%;\n}\n</style>\n"]}]}